!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=65)}([function(e,t){e.exports=require("path")},function(e,t,n){var r=n(5),i=n(33),o=n(35),a=n(37),s=[],c=n(38);var l,u,d=function(){};function h(e){i(e),e.gracefulify=h,e.FileReadStream=d,e.FileWriteStream=g,e.createReadStream=function(e,t){return new d(e,t)},e.createWriteStream=function(e,t){return new g(e,t)};var t=e.readFile;e.readFile=function(e,n,r){"function"==typeof n&&(r=n,n=null);return function e(n,r,i){return t(n,r,(function(t){!t||"EMFILE"!==t.code&&"ENFILE"!==t.code?("function"==typeof i&&i.apply(this,arguments),f()):p([e,[n,r,i]])}))}(e,n,r)};var n=e.writeFile;e.writeFile=function(e,t,r,i){"function"==typeof r&&(i=r,r=null);return function e(t,r,i,o){return n(t,r,i,(function(n){!n||"EMFILE"!==n.code&&"ENFILE"!==n.code?("function"==typeof o&&o.apply(this,arguments),f()):p([e,[t,r,i,o]])}))}(e,t,r,i)};var r=e.appendFile;r&&(e.appendFile=function(e,t,n,i){"function"==typeof n&&(i=n,n=null);return function e(t,n,i,o){return r(t,n,i,(function(r){!r||"EMFILE"!==r.code&&"ENFILE"!==r.code?("function"==typeof o&&o.apply(this,arguments),f()):p([e,[t,n,i,o]])}))}(e,t,n,i)});var a=e.readdir;function s(t){return a.apply(e,t)}if(e.readdir=function(e,t,n){var r=[e];"function"!=typeof t?r.push(t):n=t;return r.push((function(e,t){t&&t.sort&&t.sort();!e||"EMFILE"!==e.code&&"ENFILE"!==e.code?("function"==typeof n&&n.apply(this,arguments),f()):p([s,[r]])})),s(r)},"v0.8"===process.version.substr(0,4)){var c=o(e);d=c.ReadStream,g=c.WriteStream}var l=e.ReadStream;l&&(d.prototype=Object.create(l.prototype),d.prototype.open=function(){var e=this;m(e.path,e.flags,e.mode,(function(t,n){t?(e.autoClose&&e.destroy(),e.emit("error",t)):(e.fd=n,e.emit("open",n),e.read())}))});var u=e.WriteStream;function d(e,t){return this instanceof d?(l.apply(this,arguments),this):d.apply(Object.create(d.prototype),arguments)}function g(e,t){return this instanceof g?(u.apply(this,arguments),this):g.apply(Object.create(g.prototype),arguments)}u&&(g.prototype=Object.create(u.prototype),g.prototype.open=function(){var e=this;m(e.path,e.flags,e.mode,(function(t,n){t?(e.destroy(),e.emit("error",t)):(e.fd=n,e.emit("open",n))}))}),e.ReadStream=d,e.WriteStream=g;var _=e.open;function m(e,t,n,r){return"function"==typeof n&&(r=n,n=null),function e(t,n,r,i){return _(t,n,r,(function(o,a){!o||"EMFILE"!==o.code&&"ENFILE"!==o.code?("function"==typeof i&&i.apply(this,arguments),f()):p([e,[t,n,r,i]])}))}(e,t,n,r)}return e.open=m,e}function p(e){d("ENQUEUE",e[0].name,e[1]),s.push(e)}function f(){var e=s.shift();e&&(d("RETRY",e[0].name,e[1]),e[0].apply(null,e[1]))}c.debuglog?d=c.debuglog("gfs4"):/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&(d=function(){var e=c.format.apply(c,arguments);e="GFS4: "+e.split(/\n/).join("\nGFS4: "),console.error(e)}),/\bgfs4\b/i.test(process.env.NODE_DEBUG||"")&&process.on("exit",(function(){d(s),n(19).equal(s.length,0)})),e.exports=h(a(r)),process.env.TEST_GRACEFUL_FS_GLOBAL_PATCH&&!r.__patched&&(e.exports=h(r),r.__patched=!0),e.exports.close=(l=r.close,function(e,t){return l.call(r,e,(function(e){e||f(),"function"==typeof t&&t.apply(this,arguments)}))}),e.exports.closeSync=(u=r.closeSync,function(e){var t=u.apply(r,arguments);return f(),t}),/\bgraceful-fs\b/.test(r.closeSync.toString())||(r.closeSync=e.exports.closeSync,r.close=e.exports.close)},function(e,t,n){"use strict";t.fromCallback=function(e){return Object.defineProperty((function(){if("function"!=typeof arguments[arguments.length-1])return new Promise((t,n)=>{arguments[arguments.length]=(e,r)=>{if(e)return n(e);t(r)},arguments.length++,e.apply(this,arguments)});e.apply(this,arguments)}),"name",{value:e.name})},t.fromPromise=function(e){return Object.defineProperty((function(){const t=arguments[arguments.length-1];if("function"!=typeof t)return e.apply(this,arguments);e.apply(this,arguments).then(e=>t(null,e),t)}),"name",{value:e.name})}},function(e,t,n){"use strict";const r=(0,n(2).fromCallback)(n(40)),i=n(41);e.exports={mkdirs:r,mkdirsSync:i,mkdirp:r,mkdirpSync:i,ensureDir:r,ensureDirSync:i}},function(e,t,n){"use strict";const r=n(2).fromPromise,i=n(18);e.exports={pathExists:r((function(e){return i.access(e).then(()=>!0).catch(()=>!1)})),pathExistsSync:i.existsSync}},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("os")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.setInjectorConfig="controlInjector:set-injector-config",e.injectRawInput="controlInjector:inject-raw-input",e.setInjectionRect="controlInjector:set-injection-rect",e.allowSingleController="controlInjector:allow-single-controller",e.setAvatar="controlInjector:set-avatar",e.quit="quit"}(t.ElectronChannels||(t.ElectronChannels={})),t.avatarBase64="iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAFIUlEQVRYR82Yf0xVZRjHv88FrrlSVMK0TFC2RJoVuLlBP5hpcK8x2qqB1ZI/NMEwRUTkXly7c4EIcgWGBkYrQzcxapN+XCBLWaZlU2wrUtqA1GopMqEhv+Q87Rw8BPde7j3v4a66f7Cx836/z+c87/s+z3tegs6f2VIWLNHt5QZgGZjDQBTKzAtkOyJqZ6CdgDYJOAsjjjfYMrv0hCIRUbx171yC9AYxJYCwRETLwHkwPmei/Q35W/7QqtUEKIMZWMoGKBWEqVrN3Y5j9DGhgkFFWkA9AvoUzJn2Dmi/Uco/acvqnOilJwR82GYzzh+cXgogbVIZ8y6uuGzs2fyTzTbobqhbwBWW8qAAGqgjUIx3/8mPYPDpIZ6S+OWujTec3VwAl66vDAgO6m0iQvTkQ2t3YPCp6533PH3uQOrQWJULoMlSXEFEqdqtfTeSmSvrd20dt6TGAcbn2tMMjLd9F1LcSSJsaMjLrFCVo4CrthXOkQL82gl0l7itDxWMPokoTC1Bo4CTmdrI0PuxatkjCJkTrJBe7+7BmR9/wafnWvSSlzryMzOUriT/WZmzd2EAcSsIfqKOuUkmPP7oYlz9sxMtHVcVeejcYDw0/wG0Xv4NOw99gq7ePjHbMVlUAE0W+/tESBFzAWS4qPAwvPfZCZdsyVndkLhCscx5t1YYUt0wI4BW+0UCFokArn4iCmvMsdh9+BiaWtrcSmfdPRWl6a/gYsdV5B2tF7EHA5fq8zPDKc6yJ9yPDD8LqQGUpCaht38AuQePeZSueyYG5uhIvLBzn2gIDLO0mEwWew4Rdomo5cwcsqZh/8cNXjeCyFhnBmZYyGwpPgKi5P8jIJhryGyxnwQhVgRQHvvRm+n48KszOHLqvEfpwtmzUL45xeNandCA0URma3EHQCGigP/GGpQ3ipzBfhCmiAImLI3A68/H4wNH04RZlLNXlPYSvr7QgpK6E6IhwMzdZLIU3ySiQGE1gIzE5XjysQg4zjSj6ovT4yzkF0heEYMb3T3IqDyqx/4OoI4aODaaWkZu9Q+gr39g9NG8++5Fc2sbimsbhYu0aqJOsa5NIpvIxfrZmCgEBU5TWp3cg2/1DSg9OWjGdCWO3ulVxMom0VFmZK3agxu/u4C6b39A2zXXr0o5u7GREUpm9bQ7pczoKdRqDy6rdUzY5tRpkgt1wdoXdfVkpVCLtjp193rqwc47Qm9PVlqd6GFBa/1zhlRfbGPpQbfLwaXNqYcF+YHZai8BsNlbLZCPUHmvJSP3nRo0d/zubbjL8+rsdWhqbnEpSe6NeLcjf2uOksG4HUULDJKhxdtxX130rxZWCcPJgryU5xSdtxMQg/ulQSmkcc+2a6NHfrO1uACg7Z4iy4U5InQe1pdV6wLUrh/JnhxkFHDl9oJAf0PAr3q7ii5i96IeGP0fdNg29YwDlP+Jt9pfNgCHfRhM3Eri1Y6CrTWq0OXDXctUi0fVqvhnaicEhM1mMA9OOwHQU1ptfTTO4TD2JMBmk8b6ub08issqmu0X4Pc9CPN9FNyjDYOv3B4eWnJ8d06388D//PqNwVVXjH+lC12/jX0L5b5GQrmej3ovaRuWiNIa8rd4LKqaroBNO0oWQRrOImANQMbJTDszhoi4mg1+hfVvZVzy5qUJUDUxZ5fNY/8huYCu9dZ1nAMzcy+IDtBtf7ujcNPIHYmGnxDgWD+TZW80QUpiwjICzQTzTCbMUIor4yYDN0HoAugbJtQ25GWe1cDjMuRvB5EylUlS6sAAAAAASUVORK5CYII=",t.ghostAvatarBase64="iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",t.liveShareUserSettingsFileName=".vs-liveshare-settings.json",t.logDirectoryName="VSFeedbackVSRTCLogs"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(9),i=n(15),o=n(14),a=n(0),s=n(12);var c;!function(e){e[e.Critical=1]="Critical",e[e.Error=2]="Error",e[e.Warning=4]="Warning",e[e.Information=8]="Information",e[e.Verbose=16]="Verbose",e[e.Start=256]="Start",e[e.Stop=512]="Stop",e[e.Suspend=1024]="Suspend",e[e.Resume=2048]="Resume",e[e.Transfer=4096]="Transfer"}(c=t.TraceEventType||(t.TraceEventType={}));class l extends o.EventEmitter{constructor(e){super(),this.name=e}withName(e){const t=new l(e);return this.eventNames().forEach(e=>{this.listeners(e).forEach(n=>{t.on(e,n)})}),t}addTraceListener(e){this.on(l.eventEventName,e.traceEvent.bind(e)),this.on(l.lineEventName,e.writeLine.bind(e))}writeLine(e){this.emit(l.lineEventName,e)}traceEvent(e,t,n){this.emit(l.eventEventName,this.name,e,t,n)}errorEvent(e,t){this.traceEvent(c.Error,e,t)}warningEvent(e,t){this.traceEvent(c.Warning,e,t)}infoEvent(e,t){this.traceEvent(c.Information,e,t)}error(e){this.traceEvent(c.Error,0,e)}warning(e){this.traceEvent(c.Warning,0,e)}info(e){this.traceEvent(c.Information,0,e)}verbose(e){this.traceEvent(c.Verbose,0,e)}}l.lineEventName="line",l.eventEventName="event",t.TraceSource=l;var u=n(16);t.TraceSources=u.TraceSources,t.TraceEventIds=u.TraceEventIds,t.defaultTraceSource=new l("LiveShareAudio");t.TraceListener=class{traceEvent(e,t,n,r){this.filter&&!this.filter.shouldTrace(e,t,n)||this.writeEvent(e,t,n,r)}};class d{static formatEvent(e,t,n,r,o){let a;switch(n){case c.Critical:a="C";break;case c.Error:a="E";break;case c.Warning:a="W";break;case c.Information:a="I";break;case c.Verbose:a="V";break;case c.Start:a=">";break;case c.Stop:a="<";break;default:a="?"}const s=null===e?"":i(e,"yyyy-mm-dd HH:MM:ss.l ",!0);let l;return o.length>d.maxMessageLength&&(o=o.substr(0,d.maxMessageLength)+"..."),l=0!==r?`[${s}${t} ${a}] (${r}) ${o}`:`[${s}${t} ${a}] ${o}`,l}static parseEventId(e){let t=e.match(/\] \(([0-9]+)\)/);return parseInt(t&&t[1],10)||0}static IsObfuscationDisabled(e){if("boolean"==typeof d.canCollectPII)return d.canCollectPII;const t=s.readLiveShareUserSettings(e);return d.canCollectPII=!(!t||!t.canCollectPII),e.info("Can Collect PII: "+d.canCollectPII),d.canCollectPII}static formatPath(e,t){if(!e)return"<null>";if(d.IsObfuscationDisabled(t))return e;const n=h.getShortHash(a.dirname(e)),r=a.extname(e),i=h.getShortHash(a.basename(e,r)),o=e.replace("\\","/").indexOf("/");return 2===o&&":"===e[1]?`<?:${e[2]}${n}${e[2]}${i}${r}>`:0===o?`<${e[0]}${n}${e[0]}${i}${r}>`:o>0?`<${n}${e[o]}${i}${r}>`:`<${i}${r}>`}static formatMessage(e,t){return!e||d.IsObfuscationDisabled(t)?e:"string"==typeof e?h.getShortHash(e):(e.length>0&&"string"==typeof e[0]&&e[0].startsWith("ScreenScraper.getWindowList()")&&(e[0]="ScreenScraper.getWindowList() result: "+h.getShortHash(e[0])),e)}}d.maxMessageLength=5120,t.TraceFormat=d;class h{static setKey(e){h.privacyKey=new Buffer(e,"base64")}static getShortHash(e){if(!e)return"<null>";if(!h.privacyKey)return"<redacted>";const t=r.createHmac("sha256",h.privacyKey);return t.update(e),t.digest("hex").substr(0,8)}}t.Privacy=h},function(e,t){e.exports=require("crypto")},function(e,t){e.exports=require("electron")},function(e,t,n){"use strict";const r=n(2).fromCallback,i=n(44);e.exports={remove:r(i),removeSync:i.sync}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(5),i=n(6),o=n(0),a=n(7);let s;t.DeferredPromise=class{constructor(){let e,t;this.promise=new Promise((n,r)=>{e=n,t=r}),this.deferredReject=t,this.deferredResolve=e}resolve(e){this.deferredResolve(e)}reject(e){this.deferredReject(e)}},t.readLiveShareUserSettings=function(e){if(s)return s;const t=o.join(i.homedir(),a.liveShareUserSettingsFileName);try{if(r.existsSync(t)){const e=r.readFileSync(t,"utf8");return s=JSON.parse(e),s}}catch(n){e.info(`Error finding user settings at: ${t} ${n.message}`)}},t.getStartOptions=function(e){const t=Buffer.from(e,"base64").toString("utf8");return JSON.parse(t)}},function(e,t,n){"use strict";const r=n(2).fromCallback,i=n(52);e.exports={readJson:r(i.readFile),readJsonSync:i.readFileSync,writeJson:r(i.writeFile),writeJsonSync:i.writeFileSync}},function(e,t){e.exports=require("events")},function(e,t,n){var r;!function(i){"use strict";var o,a,s,c=(o=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZWN]|"[^"]*"|'[^']*'/g,a=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,s=/[^-+\dA-Z]/g,function(e,t,n,r){if(1!==arguments.length||"string"!==h(e)||/\d/.test(e)||(t=e,e=void 0),(e=e||new Date)instanceof Date||(e=new Date(e)),isNaN(e))throw TypeError("Invalid date");var i=(t=String(c.masks[t]||t||c.masks.default)).slice(0,4);"UTC:"!==i&&"GMT:"!==i||(t=t.slice(4),n=!0,"GMT:"===i&&(r=!0));var p=n?"getUTC":"get",f=e[p+"Date"](),g=e[p+"Day"](),_=e[p+"Month"](),m=e[p+"FullYear"](),v=e[p+"Hours"](),y=e[p+"Minutes"](),C=e[p+"Seconds"](),S=e[p+"Milliseconds"](),I=n?0:e.getTimezoneOffset(),T=u(e),P=d(e),E={d:f,dd:l(f),ddd:c.i18n.dayNames[g],dddd:c.i18n.dayNames[g+7],m:_+1,mm:l(_+1),mmm:c.i18n.monthNames[_],mmmm:c.i18n.monthNames[_+12],yy:String(m).slice(2),yyyy:m,h:v%12||12,hh:l(v%12||12),H:v,HH:l(v),M:y,MM:l(y),s:C,ss:l(C),l:l(S,3),L:l(Math.round(S/10)),t:v<12?c.i18n.timeNames[0]:c.i18n.timeNames[1],tt:v<12?c.i18n.timeNames[2]:c.i18n.timeNames[3],T:v<12?c.i18n.timeNames[4]:c.i18n.timeNames[5],TT:v<12?c.i18n.timeNames[6]:c.i18n.timeNames[7],Z:r?"GMT":n?"UTC":(String(e).match(a)||[""]).pop().replace(s,""),o:(I>0?"-":"+")+l(100*Math.floor(Math.abs(I)/60)+Math.abs(I)%60,4),S:["th","st","nd","rd"][f%10>3?0:(f%100-f%10!=10)*f%10],W:T,N:P};return t.replace(o,(function(e){return e in E?E[e]:e.slice(1,e.length-1)}))});function l(e,t){for(e=String(e),t=t||2;e.length<t;)e="0"+e;return e}function u(e){var t=new Date(e.getFullYear(),e.getMonth(),e.getDate());t.setDate(t.getDate()-(t.getDay()+6)%7+3);var n=new Date(t.getFullYear(),0,4);n.setDate(n.getDate()-(n.getDay()+6)%7+3);var r=t.getTimezoneOffset()-n.getTimezoneOffset();t.setHours(t.getHours()-r);var i=(t-n)/6048e5;return 1+Math.floor(i)}function d(e){var t=e.getDay();return 0===t&&(t=7),t}function h(e){return null===e?"null":void 0===e?"undefined":"object"!=typeof e?typeof e:Array.isArray(e)?"array":{}.toString.call(e).slice(8,-1).toLowerCase()}c.masks={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:sso",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",expiresHeaderFormat:"ddd, dd mmm yyyy HH:MM:ss Z"},c.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],timeNames:["a","p","am","pm","A","P","AM","PM"]},void 0===(r=function(){return c}.call(t,n,t,e))||(e.exports=r)}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.None=0]="None",e[e.RpcListeningOnPipe=1001]="RpcListeningOnPipe",e[e.AgentLogCreated=1002]="AgentLogCreated",e[e.AgentOutput=2001]="AgentOutput"}(t.TraceEventIds||(t.TraceEventIds={})),function(e){e.ClientAudioExtension="Client.AudioExtension"}(t.TraceSources||(t.TraceSources={}))},function(e,t,n){"use strict";var r,i;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.callStarted=0]="callStarted",e[e.callDisconnected=1]="callDisconnected",e[e.muteChanged=2]="muteChanged",e[e.participantChanged=3]="participantChanged",e[e.participantsChanged=4]="participantsChanged",e[e.screenShareEnded=5]="screenShareEnded"}(t.CallChangedType||(t.CallChangedType={})),function(e){e.dispose="dispose",e.endCall="endCall",e.enumerateDevices="enumerateDevices",e.getCallInfo="getCallInfo",e.getCurrentParticipants="getCurrentParticipants",e.getDominantSpeakers="getDominantSpeakers",e.getSelectedDevices="getSelectedDevices",e.getWindowsForSharing="getWindowsForSharing",e.initializeStackEvent="initializeStackEvent",e.isMuted="isMuted",e.loadSlimCore="loadSlimCore",e.muteOrUnmute="muteOrUnmute",e.selectDevices="selectDevices",e.shareWindow="shareWindow",e.showWindow="showWindow",e.hideWindow="hideWindow",e.startAudio="startAudio",e.startOrJoinCall="startOrJoinCall",e.stopScreenSharing="stopScreenSharing"}(r=t.RequestType||(t.RequestType={})),function(e){e.callChanged="callChanged",e.electronAppReady="electronAppReady",e.trace="trace"}(i=t.NotificationType||(t.NotificationType={})),function(e){e[e.error=0]="error",e[e.info=1]="info",e[e.warning=2]="warning"}(t.TraceType||(t.TraceType={}));t.AppEvents=class{constructor(e){this.jsonRPCProxy=e}get isDisposed(){return this.jsonRPCProxy.isDisposed}on(e,t){this.jsonRPCProxy.on(e,t)}sendRequest(e){return this.jsonRPCProxy.sendRequest(e)}sendNotification(e){return this.jsonRPCProxy.sendNotification(e)}dispose(){this.jsonRPCProxy.dispose()}};t.CallChanged=class{constructor(e,t,n){this.changeType=e,this.callParticipant=t,this.callInfo=n,this.eventType=i.callChanged}};t.Dispose=class{constructor(){this.eventType=r.dispose}};t.ElectronAppReady=class{constructor(){this.eventType=i.electronAppReady}};t.EndCall=class{constructor(){this.eventType=r.endCall}};t.EnumerateDevices=class{constructor(){this.eventType=r.enumerateDevices}};t.GetCallInfo=class{constructor(){this.eventType=r.getCallInfo}};t.GetCurrentParticipants=class{constructor(){this.eventType=r.getCurrentParticipants}};t.GetDominantSpeakers=class{constructor(){this.eventType=r.getDominantSpeakers}};t.GetSelectedDevices=class{constructor(){this.eventType=r.getSelectedDevices}};t.GetWindowsForSharing=class{constructor(){this.eventType=r.getWindowsForSharing}};t.InitializeStackEvent=class{constructor(e,t){this.skypeToken=e,this.displayName=t,this.eventType=r.initializeStackEvent}};t.IsMuted=class{constructor(){this.eventType=r.isMuted}};t.LoadSlimCore=class{constructor(){this.eventType=r.loadSlimCore}};t.MuteOrUnmute=class{constructor(e,t){this.isMute=e,this.participant=t,this.eventType=r.muteOrUnmute}};t.SelectDevices=class{constructor(e){this.selectedDevices=e,this.eventType=r.selectDevices}};t.ShareWindow=class{constructor(e){this.windowId=e,this.eventType=r.shareWindow}};t.ShowWindow=class{constructor(){this.eventType=r.showWindow}};t.HideWindow=class{constructor(){this.eventType=r.hideWindow}};t.StartAudio=class{constructor(){this.eventType=r.startAudio}};t.StartOrJoinCall=class{constructor(e,t){this.groupContext=e,this.enableAudio=t,this.eventType=r.startOrJoinCall}};t.StopScreenSharing=class{constructor(){this.eventType=r.stopScreenSharing}};t.Trace=class{constructor(e,t){this.traceType=e,this.message=t,this.eventType=i.trace,"string"!=typeof t&&(this.message="")}}},function(e,t,n){"use strict";const r=n(2).fromCallback,i=n(1),o=["access","appendFile","chmod","chown","close","copyFile","fchmod","fchown","fdatasync","fstat","fsync","ftruncate","futimes","lchown","link","lstat","mkdir","mkdtemp","open","readFile","readdir","readlink","realpath","rename","rmdir","stat","symlink","truncate","unlink","utimes","writeFile"].filter(e=>"function"==typeof i[e]);Object.keys(i).forEach(e=>{"promises"!==e&&(t[e]=i[e])}),o.forEach(e=>{t[e]=r(i[e])}),t.exists=function(e,t){return"function"==typeof t?i.exists(e,t):new Promise(t=>i.exists(e,t))},t.read=function(e,t,n,r,o,a){return"function"==typeof a?i.read(e,t,n,r,o,a):new Promise((a,s)=>{i.read(e,t,n,r,o,(e,t,n)=>{if(e)return s(e);a({bytesRead:t,buffer:n})})})},t.write=function(e,t,...n){return"function"==typeof n[n.length-1]?i.write(e,t,...n):new Promise((r,o)=>{i.write(e,t,...n,(e,t,n)=>{if(e)return o(e);r({bytesWritten:t,buffer:n})})})}},function(e,t){e.exports=require("assert")},function(e,t,n){"use strict";e.exports={copySync:n(39)}},function(e,t,n){"use strict";const r=n(0);function i(e){return(e=r.normalize(r.resolve(e)).split(r.sep)).length>0?e[0]:null}const o=/[<>:"|?*]/;e.exports={getRootPath:i,invalidWin32Path:function(e){const t=i(e);return e=e.replace(t,""),o.test(e)}}},function(e,t,n){"use strict";const r=n(1),i=n(6),o=n(0);e.exports={hasMillisRes:function(e){let t=o.join("millis-test"+Date.now().toString()+Math.random().toString().slice(2));t=o.join(i.tmpdir(),t);const n=new Date(1435410243862);r.writeFile(t,"https://github.com/jprichardson/node-fs-extra/pull/141",i=>{if(i)return e(i);r.open(t,"r+",(i,o)=>{if(i)return e(i);r.futimes(o,n,n,n=>{if(n)return e(n);r.close(o,n=>{if(n)return e(n);r.stat(t,(t,n)=>{if(t)return e(t);e(null,n.mtime>1435410243e3)})})})})})},hasMillisResSync:function(){let e=o.join("millis-test-sync"+Date.now().toString()+Math.random().toString().slice(2));e=o.join(i.tmpdir(),e);const t=new Date(1435410243862);r.writeFileSync(e,"https://github.com/jprichardson/node-fs-extra/pull/141");const n=r.openSync(e,"r+");return r.futimesSync(n,t,t),r.closeSync(n),r.statSync(e).mtime>1435410243e3},timeRemoveMillis:function(e){if("number"==typeof e)return 1e3*Math.floor(e/1e3);if(e instanceof Date)return new Date(1e3*Math.floor(e.getTime()/1e3));throw new Error("fs-extra: timeRemoveMillis() unknown parameter type")},utimesMillis:function(e,t,n,i){r.open(e,"r+",(e,o)=>{if(e)return i(e);r.futimes(o,t,n,e=>{r.close(o,t=>{i&&i(e||t)})})})},utimesMillisSync:function(e,t,n){const i=r.openSync(e,"r+");return r.futimesSync(i,t,n),r.closeSync(i)}}},function(e,t,n){"use strict";e.exports=function(e){if("function"==typeof Buffer.allocUnsafe)try{return Buffer.allocUnsafe(e)}catch(t){return new Buffer(e)}return new Buffer(e)}},function(e,t,n){"use strict";const r=n(2).fromCallback;e.exports={copy:r(n(42))}},,function(e,t,n){"use strict";
/*!
 *  AufLog.ts
 *  AUF
 *
 *  Created by Johan Blumenberg on 2016-12-29
 *  Copyright 2016 Microsoft. All rights reserved.
 *
 */function r(e,t){var n=0;return e.replace(/%[dixs%]/g,(function(e){var r=0;if("%"!==e[r++])return"";var i=e[r++];return"%"===i?"%":"s"===i||"d"===i||"i"===i?t[n++]:"x"===i?t[n++].toString(16):e}))}Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Trace=10]="Trace",e[e.Debug6=16]="Debug6",e[e.Debug5=18]="Debug5",e[e.Debug4=20]="Debug4",e[e.Debug3=30]="Debug3",e[e.Debug2=40]="Debug2",e[e.Debug1=50]="Debug1",e[e.Warning=60]="Warning",e[e.Error=70]="Error",e[e.Fatal=80]="Fatal",e[e.MetaData=90]="MetaData"}(t.LogLevel||(t.LogLevel={})),function(e){e[e.UseDefault=0]="UseDefault",e[e.Compress=1]="Compress",e[e.Disabled=2]="Disabled"}(t.LogFileCompression||(t.LogFileCompression={})),function(e){e[e.Raw=0]="Raw",e[e.Base64=1]="Base64"}(t.LogFileEncoding||(t.LogFileEncoding={})),function(e){e[e.Unencrypted=0]="Unencrypted",e[e.Encrypted=1]="Encrypted"}(t.LogFileEncryption||(t.LogFileEncryption={})),function(e){e[e.PEM=0]="PEM",e[e.DER=1]="DER",e[e.BER=2]="BER"}(t.CertStoreFormat||(t.CertStoreFormat={})),function(e){e[e.InsertFront=8]="InsertFront"}(t.AppenderFlags||(t.AppenderFlags={})),t.vsprintf=r,t.sprintf=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return r(e,t)}},,function(e,t,n){(function(e){var r;
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */(function(){var i="Expected a function",o="__lodash_placeholder__",a=[["ary",128],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",32],["partialRight",64],["rearg",256]],s="[object Arguments]",c="[object Array]",l="[object Boolean]",u="[object Date]",d="[object Error]",h="[object Function]",p="[object GeneratorFunction]",f="[object Map]",g="[object Number]",_="[object Object]",m="[object RegExp]",v="[object Set]",y="[object String]",C="[object Symbol]",S="[object WeakMap]",I="[object ArrayBuffer]",T="[object DataView]",P="[object Float32Array]",E="[object Float64Array]",O="[object Int8Array]",b="[object Int16Array]",A="[object Int32Array]",R="[object Uint8Array]",w="[object Uint16Array]",L="[object Uint32Array]",N=/\b__p \+= '';/g,D=/\b(__p \+=) '' \+/g,k=/(__e\(.*?\)|\b__t\)) \+\n'';/g,M=/&(?:amp|lt|gt|quot|#39);/g,F=/[&<>"']/g,j=RegExp(M.source),x=RegExp(F.source),V=/<%-([\s\S]+?)%>/g,H=/<%([\s\S]+?)%>/g,U=/<%=([\s\S]+?)%>/g,B=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,W=/^\w*$/,q=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,G=/[\\^$.*+?()[\]{}|]/g,J=RegExp(G.source),z=/^\s+|\s+$/g,K=/^\s+/,$=/\s+$/,Q=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Y=/\{\n\/\* \[wrapped with (.+)\] \*/,Z=/,? & /,X=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,ee=/\\(\\)?/g,te=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,ne=/\w*$/,re=/^[-+]0x[0-9a-f]+$/i,ie=/^0b[01]+$/i,oe=/^\[object .+?Constructor\]$/,ae=/^0o[0-7]+$/i,se=/^(?:0|[1-9]\d*)$/,ce=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,le=/($^)/,ue=/['\n\r\u2028\u2029\\]/g,de="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",he="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",pe="[\\ud800-\\udfff]",fe="["+he+"]",ge="["+de+"]",_e="\\d+",me="[\\u2700-\\u27bf]",ve="[a-z\\xdf-\\xf6\\xf8-\\xff]",ye="[^\\ud800-\\udfff"+he+_e+"\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde]",Ce="\\ud83c[\\udffb-\\udfff]",Se="[^\\ud800-\\udfff]",Ie="(?:\\ud83c[\\udde6-\\uddff]){2}",Te="[\\ud800-\\udbff][\\udc00-\\udfff]",Pe="[A-Z\\xc0-\\xd6\\xd8-\\xde]",Ee="(?:"+ve+"|"+ye+")",Oe="(?:"+Pe+"|"+ye+")",be="(?:"+ge+"|"+Ce+")"+"?",Ae="[\\ufe0e\\ufe0f]?"+be+("(?:\\u200d(?:"+[Se,Ie,Te].join("|")+")[\\ufe0e\\ufe0f]?"+be+")*"),Re="(?:"+[me,Ie,Te].join("|")+")"+Ae,we="(?:"+[Se+ge+"?",ge,Ie,Te,pe].join("|")+")",Le=RegExp("['’]","g"),Ne=RegExp(ge,"g"),De=RegExp(Ce+"(?="+Ce+")|"+we+Ae,"g"),ke=RegExp([Pe+"?"+ve+"+(?:['’](?:d|ll|m|re|s|t|ve))?(?="+[fe,Pe,"$"].join("|")+")",Oe+"+(?:['’](?:D|LL|M|RE|S|T|VE))?(?="+[fe,Pe+Ee,"$"].join("|")+")",Pe+"?"+Ee+"+(?:['’](?:d|ll|m|re|s|t|ve))?",Pe+"+(?:['’](?:D|LL|M|RE|S|T|VE))?","\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",_e,Re].join("|"),"g"),Me=RegExp("[\\u200d\\ud800-\\udfff"+de+"\\ufe0e\\ufe0f]"),Fe=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,je=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],xe=-1,Ve={};Ve[P]=Ve[E]=Ve[O]=Ve[b]=Ve[A]=Ve[R]=Ve["[object Uint8ClampedArray]"]=Ve[w]=Ve[L]=!0,Ve[s]=Ve[c]=Ve[I]=Ve[l]=Ve[T]=Ve[u]=Ve[d]=Ve[h]=Ve[f]=Ve[g]=Ve[_]=Ve[m]=Ve[v]=Ve[y]=Ve[S]=!1;var He={};He[s]=He[c]=He[I]=He[T]=He[l]=He[u]=He[P]=He[E]=He[O]=He[b]=He[A]=He[f]=He[g]=He[_]=He[m]=He[v]=He[y]=He[C]=He[R]=He["[object Uint8ClampedArray]"]=He[w]=He[L]=!0,He[d]=He[h]=He[S]=!1;var Ue={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},Be=parseFloat,We=parseInt,qe="object"==typeof global&&global&&global.Object===Object&&global,Ge="object"==typeof self&&self&&self.Object===Object&&self,Je=qe||Ge||Function("return this")(),ze=t&&!t.nodeType&&t,Ke=ze&&"object"==typeof e&&e&&!e.nodeType&&e,$e=Ke&&Ke.exports===ze,Qe=$e&&qe.process,Ye=function(){try{var e=Ke&&Ke.require&&Ke.require("util").types;return e||Qe&&Qe.binding&&Qe.binding("util")}catch(e){}}(),Ze=Ye&&Ye.isArrayBuffer,Xe=Ye&&Ye.isDate,et=Ye&&Ye.isMap,tt=Ye&&Ye.isRegExp,nt=Ye&&Ye.isSet,rt=Ye&&Ye.isTypedArray;function it(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function ot(e,t,n,r){for(var i=-1,o=null==e?0:e.length;++i<o;){var a=e[i];t(r,a,n(a),e)}return r}function at(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e}function st(e,t){for(var n=null==e?0:e.length;n--&&!1!==t(e[n],n,e););return e}function ct(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function lt(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var a=e[n];t(a,n,e)&&(o[i++]=a)}return o}function ut(e,t){return!!(null==e?0:e.length)&&Ct(e,t,0)>-1}function dt(e,t,n){for(var r=-1,i=null==e?0:e.length;++r<i;)if(n(t,e[r]))return!0;return!1}function ht(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}function pt(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}function ft(e,t,n,r){var i=-1,o=null==e?0:e.length;for(r&&o&&(n=e[++i]);++i<o;)n=t(n,e[i],i,e);return n}function gt(e,t,n,r){var i=null==e?0:e.length;for(r&&i&&(n=e[--i]);i--;)n=t(n,e[i],i,e);return n}function _t(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}var mt=Pt("length");function vt(e,t,n){var r;return n(e,(function(e,n,i){if(t(e,n,i))return r=n,!1})),r}function yt(e,t,n,r){for(var i=e.length,o=n+(r?1:-1);r?o--:++o<i;)if(t(e[o],o,e))return o;return-1}function Ct(e,t,n){return t==t?function(e,t,n){var r=n-1,i=e.length;for(;++r<i;)if(e[r]===t)return r;return-1}(e,t,n):yt(e,It,n)}function St(e,t,n,r){for(var i=n-1,o=e.length;++i<o;)if(r(e[i],t))return i;return-1}function It(e){return e!=e}function Tt(e,t){var n=null==e?0:e.length;return n?bt(e,t)/n:NaN}function Pt(e){return function(t){return null==t?void 0:t[e]}}function Et(e){return function(t){return null==e?void 0:e[t]}}function Ot(e,t,n,r,i){return i(e,(function(e,i,o){n=r?(r=!1,e):t(n,e,i,o)})),n}function bt(e,t){for(var n,r=-1,i=e.length;++r<i;){var o=t(e[r]);void 0!==o&&(n=void 0===n?o:n+o)}return n}function At(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}function Rt(e){return function(t){return e(t)}}function wt(e,t){return ht(t,(function(t){return e[t]}))}function Lt(e,t){return e.has(t)}function Nt(e,t){for(var n=-1,r=e.length;++n<r&&Ct(t,e[n],0)>-1;);return n}function Dt(e,t){for(var n=e.length;n--&&Ct(t,e[n],0)>-1;);return n}function kt(e,t){for(var n=e.length,r=0;n--;)e[n]===t&&++r;return r}var Mt=Et({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"}),Ft=Et({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function jt(e){return"\\"+Ue[e]}function xt(e){return Me.test(e)}function Vt(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n}function Ht(e,t){return function(n){return e(t(n))}}function Ut(e,t){for(var n=-1,r=e.length,i=0,a=[];++n<r;){var s=e[n];s!==t&&s!==o||(e[n]=o,a[i++]=n)}return a}function Bt(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}function Wt(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=[e,e]})),n}function qt(e){return xt(e)?function(e){var t=De.lastIndex=0;for(;De.test(e);)++t;return t}(e):mt(e)}function Gt(e){return xt(e)?function(e){return e.match(De)||[]}(e):function(e){return e.split("")}(e)}var Jt=Et({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});var zt=function e(t){var n,r=(t=null==t?Je:zt.defaults(Je.Object(),t,zt.pick(Je,je))).Array,de=t.Date,he=t.Error,pe=t.Function,fe=t.Math,ge=t.Object,_e=t.RegExp,me=t.String,ve=t.TypeError,ye=r.prototype,Ce=pe.prototype,Se=ge.prototype,Ie=t["__core-js_shared__"],Te=Ce.toString,Pe=Se.hasOwnProperty,Ee=0,Oe=(n=/[^.]+$/.exec(Ie&&Ie.keys&&Ie.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"",be=Se.toString,Ae=Te.call(ge),Re=Je._,we=_e("^"+Te.call(Pe).replace(G,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),De=$e?t.Buffer:void 0,Me=t.Symbol,Ue=t.Uint8Array,qe=De?De.allocUnsafe:void 0,Ge=Ht(ge.getPrototypeOf,ge),ze=ge.create,Ke=Se.propertyIsEnumerable,Qe=ye.splice,Ye=Me?Me.isConcatSpreadable:void 0,mt=Me?Me.iterator:void 0,Et=Me?Me.toStringTag:void 0,Kt=function(){try{var e=Xi(ge,"defineProperty");return e({},"",{}),e}catch(e){}}(),$t=t.clearTimeout!==Je.clearTimeout&&t.clearTimeout,Qt=de&&de.now!==Je.Date.now&&de.now,Yt=t.setTimeout!==Je.setTimeout&&t.setTimeout,Zt=fe.ceil,Xt=fe.floor,en=ge.getOwnPropertySymbols,tn=De?De.isBuffer:void 0,nn=t.isFinite,rn=ye.join,on=Ht(ge.keys,ge),an=fe.max,sn=fe.min,cn=de.now,ln=t.parseInt,un=fe.random,dn=ye.reverse,hn=Xi(t,"DataView"),pn=Xi(t,"Map"),fn=Xi(t,"Promise"),gn=Xi(t,"Set"),_n=Xi(t,"WeakMap"),mn=Xi(ge,"create"),vn=_n&&new _n,yn={},Cn=bo(hn),Sn=bo(pn),In=bo(fn),Tn=bo(gn),Pn=bo(_n),En=Me?Me.prototype:void 0,On=En?En.valueOf:void 0,bn=En?En.toString:void 0;function An(e){if(qa(e)&&!Da(e)&&!(e instanceof Nn)){if(e instanceof Ln)return e;if(Pe.call(e,"__wrapped__"))return Ao(e)}return new Ln(e)}var Rn=function(){function e(){}return function(t){if(!Wa(t))return{};if(ze)return ze(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();function wn(){}function Ln(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=void 0}function Nn(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=4294967295,this.__views__=[]}function Dn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function kn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Mn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Fn(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new Mn;++t<n;)this.add(e[t])}function jn(e){var t=this.__data__=new kn(e);this.size=t.size}function xn(e,t){var n=Da(e),r=!n&&Na(e),i=!n&&!r&&ja(e),o=!n&&!r&&!i&&Za(e),a=n||r||i||o,s=a?At(e.length,me):[],c=s.length;for(var l in e)!t&&!Pe.call(e,l)||a&&("length"==l||i&&("offset"==l||"parent"==l)||o&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||ao(l,c))||s.push(l);return s}function Vn(e){var t=e.length;return t?e[Fr(0,t-1)]:void 0}function Hn(e,t){return Po(mi(e),$n(t,0,e.length))}function Un(e){return Po(mi(e))}function Bn(e,t,n){(void 0!==n&&!Ra(e[t],n)||void 0===n&&!(t in e))&&zn(e,t,n)}function Wn(e,t,n){var r=e[t];Pe.call(e,t)&&Ra(r,n)&&(void 0!==n||t in e)||zn(e,t,n)}function qn(e,t){for(var n=e.length;n--;)if(Ra(e[n][0],t))return n;return-1}function Gn(e,t,n,r){return er(e,(function(e,i,o){t(r,e,n(e),o)})),r}function Jn(e,t){return e&&vi(t,Cs(t),e)}function zn(e,t,n){"__proto__"==t&&Kt?Kt(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function Kn(e,t){for(var n=-1,i=t.length,o=r(i),a=null==e;++n<i;)o[n]=a?void 0:gs(e,t[n]);return o}function $n(e,t,n){return e==e&&(void 0!==n&&(e=e<=n?e:n),void 0!==t&&(e=e>=t?e:t)),e}function Qn(e,t,n,r,i,o){var a,c=1&t,d=2&t,S=4&t;if(n&&(a=i?n(e,r,i,o):n(e)),void 0!==a)return a;if(!Wa(e))return e;var N=Da(e);if(N){if(a=function(e){var t=e.length,n=new e.constructor(t);t&&"string"==typeof e[0]&&Pe.call(e,"index")&&(n.index=e.index,n.input=e.input);return n}(e),!c)return mi(e,a)}else{var D=no(e),k=D==h||D==p;if(ja(e))return di(e,c);if(D==_||D==s||k&&!i){if(a=d||k?{}:io(e),!c)return d?function(e,t){return vi(e,to(e),t)}(e,function(e,t){return e&&vi(t,Ss(t),e)}(a,e)):function(e,t){return vi(e,eo(e),t)}(e,Jn(a,e))}else{if(!He[D])return i?e:{};a=function(e,t,n){var r=e.constructor;switch(t){case I:return hi(e);case l:case u:return new r(+e);case T:return function(e,t){var n=t?hi(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}(e,n);case P:case E:case O:case b:case A:case R:case"[object Uint8ClampedArray]":case w:case L:return pi(e,n);case f:return new r;case g:case y:return new r(e);case m:return function(e){var t=new e.constructor(e.source,ne.exec(e));return t.lastIndex=e.lastIndex,t}(e);case v:return new r;case C:return i=e,On?ge(On.call(i)):{}}var i}(e,D,c)}}o||(o=new jn);var M=o.get(e);if(M)return M;o.set(e,a),$a(e)?e.forEach((function(r){a.add(Qn(r,t,n,r,e,o))})):Ga(e)&&e.forEach((function(r,i){a.set(i,Qn(r,t,n,i,e,o))}));var F=N?void 0:(S?d?Ji:Gi:d?Ss:Cs)(e);return at(F||e,(function(r,i){F&&(r=e[i=r]),Wn(a,i,Qn(r,t,n,i,e,o))})),a}function Yn(e,t,n){var r=n.length;if(null==e)return!r;for(e=ge(e);r--;){var i=n[r],o=t[i],a=e[i];if(void 0===a&&!(i in e)||!o(a))return!1}return!0}function Zn(e,t,n){if("function"!=typeof e)throw new ve(i);return Co((function(){e.apply(void 0,n)}),t)}function Xn(e,t,n,r){var i=-1,o=ut,a=!0,s=e.length,c=[],l=t.length;if(!s)return c;n&&(t=ht(t,Rt(n))),r?(o=dt,a=!1):t.length>=200&&(o=Lt,a=!1,t=new Fn(t));e:for(;++i<s;){var u=e[i],d=null==n?u:n(u);if(u=r||0!==u?u:0,a&&d==d){for(var h=l;h--;)if(t[h]===d)continue e;c.push(u)}else o(t,d,r)||c.push(u)}return c}An.templateSettings={escape:V,evaluate:H,interpolate:U,variable:"",imports:{_:An}},An.prototype=wn.prototype,An.prototype.constructor=An,Ln.prototype=Rn(wn.prototype),Ln.prototype.constructor=Ln,Nn.prototype=Rn(wn.prototype),Nn.prototype.constructor=Nn,Dn.prototype.clear=function(){this.__data__=mn?mn(null):{},this.size=0},Dn.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Dn.prototype.get=function(e){var t=this.__data__;if(mn){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return Pe.call(t,e)?t[e]:void 0},Dn.prototype.has=function(e){var t=this.__data__;return mn?void 0!==t[e]:Pe.call(t,e)},Dn.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=mn&&void 0===t?"__lodash_hash_undefined__":t,this},kn.prototype.clear=function(){this.__data__=[],this.size=0},kn.prototype.delete=function(e){var t=this.__data__,n=qn(t,e);return!(n<0)&&(n==t.length-1?t.pop():Qe.call(t,n,1),--this.size,!0)},kn.prototype.get=function(e){var t=this.__data__,n=qn(t,e);return n<0?void 0:t[n][1]},kn.prototype.has=function(e){return qn(this.__data__,e)>-1},kn.prototype.set=function(e,t){var n=this.__data__,r=qn(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this},Mn.prototype.clear=function(){this.size=0,this.__data__={hash:new Dn,map:new(pn||kn),string:new Dn}},Mn.prototype.delete=function(e){var t=Yi(this,e).delete(e);return this.size-=t?1:0,t},Mn.prototype.get=function(e){return Yi(this,e).get(e)},Mn.prototype.has=function(e){return Yi(this,e).has(e)},Mn.prototype.set=function(e,t){var n=Yi(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this},Fn.prototype.add=Fn.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},Fn.prototype.has=function(e){return this.__data__.has(e)},jn.prototype.clear=function(){this.__data__=new kn,this.size=0},jn.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},jn.prototype.get=function(e){return this.__data__.get(e)},jn.prototype.has=function(e){return this.__data__.has(e)},jn.prototype.set=function(e,t){var n=this.__data__;if(n instanceof kn){var r=n.__data__;if(!pn||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Mn(r)}return n.set(e,t),this.size=n.size,this};var er=Si(cr),tr=Si(lr,!0);function nr(e,t){var n=!0;return er(e,(function(e,r,i){return n=!!t(e,r,i)})),n}function rr(e,t,n){for(var r=-1,i=e.length;++r<i;){var o=e[r],a=t(o);if(null!=a&&(void 0===s?a==a&&!Ya(a):n(a,s)))var s=a,c=o}return c}function ir(e,t){var n=[];return er(e,(function(e,r,i){t(e,r,i)&&n.push(e)})),n}function or(e,t,n,r,i){var o=-1,a=e.length;for(n||(n=oo),i||(i=[]);++o<a;){var s=e[o];t>0&&n(s)?t>1?or(s,t-1,n,r,i):pt(i,s):r||(i[i.length]=s)}return i}var ar=Ii(),sr=Ii(!0);function cr(e,t){return e&&ar(e,t,Cs)}function lr(e,t){return e&&sr(e,t,Cs)}function ur(e,t){return lt(t,(function(t){return Ha(e[t])}))}function dr(e,t){for(var n=0,r=(t=si(t,e)).length;null!=e&&n<r;)e=e[Oo(t[n++])];return n&&n==r?e:void 0}function hr(e,t,n){var r=t(e);return Da(e)?r:pt(r,n(e))}function pr(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Et&&Et in ge(e)?function(e){var t=Pe.call(e,Et),n=e[Et];try{e[Et]=void 0;var r=!0}catch(e){}var i=be.call(e);r&&(t?e[Et]=n:delete e[Et]);return i}(e):function(e){return be.call(e)}(e)}function fr(e,t){return e>t}function gr(e,t){return null!=e&&Pe.call(e,t)}function _r(e,t){return null!=e&&t in ge(e)}function mr(e,t,n){for(var i=n?dt:ut,o=e[0].length,a=e.length,s=a,c=r(a),l=1/0,u=[];s--;){var d=e[s];s&&t&&(d=ht(d,Rt(t))),l=sn(d.length,l),c[s]=!n&&(t||o>=120&&d.length>=120)?new Fn(s&&d):void 0}d=e[0];var h=-1,p=c[0];e:for(;++h<o&&u.length<l;){var f=d[h],g=t?t(f):f;if(f=n||0!==f?f:0,!(p?Lt(p,g):i(u,g,n))){for(s=a;--s;){var _=c[s];if(!(_?Lt(_,g):i(e[s],g,n)))continue e}p&&p.push(g),u.push(f)}}return u}function vr(e,t,n){var r=null==(e=_o(e,t=si(t,e)))?e:e[Oo(Vo(t))];return null==r?void 0:it(r,e,n)}function yr(e){return qa(e)&&pr(e)==s}function Cr(e,t,n,r,i){return e===t||(null==e||null==t||!qa(e)&&!qa(t)?e!=e&&t!=t:function(e,t,n,r,i,o){var a=Da(e),h=Da(t),p=a?c:no(e),S=h?c:no(t),P=(p=p==s?_:p)==_,E=(S=S==s?_:S)==_,O=p==S;if(O&&ja(e)){if(!ja(t))return!1;a=!0,P=!1}if(O&&!P)return o||(o=new jn),a||Za(e)?Wi(e,t,n,r,i,o):function(e,t,n,r,i,o,a){switch(n){case T:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case I:return!(e.byteLength!=t.byteLength||!o(new Ue(e),new Ue(t)));case l:case u:case g:return Ra(+e,+t);case d:return e.name==t.name&&e.message==t.message;case m:case y:return e==t+"";case f:var s=Vt;case v:var c=1&r;if(s||(s=Bt),e.size!=t.size&&!c)return!1;var h=a.get(e);if(h)return h==t;r|=2,a.set(e,t);var p=Wi(s(e),s(t),r,i,o,a);return a.delete(e),p;case C:if(On)return On.call(e)==On.call(t)}return!1}(e,t,p,n,r,i,o);if(!(1&n)){var b=P&&Pe.call(e,"__wrapped__"),A=E&&Pe.call(t,"__wrapped__");if(b||A){var R=b?e.value():e,w=A?t.value():t;return o||(o=new jn),i(R,w,n,r,o)}}if(!O)return!1;return o||(o=new jn),function(e,t,n,r,i,o){var a=1&n,s=Gi(e),c=s.length,l=Gi(t).length;if(c!=l&&!a)return!1;var u=c;for(;u--;){var d=s[u];if(!(a?d in t:Pe.call(t,d)))return!1}var h=o.get(e),p=o.get(t);if(h&&p)return h==t&&p==e;var f=!0;o.set(e,t),o.set(t,e);var g=a;for(;++u<c;){d=s[u];var _=e[d],m=t[d];if(r)var v=a?r(m,_,d,t,e,o):r(_,m,d,e,t,o);if(!(void 0===v?_===m||i(_,m,n,r,o):v)){f=!1;break}g||(g="constructor"==d)}if(f&&!g){var y=e.constructor,C=t.constructor;y==C||!("constructor"in e)||!("constructor"in t)||"function"==typeof y&&y instanceof y&&"function"==typeof C&&C instanceof C||(f=!1)}return o.delete(e),o.delete(t),f}(e,t,n,r,i,o)}(e,t,n,r,Cr,i))}function Sr(e,t,n,r){var i=n.length,o=i,a=!r;if(null==e)return!o;for(e=ge(e);i--;){var s=n[i];if(a&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++i<o;){var c=(s=n[i])[0],l=e[c],u=s[1];if(a&&s[2]){if(void 0===l&&!(c in e))return!1}else{var d=new jn;if(r)var h=r(l,u,c,e,t,d);if(!(void 0===h?Cr(u,l,3,r,d):h))return!1}}return!0}function Ir(e){return!(!Wa(e)||(t=e,Oe&&Oe in t))&&(Ha(e)?we:oe).test(bo(e));var t}function Tr(e){return"function"==typeof e?e:null==e?Js:"object"==typeof e?Da(e)?Rr(e[0],e[1]):Ar(e):tc(e)}function Pr(e){if(!ho(e))return on(e);var t=[];for(var n in ge(e))Pe.call(e,n)&&"constructor"!=n&&t.push(n);return t}function Er(e){if(!Wa(e))return function(e){var t=[];if(null!=e)for(var n in ge(e))t.push(n);return t}(e);var t=ho(e),n=[];for(var r in e)("constructor"!=r||!t&&Pe.call(e,r))&&n.push(r);return n}function Or(e,t){return e<t}function br(e,t){var n=-1,i=Ma(e)?r(e.length):[];return er(e,(function(e,r,o){i[++n]=t(e,r,o)})),i}function Ar(e){var t=Zi(e);return 1==t.length&&t[0][2]?fo(t[0][0],t[0][1]):function(n){return n===e||Sr(n,e,t)}}function Rr(e,t){return co(e)&&po(t)?fo(Oo(e),t):function(n){var r=gs(n,e);return void 0===r&&r===t?_s(n,e):Cr(t,r,3)}}function wr(e,t,n,r,i){e!==t&&ar(t,(function(o,a){if(i||(i=new jn),Wa(o))!function(e,t,n,r,i,o,a){var s=vo(e,n),c=vo(t,n),l=a.get(c);if(l)return void Bn(e,n,l);var u=o?o(s,c,n+"",e,t,a):void 0,d=void 0===u;if(d){var h=Da(c),p=!h&&ja(c),f=!h&&!p&&Za(c);u=c,h||p||f?Da(s)?u=s:Fa(s)?u=mi(s):p?(d=!1,u=di(c,!0)):f?(d=!1,u=pi(c,!0)):u=[]:za(c)||Na(c)?(u=s,Na(s)?u=as(s):Wa(s)&&!Ha(s)||(u=io(c))):d=!1}d&&(a.set(c,u),i(u,c,r,o,a),a.delete(c));Bn(e,n,u)}(e,t,a,n,wr,r,i);else{var s=r?r(vo(e,a),o,a+"",e,t,i):void 0;void 0===s&&(s=o),Bn(e,a,s)}}),Ss)}function Lr(e,t){var n=e.length;if(n)return ao(t+=t<0?n:0,n)?e[t]:void 0}function Nr(e,t,n){t=t.length?ht(t,(function(e){return Da(e)?function(t){return dr(t,1===e.length?e[0]:e)}:e})):[Js];var r=-1;return t=ht(t,Rt(Qi())),function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}(br(e,(function(e,n,i){return{criteria:ht(t,(function(t){return t(e)})),index:++r,value:e}})),(function(e,t){return function(e,t,n){var r=-1,i=e.criteria,o=t.criteria,a=i.length,s=n.length;for(;++r<a;){var c=fi(i[r],o[r]);if(c){if(r>=s)return c;var l=n[r];return c*("desc"==l?-1:1)}}return e.index-t.index}(e,t,n)}))}function Dr(e,t,n){for(var r=-1,i=t.length,o={};++r<i;){var a=t[r],s=dr(e,a);n(s,a)&&Ur(o,si(a,e),s)}return o}function kr(e,t,n,r){var i=r?St:Ct,o=-1,a=t.length,s=e;for(e===t&&(t=mi(t)),n&&(s=ht(e,Rt(n)));++o<a;)for(var c=0,l=t[o],u=n?n(l):l;(c=i(s,u,c,r))>-1;)s!==e&&Qe.call(s,c,1),Qe.call(e,c,1);return e}function Mr(e,t){for(var n=e?t.length:0,r=n-1;n--;){var i=t[n];if(n==r||i!==o){var o=i;ao(i)?Qe.call(e,i,1):Xr(e,i)}}return e}function Fr(e,t){return e+Xt(un()*(t-e+1))}function jr(e,t){var n="";if(!e||t<1||t>9007199254740991)return n;do{t%2&&(n+=e),(t=Xt(t/2))&&(e+=e)}while(t);return n}function xr(e,t){return So(go(e,t,Js),e+"")}function Vr(e){return Vn(Rs(e))}function Hr(e,t){var n=Rs(e);return Po(n,$n(t,0,n.length))}function Ur(e,t,n,r){if(!Wa(e))return e;for(var i=-1,o=(t=si(t,e)).length,a=o-1,s=e;null!=s&&++i<o;){var c=Oo(t[i]),l=n;if("__proto__"===c||"constructor"===c||"prototype"===c)return e;if(i!=a){var u=s[c];void 0===(l=r?r(u,c,s):void 0)&&(l=Wa(u)?u:ao(t[i+1])?[]:{})}Wn(s,c,l),s=s[c]}return e}var Br=vn?function(e,t){return vn.set(e,t),e}:Js,Wr=Kt?function(e,t){return Kt(e,"toString",{configurable:!0,enumerable:!1,value:Ws(t),writable:!0})}:Js;function qr(e){return Po(Rs(e))}function Gr(e,t,n){var i=-1,o=e.length;t<0&&(t=-t>o?0:o+t),(n=n>o?o:n)<0&&(n+=o),o=t>n?0:n-t>>>0,t>>>=0;for(var a=r(o);++i<o;)a[i]=e[i+t];return a}function Jr(e,t){var n;return er(e,(function(e,r,i){return!(n=t(e,r,i))})),!!n}function zr(e,t,n){var r=0,i=null==e?r:e.length;if("number"==typeof t&&t==t&&i<=2147483647){for(;r<i;){var o=r+i>>>1,a=e[o];null!==a&&!Ya(a)&&(n?a<=t:a<t)?r=o+1:i=o}return i}return Kr(e,t,Js,n)}function Kr(e,t,n,r){var i=0,o=null==e?0:e.length;if(0===o)return 0;for(var a=(t=n(t))!=t,s=null===t,c=Ya(t),l=void 0===t;i<o;){var u=Xt((i+o)/2),d=n(e[u]),h=void 0!==d,p=null===d,f=d==d,g=Ya(d);if(a)var _=r||f;else _=l?f&&(r||h):s?f&&h&&(r||!p):c?f&&h&&!p&&(r||!g):!p&&!g&&(r?d<=t:d<t);_?i=u+1:o=u}return sn(o,4294967294)}function $r(e,t){for(var n=-1,r=e.length,i=0,o=[];++n<r;){var a=e[n],s=t?t(a):a;if(!n||!Ra(s,c)){var c=s;o[i++]=0===a?0:a}}return o}function Qr(e){return"number"==typeof e?e:Ya(e)?NaN:+e}function Yr(e){if("string"==typeof e)return e;if(Da(e))return ht(e,Yr)+"";if(Ya(e))return bn?bn.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function Zr(e,t,n){var r=-1,i=ut,o=e.length,a=!0,s=[],c=s;if(n)a=!1,i=dt;else if(o>=200){var l=t?null:ji(e);if(l)return Bt(l);a=!1,i=Lt,c=new Fn}else c=t?[]:s;e:for(;++r<o;){var u=e[r],d=t?t(u):u;if(u=n||0!==u?u:0,a&&d==d){for(var h=c.length;h--;)if(c[h]===d)continue e;t&&c.push(d),s.push(u)}else i(c,d,n)||(c!==s&&c.push(d),s.push(u))}return s}function Xr(e,t){return null==(e=_o(e,t=si(t,e)))||delete e[Oo(Vo(t))]}function ei(e,t,n,r){return Ur(e,t,n(dr(e,t)),r)}function ti(e,t,n,r){for(var i=e.length,o=r?i:-1;(r?o--:++o<i)&&t(e[o],o,e););return n?Gr(e,r?0:o,r?o+1:i):Gr(e,r?o+1:0,r?i:o)}function ni(e,t){var n=e;return n instanceof Nn&&(n=n.value()),ft(t,(function(e,t){return t.func.apply(t.thisArg,pt([e],t.args))}),n)}function ri(e,t,n){var i=e.length;if(i<2)return i?Zr(e[0]):[];for(var o=-1,a=r(i);++o<i;)for(var s=e[o],c=-1;++c<i;)c!=o&&(a[o]=Xn(a[o]||s,e[c],t,n));return Zr(or(a,1),t,n)}function ii(e,t,n){for(var r=-1,i=e.length,o=t.length,a={};++r<i;){var s=r<o?t[r]:void 0;n(a,e[r],s)}return a}function oi(e){return Fa(e)?e:[]}function ai(e){return"function"==typeof e?e:Js}function si(e,t){return Da(e)?e:co(e,t)?[e]:Eo(ss(e))}var ci=xr;function li(e,t,n){var r=e.length;return n=void 0===n?r:n,!t&&n>=r?e:Gr(e,t,n)}var ui=$t||function(e){return Je.clearTimeout(e)};function di(e,t){if(t)return e.slice();var n=e.length,r=qe?qe(n):new e.constructor(n);return e.copy(r),r}function hi(e){var t=new e.constructor(e.byteLength);return new Ue(t).set(new Ue(e)),t}function pi(e,t){var n=t?hi(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function fi(e,t){if(e!==t){var n=void 0!==e,r=null===e,i=e==e,o=Ya(e),a=void 0!==t,s=null===t,c=t==t,l=Ya(t);if(!s&&!l&&!o&&e>t||o&&a&&c&&!s&&!l||r&&a&&c||!n&&c||!i)return 1;if(!r&&!o&&!l&&e<t||l&&n&&i&&!r&&!o||s&&n&&i||!a&&i||!c)return-1}return 0}function gi(e,t,n,i){for(var o=-1,a=e.length,s=n.length,c=-1,l=t.length,u=an(a-s,0),d=r(l+u),h=!i;++c<l;)d[c]=t[c];for(;++o<s;)(h||o<a)&&(d[n[o]]=e[o]);for(;u--;)d[c++]=e[o++];return d}function _i(e,t,n,i){for(var o=-1,a=e.length,s=-1,c=n.length,l=-1,u=t.length,d=an(a-c,0),h=r(d+u),p=!i;++o<d;)h[o]=e[o];for(var f=o;++l<u;)h[f+l]=t[l];for(;++s<c;)(p||o<a)&&(h[f+n[s]]=e[o++]);return h}function mi(e,t){var n=-1,i=e.length;for(t||(t=r(i));++n<i;)t[n]=e[n];return t}function vi(e,t,n,r){var i=!n;n||(n={});for(var o=-1,a=t.length;++o<a;){var s=t[o],c=r?r(n[s],e[s],s,n,e):void 0;void 0===c&&(c=e[s]),i?zn(n,s,c):Wn(n,s,c)}return n}function yi(e,t){return function(n,r){var i=Da(n)?ot:Gn,o=t?t():{};return i(n,e,Qi(r,2),o)}}function Ci(e){return xr((function(t,n){var r=-1,i=n.length,o=i>1?n[i-1]:void 0,a=i>2?n[2]:void 0;for(o=e.length>3&&"function"==typeof o?(i--,o):void 0,a&&so(n[0],n[1],a)&&(o=i<3?void 0:o,i=1),t=ge(t);++r<i;){var s=n[r];s&&e(t,s,r,o)}return t}))}function Si(e,t){return function(n,r){if(null==n)return n;if(!Ma(n))return e(n,r);for(var i=n.length,o=t?i:-1,a=ge(n);(t?o--:++o<i)&&!1!==r(a[o],o,a););return n}}function Ii(e){return function(t,n,r){for(var i=-1,o=ge(t),a=r(t),s=a.length;s--;){var c=a[e?s:++i];if(!1===n(o[c],c,o))break}return t}}function Ti(e){return function(t){var n=xt(t=ss(t))?Gt(t):void 0,r=n?n[0]:t.charAt(0),i=n?li(n,1).join(""):t.slice(1);return r[e]()+i}}function Pi(e){return function(t){return ft(Hs(Ns(t).replace(Le,"")),e,"")}}function Ei(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=Rn(e.prototype),r=e.apply(n,t);return Wa(r)?r:n}}function Oi(e){return function(t,n,r){var i=ge(t);if(!Ma(t)){var o=Qi(n,3);t=Cs(t),n=function(e){return o(i[e],e,i)}}var a=e(t,n,r);return a>-1?i[o?t[a]:a]:void 0}}function bi(e){return qi((function(t){var n=t.length,r=n,o=Ln.prototype.thru;for(e&&t.reverse();r--;){var a=t[r];if("function"!=typeof a)throw new ve(i);if(o&&!s&&"wrapper"==Ki(a))var s=new Ln([],!0)}for(r=s?r:n;++r<n;){var c=Ki(a=t[r]),l="wrapper"==c?zi(a):void 0;s=l&&lo(l[0])&&424==l[1]&&!l[4].length&&1==l[9]?s[Ki(l[0])].apply(s,l[3]):1==a.length&&lo(a)?s[c]():s.thru(a)}return function(){var e=arguments,r=e[0];if(s&&1==e.length&&Da(r))return s.plant(r).value();for(var i=0,o=n?t[i].apply(this,e):r;++i<n;)o=t[i].call(this,o);return o}}))}function Ai(e,t,n,i,o,a,s,c,l,u){var d=128&t,h=1&t,p=2&t,f=24&t,g=512&t,_=p?void 0:Ei(e);return function m(){for(var v=arguments.length,y=r(v),C=v;C--;)y[C]=arguments[C];if(f)var S=$i(m),I=kt(y,S);if(i&&(y=gi(y,i,o,f)),a&&(y=_i(y,a,s,f)),v-=I,f&&v<u){var T=Ut(y,S);return Mi(e,t,Ai,m.placeholder,n,y,T,c,l,u-v)}var P=h?n:this,E=p?P[e]:e;return v=y.length,c?y=mo(y,c):g&&v>1&&y.reverse(),d&&l<v&&(y.length=l),this&&this!==Je&&this instanceof m&&(E=_||Ei(E)),E.apply(P,y)}}function Ri(e,t){return function(n,r){return function(e,t,n,r){return cr(e,(function(e,i,o){t(r,n(e),i,o)})),r}(n,e,t(r),{})}}function wi(e,t){return function(n,r){var i;if(void 0===n&&void 0===r)return t;if(void 0!==n&&(i=n),void 0!==r){if(void 0===i)return r;"string"==typeof n||"string"==typeof r?(n=Yr(n),r=Yr(r)):(n=Qr(n),r=Qr(r)),i=e(n,r)}return i}}function Li(e){return qi((function(t){return t=ht(t,Rt(Qi())),xr((function(n){var r=this;return e(t,(function(e){return it(e,r,n)}))}))}))}function Ni(e,t){var n=(t=void 0===t?" ":Yr(t)).length;if(n<2)return n?jr(t,e):t;var r=jr(t,Zt(e/qt(t)));return xt(t)?li(Gt(r),0,e).join(""):r.slice(0,e)}function Di(e){return function(t,n,i){return i&&"number"!=typeof i&&so(t,n,i)&&(n=i=void 0),t=ns(t),void 0===n?(n=t,t=0):n=ns(n),function(e,t,n,i){for(var o=-1,a=an(Zt((t-e)/(n||1)),0),s=r(a);a--;)s[i?a:++o]=e,e+=n;return s}(t,n,i=void 0===i?t<n?1:-1:ns(i),e)}}function ki(e){return function(t,n){return"string"==typeof t&&"string"==typeof n||(t=os(t),n=os(n)),e(t,n)}}function Mi(e,t,n,r,i,o,a,s,c,l){var u=8&t;t|=u?32:64,4&(t&=~(u?64:32))||(t&=-4);var d=[e,t,i,u?o:void 0,u?a:void 0,u?void 0:o,u?void 0:a,s,c,l],h=n.apply(void 0,d);return lo(e)&&yo(h,d),h.placeholder=r,Io(h,e,t)}function Fi(e){var t=fe[e];return function(e,n){if(e=os(e),(n=null==n?0:sn(rs(n),292))&&nn(e)){var r=(ss(e)+"e").split("e");return+((r=(ss(t(r[0]+"e"+(+r[1]+n)))+"e").split("e"))[0]+"e"+(+r[1]-n))}return t(e)}}var ji=gn&&1/Bt(new gn([,-0]))[1]==1/0?function(e){return new gn(e)}:Ys;function xi(e){return function(t){var n=no(t);return n==f?Vt(t):n==v?Wt(t):function(e,t){return ht(t,(function(t){return[t,e[t]]}))}(t,e(t))}}function Vi(e,t,n,a,s,c,l,u){var d=2&t;if(!d&&"function"!=typeof e)throw new ve(i);var h=a?a.length:0;if(h||(t&=-97,a=s=void 0),l=void 0===l?l:an(rs(l),0),u=void 0===u?u:rs(u),h-=s?s.length:0,64&t){var p=a,f=s;a=s=void 0}var g=d?void 0:zi(e),_=[e,t,n,a,s,p,f,c,l,u];if(g&&function(e,t){var n=e[1],r=t[1],i=n|r,a=i<131,s=128==r&&8==n||128==r&&256==n&&e[7].length<=t[8]||384==r&&t[7].length<=t[8]&&8==n;if(!a&&!s)return e;1&r&&(e[2]=t[2],i|=1&n?0:4);var c=t[3];if(c){var l=e[3];e[3]=l?gi(l,c,t[4]):c,e[4]=l?Ut(e[3],o):t[4]}(c=t[5])&&(l=e[5],e[5]=l?_i(l,c,t[6]):c,e[6]=l?Ut(e[5],o):t[6]);(c=t[7])&&(e[7]=c);128&r&&(e[8]=null==e[8]?t[8]:sn(e[8],t[8]));null==e[9]&&(e[9]=t[9]);e[0]=t[0],e[1]=i}(_,g),e=_[0],t=_[1],n=_[2],a=_[3],s=_[4],!(u=_[9]=void 0===_[9]?d?0:e.length:an(_[9]-h,0))&&24&t&&(t&=-25),t&&1!=t)m=8==t||16==t?function(e,t,n){var i=Ei(e);return function o(){for(var a=arguments.length,s=r(a),c=a,l=$i(o);c--;)s[c]=arguments[c];var u=a<3&&s[0]!==l&&s[a-1]!==l?[]:Ut(s,l);if((a-=u.length)<n)return Mi(e,t,Ai,o.placeholder,void 0,s,u,void 0,void 0,n-a);var d=this&&this!==Je&&this instanceof o?i:e;return it(d,this,s)}}(e,t,u):32!=t&&33!=t||s.length?Ai.apply(void 0,_):function(e,t,n,i){var o=1&t,a=Ei(e);return function t(){for(var s=-1,c=arguments.length,l=-1,u=i.length,d=r(u+c),h=this&&this!==Je&&this instanceof t?a:e;++l<u;)d[l]=i[l];for(;c--;)d[l++]=arguments[++s];return it(h,o?n:this,d)}}(e,t,n,a);else var m=function(e,t,n){var r=1&t,i=Ei(e);return function t(){var o=this&&this!==Je&&this instanceof t?i:e;return o.apply(r?n:this,arguments)}}(e,t,n);return Io((g?Br:yo)(m,_),e,t)}function Hi(e,t,n,r){return void 0===e||Ra(e,Se[n])&&!Pe.call(r,n)?t:e}function Ui(e,t,n,r,i,o){return Wa(e)&&Wa(t)&&(o.set(t,e),wr(e,t,void 0,Ui,o),o.delete(t)),e}function Bi(e){return za(e)?void 0:e}function Wi(e,t,n,r,i,o){var a=1&n,s=e.length,c=t.length;if(s!=c&&!(a&&c>s))return!1;var l=o.get(e),u=o.get(t);if(l&&u)return l==t&&u==e;var d=-1,h=!0,p=2&n?new Fn:void 0;for(o.set(e,t),o.set(t,e);++d<s;){var f=e[d],g=t[d];if(r)var _=a?r(g,f,d,t,e,o):r(f,g,d,e,t,o);if(void 0!==_){if(_)continue;h=!1;break}if(p){if(!_t(t,(function(e,t){if(!Lt(p,t)&&(f===e||i(f,e,n,r,o)))return p.push(t)}))){h=!1;break}}else if(f!==g&&!i(f,g,n,r,o)){h=!1;break}}return o.delete(e),o.delete(t),h}function qi(e){return So(go(e,void 0,ko),e+"")}function Gi(e){return hr(e,Cs,eo)}function Ji(e){return hr(e,Ss,to)}var zi=vn?function(e){return vn.get(e)}:Ys;function Ki(e){for(var t=e.name+"",n=yn[t],r=Pe.call(yn,t)?n.length:0;r--;){var i=n[r],o=i.func;if(null==o||o==e)return i.name}return t}function $i(e){return(Pe.call(An,"placeholder")?An:e).placeholder}function Qi(){var e=An.iteratee||zs;return e=e===zs?Tr:e,arguments.length?e(arguments[0],arguments[1]):e}function Yi(e,t){var n,r,i=e.__data__;return("string"==(r=typeof(n=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof t?"string":"hash"]:i.map}function Zi(e){for(var t=Cs(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,po(i)]}return t}function Xi(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return Ir(n)?n:void 0}var eo=en?function(e){return null==e?[]:(e=ge(e),lt(en(e),(function(t){return Ke.call(e,t)})))}:ic,to=en?function(e){for(var t=[];e;)pt(t,eo(e)),e=Ge(e);return t}:ic,no=pr;function ro(e,t,n){for(var r=-1,i=(t=si(t,e)).length,o=!1;++r<i;){var a=Oo(t[r]);if(!(o=null!=e&&n(e,a)))break;e=e[a]}return o||++r!=i?o:!!(i=null==e?0:e.length)&&Ba(i)&&ao(a,i)&&(Da(e)||Na(e))}function io(e){return"function"!=typeof e.constructor||ho(e)?{}:Rn(Ge(e))}function oo(e){return Da(e)||Na(e)||!!(Ye&&e&&e[Ye])}function ao(e,t){var n=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&se.test(e))&&e>-1&&e%1==0&&e<t}function so(e,t,n){if(!Wa(n))return!1;var r=typeof t;return!!("number"==r?Ma(n)&&ao(t,n.length):"string"==r&&t in n)&&Ra(n[t],e)}function co(e,t){if(Da(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!Ya(e))||(W.test(e)||!B.test(e)||null!=t&&e in ge(t))}function lo(e){var t=Ki(e),n=An[t];if("function"!=typeof n||!(t in Nn.prototype))return!1;if(e===n)return!0;var r=zi(n);return!!r&&e===r[0]}(hn&&no(new hn(new ArrayBuffer(1)))!=T||pn&&no(new pn)!=f||fn&&"[object Promise]"!=no(fn.resolve())||gn&&no(new gn)!=v||_n&&no(new _n)!=S)&&(no=function(e){var t=pr(e),n=t==_?e.constructor:void 0,r=n?bo(n):"";if(r)switch(r){case Cn:return T;case Sn:return f;case In:return"[object Promise]";case Tn:return v;case Pn:return S}return t});var uo=Ie?Ha:oc;function ho(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Se)}function po(e){return e==e&&!Wa(e)}function fo(e,t){return function(n){return null!=n&&(n[e]===t&&(void 0!==t||e in ge(n)))}}function go(e,t,n){return t=an(void 0===t?e.length-1:t,0),function(){for(var i=arguments,o=-1,a=an(i.length-t,0),s=r(a);++o<a;)s[o]=i[t+o];o=-1;for(var c=r(t+1);++o<t;)c[o]=i[o];return c[t]=n(s),it(e,this,c)}}function _o(e,t){return t.length<2?e:dr(e,Gr(t,0,-1))}function mo(e,t){for(var n=e.length,r=sn(t.length,n),i=mi(e);r--;){var o=t[r];e[r]=ao(o,n)?i[o]:void 0}return e}function vo(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}var yo=To(Br),Co=Yt||function(e,t){return Je.setTimeout(e,t)},So=To(Wr);function Io(e,t,n){var r=t+"";return So(e,function(e,t){var n=t.length;if(!n)return e;var r=n-1;return t[r]=(n>1?"& ":"")+t[r],t=t.join(n>2?", ":" "),e.replace(Q,"{\n/* [wrapped with "+t+"] */\n")}(r,function(e,t){return at(a,(function(n){var r="_."+n[0];t&n[1]&&!ut(e,r)&&e.push(r)})),e.sort()}(function(e){var t=e.match(Y);return t?t[1].split(Z):[]}(r),n)))}function To(e){var t=0,n=0;return function(){var r=cn(),i=16-(r-n);if(n=r,i>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}function Po(e,t){var n=-1,r=e.length,i=r-1;for(t=void 0===t?r:t;++n<t;){var o=Fr(n,i),a=e[o];e[o]=e[n],e[n]=a}return e.length=t,e}var Eo=function(e){var t=Ta(e,(function(e){return 500===n.size&&n.clear(),e})),n=t.cache;return t}((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(q,(function(e,n,r,i){t.push(r?i.replace(ee,"$1"):n||e)})),t}));function Oo(e){if("string"==typeof e||Ya(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function bo(e){if(null!=e){try{return Te.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Ao(e){if(e instanceof Nn)return e.clone();var t=new Ln(e.__wrapped__,e.__chain__);return t.__actions__=mi(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}var Ro=xr((function(e,t){return Fa(e)?Xn(e,or(t,1,Fa,!0)):[]})),wo=xr((function(e,t){var n=Vo(t);return Fa(n)&&(n=void 0),Fa(e)?Xn(e,or(t,1,Fa,!0),Qi(n,2)):[]})),Lo=xr((function(e,t){var n=Vo(t);return Fa(n)&&(n=void 0),Fa(e)?Xn(e,or(t,1,Fa,!0),void 0,n):[]}));function No(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=null==n?0:rs(n);return i<0&&(i=an(r+i,0)),yt(e,Qi(t,3),i)}function Do(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=r-1;return void 0!==n&&(i=rs(n),i=n<0?an(r+i,0):sn(i,r-1)),yt(e,Qi(t,3),i,!0)}function ko(e){return(null==e?0:e.length)?or(e,1):[]}function Mo(e){return e&&e.length?e[0]:void 0}var Fo=xr((function(e){var t=ht(e,oi);return t.length&&t[0]===e[0]?mr(t):[]})),jo=xr((function(e){var t=Vo(e),n=ht(e,oi);return t===Vo(n)?t=void 0:n.pop(),n.length&&n[0]===e[0]?mr(n,Qi(t,2)):[]})),xo=xr((function(e){var t=Vo(e),n=ht(e,oi);return(t="function"==typeof t?t:void 0)&&n.pop(),n.length&&n[0]===e[0]?mr(n,void 0,t):[]}));function Vo(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}var Ho=xr(Uo);function Uo(e,t){return e&&e.length&&t&&t.length?kr(e,t):e}var Bo=qi((function(e,t){var n=null==e?0:e.length,r=Kn(e,t);return Mr(e,ht(t,(function(e){return ao(e,n)?+e:e})).sort(fi)),r}));function Wo(e){return null==e?e:dn.call(e)}var qo=xr((function(e){return Zr(or(e,1,Fa,!0))})),Go=xr((function(e){var t=Vo(e);return Fa(t)&&(t=void 0),Zr(or(e,1,Fa,!0),Qi(t,2))})),Jo=xr((function(e){var t=Vo(e);return t="function"==typeof t?t:void 0,Zr(or(e,1,Fa,!0),void 0,t)}));function zo(e){if(!e||!e.length)return[];var t=0;return e=lt(e,(function(e){if(Fa(e))return t=an(e.length,t),!0})),At(t,(function(t){return ht(e,Pt(t))}))}function Ko(e,t){if(!e||!e.length)return[];var n=zo(e);return null==t?n:ht(n,(function(e){return it(t,void 0,e)}))}var $o=xr((function(e,t){return Fa(e)?Xn(e,t):[]})),Qo=xr((function(e){return ri(lt(e,Fa))})),Yo=xr((function(e){var t=Vo(e);return Fa(t)&&(t=void 0),ri(lt(e,Fa),Qi(t,2))})),Zo=xr((function(e){var t=Vo(e);return t="function"==typeof t?t:void 0,ri(lt(e,Fa),void 0,t)})),Xo=xr(zo);var ea=xr((function(e){var t=e.length,n=t>1?e[t-1]:void 0;return n="function"==typeof n?(e.pop(),n):void 0,Ko(e,n)}));function ta(e){var t=An(e);return t.__chain__=!0,t}function na(e,t){return t(e)}var ra=qi((function(e){var t=e.length,n=t?e[0]:0,r=this.__wrapped__,i=function(t){return Kn(t,e)};return!(t>1||this.__actions__.length)&&r instanceof Nn&&ao(n)?((r=r.slice(n,+n+(t?1:0))).__actions__.push({func:na,args:[i],thisArg:void 0}),new Ln(r,this.__chain__).thru((function(e){return t&&!e.length&&e.push(void 0),e}))):this.thru(i)}));var ia=yi((function(e,t,n){Pe.call(e,n)?++e[n]:zn(e,n,1)}));var oa=Oi(No),aa=Oi(Do);function sa(e,t){return(Da(e)?at:er)(e,Qi(t,3))}function ca(e,t){return(Da(e)?st:tr)(e,Qi(t,3))}var la=yi((function(e,t,n){Pe.call(e,n)?e[n].push(t):zn(e,n,[t])}));var ua=xr((function(e,t,n){var i=-1,o="function"==typeof t,a=Ma(e)?r(e.length):[];return er(e,(function(e){a[++i]=o?it(t,e,n):vr(e,t,n)})),a})),da=yi((function(e,t,n){zn(e,n,t)}));function ha(e,t){return(Da(e)?ht:br)(e,Qi(t,3))}var pa=yi((function(e,t,n){e[n?0:1].push(t)}),(function(){return[[],[]]}));var fa=xr((function(e,t){if(null==e)return[];var n=t.length;return n>1&&so(e,t[0],t[1])?t=[]:n>2&&so(t[0],t[1],t[2])&&(t=[t[0]]),Nr(e,or(t,1),[])})),ga=Qt||function(){return Je.Date.now()};function _a(e,t,n){return t=n?void 0:t,Vi(e,128,void 0,void 0,void 0,void 0,t=e&&null==t?e.length:t)}function ma(e,t){var n;if("function"!=typeof t)throw new ve(i);return e=rs(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=void 0),n}}var va=xr((function(e,t,n){var r=1;if(n.length){var i=Ut(n,$i(va));r|=32}return Vi(e,r,t,n,i)})),ya=xr((function(e,t,n){var r=3;if(n.length){var i=Ut(n,$i(ya));r|=32}return Vi(t,r,e,n,i)}));function Ca(e,t,n){var r,o,a,s,c,l,u=0,d=!1,h=!1,p=!0;if("function"!=typeof e)throw new ve(i);function f(t){var n=r,i=o;return r=o=void 0,u=t,s=e.apply(i,n)}function g(e){return u=e,c=Co(m,t),d?f(e):s}function _(e){var n=e-l;return void 0===l||n>=t||n<0||h&&e-u>=a}function m(){var e=ga();if(_(e))return v(e);c=Co(m,function(e){var n=t-(e-l);return h?sn(n,a-(e-u)):n}(e))}function v(e){return c=void 0,p&&r?f(e):(r=o=void 0,s)}function y(){var e=ga(),n=_(e);if(r=arguments,o=this,l=e,n){if(void 0===c)return g(l);if(h)return ui(c),c=Co(m,t),f(l)}return void 0===c&&(c=Co(m,t)),s}return t=os(t)||0,Wa(n)&&(d=!!n.leading,a=(h="maxWait"in n)?an(os(n.maxWait)||0,t):a,p="trailing"in n?!!n.trailing:p),y.cancel=function(){void 0!==c&&ui(c),u=0,r=l=o=c=void 0},y.flush=function(){return void 0===c?s:v(ga())},y}var Sa=xr((function(e,t){return Zn(e,1,t)})),Ia=xr((function(e,t,n){return Zn(e,os(t)||0,n)}));function Ta(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new ve(i);var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=e.apply(this,r);return n.cache=o.set(i,a)||o,a};return n.cache=new(Ta.Cache||Mn),n}function Pa(e){if("function"!=typeof e)throw new ve(i);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}Ta.Cache=Mn;var Ea=ci((function(e,t){var n=(t=1==t.length&&Da(t[0])?ht(t[0],Rt(Qi())):ht(or(t,1),Rt(Qi()))).length;return xr((function(r){for(var i=-1,o=sn(r.length,n);++i<o;)r[i]=t[i].call(this,r[i]);return it(e,this,r)}))})),Oa=xr((function(e,t){return Vi(e,32,void 0,t,Ut(t,$i(Oa)))})),ba=xr((function(e,t){return Vi(e,64,void 0,t,Ut(t,$i(ba)))})),Aa=qi((function(e,t){return Vi(e,256,void 0,void 0,void 0,t)}));function Ra(e,t){return e===t||e!=e&&t!=t}var wa=ki(fr),La=ki((function(e,t){return e>=t})),Na=yr(function(){return arguments}())?yr:function(e){return qa(e)&&Pe.call(e,"callee")&&!Ke.call(e,"callee")},Da=r.isArray,ka=Ze?Rt(Ze):function(e){return qa(e)&&pr(e)==I};function Ma(e){return null!=e&&Ba(e.length)&&!Ha(e)}function Fa(e){return qa(e)&&Ma(e)}var ja=tn||oc,xa=Xe?Rt(Xe):function(e){return qa(e)&&pr(e)==u};function Va(e){if(!qa(e))return!1;var t=pr(e);return t==d||"[object DOMException]"==t||"string"==typeof e.message&&"string"==typeof e.name&&!za(e)}function Ha(e){if(!Wa(e))return!1;var t=pr(e);return t==h||t==p||"[object AsyncFunction]"==t||"[object Proxy]"==t}function Ua(e){return"number"==typeof e&&e==rs(e)}function Ba(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}function Wa(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function qa(e){return null!=e&&"object"==typeof e}var Ga=et?Rt(et):function(e){return qa(e)&&no(e)==f};function Ja(e){return"number"==typeof e||qa(e)&&pr(e)==g}function za(e){if(!qa(e)||pr(e)!=_)return!1;var t=Ge(e);if(null===t)return!0;var n=Pe.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&Te.call(n)==Ae}var Ka=tt?Rt(tt):function(e){return qa(e)&&pr(e)==m};var $a=nt?Rt(nt):function(e){return qa(e)&&no(e)==v};function Qa(e){return"string"==typeof e||!Da(e)&&qa(e)&&pr(e)==y}function Ya(e){return"symbol"==typeof e||qa(e)&&pr(e)==C}var Za=rt?Rt(rt):function(e){return qa(e)&&Ba(e.length)&&!!Ve[pr(e)]};var Xa=ki(Or),es=ki((function(e,t){return e<=t}));function ts(e){if(!e)return[];if(Ma(e))return Qa(e)?Gt(e):mi(e);if(mt&&e[mt])return function(e){for(var t,n=[];!(t=e.next()).done;)n.push(t.value);return n}(e[mt]());var t=no(e);return(t==f?Vt:t==v?Bt:Rs)(e)}function ns(e){return e?(e=os(e))===1/0||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}function rs(e){var t=ns(e),n=t%1;return t==t?n?t-n:t:0}function is(e){return e?$n(rs(e),0,4294967295):0}function os(e){if("number"==typeof e)return e;if(Ya(e))return NaN;if(Wa(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Wa(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(z,"");var n=ie.test(e);return n||ae.test(e)?We(e.slice(2),n?2:8):re.test(e)?NaN:+e}function as(e){return vi(e,Ss(e))}function ss(e){return null==e?"":Yr(e)}var cs=Ci((function(e,t){if(ho(t)||Ma(t))vi(t,Cs(t),e);else for(var n in t)Pe.call(t,n)&&Wn(e,n,t[n])})),ls=Ci((function(e,t){vi(t,Ss(t),e)})),us=Ci((function(e,t,n,r){vi(t,Ss(t),e,r)})),ds=Ci((function(e,t,n,r){vi(t,Cs(t),e,r)})),hs=qi(Kn);var ps=xr((function(e,t){e=ge(e);var n=-1,r=t.length,i=r>2?t[2]:void 0;for(i&&so(t[0],t[1],i)&&(r=1);++n<r;)for(var o=t[n],a=Ss(o),s=-1,c=a.length;++s<c;){var l=a[s],u=e[l];(void 0===u||Ra(u,Se[l])&&!Pe.call(e,l))&&(e[l]=o[l])}return e})),fs=xr((function(e){return e.push(void 0,Ui),it(Ts,void 0,e)}));function gs(e,t,n){var r=null==e?void 0:dr(e,t);return void 0===r?n:r}function _s(e,t){return null!=e&&ro(e,t,_r)}var ms=Ri((function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=be.call(t)),e[t]=n}),Ws(Js)),vs=Ri((function(e,t,n){null!=t&&"function"!=typeof t.toString&&(t=be.call(t)),Pe.call(e,t)?e[t].push(n):e[t]=[n]}),Qi),ys=xr(vr);function Cs(e){return Ma(e)?xn(e):Pr(e)}function Ss(e){return Ma(e)?xn(e,!0):Er(e)}var Is=Ci((function(e,t,n){wr(e,t,n)})),Ts=Ci((function(e,t,n,r){wr(e,t,n,r)})),Ps=qi((function(e,t){var n={};if(null==e)return n;var r=!1;t=ht(t,(function(t){return t=si(t,e),r||(r=t.length>1),t})),vi(e,Ji(e),n),r&&(n=Qn(n,7,Bi));for(var i=t.length;i--;)Xr(n,t[i]);return n}));var Es=qi((function(e,t){return null==e?{}:function(e,t){return Dr(e,t,(function(t,n){return _s(e,n)}))}(e,t)}));function Os(e,t){if(null==e)return{};var n=ht(Ji(e),(function(e){return[e]}));return t=Qi(t),Dr(e,n,(function(e,n){return t(e,n[0])}))}var bs=xi(Cs),As=xi(Ss);function Rs(e){return null==e?[]:wt(e,Cs(e))}var ws=Pi((function(e,t,n){return t=t.toLowerCase(),e+(n?Ls(t):t)}));function Ls(e){return Vs(ss(e).toLowerCase())}function Ns(e){return(e=ss(e))&&e.replace(ce,Mt).replace(Ne,"")}var Ds=Pi((function(e,t,n){return e+(n?"-":"")+t.toLowerCase()})),ks=Pi((function(e,t,n){return e+(n?" ":"")+t.toLowerCase()})),Ms=Ti("toLowerCase");var Fs=Pi((function(e,t,n){return e+(n?"_":"")+t.toLowerCase()}));var js=Pi((function(e,t,n){return e+(n?" ":"")+Vs(t)}));var xs=Pi((function(e,t,n){return e+(n?" ":"")+t.toUpperCase()})),Vs=Ti("toUpperCase");function Hs(e,t,n){return e=ss(e),void 0===(t=n?void 0:t)?function(e){return Fe.test(e)}(e)?function(e){return e.match(ke)||[]}(e):function(e){return e.match(X)||[]}(e):e.match(t)||[]}var Us=xr((function(e,t){try{return it(e,void 0,t)}catch(e){return Va(e)?e:new he(e)}})),Bs=qi((function(e,t){return at(t,(function(t){t=Oo(t),zn(e,t,va(e[t],e))})),e}));function Ws(e){return function(){return e}}var qs=bi(),Gs=bi(!0);function Js(e){return e}function zs(e){return Tr("function"==typeof e?e:Qn(e,1))}var Ks=xr((function(e,t){return function(n){return vr(n,e,t)}})),$s=xr((function(e,t){return function(n){return vr(e,n,t)}}));function Qs(e,t,n){var r=Cs(t),i=ur(t,r);null!=n||Wa(t)&&(i.length||!r.length)||(n=t,t=e,e=this,i=ur(t,Cs(t)));var o=!(Wa(n)&&"chain"in n&&!n.chain),a=Ha(e);return at(i,(function(n){var r=t[n];e[n]=r,a&&(e.prototype[n]=function(){var t=this.__chain__;if(o||t){var n=e(this.__wrapped__),i=n.__actions__=mi(this.__actions__);return i.push({func:r,args:arguments,thisArg:e}),n.__chain__=t,n}return r.apply(e,pt([this.value()],arguments))})})),e}function Ys(){}var Zs=Li(ht),Xs=Li(ct),ec=Li(_t);function tc(e){return co(e)?Pt(Oo(e)):function(e){return function(t){return dr(t,e)}}(e)}var nc=Di(),rc=Di(!0);function ic(){return[]}function oc(){return!1}var ac=wi((function(e,t){return e+t}),0),sc=Fi("ceil"),cc=wi((function(e,t){return e/t}),1),lc=Fi("floor");var uc,dc=wi((function(e,t){return e*t}),1),hc=Fi("round"),pc=wi((function(e,t){return e-t}),0);return An.after=function(e,t){if("function"!=typeof t)throw new ve(i);return e=rs(e),function(){if(--e<1)return t.apply(this,arguments)}},An.ary=_a,An.assign=cs,An.assignIn=ls,An.assignInWith=us,An.assignWith=ds,An.at=hs,An.before=ma,An.bind=va,An.bindAll=Bs,An.bindKey=ya,An.castArray=function(){if(!arguments.length)return[];var e=arguments[0];return Da(e)?e:[e]},An.chain=ta,An.chunk=function(e,t,n){t=(n?so(e,t,n):void 0===t)?1:an(rs(t),0);var i=null==e?0:e.length;if(!i||t<1)return[];for(var o=0,a=0,s=r(Zt(i/t));o<i;)s[a++]=Gr(e,o,o+=t);return s},An.compact=function(e){for(var t=-1,n=null==e?0:e.length,r=0,i=[];++t<n;){var o=e[t];o&&(i[r++]=o)}return i},An.concat=function(){var e=arguments.length;if(!e)return[];for(var t=r(e-1),n=arguments[0],i=e;i--;)t[i-1]=arguments[i];return pt(Da(n)?mi(n):[n],or(t,1))},An.cond=function(e){var t=null==e?0:e.length,n=Qi();return e=t?ht(e,(function(e){if("function"!=typeof e[1])throw new ve(i);return[n(e[0]),e[1]]})):[],xr((function(n){for(var r=-1;++r<t;){var i=e[r];if(it(i[0],this,n))return it(i[1],this,n)}}))},An.conforms=function(e){return function(e){var t=Cs(e);return function(n){return Yn(n,e,t)}}(Qn(e,1))},An.constant=Ws,An.countBy=ia,An.create=function(e,t){var n=Rn(e);return null==t?n:Jn(n,t)},An.curry=function e(t,n,r){var i=Vi(t,8,void 0,void 0,void 0,void 0,void 0,n=r?void 0:n);return i.placeholder=e.placeholder,i},An.curryRight=function e(t,n,r){var i=Vi(t,16,void 0,void 0,void 0,void 0,void 0,n=r?void 0:n);return i.placeholder=e.placeholder,i},An.debounce=Ca,An.defaults=ps,An.defaultsDeep=fs,An.defer=Sa,An.delay=Ia,An.difference=Ro,An.differenceBy=wo,An.differenceWith=Lo,An.drop=function(e,t,n){var r=null==e?0:e.length;return r?Gr(e,(t=n||void 0===t?1:rs(t))<0?0:t,r):[]},An.dropRight=function(e,t,n){var r=null==e?0:e.length;return r?Gr(e,0,(t=r-(t=n||void 0===t?1:rs(t)))<0?0:t):[]},An.dropRightWhile=function(e,t){return e&&e.length?ti(e,Qi(t,3),!0,!0):[]},An.dropWhile=function(e,t){return e&&e.length?ti(e,Qi(t,3),!0):[]},An.fill=function(e,t,n,r){var i=null==e?0:e.length;return i?(n&&"number"!=typeof n&&so(e,t,n)&&(n=0,r=i),function(e,t,n,r){var i=e.length;for((n=rs(n))<0&&(n=-n>i?0:i+n),(r=void 0===r||r>i?i:rs(r))<0&&(r+=i),r=n>r?0:is(r);n<r;)e[n++]=t;return e}(e,t,n,r)):[]},An.filter=function(e,t){return(Da(e)?lt:ir)(e,Qi(t,3))},An.flatMap=function(e,t){return or(ha(e,t),1)},An.flatMapDeep=function(e,t){return or(ha(e,t),1/0)},An.flatMapDepth=function(e,t,n){return n=void 0===n?1:rs(n),or(ha(e,t),n)},An.flatten=ko,An.flattenDeep=function(e){return(null==e?0:e.length)?or(e,1/0):[]},An.flattenDepth=function(e,t){return(null==e?0:e.length)?or(e,t=void 0===t?1:rs(t)):[]},An.flip=function(e){return Vi(e,512)},An.flow=qs,An.flowRight=Gs,An.fromPairs=function(e){for(var t=-1,n=null==e?0:e.length,r={};++t<n;){var i=e[t];r[i[0]]=i[1]}return r},An.functions=function(e){return null==e?[]:ur(e,Cs(e))},An.functionsIn=function(e){return null==e?[]:ur(e,Ss(e))},An.groupBy=la,An.initial=function(e){return(null==e?0:e.length)?Gr(e,0,-1):[]},An.intersection=Fo,An.intersectionBy=jo,An.intersectionWith=xo,An.invert=ms,An.invertBy=vs,An.invokeMap=ua,An.iteratee=zs,An.keyBy=da,An.keys=Cs,An.keysIn=Ss,An.map=ha,An.mapKeys=function(e,t){var n={};return t=Qi(t,3),cr(e,(function(e,r,i){zn(n,t(e,r,i),e)})),n},An.mapValues=function(e,t){var n={};return t=Qi(t,3),cr(e,(function(e,r,i){zn(n,r,t(e,r,i))})),n},An.matches=function(e){return Ar(Qn(e,1))},An.matchesProperty=function(e,t){return Rr(e,Qn(t,1))},An.memoize=Ta,An.merge=Is,An.mergeWith=Ts,An.method=Ks,An.methodOf=$s,An.mixin=Qs,An.negate=Pa,An.nthArg=function(e){return e=rs(e),xr((function(t){return Lr(t,e)}))},An.omit=Ps,An.omitBy=function(e,t){return Os(e,Pa(Qi(t)))},An.once=function(e){return ma(2,e)},An.orderBy=function(e,t,n,r){return null==e?[]:(Da(t)||(t=null==t?[]:[t]),Da(n=r?void 0:n)||(n=null==n?[]:[n]),Nr(e,t,n))},An.over=Zs,An.overArgs=Ea,An.overEvery=Xs,An.overSome=ec,An.partial=Oa,An.partialRight=ba,An.partition=pa,An.pick=Es,An.pickBy=Os,An.property=tc,An.propertyOf=function(e){return function(t){return null==e?void 0:dr(e,t)}},An.pull=Ho,An.pullAll=Uo,An.pullAllBy=function(e,t,n){return e&&e.length&&t&&t.length?kr(e,t,Qi(n,2)):e},An.pullAllWith=function(e,t,n){return e&&e.length&&t&&t.length?kr(e,t,void 0,n):e},An.pullAt=Bo,An.range=nc,An.rangeRight=rc,An.rearg=Aa,An.reject=function(e,t){return(Da(e)?lt:ir)(e,Pa(Qi(t,3)))},An.remove=function(e,t){var n=[];if(!e||!e.length)return n;var r=-1,i=[],o=e.length;for(t=Qi(t,3);++r<o;){var a=e[r];t(a,r,e)&&(n.push(a),i.push(r))}return Mr(e,i),n},An.rest=function(e,t){if("function"!=typeof e)throw new ve(i);return xr(e,t=void 0===t?t:rs(t))},An.reverse=Wo,An.sampleSize=function(e,t,n){return t=(n?so(e,t,n):void 0===t)?1:rs(t),(Da(e)?Hn:Hr)(e,t)},An.set=function(e,t,n){return null==e?e:Ur(e,t,n)},An.setWith=function(e,t,n,r){return r="function"==typeof r?r:void 0,null==e?e:Ur(e,t,n,r)},An.shuffle=function(e){return(Da(e)?Un:qr)(e)},An.slice=function(e,t,n){var r=null==e?0:e.length;return r?(n&&"number"!=typeof n&&so(e,t,n)?(t=0,n=r):(t=null==t?0:rs(t),n=void 0===n?r:rs(n)),Gr(e,t,n)):[]},An.sortBy=fa,An.sortedUniq=function(e){return e&&e.length?$r(e):[]},An.sortedUniqBy=function(e,t){return e&&e.length?$r(e,Qi(t,2)):[]},An.split=function(e,t,n){return n&&"number"!=typeof n&&so(e,t,n)&&(t=n=void 0),(n=void 0===n?4294967295:n>>>0)?(e=ss(e))&&("string"==typeof t||null!=t&&!Ka(t))&&!(t=Yr(t))&&xt(e)?li(Gt(e),0,n):e.split(t,n):[]},An.spread=function(e,t){if("function"!=typeof e)throw new ve(i);return t=null==t?0:an(rs(t),0),xr((function(n){var r=n[t],i=li(n,0,t);return r&&pt(i,r),it(e,this,i)}))},An.tail=function(e){var t=null==e?0:e.length;return t?Gr(e,1,t):[]},An.take=function(e,t,n){return e&&e.length?Gr(e,0,(t=n||void 0===t?1:rs(t))<0?0:t):[]},An.takeRight=function(e,t,n){var r=null==e?0:e.length;return r?Gr(e,(t=r-(t=n||void 0===t?1:rs(t)))<0?0:t,r):[]},An.takeRightWhile=function(e,t){return e&&e.length?ti(e,Qi(t,3),!1,!0):[]},An.takeWhile=function(e,t){return e&&e.length?ti(e,Qi(t,3)):[]},An.tap=function(e,t){return t(e),e},An.throttle=function(e,t,n){var r=!0,o=!0;if("function"!=typeof e)throw new ve(i);return Wa(n)&&(r="leading"in n?!!n.leading:r,o="trailing"in n?!!n.trailing:o),Ca(e,t,{leading:r,maxWait:t,trailing:o})},An.thru=na,An.toArray=ts,An.toPairs=bs,An.toPairsIn=As,An.toPath=function(e){return Da(e)?ht(e,Oo):Ya(e)?[e]:mi(Eo(ss(e)))},An.toPlainObject=as,An.transform=function(e,t,n){var r=Da(e),i=r||ja(e)||Za(e);if(t=Qi(t,4),null==n){var o=e&&e.constructor;n=i?r?new o:[]:Wa(e)&&Ha(o)?Rn(Ge(e)):{}}return(i?at:cr)(e,(function(e,r,i){return t(n,e,r,i)})),n},An.unary=function(e){return _a(e,1)},An.union=qo,An.unionBy=Go,An.unionWith=Jo,An.uniq=function(e){return e&&e.length?Zr(e):[]},An.uniqBy=function(e,t){return e&&e.length?Zr(e,Qi(t,2)):[]},An.uniqWith=function(e,t){return t="function"==typeof t?t:void 0,e&&e.length?Zr(e,void 0,t):[]},An.unset=function(e,t){return null==e||Xr(e,t)},An.unzip=zo,An.unzipWith=Ko,An.update=function(e,t,n){return null==e?e:ei(e,t,ai(n))},An.updateWith=function(e,t,n,r){return r="function"==typeof r?r:void 0,null==e?e:ei(e,t,ai(n),r)},An.values=Rs,An.valuesIn=function(e){return null==e?[]:wt(e,Ss(e))},An.without=$o,An.words=Hs,An.wrap=function(e,t){return Oa(ai(t),e)},An.xor=Qo,An.xorBy=Yo,An.xorWith=Zo,An.zip=Xo,An.zipObject=function(e,t){return ii(e||[],t||[],Wn)},An.zipObjectDeep=function(e,t){return ii(e||[],t||[],Ur)},An.zipWith=ea,An.entries=bs,An.entriesIn=As,An.extend=ls,An.extendWith=us,Qs(An,An),An.add=ac,An.attempt=Us,An.camelCase=ws,An.capitalize=Ls,An.ceil=sc,An.clamp=function(e,t,n){return void 0===n&&(n=t,t=void 0),void 0!==n&&(n=(n=os(n))==n?n:0),void 0!==t&&(t=(t=os(t))==t?t:0),$n(os(e),t,n)},An.clone=function(e){return Qn(e,4)},An.cloneDeep=function(e){return Qn(e,5)},An.cloneDeepWith=function(e,t){return Qn(e,5,t="function"==typeof t?t:void 0)},An.cloneWith=function(e,t){return Qn(e,4,t="function"==typeof t?t:void 0)},An.conformsTo=function(e,t){return null==t||Yn(e,t,Cs(t))},An.deburr=Ns,An.defaultTo=function(e,t){return null==e||e!=e?t:e},An.divide=cc,An.endsWith=function(e,t,n){e=ss(e),t=Yr(t);var r=e.length,i=n=void 0===n?r:$n(rs(n),0,r);return(n-=t.length)>=0&&e.slice(n,i)==t},An.eq=Ra,An.escape=function(e){return(e=ss(e))&&x.test(e)?e.replace(F,Ft):e},An.escapeRegExp=function(e){return(e=ss(e))&&J.test(e)?e.replace(G,"\\$&"):e},An.every=function(e,t,n){var r=Da(e)?ct:nr;return n&&so(e,t,n)&&(t=void 0),r(e,Qi(t,3))},An.find=oa,An.findIndex=No,An.findKey=function(e,t){return vt(e,Qi(t,3),cr)},An.findLast=aa,An.findLastIndex=Do,An.findLastKey=function(e,t){return vt(e,Qi(t,3),lr)},An.floor=lc,An.forEach=sa,An.forEachRight=ca,An.forIn=function(e,t){return null==e?e:ar(e,Qi(t,3),Ss)},An.forInRight=function(e,t){return null==e?e:sr(e,Qi(t,3),Ss)},An.forOwn=function(e,t){return e&&cr(e,Qi(t,3))},An.forOwnRight=function(e,t){return e&&lr(e,Qi(t,3))},An.get=gs,An.gt=wa,An.gte=La,An.has=function(e,t){return null!=e&&ro(e,t,gr)},An.hasIn=_s,An.head=Mo,An.identity=Js,An.includes=function(e,t,n,r){e=Ma(e)?e:Rs(e),n=n&&!r?rs(n):0;var i=e.length;return n<0&&(n=an(i+n,0)),Qa(e)?n<=i&&e.indexOf(t,n)>-1:!!i&&Ct(e,t,n)>-1},An.indexOf=function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=null==n?0:rs(n);return i<0&&(i=an(r+i,0)),Ct(e,t,i)},An.inRange=function(e,t,n){return t=ns(t),void 0===n?(n=t,t=0):n=ns(n),function(e,t,n){return e>=sn(t,n)&&e<an(t,n)}(e=os(e),t,n)},An.invoke=ys,An.isArguments=Na,An.isArray=Da,An.isArrayBuffer=ka,An.isArrayLike=Ma,An.isArrayLikeObject=Fa,An.isBoolean=function(e){return!0===e||!1===e||qa(e)&&pr(e)==l},An.isBuffer=ja,An.isDate=xa,An.isElement=function(e){return qa(e)&&1===e.nodeType&&!za(e)},An.isEmpty=function(e){if(null==e)return!0;if(Ma(e)&&(Da(e)||"string"==typeof e||"function"==typeof e.splice||ja(e)||Za(e)||Na(e)))return!e.length;var t=no(e);if(t==f||t==v)return!e.size;if(ho(e))return!Pr(e).length;for(var n in e)if(Pe.call(e,n))return!1;return!0},An.isEqual=function(e,t){return Cr(e,t)},An.isEqualWith=function(e,t,n){var r=(n="function"==typeof n?n:void 0)?n(e,t):void 0;return void 0===r?Cr(e,t,void 0,n):!!r},An.isError=Va,An.isFinite=function(e){return"number"==typeof e&&nn(e)},An.isFunction=Ha,An.isInteger=Ua,An.isLength=Ba,An.isMap=Ga,An.isMatch=function(e,t){return e===t||Sr(e,t,Zi(t))},An.isMatchWith=function(e,t,n){return n="function"==typeof n?n:void 0,Sr(e,t,Zi(t),n)},An.isNaN=function(e){return Ja(e)&&e!=+e},An.isNative=function(e){if(uo(e))throw new he("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Ir(e)},An.isNil=function(e){return null==e},An.isNull=function(e){return null===e},An.isNumber=Ja,An.isObject=Wa,An.isObjectLike=qa,An.isPlainObject=za,An.isRegExp=Ka,An.isSafeInteger=function(e){return Ua(e)&&e>=-9007199254740991&&e<=9007199254740991},An.isSet=$a,An.isString=Qa,An.isSymbol=Ya,An.isTypedArray=Za,An.isUndefined=function(e){return void 0===e},An.isWeakMap=function(e){return qa(e)&&no(e)==S},An.isWeakSet=function(e){return qa(e)&&"[object WeakSet]"==pr(e)},An.join=function(e,t){return null==e?"":rn.call(e,t)},An.kebabCase=Ds,An.last=Vo,An.lastIndexOf=function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var i=r;return void 0!==n&&(i=(i=rs(n))<0?an(r+i,0):sn(i,r-1)),t==t?function(e,t,n){for(var r=n+1;r--;)if(e[r]===t)return r;return r}(e,t,i):yt(e,It,i,!0)},An.lowerCase=ks,An.lowerFirst=Ms,An.lt=Xa,An.lte=es,An.max=function(e){return e&&e.length?rr(e,Js,fr):void 0},An.maxBy=function(e,t){return e&&e.length?rr(e,Qi(t,2),fr):void 0},An.mean=function(e){return Tt(e,Js)},An.meanBy=function(e,t){return Tt(e,Qi(t,2))},An.min=function(e){return e&&e.length?rr(e,Js,Or):void 0},An.minBy=function(e,t){return e&&e.length?rr(e,Qi(t,2),Or):void 0},An.stubArray=ic,An.stubFalse=oc,An.stubObject=function(){return{}},An.stubString=function(){return""},An.stubTrue=function(){return!0},An.multiply=dc,An.nth=function(e,t){return e&&e.length?Lr(e,rs(t)):void 0},An.noConflict=function(){return Je._===this&&(Je._=Re),this},An.noop=Ys,An.now=ga,An.pad=function(e,t,n){e=ss(e);var r=(t=rs(t))?qt(e):0;if(!t||r>=t)return e;var i=(t-r)/2;return Ni(Xt(i),n)+e+Ni(Zt(i),n)},An.padEnd=function(e,t,n){e=ss(e);var r=(t=rs(t))?qt(e):0;return t&&r<t?e+Ni(t-r,n):e},An.padStart=function(e,t,n){e=ss(e);var r=(t=rs(t))?qt(e):0;return t&&r<t?Ni(t-r,n)+e:e},An.parseInt=function(e,t,n){return n||null==t?t=0:t&&(t=+t),ln(ss(e).replace(K,""),t||0)},An.random=function(e,t,n){if(n&&"boolean"!=typeof n&&so(e,t,n)&&(t=n=void 0),void 0===n&&("boolean"==typeof t?(n=t,t=void 0):"boolean"==typeof e&&(n=e,e=void 0)),void 0===e&&void 0===t?(e=0,t=1):(e=ns(e),void 0===t?(t=e,e=0):t=ns(t)),e>t){var r=e;e=t,t=r}if(n||e%1||t%1){var i=un();return sn(e+i*(t-e+Be("1e-"+((i+"").length-1))),t)}return Fr(e,t)},An.reduce=function(e,t,n){var r=Da(e)?ft:Ot,i=arguments.length<3;return r(e,Qi(t,4),n,i,er)},An.reduceRight=function(e,t,n){var r=Da(e)?gt:Ot,i=arguments.length<3;return r(e,Qi(t,4),n,i,tr)},An.repeat=function(e,t,n){return t=(n?so(e,t,n):void 0===t)?1:rs(t),jr(ss(e),t)},An.replace=function(){var e=arguments,t=ss(e[0]);return e.length<3?t:t.replace(e[1],e[2])},An.result=function(e,t,n){var r=-1,i=(t=si(t,e)).length;for(i||(i=1,e=void 0);++r<i;){var o=null==e?void 0:e[Oo(t[r])];void 0===o&&(r=i,o=n),e=Ha(o)?o.call(e):o}return e},An.round=hc,An.runInContext=e,An.sample=function(e){return(Da(e)?Vn:Vr)(e)},An.size=function(e){if(null==e)return 0;if(Ma(e))return Qa(e)?qt(e):e.length;var t=no(e);return t==f||t==v?e.size:Pr(e).length},An.snakeCase=Fs,An.some=function(e,t,n){var r=Da(e)?_t:Jr;return n&&so(e,t,n)&&(t=void 0),r(e,Qi(t,3))},An.sortedIndex=function(e,t){return zr(e,t)},An.sortedIndexBy=function(e,t,n){return Kr(e,t,Qi(n,2))},An.sortedIndexOf=function(e,t){var n=null==e?0:e.length;if(n){var r=zr(e,t);if(r<n&&Ra(e[r],t))return r}return-1},An.sortedLastIndex=function(e,t){return zr(e,t,!0)},An.sortedLastIndexBy=function(e,t,n){return Kr(e,t,Qi(n,2),!0)},An.sortedLastIndexOf=function(e,t){if(null==e?0:e.length){var n=zr(e,t,!0)-1;if(Ra(e[n],t))return n}return-1},An.startCase=js,An.startsWith=function(e,t,n){return e=ss(e),n=null==n?0:$n(rs(n),0,e.length),t=Yr(t),e.slice(n,n+t.length)==t},An.subtract=pc,An.sum=function(e){return e&&e.length?bt(e,Js):0},An.sumBy=function(e,t){return e&&e.length?bt(e,Qi(t,2)):0},An.template=function(e,t,n){var r=An.templateSettings;n&&so(e,t,n)&&(t=void 0),e=ss(e),t=us({},t,r,Hi);var i,o,a=us({},t.imports,r.imports,Hi),s=Cs(a),c=wt(a,s),l=0,u=t.interpolate||le,d="__p += '",h=_e((t.escape||le).source+"|"+u.source+"|"+(u===U?te:le).source+"|"+(t.evaluate||le).source+"|$","g"),p="//# sourceURL="+(Pe.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++xe+"]")+"\n";e.replace(h,(function(t,n,r,a,s,c){return r||(r=a),d+=e.slice(l,c).replace(ue,jt),n&&(i=!0,d+="' +\n__e("+n+") +\n'"),s&&(o=!0,d+="';\n"+s+";\n__p += '"),r&&(d+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),l=c+t.length,t})),d+="';\n";var f=Pe.call(t,"variable")&&t.variable;f||(d="with (obj) {\n"+d+"\n}\n"),d=(o?d.replace(N,""):d).replace(D,"$1").replace(k,"$1;"),d="function("+(f||"obj")+") {\n"+(f?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(i?", __e = _.escape":"")+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+d+"return __p\n}";var g=Us((function(){return pe(s,p+"return "+d).apply(void 0,c)}));if(g.source=d,Va(g))throw g;return g},An.times=function(e,t){if((e=rs(e))<1||e>9007199254740991)return[];var n=4294967295,r=sn(e,4294967295);e-=4294967295;for(var i=At(r,t=Qi(t));++n<e;)t(n);return i},An.toFinite=ns,An.toInteger=rs,An.toLength=is,An.toLower=function(e){return ss(e).toLowerCase()},An.toNumber=os,An.toSafeInteger=function(e){return e?$n(rs(e),-9007199254740991,9007199254740991):0===e?e:0},An.toString=ss,An.toUpper=function(e){return ss(e).toUpperCase()},An.trim=function(e,t,n){if((e=ss(e))&&(n||void 0===t))return e.replace(z,"");if(!e||!(t=Yr(t)))return e;var r=Gt(e),i=Gt(t);return li(r,Nt(r,i),Dt(r,i)+1).join("")},An.trimEnd=function(e,t,n){if((e=ss(e))&&(n||void 0===t))return e.replace($,"");if(!e||!(t=Yr(t)))return e;var r=Gt(e);return li(r,0,Dt(r,Gt(t))+1).join("")},An.trimStart=function(e,t,n){if((e=ss(e))&&(n||void 0===t))return e.replace(K,"");if(!e||!(t=Yr(t)))return e;var r=Gt(e);return li(r,Nt(r,Gt(t))).join("")},An.truncate=function(e,t){var n=30,r="...";if(Wa(t)){var i="separator"in t?t.separator:i;n="length"in t?rs(t.length):n,r="omission"in t?Yr(t.omission):r}var o=(e=ss(e)).length;if(xt(e)){var a=Gt(e);o=a.length}if(n>=o)return e;var s=n-qt(r);if(s<1)return r;var c=a?li(a,0,s).join(""):e.slice(0,s);if(void 0===i)return c+r;if(a&&(s+=c.length-s),Ka(i)){if(e.slice(s).search(i)){var l,u=c;for(i.global||(i=_e(i.source,ss(ne.exec(i))+"g")),i.lastIndex=0;l=i.exec(u);)var d=l.index;c=c.slice(0,void 0===d?s:d)}}else if(e.indexOf(Yr(i),s)!=s){var h=c.lastIndexOf(i);h>-1&&(c=c.slice(0,h))}return c+r},An.unescape=function(e){return(e=ss(e))&&j.test(e)?e.replace(M,Jt):e},An.uniqueId=function(e){var t=++Ee;return ss(e)+t},An.upperCase=xs,An.upperFirst=Vs,An.each=sa,An.eachRight=ca,An.first=Mo,Qs(An,(uc={},cr(An,(function(e,t){Pe.call(An.prototype,t)||(uc[t]=e)})),uc),{chain:!1}),An.VERSION="4.17.20",at(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(e){An[e].placeholder=An})),at(["drop","take"],(function(e,t){Nn.prototype[e]=function(n){n=void 0===n?1:an(rs(n),0);var r=this.__filtered__&&!t?new Nn(this):this.clone();return r.__filtered__?r.__takeCount__=sn(n,r.__takeCount__):r.__views__.push({size:sn(n,4294967295),type:e+(r.__dir__<0?"Right":"")}),r},Nn.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}})),at(["filter","map","takeWhile"],(function(e,t){var n=t+1,r=1==n||3==n;Nn.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:Qi(e,3),type:n}),t.__filtered__=t.__filtered__||r,t}})),at(["head","last"],(function(e,t){var n="take"+(t?"Right":"");Nn.prototype[e]=function(){return this[n](1).value()[0]}})),at(["initial","tail"],(function(e,t){var n="drop"+(t?"":"Right");Nn.prototype[e]=function(){return this.__filtered__?new Nn(this):this[n](1)}})),Nn.prototype.compact=function(){return this.filter(Js)},Nn.prototype.find=function(e){return this.filter(e).head()},Nn.prototype.findLast=function(e){return this.reverse().find(e)},Nn.prototype.invokeMap=xr((function(e,t){return"function"==typeof e?new Nn(this):this.map((function(n){return vr(n,e,t)}))})),Nn.prototype.reject=function(e){return this.filter(Pa(Qi(e)))},Nn.prototype.slice=function(e,t){e=rs(e);var n=this;return n.__filtered__&&(e>0||t<0)?new Nn(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),void 0!==t&&(n=(t=rs(t))<0?n.dropRight(-t):n.take(t-e)),n)},Nn.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Nn.prototype.toArray=function(){return this.take(4294967295)},cr(Nn.prototype,(function(e,t){var n=/^(?:filter|find|map|reject)|While$/.test(t),r=/^(?:head|last)$/.test(t),i=An[r?"take"+("last"==t?"Right":""):t],o=r||/^find/.test(t);i&&(An.prototype[t]=function(){var t=this.__wrapped__,a=r?[1]:arguments,s=t instanceof Nn,c=a[0],l=s||Da(t),u=function(e){var t=i.apply(An,pt([e],a));return r&&d?t[0]:t};l&&n&&"function"==typeof c&&1!=c.length&&(s=l=!1);var d=this.__chain__,h=!!this.__actions__.length,p=o&&!d,f=s&&!h;if(!o&&l){t=f?t:new Nn(this);var g=e.apply(t,a);return g.__actions__.push({func:na,args:[u],thisArg:void 0}),new Ln(g,d)}return p&&f?e.apply(this,a):(g=this.thru(u),p?r?g.value()[0]:g.value():g)})})),at(["pop","push","shift","sort","splice","unshift"],(function(e){var t=ye[e],n=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",r=/^(?:pop|shift)$/.test(e);An.prototype[e]=function(){var e=arguments;if(r&&!this.__chain__){var i=this.value();return t.apply(Da(i)?i:[],e)}return this[n]((function(n){return t.apply(Da(n)?n:[],e)}))}})),cr(Nn.prototype,(function(e,t){var n=An[t];if(n){var r=n.name+"";Pe.call(yn,r)||(yn[r]=[]),yn[r].push({name:t,func:n})}})),yn[Ai(void 0,2).name]=[{name:"wrapper",func:void 0}],Nn.prototype.clone=function(){var e=new Nn(this.__wrapped__);return e.__actions__=mi(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=mi(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=mi(this.__views__),e},Nn.prototype.reverse=function(){if(this.__filtered__){var e=new Nn(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},Nn.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,n=Da(e),r=t<0,i=n?e.length:0,o=function(e,t,n){var r=-1,i=n.length;for(;++r<i;){var o=n[r],a=o.size;switch(o.type){case"drop":e+=a;break;case"dropRight":t-=a;break;case"take":t=sn(t,e+a);break;case"takeRight":e=an(e,t-a)}}return{start:e,end:t}}(0,i,this.__views__),a=o.start,s=o.end,c=s-a,l=r?s:a-1,u=this.__iteratees__,d=u.length,h=0,p=sn(c,this.__takeCount__);if(!n||!r&&i==c&&p==c)return ni(e,this.__actions__);var f=[];e:for(;c--&&h<p;){for(var g=-1,_=e[l+=t];++g<d;){var m=u[g],v=m.iteratee,y=m.type,C=v(_);if(2==y)_=C;else if(!C){if(1==y)continue e;break e}}f[h++]=_}return f},An.prototype.at=ra,An.prototype.chain=function(){return ta(this)},An.prototype.commit=function(){return new Ln(this.value(),this.__chain__)},An.prototype.next=function(){void 0===this.__values__&&(this.__values__=ts(this.value()));var e=this.__index__>=this.__values__.length;return{done:e,value:e?void 0:this.__values__[this.__index__++]}},An.prototype.plant=function(e){for(var t,n=this;n instanceof wn;){var r=Ao(n);r.__index__=0,r.__values__=void 0,t?i.__wrapped__=r:t=r;var i=r;n=n.__wrapped__}return i.__wrapped__=e,t},An.prototype.reverse=function(){var e=this.__wrapped__;if(e instanceof Nn){var t=e;return this.__actions__.length&&(t=new Nn(this)),(t=t.reverse()).__actions__.push({func:na,args:[Wo],thisArg:void 0}),new Ln(t,this.__chain__)}return this.thru(Wo)},An.prototype.toJSON=An.prototype.valueOf=An.prototype.value=function(){return ni(this.__wrapped__,this.__actions__)},An.prototype.first=An.prototype.head,mt&&(An.prototype[mt]=function(){return this}),An}();Je._=zt,void 0===(r=function(){return zt}.call(t,n,t,e))||(e.exports=r)}).call(this)}).call(this,n(69)(e))},function(e,t,n){"use strict";
/*!
 *  LogFactory.ts
 *  AUF
 *
 *  Created by Johan Blumenberg on 2016-12-29
 *  Copyright 2016 Microsoft. All rights reserved.
 *
 */var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o,a=n(26);function s(e){if(null===e)return-1;for(var t=0,n=e.length-1;n>=0;n--)t=37*t+e.charCodeAt(n)|0;var r="__auf_literal:";for(n=r.length-1;n>=0;n--)t=37*t+r.charCodeAt(n)|0;return t}!function(e){e[e.Unsafe=0]="Unsafe",e[e.Safe=1]="Safe",e[e.Inherited_Unsafe=2]="Inherited_Unsafe",e[e.Inherited_Safe=3]="Inherited_Safe",e[e.Blacklisted_Unsafe=4]="Blacklisted_Unsafe"}(o||(o={}));var c,l=function(){function e(e,t){this._level=a.LogLevel.Debug4,this._threshold=255,this._safe=o.Inherited_Unsafe,this._name=e,t&&(this._level=t.level(),this._safe=t.safe()?o.Inherited_Safe:o.Inherited_Unsafe,this._extendedInfo=t.extendedInfo())}return e.prototype.name=function(){return this._name},e.prototype.safe=function(){return this._safe===o.Safe||this._safe===o.Inherited_Safe},e.prototype.safety=function(){return this._safe},e.prototype.setSafety=function(e){this._safe=e},e.prototype.description=function(){return this._desc},e.prototype.setDescription=function(e){this._desc=e},e.prototype.level=function(){return this._level},e.prototype.setLevel=function(e){c.setLevel(this,e)},e.prototype._setLevel=function(e){this._level=e},e.prototype._setThreshold=function(e){this._threshold=e},e.prototype.isEnabled=function(e){return this._threshold<=e},e.prototype.setExtendedInfo=function(e){this._extendedInfo=e},e.prototype.extendedInfo=function(){return this._extendedInfo},e.prototype.trace=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.log.apply(c,[this,a.LogLevel.Trace,s(e),e].concat(t))},e.prototype.debug6=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.log.apply(c,[this,a.LogLevel.Debug6,s(e),e].concat(t))},e.prototype.debug5=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.log.apply(c,[this,a.LogLevel.Debug5,s(e),e].concat(t))},e.prototype.debug4=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.log.apply(c,[this,a.LogLevel.Debug4,s(e),e].concat(t))},e.prototype.debug3=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.log.apply(c,[this,a.LogLevel.Debug3,s(e),e].concat(t))},e.prototype.debug2=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.log.apply(c,[this,a.LogLevel.Debug2,s(e),e].concat(t))},e.prototype.debug1=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.log.apply(c,[this,a.LogLevel.Debug1,s(e),e].concat(t))},e.prototype.warn=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.log.apply(c,[this,a.LogLevel.Warning,s(e),e].concat(t))},e.prototype.error=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.log.apply(c,[this,a.LogLevel.Error,s(e),e].concat(t))},e.prototype.fatal=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.log.apply(c,[this,a.LogLevel.Fatal,s(e),e].concat(t))},e.prototype.meta=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.log.apply(c,[this,a.LogLevel.MetaData,s(e),e].concat(t))},e}(),u=function(){function e(){}return e.instance=function(){return c},e.levelToString=function(e){return e<=a.LogLevel.Trace?"TRACE":e<=a.LogLevel.Debug6?"DEBUG6":e<=a.LogLevel.Debug5?"DEBUG5":e<=a.LogLevel.Debug4?"DEBUG4":e<=a.LogLevel.Debug3?"DEBUG3":e<=a.LogLevel.Debug2?"DEBUG2":e<=a.LogLevel.Debug1?"DEBUG1":e<=a.LogLevel.Warning?"WARN":e<=a.LogLevel.Error?"ERROR":e<=a.LogLevel.Fatal?"FATAL":(a.LogLevel.MetaData,"META")},e.levelFromString=function(e){return this._levelFromString[e]||parseInt(e,10)},e}();function d(e,t){for(var n=t.name();n.length>0;){if(e[n])return e[n];var r=n.lastIndexOf(".");n=r<0?"":n.substr(0,r)}return e[""]?e[""]:a.LogLevel.Debug4}function h(e,t){var n=255;return t.forEach((function(t){var r=255;t.appender.levels()?r=Math.min(r,d(t.appender.levels(),e)):t.appender.receiveAll()||(r=Math.min(r,e.level())),n=Math.min(n,r)})),n}function p(e,t,n){return!!e.appender.receiveAll()||(e.appender.levels()?n>=d(e.appender.levels(),t):n>=t.level())}u._levelFromString={TRACE:a.LogLevel.Trace,DEBUG6:a.LogLevel.Debug6,DEBUG5:a.LogLevel.Debug5,DEBUG4:a.LogLevel.Debug4,DEBUG3:a.LogLevel.Debug3,DEBUG2:a.LogLevel.Debug2,DEBUG1:a.LogLevel.Debug1,WARN:a.LogLevel.Warning,ERROR:a.LogLevel.Error,FATAL:a.LogLevel.Fatal,META:a.LogLevel.MetaData},t.LogFactory=u;var f=function(e){function t(){var t=e.call(this)||this;return t._nextId=0,t._appenders=[],t._components={},t._componentBlacklist=[],t._components[""]=new l("",null),t}return i(t,e),t.prototype.toHex=function(e){return(4294967296+e).toString(16).substr(-8)},t.prototype.addAppender=function(e,t){void 0===t&&(t=0);var n=this._nextId++;return t&a.AppenderFlags.InsertFront?this._appenders.unshift({appender:e,handle:n}):this._appenders.push({appender:e,handle:n}),this.recalcComponentThresholds(),n},t.prototype.removeAppender=function(e){for(var t=0;t<this._appenders.length;t++)if(this._appenders[t].handle===e){this._appenders.splice(t,1);break}this.recalcComponentThresholds()},t.prototype.log=function(e,t,n,r){for(var i=[],o=4;o<arguments.length;o++)i[o-4]=arguments[o];try{if(e.isEnabled(t)){var a={timestamp:(new Date).getTime(),component:e,level:t};this._appenders.forEach((function(o){p(o,e,t)&&o.appender.log(a,n,r,i)}))}}catch(e){}},t.prototype.parent=function(e){for(;;){var t=e.lastIndexOf(".");if(e=t>=0?e.substr(0,t):"",this._components[e])return this._components[e]}},t.prototype.children=function(e){var t=[];for(var n in this._components)this.parent(n).name()===e&&t.push(this._components[n]);return t},t.prototype.component=function(e){if(this._components[e])return this._components[e];var t=new l(e,this.parent(e));this._components[e]=t;var n=h(t,this._appenders);return t._setThreshold(n),t},t.prototype.rootComponent=function(){return this.component("")},t.prototype.setSafetyRecursive=function(e,t){var n=this;this.children(e).forEach((function(e){e.safety()!==o.Inherited_Safe&&e.safety()!==o.Inherited_Unsafe||(e.setSafety(t),n.setSafetyRecursive(e.name(),t))}))},t.prototype.declareComponentSafe=function(e,t){var n=this.component(e);-1!==this._componentBlacklist.indexOf(n.name())?n.setSafety(o.Blacklisted_Unsafe):n.setSafety(t?o.Safe:o.Unsafe),this.setSafetyRecursive(e,t?o.Inherited_Safe:o.Inherited_Unsafe)},t.prototype.declareComponentDescription=function(e,t){this.component(e).setDescription(t)},t.prototype.setExtendedInfoRecursive=function(e,t){var n=this;this.children(e).forEach((function(e){void 0===e.extendedInfo()&&(e.setExtendedInfo(t),n.setExtendedInfoRecursive(e.name(),t))}))},t.prototype.declareComponentExtendedInfo=function(e,t){var n=this.component(e);n.setExtendedInfo(t),this.setExtendedInfoRecursive(n.name(),t)},t.prototype.recalcComponentThresholds=function(){for(var e in this._components){var t=this._components[e],n=h(t,this._appenders);t._setThreshold(n)}},t.prototype.setLevel=function(e,t){if(""===e.name())for(var n in this._components){(o=this._components[n])._setLevel(t);var r=h(o,this._appenders);o._setThreshold(r)}else{var i=e.name()+".";e._setLevel(t);r=h(e,this._appenders);for(var n in e._setThreshold(r),this._components){var o;if((o=this._components[n]).name().substr(0,i.length)===i){o._setLevel(t);var a=h(o,this._appenders);o._setThreshold(a)}}}},t.prototype.setComponentBlacklist=function(e){for(var t in this._componentBlacklist=e,this._components){var n=this._components[t];-1!==this._componentBlacklist.indexOf(n.name())&&n.setSafety(o.Blacklisted_Unsafe)}},t}(u);c=new f},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(8),o=n(5),a=n(6),s=n(0),c=n(31);class l extends i.TraceListener{constructor(e,t){super(),this.processName=e,this.logDirectory=t,this.canWriteLogs=!0,this.openLogFileAsync=(e=0)=>r(this,void 0,void 0,(function*(){if(5===e)return this.canWriteLogs=!1,void console.error("Name Log File Failed - Reached maximum number of attempts.");const t=(new Date).toISOString().replace(/T/,"_").replace(/:|-/g,"").replace(/\..+/,""),n=s.join(this.logDirectory,`${t}_${Date.now()}${e}_${this.processName}.log`);try{const e=yield c.openFileAsync(n,"ax");this.fileDescriptior=e,this.fileName=n}catch(t){"EEXIST"===t.code?yield this.openLogFileAsync(e+1):(this.canWriteLogs=!1,console.error("Name Log File Failed. "+t.message,t.stack))}this.writePromise=Promise.resolve()})),this.logDirectory||(this.logDirectory=l.defaultLogDirectory)}static get defaultLogDirectory(){return s.join(a.tmpdir(),"VSFeedbackVSRTCLogs")}get logFileName(){return this.fileName}openAsync(){return r(this,void 0,void 0,(function*(){yield new Promise((e,t)=>{o.mkdir(this.logDirectory,t=>{e()})}),yield this.openLogFileAsync()}))}writeLine(e){}writeEvent(e,t,n,r){if(!1===this.canWriteLogs)return;const s=i.TraceFormat.formatEvent(new Date,e,t,n,r);this.writePromise=this.writePromise.then(()=>new Promise((e,t)=>{o.write(this.fileDescriptior,s+a.EOL,t=>{t&&(this.canWriteLogs=!1,console.error(t.message,t.stack)),e()})}))}}t.LogFileTraceListener=l},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(5),o=n(32),a=n(9);t.openFileAsync=(e,t)=>new Promise((n,r)=>{i.open(e,t,(e,t)=>{e&&r(e),n(t)})}),t.computeFileHashAsync=function(e,t="sha1"){return new Promise(n=>{const r=a.createHash(t),o=i.createReadStream(e);o.on("error",e=>{if("ENOENT"!==e.code)throw new Error(e);n(null)}),o.on("readable",()=>{const e=o.read();e?r.update(e):n(r.digest("hex"))})})},t.fileExistsAsync=function(e){return new Promise((t,n)=>{i.stat(e,(e,n)=>{n&&n.isFile()?t(!0):t(!1)})})},t.moveElseThrowAsync=function(e,t){return r(this,void 0,void 0,(function*(){if(yield o.removeSync(t),yield o.move(e,t),!i.existsSync(t))throw new Error(`Setup of package files failed verification tests. Source: ${e}, target: ${t}`)}))},t.copyElseThrowSync=function(e,t){o.copySync(e,t),i.statSync(t)};t.PathUtil=class{static removePath(e,t=""){return e.replace(/([A-Za-z]:)?(\S*[\\\/])+\S*/gi,(e,n,r,i,o)=>{if(/^\d{1,4}\/\d{1,2}\/\d{1,4}$/.test(e))return e;{const i=(n?n.length:0)+r.length,o=e.substr(i);return t+o}})}};class s extends Error{constructor(e,t){super(...arguments),this.code=t}}t.CancellationError=s},function(e,t,n){"use strict";e.exports=Object.assign({},n(18),n(20),n(24),n(43),n(45),n(51),n(3),n(55),n(56),n(57),n(4),n(11));const r=n(5);Object.getOwnPropertyDescriptor(r,"promises")&&Object.defineProperty(e.exports,"promises",{get:()=>r.promises})},function(e,t,n){var r=n(34),i=process.cwd,o=null,a=process.env.GRACEFUL_FS_PLATFORM||process.platform;process.cwd=function(){return o||(o=i.call(process)),o};try{process.cwd()}catch(e){}var s=process.chdir;process.chdir=function(e){o=null,s.call(process,e)},e.exports=function(e){r.hasOwnProperty("O_SYMLINK")&&process.version.match(/^v0\.6\.[0-2]|^v0\.5\./)&&function(e){e.lchmod=function(t,n,i){e.open(t,r.O_WRONLY|r.O_SYMLINK,n,(function(t,r){t?i&&i(t):e.fchmod(r,n,(function(t){e.close(r,(function(e){i&&i(t||e)}))}))}))},e.lchmodSync=function(t,n){var i,o=e.openSync(t,r.O_WRONLY|r.O_SYMLINK,n),a=!0;try{i=e.fchmodSync(o,n),a=!1}finally{if(a)try{e.closeSync(o)}catch(e){}else e.closeSync(o)}return i}}(e);e.lutimes||function(e){r.hasOwnProperty("O_SYMLINK")?(e.lutimes=function(t,n,i,o){e.open(t,r.O_SYMLINK,(function(t,r){t?o&&o(t):e.futimes(r,n,i,(function(t){e.close(r,(function(e){o&&o(t||e)}))}))}))},e.lutimesSync=function(t,n,i){var o,a=e.openSync(t,r.O_SYMLINK),s=!0;try{o=e.futimesSync(a,n,i),s=!1}finally{if(s)try{e.closeSync(a)}catch(e){}else e.closeSync(a)}return o}):(e.lutimes=function(e,t,n,r){r&&process.nextTick(r)},e.lutimesSync=function(){})}(e);e.chown=o(e.chown),e.fchown=o(e.fchown),e.lchown=o(e.lchown),e.chmod=n(e.chmod),e.fchmod=n(e.fchmod),e.lchmod=n(e.lchmod),e.chownSync=s(e.chownSync),e.fchownSync=s(e.fchownSync),e.lchownSync=s(e.lchownSync),e.chmodSync=i(e.chmodSync),e.fchmodSync=i(e.fchmodSync),e.lchmodSync=i(e.lchmodSync),e.stat=c(e.stat),e.fstat=c(e.fstat),e.lstat=c(e.lstat),e.statSync=l(e.statSync),e.fstatSync=l(e.fstatSync),e.lstatSync=l(e.lstatSync),e.lchmod||(e.lchmod=function(e,t,n){n&&process.nextTick(n)},e.lchmodSync=function(){});e.lchown||(e.lchown=function(e,t,n,r){r&&process.nextTick(r)},e.lchownSync=function(){});"win32"===a&&(e.rename=(t=e.rename,function(n,r,i){var o=Date.now(),a=0;t(n,r,(function s(c){if(c&&("EACCES"===c.code||"EPERM"===c.code)&&Date.now()-o<6e4)return setTimeout((function(){e.stat(r,(function(e,o){e&&"ENOENT"===e.code?t(n,r,s):i(c)}))}),a),void(a<100&&(a+=10));i&&i(c)}))}));var t;function n(t){return t?function(n,r,i){return t.call(e,n,r,(function(e){u(e)&&(e=null),i&&i.apply(this,arguments)}))}:t}function i(t){return t?function(n,r){try{return t.call(e,n,r)}catch(e){if(!u(e))throw e}}:t}function o(t){return t?function(n,r,i,o){return t.call(e,n,r,i,(function(e){u(e)&&(e=null),o&&o.apply(this,arguments)}))}:t}function s(t){return t?function(n,r,i){try{return t.call(e,n,r,i)}catch(e){if(!u(e))throw e}}:t}function c(t){return t?function(n,r){return t.call(e,n,(function(e,t){if(!t)return r.apply(this,arguments);t.uid<0&&(t.uid+=4294967296),t.gid<0&&(t.gid+=4294967296),r&&r.apply(this,arguments)}))}:t}function l(t){return t?function(n){var r=t.call(e,n);return r.uid<0&&(r.uid+=4294967296),r.gid<0&&(r.gid+=4294967296),r}:t}function u(e){return!e||("ENOSYS"===e.code||!(process.getuid&&0===process.getuid()||"EINVAL"!==e.code&&"EPERM"!==e.code))}e.read=(h=e.read,function(t,n,r,i,o,a){var s;if(a&&"function"==typeof a){var c=0;s=function(l,u,d){if(l&&"EAGAIN"===l.code&&c<10)return c++,h.call(e,t,n,r,i,o,s);a.apply(this,arguments)}}return h.call(e,t,n,r,i,o,s)}),e.readSync=(d=e.readSync,function(t,n,r,i,o){for(var a=0;;)try{return d.call(e,t,n,r,i,o)}catch(e){if("EAGAIN"===e.code&&a<10){a++;continue}throw e}});var d;var h}},function(e,t){e.exports=require("constants")},function(e,t,n){var r=n(36).Stream;e.exports=function(e){return{ReadStream:function t(n,i){if(!(this instanceof t))return new t(n,i);r.call(this);var o=this;this.path=n,this.fd=null,this.readable=!0,this.paused=!1,this.flags="r",this.mode=438,this.bufferSize=65536,i=i||{};for(var a=Object.keys(i),s=0,c=a.length;s<c;s++){var l=a[s];this[l]=i[l]}this.encoding&&this.setEncoding(this.encoding);if(void 0!==this.start){if("number"!=typeof this.start)throw TypeError("start must be a Number");if(void 0===this.end)this.end=1/0;else if("number"!=typeof this.end)throw TypeError("end must be a Number");if(this.start>this.end)throw new Error("start must be <= end");this.pos=this.start}if(null!==this.fd)return void process.nextTick((function(){o._read()}));e.open(this.path,this.flags,this.mode,(function(e,t){if(e)return o.emit("error",e),void(o.readable=!1);o.fd=t,o.emit("open",t),o._read()}))},WriteStream:function t(n,i){if(!(this instanceof t))return new t(n,i);r.call(this),this.path=n,this.fd=null,this.writable=!0,this.flags="w",this.encoding="binary",this.mode=438,this.bytesWritten=0,i=i||{};for(var o=Object.keys(i),a=0,s=o.length;a<s;a++){var c=o[a];this[c]=i[c]}if(void 0!==this.start){if("number"!=typeof this.start)throw TypeError("start must be a Number");if(this.start<0)throw new Error("start must be >= zero");this.pos=this.start}this.busy=!1,this._queue=[],null===this.fd&&(this._open=e.open,this._queue.push([this._open,this.path,this.flags,this.mode,void 0]),this.flush())}}}},function(e,t){e.exports=require("stream")},function(e,t,n){"use strict";e.exports=function(e){if(null===e||"object"!=typeof e)return e;if(e instanceof Object)var t={__proto__:e.__proto__};else t=Object.create(null);return Object.getOwnPropertyNames(e).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})),t}},function(e,t){e.exports=require("util")},function(e,t,n){"use strict";const r=n(1),i=n(0),o=n(3).mkdirsSync,a=n(22).utimesMillisSync,s=Symbol("notExist"),c=Symbol("existsReg");function l(e,t,n,o){if(!o.filter||o.filter(t,n))return function(e,t,n,o){const a=(o.dereference?r.statSync:r.lstatSync)(t);if(a.isDirectory())return function(e,t,n,i,o){if(t===s){if(p(n,i))throw new Error(`Cannot copy '${n}' to a subdirectory of itself, '${i}'.`);return function(e,t,n,i){return r.mkdirSync(n,e.mode),r.chmodSync(n,e.mode),h(t,n,i)}(e,n,i,o)}if(t===c){if(p(n,i))throw new Error(`Cannot copy '${n}' to a subdirectory of itself, '${i}'.`);return function(e,t,n){if(!r.statSync(t).isDirectory())throw new Error(`Cannot overwrite non-directory '${t}' with directory '${e}'.`);return h(e,t,n)}(n,i,o)}return h(n,i,o)}(a,e,t,n,o);if(a.isFile()||a.isCharacterDevice()||a.isBlockDevice())return function(e,t,n,r,i){if(t===s)return d(e,n,r,i);if(t===c)return u(e,n,r,i);return u(e,n,r,i)}(a,e,t,n,o);if(a.isSymbolicLink())return function(e,t,n,o){let a=r.readlinkSync(t);o.dereference&&(a=i.resolve(process.cwd(),a));if(e===s||e===c)return r.symlinkSync(a,n);if(o.dereference&&(e=i.resolve(process.cwd(),e)),f(a,e))return;if(r.statSync(n).isDirectory()&&p(e,a))throw new Error(`Cannot overwrite '${e}' with '${a}'.`);return function(e,t){return r.unlinkSync(t),r.symlinkSync(e,t)}(a,n)}(e,t,n,o)}(e,t,n,o)}function u(e,t,n,i){if(i.overwrite)return r.unlinkSync(n),d(e,t,n,i);if(i.errorOnExist)throw new Error(`'${n}' already exists`)}function d(e,t,i,o){return"function"==typeof r.copyFileSync?(r.copyFileSync(t,i),r.chmodSync(i,e.mode),o.preserveTimestamps?a(i,e.atime,e.mtime):void 0):function(e,t,i,o){const a=n(23)(65536),s=r.openSync(t,"r"),c=r.openSync(i,"w",e.mode);let l=0;for(;l<e.size;){const e=r.readSync(s,a,0,65536,l);r.writeSync(c,a,0,e),l+=e}o.preserveTimestamps&&r.futimesSync(c,e.atime,e.mtime);r.closeSync(s),r.closeSync(c)}(e,t,i,o)}function h(e,t,n){r.readdirSync(e).forEach(r=>function(e,t,n,r){const o=i.join(t,e),a=i.join(n,e);return l(g(o,a),o,a,r)}(r,e,t,n))}function p(e,t){const n=i.resolve(e).split(i.sep),r=i.resolve(t).split(i.sep);return n.reduce((e,t,n)=>e&&r[n]===t,!0)}function f(e,t){const n=process.platform,r=i.resolve(e),o=i.resolve(t);return"darwin"===n||"win32"===n?r.toLowerCase()===o.toLowerCase():r===o}function g(e,t){const n=function(e){let t;try{t=r.readlinkSync(e)}catch(e){if("ENOENT"===e.code)return s;if("EINVAL"===e.code||"UNKNOWN"===e.code)return c;throw e}return t}(t);if(n===s||n===c){if(f(e,t))throw new Error("Source and destination must not be the same.");return n}if(f(e,n))throw new Error("Source and destination must not be the same.");return n}e.exports=function(e,t,n){"function"==typeof n&&(n={filter:n}),(n=n||{}).clobber=!("clobber"in n)||!!n.clobber,n.overwrite="overwrite"in n?!!n.overwrite:n.clobber,n.preserveTimestamps&&"ia32"===process.arch&&console.warn("fs-extra: Using the preserveTimestamps option in 32-bit node is not recommended;\n\n    see https://github.com/jprichardson/node-fs-extra/issues/269");const a=g(e,t);if(n.filter&&!n.filter(e,t))return;const s=i.dirname(t);return r.existsSync(s)||o(s),l(a,e,t,n)}},function(e,t,n){"use strict";const r=n(1),i=n(0),o=n(21).invalidWin32Path,a=parseInt("0777",8);e.exports=function e(t,n,s,c){if("function"==typeof n?(s=n,n={}):n&&"object"==typeof n||(n={mode:n}),"win32"===process.platform&&o(t)){const e=new Error(t+" contains invalid WIN32 path characters.");return e.code="EINVAL",s(e)}let l=n.mode;const u=n.fs||r;void 0===l&&(l=a&~process.umask()),c||(c=null),s=s||function(){},t=i.resolve(t),u.mkdir(t,l,r=>{if(!r)return s(null,c=c||t);switch(r.code){case"ENOENT":if(i.dirname(t)===t)return s(r);e(i.dirname(t),n,(r,i)=>{r?s(r,i):e(t,n,s,i)});break;default:u.stat(t,(e,t)=>{e||!t.isDirectory()?s(r,c):s(null,c)})}})}},function(e,t,n){"use strict";const r=n(1),i=n(0),o=n(21).invalidWin32Path,a=parseInt("0777",8);e.exports=function e(t,n,s){n&&"object"==typeof n||(n={mode:n});let c=n.mode;const l=n.fs||r;if("win32"===process.platform&&o(t)){const e=new Error(t+" contains invalid WIN32 path characters.");throw e.code="EINVAL",e}void 0===c&&(c=a&~process.umask()),s||(s=null),t=i.resolve(t);try{l.mkdirSync(t,c),s=s||t}catch(r){if("ENOENT"===r.code){if(i.dirname(t)===t)throw r;s=e(i.dirname(t),n,s),e(t,n,s)}else{let e;try{e=l.statSync(t)}catch(e){throw r}if(!e.isDirectory())throw r}}return s}},function(e,t,n){"use strict";const r=n(1),i=n(0),o=n(3).mkdirs,a=n(4).pathExists,s=n(22).utimesMillis,c=Symbol("notExist"),l=Symbol("existsReg");function u(e,t,n,r,s){const c=i.dirname(n);a(c,(i,a)=>i?s(i):a?d(e,t,n,r,s):void o(c,i=>i?s(i):d(e,t,n,r,s)))}function d(e,t,n,r,i){return r.filter?h(p,e,t,n,r,i):p(e,t,n,r,i)}function h(e,t,n,r,i,o){Promise.resolve(i.filter(n,r)).then(a=>a?t?e(t,n,r,i,o):e(n,r,i,o):o(),e=>o(e))}function p(e,t,n,o,a){(o.dereference?r.stat:r.lstat)(t,(s,u)=>s?a(s):u.isDirectory()?function(e,t,n,i,o,a){if(t===c)return y(n,i)?a(new Error(`Cannot copy '${n}' to a subdirectory of itself, '${i}'.`)):function(e,t,n,i,o){r.mkdir(n,e.mode,a=>{if(a)return o(a);r.chmod(n,e.mode,e=>e?o(e):m(t,n,i,o))})}(e,n,i,o,a);if(t===l)return y(n,i)?a(new Error(`Cannot copy '${n}' to a subdirectory of itself, '${i}'.`)):function(e,t,n,i){r.stat(t,(r,o)=>r?i(r):o.isDirectory()?m(e,t,n,i):i(new Error(`Cannot overwrite non-directory '${t}' with directory '${e}'.`)))}(n,i,o,a);return m(n,i,o,a)}(u,e,t,n,o,a):u.isFile()||u.isCharacterDevice()||u.isBlockDevice()?function(e,t,n,r,i,o){if(t===c)return g(e,n,r,i,o);if(t===l)return f(e,n,r,i,o);return f(e,n,r,i,o)}(u,e,t,n,o,a):u.isSymbolicLink()?function(e,t,n,o,a){r.readlink(t,(t,s)=>t?a(t):(o.dereference&&(s=i.resolve(process.cwd(),s)),e===c||e===l?r.symlink(s,n,a):(o.dereference&&(e=i.resolve(process.cwd(),e)),C(s,e)?a():void r.stat(n,(t,i)=>t?a(t):i.isDirectory()&&y(e,s)?a(new Error(`Cannot overwrite '${e}' with '${s}'.`)):function(e,t,n){r.unlink(t,i=>i?n(i):r.symlink(e,t,n))}(s,n,a)))))}(e,t,n,o,a):void 0)}function f(e,t,n,i,o){if(!i.overwrite)return i.errorOnExist?o(new Error(`'${n}' already exists`)):o();r.unlink(n,r=>r?o(r):g(e,t,n,i,o))}function g(e,t,n,i,o){return"function"==typeof r.copyFile?r.copyFile(t,n,t=>t?o(t):_(e,n,i,o)):function(e,t,n,i,o){const a=r.createReadStream(t);a.on("error",e=>o(e)).once("open",()=>{const t=r.createWriteStream(n,{mode:e.mode});t.on("error",e=>o(e)).on("open",()=>a.pipe(t)).once("close",()=>_(e,n,i,o))})}(e,t,n,i,o)}function _(e,t,n,i){r.chmod(t,e.mode,r=>r?i(r):n.preserveTimestamps?s(t,e.atime,e.mtime,i):i())}function m(e,t,n,i){r.readdir(e,(r,o)=>r?i(r):v(o,e,t,n,i))}function v(e,t,n,r,o){const a=e.pop();return a?function(e,t,n,r,o,a){const s=i.join(n,t),c=i.join(r,t);S(s,c,(t,i)=>{if(t)return a(t);d(i,s,c,o,t=>t?a(t):v(e,n,r,o,a))})}(e,a,t,n,r,o):o()}function y(e,t){const n=i.resolve(e).split(i.sep),r=i.resolve(t).split(i.sep);return n.reduce((e,t,n)=>e&&r[n]===t,!0)}function C(e,t){const n=process.platform,r=i.resolve(e),o=i.resolve(t);return"darwin"===n||"win32"===n?r.toLowerCase()===o.toLowerCase():r===o}function S(e,t,n){!function(e,t){r.readlink(e,(e,n)=>e?"ENOENT"===e.code?t(null,c):"EINVAL"===e.code||"UNKNOWN"===e.code?t(null,l):t(e):t(null,n))}(t,(r,i)=>r?n(r):i===c||i===l?C(e,t)?n(new Error("Source and destination must not be the same.")):n(null,i):C(e,i)?n(new Error("Source and destination must not be the same.")):n(null,i))}e.exports=function(e,t,n,r){"function"!=typeof n||r?"function"==typeof n&&(n={filter:n}):(r=n,n={}),r=r||function(){},(n=n||{}).clobber=!("clobber"in n)||!!n.clobber,n.overwrite="overwrite"in n?!!n.overwrite:n.clobber,n.preserveTimestamps&&"ia32"===process.arch&&console.warn("fs-extra: Using the preserveTimestamps option in 32-bit node is not recommended;\n\n    see https://github.com/jprichardson/node-fs-extra/issues/269"),S(e,t,(i,o)=>i?r(i):n.filter?h(u,o,e,t,n,r):u(o,e,t,n,r))}},function(e,t,n){"use strict";const r=n(2).fromCallback,i=n(5),o=n(0),a=n(3),s=n(11),c=r((function(e,t){t=t||function(){},i.readdir(e,(n,r)=>{if(n)return a.mkdirs(e,t);r=r.map(t=>o.join(e,t)),function e(){const n=r.pop();if(!n)return t();s.remove(n,n=>{if(n)return t(n);e()})}()})}));function l(e){let t;try{t=i.readdirSync(e)}catch(t){return a.mkdirsSync(e)}t.forEach(t=>{t=o.join(e,t),s.removeSync(t)})}e.exports={emptyDirSync:l,emptydirSync:l,emptyDir:c,emptydir:c}},function(e,t,n){"use strict";const r=n(1),i=n(0),o=n(19),a="win32"===process.platform;function s(e){["unlink","chmod","stat","lstat","rmdir","readdir"].forEach(t=>{e[t]=e[t]||r[t],e[t+="Sync"]=e[t]||r[t]}),e.maxBusyTries=e.maxBusyTries||3}function c(e,t,n){let r=0;"function"==typeof t&&(n=t,t={}),o(e,"rimraf: missing path"),o.strictEqual(typeof e,"string","rimraf: path should be a string"),o.strictEqual(typeof n,"function","rimraf: callback function required"),o(t,"rimraf: invalid options argument provided"),o.strictEqual(typeof t,"object","rimraf: options should be object"),s(t),l(e,t,(function i(o){if(o){if(("EBUSY"===o.code||"ENOTEMPTY"===o.code||"EPERM"===o.code)&&r<t.maxBusyTries){r++;return setTimeout(()=>l(e,t,i),100*r)}"ENOENT"===o.code&&(o=null)}n(o)}))}function l(e,t,n){o(e),o(t),o("function"==typeof n),t.lstat(e,(r,i)=>r&&"ENOENT"===r.code?n(null):r&&"EPERM"===r.code&&a?u(e,t,r,n):i&&i.isDirectory()?h(e,t,r,n):void t.unlink(e,r=>{if(r){if("ENOENT"===r.code)return n(null);if("EPERM"===r.code)return a?u(e,t,r,n):h(e,t,r,n);if("EISDIR"===r.code)return h(e,t,r,n)}return n(r)}))}function u(e,t,n,r){o(e),o(t),o("function"==typeof r),n&&o(n instanceof Error),t.chmod(e,438,i=>{i?r("ENOENT"===i.code?null:n):t.stat(e,(i,o)=>{i?r("ENOENT"===i.code?null:n):o.isDirectory()?h(e,t,n,r):t.unlink(e,r)})})}function d(e,t,n){let r;o(e),o(t),n&&o(n instanceof Error);try{t.chmodSync(e,438)}catch(e){if("ENOENT"===e.code)return;throw n}try{r=t.statSync(e)}catch(e){if("ENOENT"===e.code)return;throw n}r.isDirectory()?f(e,t,n):t.unlinkSync(e)}function h(e,t,n,r){o(e),o(t),n&&o(n instanceof Error),o("function"==typeof r),t.rmdir(e,a=>{!a||"ENOTEMPTY"!==a.code&&"EEXIST"!==a.code&&"EPERM"!==a.code?a&&"ENOTDIR"===a.code?r(n):r(a):function(e,t,n){o(e),o(t),o("function"==typeof n),t.readdir(e,(r,o)=>{if(r)return n(r);let a,s=o.length;if(0===s)return t.rmdir(e,n);o.forEach(r=>{c(i.join(e,r),t,r=>{if(!a)return r?n(a=r):void(0==--s&&t.rmdir(e,n))})})})}(e,t,r)})}function p(e,t){let n;s(t=t||{}),o(e,"rimraf: missing path"),o.strictEqual(typeof e,"string","rimraf: path should be a string"),o(t,"rimraf: missing options"),o.strictEqual(typeof t,"object","rimraf: options should be object");try{n=t.lstatSync(e)}catch(n){if("ENOENT"===n.code)return;"EPERM"===n.code&&a&&d(e,t,n)}try{n&&n.isDirectory()?f(e,t,null):t.unlinkSync(e)}catch(n){if("ENOENT"===n.code)return;if("EPERM"===n.code)return a?d(e,t,n):f(e,t,n);if("EISDIR"!==n.code)throw n;f(e,t,n)}}function f(e,t,n){o(e),o(t),n&&o(n instanceof Error);try{t.rmdirSync(e)}catch(r){if("ENOTDIR"===r.code)throw n;if("ENOTEMPTY"===r.code||"EEXIST"===r.code||"EPERM"===r.code)!function(e,t){o(e),o(t),t.readdirSync(e).forEach(n=>p(i.join(e,n),t));const n=a?100:1;let r=0;for(;;){let i=!0;try{const o=t.rmdirSync(e,t);return i=!1,o}finally{if(++r<n&&i)continue}}}(e,t);else if("ENOENT"!==r.code)throw r}}e.exports=c,c.sync=p},function(e,t,n){"use strict";const r=n(46),i=n(47),o=n(48);e.exports={createFile:r.createFile,createFileSync:r.createFileSync,ensureFile:r.createFile,ensureFileSync:r.createFileSync,createLink:i.createLink,createLinkSync:i.createLinkSync,ensureLink:i.createLink,ensureLinkSync:i.createLinkSync,createSymlink:o.createSymlink,createSymlinkSync:o.createSymlinkSync,ensureSymlink:o.createSymlink,ensureSymlinkSync:o.createSymlinkSync}},function(e,t,n){"use strict";const r=n(2).fromCallback,i=n(0),o=n(1),a=n(3),s=n(4).pathExists;e.exports={createFile:r((function(e,t){function n(){o.writeFile(e,"",e=>{if(e)return t(e);t()})}o.stat(e,(r,o)=>{if(!r&&o.isFile())return t();const c=i.dirname(e);s(c,(e,r)=>e?t(e):r?n():void a.mkdirs(c,e=>{if(e)return t(e);n()}))})})),createFileSync:function(e){let t;try{t=o.statSync(e)}catch(e){}if(t&&t.isFile())return;const n=i.dirname(e);o.existsSync(n)||a.mkdirsSync(n),o.writeFileSync(e,"")}}},function(e,t,n){"use strict";const r=n(2).fromCallback,i=n(0),o=n(1),a=n(3),s=n(4).pathExists;e.exports={createLink:r((function(e,t,n){function r(e,t){o.link(e,t,e=>{if(e)return n(e);n(null)})}s(t,(c,l)=>c?n(c):l?n(null):void o.lstat(e,o=>{if(o)return o.message=o.message.replace("lstat","ensureLink"),n(o);const c=i.dirname(t);s(c,(i,o)=>i?n(i):o?r(e,t):void a.mkdirs(c,i=>{if(i)return n(i);r(e,t)}))}))})),createLinkSync:function(e,t){if(o.existsSync(t))return;try{o.lstatSync(e)}catch(e){throw e.message=e.message.replace("lstat","ensureLink"),e}const n=i.dirname(t);return o.existsSync(n)||a.mkdirsSync(n),o.linkSync(e,t)}}},function(e,t,n){"use strict";const r=n(2).fromCallback,i=n(0),o=n(1),a=n(3),s=a.mkdirs,c=a.mkdirsSync,l=n(49),u=l.symlinkPaths,d=l.symlinkPathsSync,h=n(50),p=h.symlinkType,f=h.symlinkTypeSync,g=n(4).pathExists;e.exports={createSymlink:r((function(e,t,n,r){r="function"==typeof n?n:r,n="function"!=typeof n&&n,g(t,(a,c)=>a?r(a):c?r(null):void u(e,t,(a,c)=>{if(a)return r(a);e=c.toDst,p(c.toCwd,n,(n,a)=>{if(n)return r(n);const c=i.dirname(t);g(c,(n,i)=>n?r(n):i?o.symlink(e,t,a,r):void s(c,n=>{if(n)return r(n);o.symlink(e,t,a,r)}))})}))})),createSymlinkSync:function(e,t,n){if(o.existsSync(t))return;const r=d(e,t);e=r.toDst,n=f(r.toCwd,n);const a=i.dirname(t);return o.existsSync(a)||c(a),o.symlinkSync(e,t,n)}}},function(e,t,n){"use strict";const r=n(0),i=n(1),o=n(4).pathExists;e.exports={symlinkPaths:function(e,t,n){if(r.isAbsolute(e))return i.lstat(e,t=>t?(t.message=t.message.replace("lstat","ensureSymlink"),n(t)):n(null,{toCwd:e,toDst:e}));{const a=r.dirname(t),s=r.join(a,e);return o(s,(t,o)=>t?n(t):o?n(null,{toCwd:s,toDst:e}):i.lstat(e,t=>t?(t.message=t.message.replace("lstat","ensureSymlink"),n(t)):n(null,{toCwd:e,toDst:r.relative(a,e)})))}},symlinkPathsSync:function(e,t){let n;if(r.isAbsolute(e)){if(n=i.existsSync(e),!n)throw new Error("absolute srcpath does not exist");return{toCwd:e,toDst:e}}{const o=r.dirname(t),a=r.join(o,e);if(n=i.existsSync(a),n)return{toCwd:a,toDst:e};if(n=i.existsSync(e),!n)throw new Error("relative srcpath does not exist");return{toCwd:e,toDst:r.relative(o,e)}}}}},function(e,t,n){"use strict";const r=n(1);e.exports={symlinkType:function(e,t,n){if(n="function"==typeof t?t:n,t="function"!=typeof t&&t)return n(null,t);r.lstat(e,(e,r)=>{if(e)return n(null,"file");t=r&&r.isDirectory()?"dir":"file",n(null,t)})},symlinkTypeSync:function(e,t){let n;if(t)return t;try{n=r.lstatSync(e)}catch(e){return"file"}return n&&n.isDirectory()?"dir":"file"}}},function(e,t,n){"use strict";const r=n(2).fromCallback,i=n(13);i.outputJson=r(n(53)),i.outputJsonSync=n(54),i.outputJSON=i.outputJson,i.outputJSONSync=i.outputJsonSync,i.writeJSON=i.writeJson,i.writeJSONSync=i.writeJsonSync,i.readJSON=i.readJson,i.readJSONSync=i.readJsonSync,e.exports=i},function(e,t,n){var r;try{r=n(1)}catch(e){r=n(5)}function i(e,t){var n,r="\n";return"object"==typeof t&&null!==t&&(t.spaces&&(n=t.spaces),t.EOL&&(r=t.EOL)),JSON.stringify(e,t?t.replacer:null,n).replace(/\n/g,r)+r}function o(e){return Buffer.isBuffer(e)&&(e=e.toString("utf8")),e=e.replace(/^\uFEFF/,"")}var a={readFile:function(e,t,n){null==n&&(n=t,t={}),"string"==typeof t&&(t={encoding:t});var i=(t=t||{}).fs||r,a=!0;"throws"in t&&(a=t.throws),i.readFile(e,t,(function(r,i){if(r)return n(r);var s;i=o(i);try{s=JSON.parse(i,t?t.reviver:null)}catch(t){return a?(t.message=e+": "+t.message,n(t)):n(null,null)}n(null,s)}))},readFileSync:function(e,t){"string"==typeof(t=t||{})&&(t={encoding:t});var n=t.fs||r,i=!0;"throws"in t&&(i=t.throws);try{var a=n.readFileSync(e,t);return a=o(a),JSON.parse(a,t.reviver)}catch(t){if(i)throw t.message=e+": "+t.message,t;return null}},writeFile:function(e,t,n,o){null==o&&(o=n,n={});var a=(n=n||{}).fs||r,s="";try{s=i(t,n)}catch(e){return void(o&&o(e,null))}a.writeFile(e,s,n,o)},writeFileSync:function(e,t,n){var o=(n=n||{}).fs||r,a=i(t,n);return o.writeFileSync(e,a,n)}};e.exports=a},function(e,t,n){"use strict";const r=n(0),i=n(3),o=n(4).pathExists,a=n(13);e.exports=function(e,t,n,s){"function"==typeof n&&(s=n,n={});const c=r.dirname(e);o(c,(r,o)=>r?s(r):o?a.writeJson(e,t,n,s):void i.mkdirs(c,r=>{if(r)return s(r);a.writeJson(e,t,n,s)}))}},function(e,t,n){"use strict";const r=n(1),i=n(0),o=n(3),a=n(13);e.exports=function(e,t,n){const s=i.dirname(e);r.existsSync(s)||o.mkdirsSync(s),a.writeJsonSync(e,t,n)}},function(e,t,n){"use strict";const r=n(1),i=n(0),o=n(20).copySync,a=n(11).removeSync,s=n(3).mkdirsSync,c=n(23);function l(e,t,n){return r.statSync(e).isDirectory()?function(e,t,n){const r={overwrite:!1};n?(a(t),i()):i();function i(){return o(e,t,r),a(e)}}(e,t,n):function(e,t,n){const i=c(65536),o=n?"w":"wx",a=r.openSync(e,"r"),s=r.fstatSync(a),l=r.openSync(t,o,s.mode);let u=0;for(;u<s.size;){const e=r.readSync(a,i,0,65536,u);r.writeSync(l,i,0,e),u+=e}return r.closeSync(a),r.closeSync(l),r.unlinkSync(e)}(e,t,n)}e.exports={moveSync:function e(t,n,o){const c=(o=o||{}).overwrite||o.clobber||!1;if(t=i.resolve(t),n=i.resolve(n),t===n)return r.accessSync(t);if(function(e,t){try{return r.statSync(e).isDirectory()&&e!==t&&t.indexOf(e)>-1&&t.split(i.dirname(e)+i.sep)[1].split(i.sep)[0]===i.basename(e)}catch(e){return!1}}(t,n))throw new Error(`Cannot move '${t}' into itself '${n}'.`);s(i.dirname(n)),function(){if(c)try{r.renameSync(t,n)}catch(r){if("ENOTEMPTY"===r.code||"EEXIST"===r.code||"EPERM"===r.code)return a(n),o.overwrite=!1,e(t,n,o);if("EXDEV"!==r.code)throw r;return l(t,n,c)}else try{r.linkSync(t,n),r.unlinkSync(t)}catch(e){if("EXDEV"===e.code||"EISDIR"===e.code||"EPERM"===e.code||"ENOTSUP"===e.code)return l(t,n,c);throw e}}()}}},function(e,t,n){"use strict";const r=n(2).fromCallback,i=n(1),o=n(0),a=n(24).copy,s=n(11).remove,c=n(3).mkdirp,l=n(4).pathExists;function u(e,t,n,r){i.rename(e,t,i=>i?"EXDEV"!==i.code?r(i):function(e,t,n,r){a(e,t,{overwrite:n,errorOnExist:!0},t=>t?r(t):s(e,r))}(e,t,n,r):r())}e.exports={move:r((function(e,t,n,r){"function"==typeof n&&(r=n,n={});const a=n.overwrite||n.clobber||!1;if(e=o.resolve(e),t=o.resolve(t),e===t)return i.access(e,r);i.stat(e,(n,i)=>n?r(n):i.isDirectory()&&function(e,t){const n=e.split(o.sep),r=t.split(o.sep);return n.reduce((e,t,n)=>e&&r[n]===t,!0)}(e,t)?r(new Error(`Cannot move '${e}' to a subdirectory of itself, '${t}'.`)):void c(o.dirname(t),n=>n?r(n):function(e,t,n,r){if(n)return s(t,i=>i?r(i):u(e,t,n,r));l(t,(i,o)=>i?r(i):o?r(new Error("dest already exists.")):u(e,t,n,r))}(e,t,a,r)))}))}},function(e,t,n){"use strict";const r=n(2).fromCallback,i=n(1),o=n(0),a=n(3),s=n(4).pathExists;e.exports={outputFile:r((function(e,t,n,r){"function"==typeof n&&(r=n,n="utf8");const c=o.dirname(e);s(c,(o,s)=>o?r(o):s?i.writeFile(e,t,n,r):void a.mkdirs(c,o=>{if(o)return r(o);i.writeFile(e,t,n,r)}))})),outputFileSync:function(e,...t){const n=o.dirname(e);if(i.existsSync(n))return i.writeFileSync(e,...t);a.mkdirsSync(n),i.writeFileSync(e,...t)}}},,,,,function(e,t,n){"use strict";
/*!
 *  Appenders.ts
 *  AUF
 *
 *  Created by Johan Blumenberg on 2016-12-29
 *  Copyright 2016 Microsoft. All rights reserved.
 *
 */var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o,a=n(26),s=n(29),c=function(){function e(e){this._formatter=e||new d}return e.prototype.formatter=function(){return this._formatter},e.prototype.receiveAll=function(){return!1},e.prototype.levels=function(){return null},e}();function l(e){return(4294967296+e).toString(16).substr(-8)}function u(e,t){return(1e12+e).toString(10).substr(-t)}t.AbstractLogAppender=c,function(e){e[e.Timestamp=1]="Timestamp",e[e.Component=4]="Component",e[e.Level=8]="Level",e[e.FullDate=32]="FullDate",e[e.LogId=64]="LogId"}(o=t.SLF_Flags||(t.SLF_Flags={}));var d=function(){function e(e){void 0===e&&(e=4294967295),this._flags=e}return e.prototype.format=function(e,t,n,r){var i="";if(this._flags&o.FullDate)i+=new Date(e.timestamp).toISOString()+" ";else if(this._flags&o.Timestamp){var c=new Date(e.timestamp);i+=u(c.getHours(),2)+":"+u(c.getMinutes(),2)+":"+u(c.getSeconds(),2)+"."+u(c.getMilliseconds(),2)+" "}return this._flags&o.LogId&&(i+="[#"+l(t)+"-"+(e.component.safe()?"S":"u")+"] "),this._flags&o.Level&&(i+="["+s.LogFactory.levelToString(e.level)+"] "),this._flags&o.Component&&(i+="["+e.component.name()+"] "),n||""===n?i+a.vsprintf(n,r):i+l(t)+": "+r.join(" ")},e}();t.StandardLogFormatter=d;var h=console,p=console.log||function(){},f=console.info||p,g=console.warn||f,_=console.error||g,m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.log=function(e,t,n,r){r=r.slice(0);var i=e.level<=a.LogLevel.Debug3?p:e.level<=a.LogLevel.Debug1?f:e.level<=a.LogLevel.Warning?g:_;if(-1===t){var o=this.formatter().format(e,t,"",[]);"string"==typeof r[0]&&(o+=r.shift()),i.apply(h,[o].concat(r))}else{for(var s=void 0,c=[];s=n.match(/\s*%@\s*$/);)n=n.substr(0,n.length-s[0].length),c.unshift(r.pop());o=this.formatter().format(e,t,n,r);i.apply(h,[o].concat(c))}},t}(c);t.ConsoleAppender=m;var v=function(){function e(e){this._chained=e}return e.prototype.log=function(e,t,n,r){this._chained.log(e,t,n,r)},e.prototype.receiveAll=function(){return this._chained.receiveAll()},e.prototype.levels=function(){return this._chained.levels()},e}();t.ChainedLogAppender=v;var y=function(e){function t(t,n){var r=e.call(this,t)||this;return r._levels=n,r}return i(t,e),t.prototype.levels=function(){return this._levels},t}(v);t.wrapAppenderWithLogLevels=function(e,t){return new y(e,t)}},function(e,t,n){var r=n(9);e.exports=function(){return r.randomBytes(16)}},function(e,t){for(var n=[],r=0;r<256;++r)n[r]=(r+256).toString(16).substr(1);e.exports=function(e,t){var r=t||0,i=n;return[i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]]].join("")}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(66),o=n(17),a=n(30);let{remote:s}=n(10);const c=window.TraceSource,l=new i.ElectronApp(c),u=e=>r(this,void 0,void 0,(function*(){return c.info("Request: dispose"),yield l.dispose()})),d=e=>r(this,void 0,void 0,(function*(){return c.info("Request: endCall"),yield l.endAndCleanUpCurrentCall()})),h=e=>r(this,void 0,void 0,(function*(){return c.info("Request: enumerateDevices"),yield l.enumerateDevices()})),p=e=>r(this,void 0,void 0,(function*(){return c.info("Request: callInfo"),l.getCallInfo()})),f=e=>r(this,void 0,void 0,(function*(){return c.info("Request: currentParticipants"),yield l.getCurrentParticipants()})),g=e=>r(this,void 0,void 0,(function*(){return c.info("Request: dominantSpeakers"),yield l.getDominantSpeakers()})),_=e=>r(this,void 0,void 0,(function*(){return c.info("Request: selectedDevices"),l.getSelectedDevices()})),m=e=>r(this,void 0,void 0,(function*(){return c.info("Request: getWindowsForSharing"),yield l.getWindowsForSharing()})),v=e=>r(this,void 0,void 0,(function*(){return c.info("Request: initalizeStack"),yield l.initialize(e.skypeToken,e.displayName)})),y=e=>r(this,void 0,void 0,(function*(){return c.info("Request: isMuted"),l.isMuted()})),C=e=>r(this,void 0,void 0,(function*(){return c.info("Request: loadSlimCore"),yield l.loadSlimCore()})),S=e=>r(this,void 0,void 0,(function*(){return c.info("Request: muteOrUnmute"),l.muteOrUnmute(e.isMute,e.participant)})),I=e=>r(this,void 0,void 0,(function*(){return c.info("Request: selectDevices"),l.selectDevices(e.selectedDevices)})),T=e=>r(this,void 0,void 0,(function*(){c.info("Request: showWindow"),yield l.showWindow()})),P=e=>r(this,void 0,void 0,(function*(){c.info("Request: hideWindow"),yield l.hideWindow()})),E=e=>r(this,void 0,void 0,(function*(){c.info("Request: shareWindow"),yield l.shareWindow(e.windowId)})),O=e=>r(this,void 0,void 0,(function*(){return c.info("Request: startAudio"),yield l.startAudio()})),b=e=>r(this,void 0,void 0,(function*(){return c.info("Request: startOrJoinCall"),yield l.connectToCall(e.groupContext,e.enableAudio)})),A=e=>r(this,void 0,void 0,(function*(){return c.info("Request: stopScreenSharing"),yield l.stopScreenSharing()}));window.onload=()=>r(this,void 0,void 0,(function*(){const e=new a.LogFileTraceListener("VSLSAudio_ElectronRendererProcess");yield e.openAsync(),c.addTraceListener(e);const t=window.appEvents;t.on(o.RequestType.dispose,u),t.on(o.RequestType.endCall,d),t.on(o.RequestType.enumerateDevices,h),t.on(o.RequestType.getCallInfo,p),t.on(o.RequestType.getCurrentParticipants,f),t.on(o.RequestType.getDominantSpeakers,g),t.on(o.RequestType.getSelectedDevices,_),t.on(o.RequestType.getWindowsForSharing,m),t.on(o.RequestType.initializeStackEvent,v),t.on(o.RequestType.isMuted,y),t.on(o.RequestType.loadSlimCore,C),t.on(o.RequestType.muteOrUnmute,S),t.on(o.RequestType.selectDevices,I),t.on(o.RequestType.shareWindow,E),t.on(o.RequestType.showWindow,T),t.on(o.RequestType.hideWindow,P),t.on(o.RequestType.startAudio,O),t.on(o.RequestType.startOrJoinCall,b),t.on(o.RequestType.stopScreenSharing,A),l.callChangedEventEmitter.on(o.NotificationType.callChanged,e=>{t.sendNotification(e)}),yield t.sendNotification(new o.ElectronAppReady),document.getElementById("close-button").addEventListener("click",(function(e){l.terminateControl();s.getCurrentWindow().hide()}))})),window.onbeforeunload=()=>{l.dispose()}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(67),o=n(28),a=n(80),s=n(17),c=n(14),l=n(7);t.ElectronApp=class{constructor(e){this.trace=e,this.logPrefix="[ElectronApp]",this.currentCallParticipants={},this.callChangedEventEmitter=new c,this.isScreenShareEnabled=window.StartOptions.isScreenShareEnabled,this.isScreenShareControlEnabled=window.StartOptions.isScreenShareControlEnabled}loadSlimCore(){return r(this,void 0,void 0,(function*(){try{this.trace.info(this.logPrefix+" loadSlimCore"),this.stackProvider=new i.ElectronStackProvider(this.trace),this.callingStack=yield this.stackProvider.build(),this.config=this.stackProvider.config,this.trace.info(this.logPrefix+" loaded slimcore")}catch(e){throw this.trace.error(`${this.logPrefix} failed to load slimcore: ${e}`),e}}))}initialize(e,t){return r(this,void 0,void 0,(function*(){return this.trace.info(this.logPrefix+" create callRegistry"),this.callRegistry=this.callingStack.getCallRegistry(),this.trace.info(this.logPrefix+" init callRegistry"),yield this.callRegistry.init({displayName:t,id:e.skypeId,tokenProvider:()=>(this.trace.info(this.logPrefix+" return token"),Promise.resolve(e.skypeToken))}),this.trace.info(this.logPrefix+" get DeviceManager"),this.deviceManager=this.callingStack.getDeviceManager(),this.trace.info(this.logPrefix+" get ScreenSharingManager"),this.screenSharingManager=this.callingStack.getScreenSharingManager(),this.trace.info(this.logPrefix+" done"),new Promise((e,t)=>{setTimeout(()=>e(),1500)})}))}endAndCleanUpCurrentCall(){return r(this,void 0,void 0,(function*(){if(this.trace.info(this.logPrefix+" endAndCleanUpCurrentCall started"),this.currentCall){try{yield this.currentCall.stop()}finally{this.callWrapper&&(this.trace.info(this.logPrefix+" disposing call wrapper"),this.callWrapper.dispose(),this.callWrapper=null),this.trace.info(this.logPrefix+" disposing participants"),Object.keys(this.currentCallParticipants).forEach(e=>{this.trace.info(`${this.logPrefix} disposing call participant with id: ${e}`),this.currentCallParticipants[e].dispose()}),this.currentCallParticipants={},this.currentCall=null,this.isScreenSharing=!1,this.callChangedCallback&&(this.callChangedCallback.dispose(),this.callChangedCallback=null)}this.trace.info(this.logPrefix+" endAndCleanUpCurrentCall completed")}}))}enumerateDevices(){return r(this,void 0,void 0,(function*(){if(!this.deviceManager)return[];const e=yield this.deviceManager.enumerateDevicesAsync();return this.trace.info(`${this.logPrefix} finished enumerating devices: ${e}`),e}))}getSelectedDevices(){if(this.deviceManager)return this.deviceManager.getSelectedDevices()}getCurrentParticipants(){return this.currentCallParticipants?o.map(this.currentCallParticipants,e=>({displayName:e.displayName,id:e.id,isServerMuted:e.isServerMuted,voiceLevel:e.voiceLevel})):[]}getDominantSpeakers(){return this.currentCall?o.map(this.currentCall.dominantSpeakerInfo.speakerList,e=>{const t=this.currentCallParticipants[e];return{displayName:t.displayName,id:t.id,isServerMuted:t.isServerMuted,voiceLevel:t.voiceLevel}}):[]}selectDevices(e){if(this.deviceManager)return this.deviceManager.selectDevices(e)}isMuted(){return!this.callWrapper||this.callWrapper.isMuted()}getWindowsForSharing(){return r(this,void 0,void 0,(function*(){return(yield this.screenSharingManager.enumerateWindowsAsync()).map(e=>({id:e.getId(),description:e.getDescription(),appName:e.getAppName()}))}))}shareWindow(e){return r(this,void 0,void 0,(function*(){if(this.trace.info(`${this.logPrefix} Share window start: ${e}`),!this.isScreenShareEnabled)return void this.trace.info(this.logPrefix+" cannot share window when screen sharing is disabled");const t=yield this.screenSharingManager.enumerateWindowsAsync(),n=o.filter(t,t=>t.getId()===e);if(!n||!n.length)throw new Error("Window does not exist");this.isCallConnected?(yield this.currentCall.startScreenSharing(n[0]),this.isScreenSharing=!0,this.trace.info(this.logPrefix+" Share window end")):this.trace.warning(`${this.logPrefix} cannot share when call isn't connected. State: ${this.currentCall&&this.currentCall.state}`)}))}showWindow(){return r(this,void 0,void 0,(function*(){this.isScreenShareEnabled?this.callWrapper&&this.callWrapper.showWindow():this.trace.info(this.logPrefix+" cannot show window when screen sharing is disabled")}))}hideWindow(){return r(this,void 0,void 0,(function*(){this.callWrapper&&this.callWrapper.hideWindow()}))}stopScreenSharing(){return r(this,void 0,void 0,(function*(){yield this.currentCall.stopScreenSharing(),this.isScreenSharing=!1;const e=new s.CallChanged(s.CallChangedType.screenShareEnded);this.callChangedEventEmitter.emit(s.NotificationType.callChanged,e)}))}terminateControl(){return r(this,void 0,void 0,(function*(){if(this.isScreenShareControlEnabled){const e=this.currentCall.screenSharingControl;yield e.terminateControl()}}))}startAudio(){return r(this,void 0,void 0,(function*(){this.trace.info(`${this.logPrefix} Start audio for screen sharing only call: ${this.currentCall.callId}`),yield this.currentCall.startAudio().then(e=>{0===e?this.trace.info(`${this.logPrefix} Screen sharing call was escalated: ${this.currentCall.callId}`):this.trace.error(`${this.logPrefix} Failed to escalate screensharing call: ${this.currentCall.callId}, with status: ${e}`)}).catch(e=>{this.trace.error(`${this.logPrefix} Failed to escalate screensharing call: ${this.currentCall.callId}, with error: ${e}`)})}))}connectToCall(e,t){return r(this,void 0,void 0,(function*(){if(this.currentCall)return this.trace.warning(this.logPrefix+" Already connected to a call"),this.endAndCleanUpCurrentCall().then(()=>Promise.reject(new Error("Already connected to a call. Ending current call. Please retry audio join")));try{this.trace.info(`${this.logPrefix} Connecting to call with group context: ${e} enableAudio:${t}`);const n=this.callRegistry.createCall(e);n.init({threadId:e,mediaPeerType:2}),n.on("callStateChanged",()=>r(this,void 0,void 0,(function*(){if(this.trace.info(`${this.logPrefix} callStateChanged: ${n.state}`),7===n.state){const e=new s.CallChanged(s.CallChangedType.callDisconnected);this.callChangedEventEmitter.emit(s.NotificationType.callChanged,e),yield this.endAndCleanUpCurrentCall()}}))),n.on("participantAdded",()=>r(this,void 0,void 0,(function*(){this.trace.info(this.logPrefix+" participantAdded"),o.forEach(n.participants,e=>r(this,void 0,void 0,(function*(){if(!(e.id in this.currentCallParticipants)){this.currentCallParticipants[e.id]=e;const t=new s.CallChanged(s.CallChangedType.participantsChanged);this.callChangedEventEmitter.emit(s.NotificationType.callChanged,t)}})))}))),n.on("participantRemoved",()=>{this.trace.info(this.logPrefix+" participantRemoved");const e={};o.forEach(n.participants,t=>{e[t.id]=t});let t=[];o.forEach(Object.keys(this.currentCallParticipants),n=>{n in e||t.push(this.currentCallParticipants[n])}),o.forEach(t,e=>{delete this.currentCallParticipants[e.id];const t=new s.CallChanged(s.CallChangedType.participantsChanged);this.callChangedEventEmitter.emit(s.NotificationType.callChanged,t)}),t=null}),n.on("serverMutedChanged",e=>{this.trace.info(`${this.logPrefix} serverMutedChanged: ${e}`);const t=new s.CallChanged(s.CallChangedType.muteChanged,null);this.callChangedEventEmitter.emit(s.NotificationType.callChanged,t)}),n.on("participantUpdated",e=>{this.trace.info(this.logPrefix+" participantUpdated");const t={displayName:e.displayName,id:e.id,isServerMuted:e.isServerMuted,voiceLevel:e.voiceLevel},n=new s.CallChanged(s.CallChangedType.participantChanged,t);this.callChangedEventEmitter.emit(s.NotificationType.callChanged,n)}),n.on("callStateChanged",()=>{switch(this.trace.info(`${this.logPrefix} callStateChanged: ${n.state}`),n.state){case 3:{this.trace.info(this.logPrefix+" callStateChanged: connected to call");const e={threadId:n.threadId,callId:n.callId,state:n.state},t=new s.CallChanged(s.CallChangedType.callStarted,null,e);this.callChangedEventEmitter.emit(s.NotificationType.callChanged,t)}break;default:return}}),this.currentCall=n;const i=window.StartOptions.isHost;this.trace.info("isHost: "+i),this.trace.info("isScreenShareEnabled: "+this.isScreenShareEnabled),this.trace.info("isScreenShareControlEnabled: "+this.isScreenShareControlEnabled);const c=t?4:3,l=this.isScreenShareEnabled?4:0,u={audioDirection:c,ringOthers:!1,screenshareDirection:l,videoDirection:0,datachannelDirection:this.isScreenShareControlEnabled?4:0};this.callChangedCallback=n.changed(()=>{if(this.isScreenSharing&&!n.isScreenSharingOn){this.trace.info(this.logPrefix+" screen sharing ended"),this.isScreenSharing=!1;const e=new s.CallChanged(s.CallChangedType.screenShareEnded);this.callChangedEventEmitter.emit(s.NotificationType.callChanged,e)}}),yield n.start(u),this.callWrapper=new a.default(n,i,this.isScreenShareControlEnabled,this.trace),this.isScreenShareControlEnabled&&this.enableScreenSharingControl(n,i)}catch(e){throw this.trace.error(`${this.logPrefix} error while connecting to call: ${e.message}`),e}}))}muteOrUnmute(e,t){return r(this,void 0,void 0,(function*(){if(!this.currentCall)return;let n;if(!t)return e?yield this.currentCall.mute():yield this.currentCall.unmute();const r=o.find(this.currentCallParticipants,e=>e.id===t.id);if(!r)return;n=o.filter(this.currentCallParticipants,e=>e.isServerMuted);const i=n.indexOf(r);e&&i<0?n.push(r):!e&&i>=0&&n.splice(i,1),yield this.currentCall.muteParticipants(1,n)}))}getCallInfo(){if(this.callWrapper)return this.callWrapper.getCallInfo()}dispose(){return r(this,void 0,void 0,(function*(){yield this.endAndCleanUpCurrentCall(),this.stackProvider&&(this.stackProvider.dispose(),this.stackProvider=null),this.callingStack=null,this.callRegistry=null,this.deviceManager=null,this.screenSharingManager=null,this.config=null}))}isCallConnected(){return this.currentCall&&3===this.currentCall.state}enableScreenSharingControl(e,t){const n=this.currentCall.screenSharingControl;n.setScreenSharingControlFeatureFlag(!0),t?(this.trace.info("Host: setup screen sharing for "+e.participantId),n.enableScreenSharingControl(!0,null,null,e=>(this.trace.info(`${this.logPrefix} Screen share control for user: ${e}`),Promise.resolve(!0))),n.on("sharingIncomingControlRequest",e=>{const t=this.currentCall.participants.find(t=>t.id===e);this.trace.info(`${this.logPrefix} Set pointer images for participant: ${t}`),n.setRemotePointerImage(t,l.avatarBase64),n.setLocalPointerImage(l.ghostAvatarBase64),this.trace.info(this.logPrefix+" Processing accept control request for sharer"),this.currentCall.screenSharingControl.acceptControlRequest().then(()=>this.trace.info(this.logPrefix+" acceptControlRequest completed successfully")).catch(e=>this.trace.error("acceptControlRequest error: "+e))})):(this.trace.info(`${this.logPrefix} Guest: setup screen sharing for ${e.participantId}`),n.on("sharingControlCapable",e=>{this.trace.info(`${this.logPrefix} sharingControlCapable raised. [Capabilty] capable:${e.capable}, disabledBySharer:${e.disabledBySharer}, id:${e.id}`),e.capable&&!e.disabledBySharer&&n.requestControl().then(()=>this.trace.info(this.logPrefix+" Control taken")).catch(e=>this.trace.info(`${this.logPrefix} Control taken error: ${e}`))}))}}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(5),o=n(0),a=n(6),s=n(68),c=n(74),l=n(8),u=n(7),{ipcRenderer:d}=n(10);class h{constructor(e){this.trace=e,this.logPrefix="[AppLogger]"}createChild(e,t){return this}log(...e){this.trace.info(`${this.logPrefix} log: ${l.TraceFormat.formatMessage(e,this.trace)}`)}debug(...e){this.trace.info(`${this.logPrefix} debug: ${l.TraceFormat.formatMessage(e,this.trace)}`)}info(...e){this.trace.info(`${this.logPrefix} info: ${l.TraceFormat.formatMessage(e,this.trace)}`)}warn(...e){this.trace.warning(`${this.logPrefix} warn: ${l.TraceFormat.formatMessage(e,this.trace)}`)}error(...e){this.trace.error(`${this.logPrefix} error: ${l.TraceFormat.formatMessage(e,this.trace)}`)}}class p{constructor(e){this.trace=e,this.logPrefix="[ControlInjectorProxy]"}setInjectorConfig(e){return r(this,void 0,void 0,(function*(){return this.invokeInjectorCommand(u.ElectronChannels.setInjectorConfig,()=>d.send(u.ElectronChannels.setInjectorConfig,e))}))}injectRawInput(e,t){return r(this,void 0,void 0,(function*(){return this.invokeInjectorCommand(u.ElectronChannels.injectRawInput,()=>d.send(u.ElectronChannels.injectRawInput,e,t))}))}setInjectionRect(e){return r(this,void 0,void 0,(function*(){return this.invokeInjectorCommand(u.ElectronChannels.setInjectionRect,()=>d.send(u.ElectronChannels.setInjectionRect,e))}))}allowSingleController(e){return r(this,void 0,void 0,(function*(){return this.invokeInjectorCommand(u.ElectronChannels.allowSingleController,()=>d.send(u.ElectronChannels.allowSingleController,e))}))}setAvatar(e,t){return r(this,void 0,void 0,(function*(){return this.invokeInjectorCommand(u.ElectronChannels.setAvatar,()=>d.send(u.ElectronChannels.setAvatar,e,t))}))}invokeInjectorCommand(e,t){return r(this,void 0,void 0,(function*(){this.trace.info(`${this.logPrefix} Proxy ${e}: start`);try{t()}catch(e){this.trace.error(e)}this.trace.info(`${this.logPrefix} Proxy ${e}: end`)}))}dispose(){}}class f{constructor(e){this.trace=e,this.logPrefix="[AppHooks]";const t=window.process.platform;let n;switch(this.trace.info(`${this.logPrefix} Create control injector instance. Platform: ${t}`),t){case"freebsd":case"linux":n={setInjectorConfig:e=>Promise.resolve(),injectRawInput:(e,t)=>Promise.resolve(),setInjectionRect:e=>Promise.resolve(),allowSingleController:e=>Promise.resolve(),setAvatar:(e,t)=>Promise.resolve(),dispose:()=>{}};break;case"darwin":case"win32":default:n=new p(this.trace)}this.controlInjector=n}onDisplaysChanged(e){return{dispose:()=>{}}}showSharingIndicator(e){}hideSharingIndicator(){}getControlInjector(){return this.trace.info(`${this.logPrefix} getcontrolinjector: ${this.controlInjector}`),this.controlInjector}}t.ElectronStackProvider=class{constructor(e){this.trace=e,this.logPrefix="[ElectronStackProvider]"}build(){const e=c.PLATFORMS[`${window.process.platform}-${window.process.arch}`];if(this.trace.info(`${this.logPrefix} PlatformId: ${e}`),!e)throw new Error(`Platform ${window.process.platform}-${window.process.arch} not supported`);const t=o.join(a.tmpdir(),u.logDirectoryName);i.existsSync(t)||i.mkdirSync(t),this.trace.info(`${this.logPrefix} temp slimcore directory: ${l.TraceFormat.formatPath(t,this.trace)}`);const n={dataPath:t,mediaLogsPath:t,logFileName:"logger",version:`${e}/${c.getNormalizedVersion()}//`,isEncrypted:!1};return this.trace.info(this.logPrefix+" creating slimcore instance"),this.slimCoreInstance=global.SlimCore.createSlimCoreInstance(n),this.trace.info(`${this.logPrefix} ${this.slimCoreInstance}`),this.config={appHooks:new f(this.trace),logger:new h(this.trace),settings:{enableDXVA:!1,autoStopLocalVideo:!1},slimCoreInstance:this.slimCoreInstance},s.slimCoreElectronStackFactory.build(this.config)}dispose(){this.slimCoreInstance&&(this.slimCoreInstance.dispose(),this.slimCoreInstance=null),global.SlimCore=null,global.Enums=null}}},function(e,t,n){var r;"undefined"!=typeof self&&self,r=function(e,t){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=39)}([function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o,a,s,c=n(1),l=n(23);if(c.defaults(window,{SlimCore:{}}),c.defaults(SlimCore,{Enums:{}}),h()){var u=window.SlimCoreRT.SlimCore.Enums;a=u,s=SlimCore.Enums,Object.keys(a).forEach((function(e){!function(e,t,n){n[e]={},Object.keys(t).forEach((function(r){n[e][r]=t[r]}))}(e,a[e],s)})),o=SlimCore.Enums,Object.keys(o).forEach((function(e){var t;t=o[e],Object.keys(t).forEach((function(e){!function(e,t){var n,r=(n=t)[0].toUpperCase()+n.substr(1);if(r!==t){var i=e[t];e[i]=r,delete e[t],e[r]=i}}(t,e)}))}))}Proxy&&(SlimCore.Enums=new Proxy(SlimCore.Enums,{get:function(e,t){return t in e?e[t]:{}}}));var d=SlimCore.Enums;function h(){return!!(window.SlimCoreRT&&window.SlimCoreRT.SlimCore&&window.SlimCoreRT.SlimCore.Enums)}t.isSlimCoreRTModuleAvailable=h;var p,f=[d.VideoStatus.Available,d.VideoStatus.Starting,d.VideoStatus.Running];function g(e,t,n,r,i){try{return e.getIntProperty(n,r)}catch(e){return t.logFailure("getIntProperty failed: "+e),i}}t.wrap=function(e,t){return void 0===t&&(t={}),t.enableNativeHandle&&"handle"in e?e:c.assign(e,{handle:function(t,n,r){var i=n?function(e,t){return function(n){(function(e,t){for(var n in t)if(t.hasOwnProperty(n)&&e[n]!==t[n])return!1;return!0})(n,t)&&e(n)}}(r,n):r;return e.addListener(t,i),{dispose:function(){e.removeListener(t,i)}}}})},function(e){e[e.Electron=1]="Electron",e[e.Uwp=2]="Uwp"}(p=t.PlatformType||(t.PlatformType={})),t.forgetAndLog=function(e,t,n){return e?(t.info("Promise executing: "+n),e.catch((function(e){t.logFailure("Promise execution failed: "+e)}))):(t.logFailure("Undefined promise @ "+(new Error).stack),Promise.resolve())},t.getStrProperty=function(e,t,n,r,i){try{return e.getStrProperty(n,r)}catch(e){return t.logFailure("getStrProperty failed for objectId="+n+", propertyKey="+r+": "+e),i}},t.getIntProperty=g,t.hasFeature=function(e){return e in d.Feature};var _=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.fire=function(){this.raiseEvents((function(e){return e()}))},t}(l.EventSourceImpl);function m(e){return new Promise((function(t,n){var r,i=!1,o=null,a=0,s=function(e){i=!0,o&&(o.dispose(),o=null),a&&(clearTimeout(a),a=0),r&&r.dispose(),e?n(e):t()},c=function(t){i||(e.logger.info("waitForVideoObjectState["+e.videoObjectId+"] state changed -> "+t+" ("+d.VideoStatus[t]+")"),v(t,e.resolveStates)?s():e.rejectStates&&v(t,e.rejectStates)&&s("waitForVideoObjectState["+e.videoObjectId+"] rejecting state "+t+" ("+d.VideoStatus[t]+")"))};e.timeout&&(a=setTimeout((function(){if(!i){e.logger.info("waitForVideoObjectState["+e.videoObjectId+"] timeout. Checking state again.");var t=g(e.slimcoreObject,e.logger,e.videoObjectId,d.Property.VideoStatus);v(t,e.resolveStates)?s():e.rejectStates&&v(t,e.rejectStates)?s("waitForVideoObjectState["+e.videoObjectId+"] rejecting state "+t):s("waitForVideoObjectState["+e.videoObjectId+"] timeout.")}}),e.timeout)),e.cancelEvent&&(r=e.cancelEvent.subscribe((function(){e.logger.info("waitForVideoObjectState["+e.videoObjectId+"] canceled."),s("waitForVideoObjectState["+e.videoObjectId+"] canceled.")}))),o=e.slimcoreInstance.handle("object-property-changed",{objectId:e.videoObjectId,propKey:d.Property.VideoStatus},(function(e){return c(e.value)}));var l=g(e.slimcoreObject,e.logger,e.videoObjectId,d.Property.VideoStatus);c(l)}))}function v(e,t){return-1!==t.indexOf(e)}function y(e,t){return c.reduce(e,(function(e,n){return t(n)?e+1:e}),0)}t.VideoStateCancelEvent=_,t.waitForVideoObjectState=m,t.isVideoInState=v,t.videoObjectTimeout=function(e){return e.platform===p.Uwp?5e3:500},t.waitForVideoObjectToBeAvailable=function(e,t,n,r,i,o){return m({slimcoreInstance:e,slimcoreObject:t,videoObjectId:n,logger:r,resolveStates:f,rejectStates:[],timeout:i,cancelEvent:o})},t.waitForVideoObjectToBeRunning=function(e,t,n,r,i,o){return m({slimcoreInstance:e,slimcoreObject:t,videoObjectId:n,logger:r,resolveStates:[d.VideoStatus.Running],rejectStates:[d.VideoStatus.Stopping],timeout:i,cancelEvent:o})},t.waitForVideoObjectToBeStopped=function(e,t,n,r,i,o){return m({slimcoreInstance:e,slimcoreObject:t,videoObjectId:n,logger:r,resolveStates:[d.VideoStatus.NotStarted,d.VideoStatus.Available,d.VideoStatus.NotAvailable],rejectStates:[],timeout:i,cancelEvent:o})},t.isVideoAvailable=function(e){return v(e,f)},t.bufferToString=function(e){return String.fromCharCode.apply(null,e)},t.stringToBuffer=function(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n},t.mapMediaTypeStringToMediaType=function(e){switch(e){case"audio":return 0;case"video":return 1;case"panoramic-video":return 2;case"applicationsharing-video":return 3;case"data":return 4;default:return}},t.mapToEmptyStrIfFalsy=function(e){return e||""},t.hasCreateDataSource=function(e){return!(!e.createDataSource&&!SlimCore.createDataSource)},t.hasCreateDataSink=function(e){return!(!e.createDataSink&&!SlimCore.createDataSink)},t.createDataSource=function(e,t){return e.createDataSource?e.createDataSource(t):SlimCore.createDataSource(t)},t.createDataSink=function(e,t){return e.createDataSink?e.createDataSink(t):SlimCore.createDataSink(t)},t.convertImageData=function(e){if(e.isImage)return e;var t=e.data,n=new Uint8ClampedArray(t.buffer,t.byteOffset,t.byteLength);return new ImageData(n,e.width,e.height)},t.convertEndpointScope=function(e){switch(e){case 0:return d.RemoveEndpointScope.RemoveEndpointScopeSpecified;case 1:return d.RemoveEndpointScope.RemoveEndpointScopeOther;default:return}},t.selectMonitorForScreenSharing=function(e,t){return e?function(t){return e.isDuplicated&&function(e){var t=y(e,(function(e){return e.isDuplicated})),n=y(e,(function(e){return e.isPrimary}));return 0===t&&1===n&&e.length>1}(t)?c.find(t,(function(e){return!e.isInternal})):null}(t)||function(t){return!e.isDuplicated&&function(e){var t=y(e,(function(e){return e.isDuplicated})),n=y(e,(function(e){return e.isPrimary}));return 1===t&&1===n}(t)?c.find(t,(function(e){return e.isPrimary})):null}(t)||function(t){return c.find(t,(function(t){return t.monitorId===e.monitorId||c.isEqual(t.region,e.region)}))}(t):null}},function(t,n){t.exports=e},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateCauseId=function(){for(var e="abcdefghijklmnopqrstuvwxyz0123456789".length,t="",n=0;n<8;n++)t+="abcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(Math.random()*e));return t},t.validateCauseId=function(e){return new RegExp("^[a-z0-9]{8}$").test(e)&&8===e.length}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(40),a=n(0),s=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i._logger=t,i._settings=n,i._slimcoreInstance=r,i._disposables=[],i._objectPropertyChangedHandlers=new Map,i}return i(t,e),t.prototype.dispose=function(t){this._logger.info("dispose"),this._disposables.forEach((function(e){return e.dispose(t)})),this._disposables=[],this._objectPropertyChangedHandlers.clear(),e.prototype.dispose.call(this)},t.prototype._registerDisposable=function(e){e?this._disposables.push(e):this._logger.error("Attempt to register null disposable, ignoring")},t.prototype._getProperties=function(e,t,n,r){if(e.getProperties&&this._settings.enableNativeGetProperties)return e.getProperties(t,n,r);for(var i={},o=0,s=Object.keys(n);o<s.length;o++){var c=n[d=s[o]];i[d]=a.getStrProperty(e,this._logger,c.objectId||t,c.propKey,c.fallback)}for(var l=0,u=Object.keys(r);l<u.length;l++){var d;c=r[d=u[l]],i[d]=a.getIntProperty(e,this._logger,c.objectId||t,c.propKey,c.fallback)}return i},t.prototype._getStrProperty=function(e,t,n,r){return a.getStrProperty(e,this._logger,t,n,r)},t.prototype._getIntProperty=function(e,t,n,r){return a.getIntProperty(e,this._logger,t,n,r)},t.prototype._onObjectPropertyChanged=function(e,t,n){var r=this;this._objectPropertyChangedHandlers.has(e)||(this._objectPropertyChangedHandlers.set(e,new Map),this._registerDisposable(this._slimcoreInstance.handle("object-property-changed",{objectId:e},(function(e){return r._onObjectPropertyChangedCallback(e)})))),this._objectPropertyChangedHandlers.get(e).set(t,n)},t.prototype._onObjectPropertyChangedCallback=function(e){var t=this._objectPropertyChangedHandlers.get(e.objectId);if(t){var n=t.get(e.propKey);if(this._settings.enableSlimCoreEventsCounting){var r=SlimCore.Enums.Property[e.propKey]||e.propKey,i=SlimCore.Enums.ObjectType[e.objectType]||e.objectType;this._logger.debug("_onObjectPropertyChangedCallback - objectId: "+e.objectId+", objectType: "+i+", propKey: "+r+", value: "+e.value+", handler: "+!!n)}n&&n.call(this,e)}},t.prototype.raiseChanged=function(){try{e.prototype.raiseChanged.call(this)}catch(e){this._logger.error("Change handling error: "+e)}},t.prototype._raiseEventImpl=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];try{e.prototype._raiseEventImpl.apply(this,[t].concat(n))}catch(e){this._logger.error("Event '"+t+"' handling error: "+e)}},t}(o.default);t.default=s},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.asap=function(e){return new Promise((function(t){t(e())}))};var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t}(Error);t.TimeoutError=o;var a=function(){function e(e){this.ontimeout=e}return e.prototype.start=function(e){this.timeoutId=setTimeout(this.ontimeout,e)},e.prototype.stop=function(){clearTimeout(this.timeoutId)},e}();t.Timer=a,t.defer=function(){var e,t;return{promise:new Promise((function(n,r){e=n,t=r})),resolve:e,reject:t}},t.timedDefer=function(e,t){var n,r;void 0===t&&(t="deferred timed out after "+e+"ms");var i=new a((function(){return r(new o(t))})),s=new Promise((function(e,t){n=function(t){i.stop(),e(t)},r=function(e){i.stop(),t(e)}}));return i.start(e),{promise:s,resolve:n,reject:r}},t.delay=function(e){return new Promise((function(t){return setTimeout(t,e)}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7);function i(e){return"string"==typeof e?r.pii.Mri(e):r.pii.Omit(e)}t.scrubMriOrOmit=i,t.scrubMriOrOmitList=function(e){return e.forEach(i)},t.mriOrId=function(e){return e&&r.pii.Mri(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.noop=function(){}},function(e,n){e.exports=t},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.INITIALIZE="Initialize",e.START_CALL="StartCall",e.START_TRANSFER_TARGET_CALL="StartTransferTargetCall",e.STOP_CALL="StopCall",e.STOP_CALL_WITH_BEACON="StopCallWithBeacon",e.JOIN_CALL="JoinCall",e.JOIN_PREHEATED_CALL="JoinPreheatedCall",e.SUBSCRIBE="Subscribe",e.START_CALL_TO_VOICE_MAIL="StartCallToVoiceMail",e.ACKNOWLEDGE="Acknowledge",e.ACCEPT="Accept",e.REJECT="Reject",e.START_VIDEO="StartVideo",e.STOP_VIDEO="StopVideo",e.HOLD="Hold",e.UNHOLD="Unhold",e.UPDATE_ENDPOINT_METADATA="UpdateEndpointMetadata",e.SEND_DTMF_TONE="SendDtmfTone",e.SET_AUDIO_USAGE="SetAudioUsage",e.DUMP_VIDEO_SOURCE_IMAGES="DumpVideoSourceImages",e.BLIND_TRANSFER="BlindTransfer",e.SAFE_TRANSFER="SafeTransfer",e.TRANSFER_TO_VOICEMAIL="TransferToVoicemail",e.CONSULTATIVE_TRANSFER="ConsultativeTransfer",e.START_SCREEN_SHARING="StartScreenSharing",e.STOP_SCREEN_SHARING="StopScreenSharing",e.START_DATA_CHANNEL="StartDataChannel",e.STOP_DATA_CHANNEL="StopDataChannel",e.SHARE_SYSTEM_SOUNDS="ShareSystemSounds",e.MUTE="Mute",e.UNMUTE="Unmute",e.MUTE_SPEAKER="MuteSpeaker",e.UNMUTE_SPEAKER="UnmuteSpeaker",e.MUTE_PARTICIPANTS="MuteParticipants",e.UPDATE_MEETING_ROLE="UpdateMeetingRole",e.START_AUDIO="StartAudio",e.STOP_AUDIO="StopAudio",e.ASSIMILATE="Assimilate",e.SET_MAX_VIDEO_CHANNELS="SetMaxVideoChannels",e.CREATE_CONTENT_SHARING_SESSION="CreateContentSharingSession",e.START_CALL_WITH_NUDGE="StartCallWithNudge",e.START_CALL_AND_UNPARK="StartCallAndUnpark",e.PARK_CALL="ParkCall",e.NUDGE_PARTICIPANTS="NudgeParticipants",e.LWJ_FALLBACK="LwjFallback",e.ELECTRON_PROVIDE_CQF="ElectronProvideCQF",e.MERGE_CALL="MergeCall",e.ADD_GROUP_MODALITY="AddGroupModality",e.MERGE_WITH_PICKUP_CODE="MergeWithPickupCode"}(t.CALL_OPERATIONS||(t.CALL_OPERATIONS={})),function(e){e.CALL_START_OR_JOIN_INITIATED="_CallStartOrJoinInitiated",e.INCOMING_INITIALIZE="_IncomingInitialize",e.CALL_ENDED="_CallEnded",e.RECONNECT="_Reconnect",e.RENEGOTIATE="_Renegotiate",e.RENEGOTIATE_OUTGOING="_RenegotiateOutgoing",e.RENEGOTIATE_INCOMING="_RenegotiateIncoming",e.COMPLETE_NEGOTIATION_FAILED="_CompleteNegotiationFailed",e.UPDATE_LOCAL_MEDIA_STATUS="_UpdateLocalMediaStatus",e.START_PREVIEW_VIDEO="_StartPreviewVideo",e.START_LOCAL_VIDEO="_StartLocalVideo",e.SET_LOCAL_VIDEO="_SetLocalVideo",e.CALL_TRANSFER_IN_PROGRESS="_CallTransferInProgress",e.ON_TRANSFER_REQUESTED="_OnTransferRequested",e.ON_TRANSFER_REQUESTED_INVALID="_OnTransferRequestedInvalid",e.ON_INCOMING_CALL_REPLACEMENT="_onIncomingCallReplacement",e.GET_CALL_REPLACEMENT_DETAILS="_GetCallReplacementDetails",e.SET_CALL_STATE="_SetCallState",e.SET_TRANSFER_STATE="_SetTransferState",e.SET_PARK_STATE="_SetParkState",e.SET_MUTED="_SetMuted",e.SET_MUTED_SPEAKER="_SetMutedSpeaker",e.SET_SCREEN_SHARING="_SetScreenSharing",e.SET_CALL_ORIGIN="_SetCallOrigin",e.CONNECT_CALL="_ConnectCall",e.WAIT_FOR_ANSWER="_WaitForAnswer",e.MEDIA_ACKNOWLEDGMENT="_MediaAcknowledgment",e.SIGNALING_STATE_CHANGED="_SignalingStateChanged",e.CALL_TERMINATION_INFO="_CallTerminationInfo",e.MEDIA_WHITELISTING_ISSUE_DETECTED="_MediaWhiteListingIssueDetected",e.CALL_ESCALATED_TO_CONFERENCE="_CallEscalatedToConference",e.WEB_ON_OFFER="_WebOnOffer",e.WEB_ON_ANSWER="_WebOnAnswer",e.WEB_ON_RETARGET_SUCCESS="_WebRetargetSuccess",e.WEB_ON_RETARGET_FAILURE="_WebRetargetFailure",e.WEB_ON_ESCALATION_SUCCESS="_WebOnEscalationSuccess",e.WEB_ON_ESCALATION_FAILURE="_WebOnEscalationFailure",e.CALL_USES_MIXER="_CallUsesMixer",e.ESCALATION_IN_PROGRESS="_EscalationInProgress",e.ESCALATION_COMPLETED="_EscalationCompleted",e.ELECTRON_WAIT_FOR_HANDLE_PUSH="_ElectronWaitForHandlePush",e.ELECTRON_WAIT_FOR_RINGING="_ElectronWaitForRinging",e.ELECTRON_START_SCREEN_SHARING="_ElectronStartScreenSharing",e.ELECTRON_STOP_SCREEN_SHARING="_ElectronStopScreenSharing",e.ELECTRON_SLIMCORE_READY="_ElectronSlimcoreReady",e.ELECTRON_DATA_CHANNEL_CREATED="_ElectronDataChannelCreated",e.ELECTRON_ATTACH_SLIMCORE_CALL="_ElectronAttachSlimcoreCall",e.ELECTRON_ATTACH_SLIMCORE_CALL_FAILED="_ElectronAttachSlimcoreCallFailed",e.ELECTRON_LEAVE_CALL="_ElectronLeaveCall",e.PROCESS_CALL_START_OPTIONS="_ProcessCallStartOptions"}(t.CALL_OPERATIONS_INTERNAL||(t.CALL_OPERATIONS_INTERNAL={})),function(e){e.CCWM="CCWM",e.ENCRYPTED="Encrypted",e.LWJ="LWJ",e.PREHEAT="Preheat"}(t.OPERATION_VARIANTS||(t.OPERATION_VARIANTS={})),function(e){e.AUDIO_QUALITY_CHANGED="AudioQualityChanged",e.SESSION_ERROR="SessionError",e.NEGOTIATION_REQUIRED="NegotiationRequired",e.OUTGOING_NEGOTIATION_FAILURE="OutgoingNegotiationFailure",e.INCOMING_NEGOTIATION_FAILURE="IncomingNegotiationFailure",e.NEGOTIATION_FATAL_ERROR="NegotiationFatalError",e.NEGOTIATION_COMPLETION="NegotiationCompletion",e.AUDIO_STATE_CHANGED="AudioStateChanged",e.INCOMPATIBLE_OFFER="IncompatibleOffer",e.NEW_OFFER_FAILED="NewOfferFailed"}(t.MEDIA_EVENT||(t.MEDIA_EVENT={})),function(e){e.ADD_PARTICIPANT="AddParticipant",e.REMOVE_PARTICIPANT="RemoveParticipant",e.ADMIT_PARTICIPANT="AdmitParticipant",e.CALL_ME_BACK="CallMeBack",e.ADD_PARTICIPANTS="AddParticipants"}(t.PARTICIPANT_OPERATIONS||(t.PARTICIPANT_OPERATIONS={})),function(e){e.SET_PARTICIPANT_STATE="_SetParticipantState",e.SET_PARTICIPANT_STATE_INVALID="_SetParticipantStateInvalid",e.UPDATE_PARTICIPANT_STREAM="_UpdateParticipantStream",e.UPDATE_LOCAL_PARTICIPANT_STREAM="_UpdateLocalParticipantStream",e.PARTICIPANT_JOINED="_ParticipantJoined",e.SELF_PARTICIPANT_UPDATED="_SelfParticipantUpdated",e.ELECTRON_ATTACH_SLIMCORE_PARTICIPANT_FAILED="_ElectronAttachSlimcoreParticipantFailed"}(t.PARTICIPANT_OPERATIONS_INTERNAL||(t.PARTICIPANT_OPERATIONS_INTERNAL={})),function(e){e.START_CONTENT_SHARING="StartContentSharing",e.STOP_CONTENT_SHARING="StopContentSharing",e.JOIN_CONTENT_SHARING="JoinContentSharing",e.TAKE_CONTENT_SHARING_CONTROL="TakeContentSharingControl",e.UPDATE_CONTENT_SHARING_SESSION_STATE="UpdateContentSharingSessionState",e.UPDATE_PARTICIPANT_STATE="UpdateParticipantState"}(t.CONTENT_SHARING_OPERATIONS||(t.CONTENT_SHARING_OPERATIONS={})),function(e){e.SET_CONTENT_SHARING_STATUS="_SetContentSharingStatus"}(t.CONTENT_SHARING_OPERATIONS_INTERNAL||(t.CONTENT_SHARING_OPERATIONS_INTERNAL={})),t.UNPARK_CODE={PARK:"*11",SHARED_LINE:"*12",SERVER_HOLD:"*13"},function(e){e[e.SUCCESS=0]="SUCCESS",e[e.FORBIDDEN=403]="FORBIDDEN",e[e.CLIENT_ERROR=499]="CLIENT_ERROR",e[e.SIGNALING_ERROR=599]="SIGNALING_ERROR"}(t.TRANSACTION_END_CODE||(t.TRANSACTION_END_CODE={})),function(e){e[e.LOCAL_REJECT=0]="LOCAL_REJECT",e[e.TRANSACTION_NOT_ALLOWED=3548]="TRANSACTION_NOT_ALLOWED"}(t.TRANSACTION_END_SUBCODE||(t.TRANSACTION_END_SUBCODE={})),function(e){e.TRANSACTION_COMPLETE="TransactionComplete",e.TRANSACTION_ALLOWED="TransactionAllowed",e.TRANSACTION_DISALLOWED="TransactionDisallowed",e.UNKNOWN="Unknown"}(t.TRANSACTION_END_PHRASE||(t.TRANSACTION_END_PHRASE={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=["response","responseText","responseURL","status","state","statusText","timeout","withCredentials","stack","message","name","error","piiSafe","phase","code","participantId","endpointId","phrase","subCode","reason"];t.getPIISafeObject=function(e){try{return JSON.parse(JSON.stringify(e,r,4))}catch(e){return{error:"failed to parse object"}}},t.getPrintableObject=function(e,t){if(void 0===t&&(t=!1),void 0===e)return"void";if(e instanceof Error)return e.toString();if(e instanceof String||e instanceof Number||e instanceof Boolean)return e.toString();try{return e.stack&&(e.stack=function(e){try{return e.split("\n")[0]}catch(e){return"invalid stack"}}(e.stack)),(t?JSON.stringify(e):JSON.stringify(e,r,4)).replace(/(\r\n\t|\n|\r\t|\s)/gm,"")}catch(t){return"failed to get error information:"+(e&&"function"==typeof e.toString&&e.toString())+" "+(e&&e.response&&JSON.stringify(e.response))}},t.safeJsonStringify=function(e){try{return JSON.stringify(e)}catch(e){return"failed to stringify obj"}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getTsCallingVersion=function(){return"2019.35.01.3"},t.getOvb=function(){return"b1de1e4a28cc16424809a116003ce37f3a43f26d"}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}},c=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}c((r=r.apply(e,t||[])).next())}))},l=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var u=n(12),d=n(1),h=n(4),p=n(8),f=n(13),g=n(25),_=n(14),m=n(15),v=n(5),y=n(42),C=n(43),S=n(0),I=n(3),T=n(26),P=n(45),E=n(47),O=n(19),b=n(29),A=n(31),R=n(18),w=n(17),L=n(48),N=SlimCore.Enums,D=n(2),k=n(6),M=n(9);function F(e){return void 0!==e.code}var j=function(e){function t(t,n,r,i,o,a,s,u,h,f,g,_){var v,y=e.call(this,t.createChild((function(){var e=(y.endpointId||"").substr(0,8),t=(y.participantId||"").substr(0,8);return"Electron["+y.slimcoreCallId+":"+y.callId+"]["+e+"]["+t+"]["+y.state+"]"})),n,r)||this;y._slimcoreCallHandler=i,y._deviceManager=o,y._appHooks=a,y.threadId=s,y.callId=u,y.currentUserSkypeIdentity=h,y.participantId=f,y._telemetryService=g,y.participants=[],y.participantMap={},y.isMuted=!1,y.isSpeakerMuted=!1,y.isServerMuted=!1,y.isVideoOn=!1,y.isScreenSharingOn=!1,y.dominantSpeakerInfo={speakerList:[],timestamp:null},y.callStartedAt=null,y.callHeldAt=null,y.failureType=2,y.slimcoreCallId=0,y.isHostless=!0,y.callType=-1,y.isIncomingOneOnOneVideoCall=!1,y.contentSharingSessions=[],y.screenSharingControl=null,y.dataChannelAdapter=null,y.isPreheatEnabled=!1,y.localMediaStreams=[],y.mediaStreams=((v={})[0]=[],v[1]=[],v),y._streamContextMap={},y._isAudioStreamConnected=!1,y._wasAudioStreamConnected=!1,y._callGotConnected=!1,y._enableGroupCallMeetupGeneration=!1,y._mediaPeerType=0,y._dataChannel=null,y._dataChannelUsers=[],y._isRelayWhiteListingIssue=!1,y._isOptimizedSpeakerEventingEnabled=!1,y._isSetVideoChannelsRenegotiated=!1,y._callIsSetupComplete=!1,y._transferState=0,y._parkState=0,y._capabilityFlags=N.SelfCapability.None,y._capabilities={canMuteOthers:!1,canUnmuteSelf:!1},y.inCallTelemetryReported=!1,y.setupTelemetryReported=!1,y.connectCallPromise=Promise.resolve(),y._videoRequestedOnWhileConnecting=!1,y._videoRequestedOffWhileConnecting=!1,y._callStartTime=(new Date).getTime(),y._state=0,y.isServerMuteUnmuteEnabled=function(){return!!y.endpoints&&d.some(y.endpoints.endpointDetails,(function(e){return y.endpointId===e.endpointId&&e.capabilities&&"enabled"===e.capabilities.serverMuteUnmute}))},y.isMuteDisabled=function(){return y.isMuted},y.isUnMuteDisabled=function(){return 1===y.callType?!y.isMuted:2===y.callType&&(y.isServerMuteUnmuteEnabled()?!y.isServerMuted&&!y.isMuted:!y.isMuted)},y.cleanUp=function(e){return c(y,void 0,void 0,(function(){return l(this,(function(t){switch(t.label){case 0:return this._logger.info("["+e+"][cleanup]start"),[4,Promise.all([this._getCallEndOperation(),this._cleanCallResources(e)])];case 1:return t.sent(),this._callOperationHandler.rejectPendingOperations(61),this._participantOperationHandler.rejectPendingOperations(47),this._callTelemetry.setTerminationState(this.state),this._callTelemetry.setTerminationReason(this.terminatedReason),this._reportTsCallingTelemetry(!this._callIsSetupComplete),[2]}}))}))},y._getCallEndOperation=function(){return y._callOperationHandler.hasPendingOperation(p.CALL_OPERATIONS.STOP_CALL)?y._callOperationHandler.waitForOperation(p.CALL_OPERATIONS.STOP_CALL):y._callOperationHandler.hasPendingOperation(p.CALL_OPERATIONS.REJECT)?y._callOperationHandler.waitForOperation(p.CALL_OPERATIONS.REJECT):Promise.resolve()},y._getFirstParticipantFailureReason=function(e){try{if(y.participants.length){var t=d.head(y.participants).getIntProperty(N.Property.ParticipantFailureReason);return e.info("participantFailureReason="+t),t}return void e.logFailure("no participants , can't query for participantFailureReason")}catch(e){return void y._logger.logFailure("participantFailureReason="+M.getPrintableObject(e))}},y._setTransferState=function(e,t){y.transferState!==e&&(y._logger.info("Transfer: state set: "+e),y._transferState=e,y._callTelemetry.recordEvent(p.CALL_OPERATIONS_INTERNAL.SET_TRANSFER_STATE,{state:e},t),y.raiseChanged())},y._setParkState=function(e,t){y.parkState!==e&&(y._logger.info("Park: state set: "+e),y._parkState=e,y._callTelemetry.recordEvent(p.CALL_OPERATIONS_INTERNAL.SET_PARK_STATE,{state:e},t),y.raiseChanged())},y._logger.info("constructor"),y.terminatedReason=0,y._setupCallTelemetry(),y._setParticipantId(y.participantId),y._setThreadId(y.threadId),y._setCallId(y.callId),y._setCallOrigin(0),y._setMessageId(_),y._setIsEmergency(!1);try{y._setEndpointId(y._slimcoreInstance.getRegistrationId(y.currentUserSkypeIdentity.id))}catch(e){y._logger.warn("getRegistrationId is missing!")}return y.screenSharingControl=new L.default(y._logger,y._settings,y._slimcoreInstance,y,y._appHooks.getControlInjector(),y._telemetryService),y.raiseRenderedAtViewer=y.raiseRenderedAtViewer.bind(y),y.screenSharingControl.setRaiseRenderedAtViewer(y.raiseRenderedAtViewer),y.dataChannelAdapter=new E.default(y._logger,y._slimcoreInstance),y._dataChannelUsers=[y.screenSharingControl,y.dataChannelAdapter],y._callOperationHandler=new m.default(y._logger,y._callTelemetry),y._participantOperationHandler=new m.default(y._logger,y._callTelemetry),y._dataChannelCreatedPromise=y._callOperationHandler.createPendingOperation(p.CALL_OPERATIONS_INTERNAL.ELECTRON_DATA_CHANNEL_CREATED),y._dataChannelCreatedPromise.catch(k.noop),y._streamContextMap[0]=new R.SlimCoreElectronRemoteStreamContext(y._logger),y._streamContextMap[1]=new R.SlimCoreElectronRemoteStreamContext(y._logger),y}return i(t,e),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},set:function(e){this._state=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"transferState",{get:function(){return this._transferState},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parkState",{get:function(){return this._parkState},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"capabilities",{get:function(){return this._capabilities},enumerable:!0,configurable:!0}),t.prototype.init=function(e){this._setMessageId(e.messageId),e.threadId&&this._setThreadId(e.threadId),this._meetingInfo=e.meetingInfo,this._enableGroupCallMeetupGeneration=!!e.enableGroupCallMeetupGeneration,e.transferContext&&(this._transferContext=e.transferContext,1===e.transferContext.transferType?this._setCallOrigin(2):0===e.transferContext.transferType?this._setCallOrigin(1):2===e.transferContext.transferType&&this._setCallOrigin(3),e.transferContext.transferorMri&&this._updateTransferorMri(e.transferContext.transferorMri)),this._endpointMetadata=e.endpointMetadata,this.onBehalfOfMri=e.onBehalfOf,this._emergencyContent=e.emergencyContent,this._locationContent=e.locationContent,this._mediaPeerType=e.mediaPeerType,this.broadcastMeeting&&(this.broadcastMeeting.context=e.broadcastContext),this._setIsEmergency(!!e.isEmergency),this.raiseChanged()},t.prototype.processCallStartOptions=function(e,t){var n=this._logger.createFnLogger(p.CALL_OPERATIONS_INTERNAL.PROCESS_CALL_START_OPTIONS,t);try{1&e.preheatFlags&&(this.isPreheatEnabled=!0)}catch(e){n.logFailure(e)}},t.prototype.join=function(e,t,n){return void 0===n&&(n=D.generateCauseId()),c(this,void 0,void 0,(function(){var r;return l(this,(function(i){return this._setCallerMri(g.stripMriAliases(e.groupCallInitiator),n),this._callTelemetry.setDirection(f.DIRECTION.INCOMING),this._callTelemetry.setSelfParticipantRole(f.SELF_PARTICIPANT_ROLE.JOIN),1&t.preheatFlags&&this._callTelemetry.setOperationVariant(p.CALL_OPERATIONS.JOIN_CALL,p.OPERATION_VARIANTS.PREHEAT),t.muteFlags&&(r={muteMicrophone:!!(1&t.muteFlags),muteSpeaker:!!(2&t.muteFlags)},this._callTelemetry.updateOperationData(p.CALL_OPERATIONS.JOIN_CALL,r,n)),this._callTelemetry.setPreheatFlags(t.preheatFlags),this.connectCallPromise=this._callOperationHandler.waitForOperation(p.CALL_OPERATIONS.JOIN_CALL),[2,this._joinOrStartCall({audioDirection:t.audioDirection,videoDirection:void 0!==t.videoDirection?t.videoDirection:t.withVideo?4:1,screenshareDirection:t.screenshareDirection,datachannelDirection:t.datachannelDirection,muteFlags:t.muteFlags,conversationUrl:e.conversationUrl,preheatFlags:t.preheatFlags,label:t.label,conversationType:e.conversationType,enableLightWeightMeeting:!1,maxVideoChannels:t.maxVideoChannels,negotiationTag:t.negotiationTag,scenario:S.mapToEmptyStrIfFalsy(t.scenario)},n)]}))}))},t.prototype.start=function(e,t){return void 0===t&&(t=D.generateCauseId()),c(this,void 0,void 0,(function(){var n,r,i,o,a=this;return l(this,(function(s){return n=this._logger.createFnLogger(p.CALL_OPERATIONS.START_CALL,t),this._setCallerMri(g.MRI_SKYPE_PREFIX+this.currentUserSkypeIdentity.id,t),this._callTelemetry.setDirection(f.DIRECTION.OUTGOING),this._callTelemetry.setSelfParticipantRole(f.SELF_PARTICIPANT_ROLE.CALLER),1&e.preheatFlags?this._callTelemetry.setOperationVariant(p.CALL_OPERATIONS.START_CALL,p.OPERATION_VARIANTS.PREHEAT):e.encryptedKey&&this._callTelemetry.setOperationVariant(p.CALL_OPERATIONS.START_CALL,p.OPERATION_VARIANTS.ENCRYPTED),this.connectCallPromise=this._callOperationHandler.waitForOperation(p.CALL_OPERATIONS.START_CALL),e.muteFlags&&(r={muteMicrophone:!!(1&e.muteFlags),muteSpeaker:!!(2&e.muteFlags)},this._callTelemetry.updateOperationData(p.CALL_OPERATIONS.START_CALL,r,t)),this._callTelemetry.setPreheatFlags(e.preheatFlags),this._transferContext?(n.info("Transfer: Starting transfered call."),(i=this._transferContext.context).newCallObjectId?(this._setCallType(1),o=e.withVideo||4===e.videoDirection,2===this._transferContext.transferType&&(o=!1),[2,this._callOperationHandler.execute((function(){return a._startTransferTargetCall(i.newCallObjectId,o,t)}),p.CALL_OPERATIONS.START_TRANSFER_TARGET_CALL)]):[2,Promise.reject(new Error("Transfer: Transfered context is invalid. Missing callObjectId or newCallObjectId"))]):(e.withVideo&&(e.videoDirection=4),[2,this._joinOrStartCall({audioDirection:e.audioDirection,videoDirection:e.videoDirection,screenshareDirection:e.screenshareDirection,datachannelDirection:e.datachannelDirection,ringOthers:e.ringOthers,preheatFlags:e.preheatFlags,label:e.label,conversationType:this.isEmergency?"emergencyGroupCall":e.isCast?"cast":"",enableLightWeightMeeting:!1,callKey:e.callKey,encryptedKey:e.encryptedKey,connectionType:e.connectionType,mediaConfiguration:e.mediaConfiguration,maxVideoChannels:e.maxVideoChannels,routingFlags:e.routingFlags,muteFlags:e.muteFlags,negotiationTag:e.negotiationTag,scenario:S.mapToEmptyStrIfFalsy(e.scenario)},t)])}))}))},t.prototype.startCallToVoicemail=function(e,t){return void 0===t&&(t=D.generateCauseId()),c(this,void 0,void 0,(function(){return l(this,(function(n){return this._setCallerMri(g.MRI_SKYPE_PREFIX+this.currentUserSkypeIdentity.id,t),this._callTelemetry.setDirection(f.DIRECTION.OUTGOING),this._callTelemetry.setSelfParticipantRole(f.SELF_PARTICIPANT_ROLE.CALLER),this.connectCallPromise=this._callOperationHandler.waitForOperation(p.CALL_OPERATIONS.START_CALL_TO_VOICE_MAIL),[2,this._joinOrStartCall({callToVoicemail:!0,voicemailResourcePath:e.voicemailResourcePath,voicemailItemId:e.voicemailItemId},t)]}))}))},t.prototype.startCallWithNudge=function(e,t,n){return void 0===n&&(n=D.generateCauseId()),c(this,void 0,void 0,(function(){var r;return l(this,(function(i){return this._setCallerMri(g.MRI_SKYPE_PREFIX+this.currentUserSkypeIdentity.id,n),r=this._logger.createFnLogger(p.CALL_OPERATIONS.START_CALL_WITH_NUDGE,n),this._callTelemetry.setDirection(f.DIRECTION.OUTGOING),this._callTelemetry.setSelfParticipantRole(f.SELF_PARTICIPANT_ROLE.CALLER),t.encryptedKey&&this._callTelemetry.setOperationVariant(p.CALL_OPERATIONS.START_CALL_WITH_NUDGE,p.OPERATION_VARIANTS.ENCRYPTED),d.isEmpty(e)?(r.logFailure("No participants provided to nudge"),[2,Promise.reject(new Error("No participants provided to nudge"))]):(this.connectCallPromise=this._callOperationHandler.waitForOperation(p.CALL_OPERATIONS.START_CALL_WITH_NUDGE),[2,this._joinOrStartCall({audioDirection:t.audioDirection,videoDirection:void 0!==t.videoDirection?t.videoDirection:t.withVideo?4:1,screenshareDirection:t.screenshareDirection,datachannelDirection:t.datachannelDirection,ringOthers:!1,label:t.label,conversationType:t.isCast?"cast":"",enableLightWeightMeeting:!1,callKey:t.callKey,encryptedKey:t.encryptedKey,connectionType:t.connectionType,mediaConfiguration:t.mediaConfiguration,participantsToNudge:e,invitationType:N.InvitationType.Nudge,negotiationTag:t.negotiationTag,scenario:S.mapToEmptyStrIfFalsy(t.scenario)},n)])}))}))},t.prototype.startAndUnpark=function(e,t,n,r){return void 0===n&&(n={}),void 0===r&&(r=D.generateCauseId()),c(this,void 0,void 0,(function(){var i,o;return l(this,(function(a){return this._setCallerMri(g.MRI_SKYPE_PREFIX+this.currentUserSkypeIdentity.id,r),i=this._logger.createFnLogger(p.CALL_OPERATIONS.START_CALL_AND_UNPARK,r),this._callTelemetry.setDirection(f.DIRECTION.OUTGOING),this._callTelemetry.setSelfParticipantRole(f.SELF_PARTICIPANT_ROLE.CALLER),n.encryptedKey&&this._callTelemetry.setOperationVariant(p.CALL_OPERATIONS.START_CALL_AND_UNPARK,p.OPERATION_VARIANTS.ENCRYPTED),this._setCallType(1),this.connectCallPromise=this._callOperationHandler.waitForOperation(p.CALL_OPERATIONS.START_CALL_AND_UNPARK),n.withVideo&&(n.videoDirection=4),o=0===e?p.UNPARK_CODE.PARK:1===e?p.UNPARK_CODE.SHARED_LINE:p.UNPARK_CODE.SERVER_HOLD,this.addParticipant("4:"+o,void 0,r).catch((function(e){return i.logFailure("Failed to add participant to unparked call="+e)})),[2,this._joinOrStartCall({audioDirection:n.audioDirection,videoDirection:n.videoDirection,screenshareDirection:n.screenshareDirection,datachannelDirection:n.datachannelDirection,ringOthers:n.ringOthers,label:n.label,conversationType:n.isCast?"cast":"",enableLightWeightMeeting:!1,callKey:n.callKey,encryptedKey:n.encryptedKey,connectionType:n.connectionType,mediaConfiguration:n.mediaConfiguration,maxVideoChannels:n.maxVideoChannels,routingFlags:n.routingFlags,muteFlags:n.muteFlags,parkContext:e,pickupCode:t,scenario:S.mapToEmptyStrIfFalsy(n.scenario)},r)]}))}))},t.prototype.joinCallWithoutCallModality=function(e,n,r){return void 0===r&&(r=D.generateCauseId()),c(this,void 0,void 0,(function(){var i,o,a,s;return l(this,(function(c){switch(c.label){case 0:if(this._setCallerMri(g.stripMriAliases(e.groupCallInitiator),r),(i=this._logger.createFnLogger(p.CALL_OPERATIONS.SUBSCRIBE,r)).info("joinCallWithoutCallModality: "+e.conversationUrl),this._callTelemetry.setDirection(f.DIRECTION.OUTGOING),this._callTelemetry.setSelfParticipantRole(f.SELF_PARTICIPANT_ROLE.SUBSCRIBE),e.conversationUrl||this._callTelemetry.setOperationVariant(p.CALL_OPERATIONS.SUBSCRIBE,p.OPERATION_VARIANTS.CCWM),0!==this.state)return i.logFailure("Trying to start a call that has already been acted on"),[2,Promise.reject(new Error("Trying to start a call that has already been acted on"))];o=this._getSlimCoreCallProperties({audioDirection:N.MediaDirection.Disabled,videoDirection:N.MediaDirection.Disabled,screenshareDirection:N.MediaDirection.Disabled,datachannelDirection:N.MediaDirection.Disabled,mediaPeerType:t.convertToSlimCoreMediaPeerType(this._mediaPeerType),isVideoEnabled:!1,isGoLive:!n.ringOthers,isHostless:!0,participantLegId:this.participantId,enableGroupCallMeetupGeneration:this._enableGroupCallMeetupGeneration,threadId:S.mapToEmptyStrIfFalsy(this.threadId),messageId:S.mapToEmptyStrIfFalsy(this.messageId),subject:S.mapToEmptyStrIfFalsy(n.label),conversationType:S.mapToEmptyStrIfFalsy(e.conversationType),meetingInfo:S.mapToEmptyStrIfFalsy(JSON.stringify(this._meetingInfo)),endpointMetadata:S.mapToEmptyStrIfFalsy(this._endpointMetadata),onBehalfOf:S.mapToEmptyStrIfFalsy(this.onBehalfOfMri),enableLightWeightMeeting:!1,emergencyContent:S.mapToEmptyStrIfFalsy(this._emergencyContent),broadcastContext:this.broadcastMeeting&&this.broadcastMeeting.context?JSON.stringify(this.broadcastMeeting.context):null,callKey:"",encryptedKey:"",invitationType:N.InvitationType.None,connectionType:N.ConnectionType.AllSupported,maxVideoChannels:void 0!==n.maxVideoChannels?n.maxVideoChannels:0,muteFlags:n.muteFlags,negotiationTag:S.mapToEmptyStrIfFalsy(n.negotiationTag),routingFlags:n.routingFlags,scenario:S.mapToEmptyStrIfFalsy(n.scenario),locationContent:S.mapToEmptyStrIfFalsy(this._locationContent),mediaConfigurationJson:S.mapToEmptyStrIfFalsy(JSON.stringify(n.mediaConfiguration))}),c.label=1;case 1:return c.trys.push([1,3,,4]),a=this._slimcoreCallHandler.subscribe(JSON.stringify({conversationUrl:e.conversationUrl,conversationId:this.callId,conversationType:e.conversationType}),o),this._setCallState(8,r),[4,this.attachSlimCoreCallObject(a,r,!0,"joinCallWithoutCallModality")];case 2:return c.sent(),S.hasFeature(N.Feature.ObservingStateSupported)?[2,this._callOperationHandler.waitForOperation(p.CALL_OPERATIONS.SUBSCRIBE,void 0,r)]:[2,Promise.resolve()];case 3:throw s=c.sent(),i.logFailure("sync failure, cleaning up slimcore ready operation: error="+M.getPrintableObject(s)),this._callTelemetry.updateOperationData(p.CALL_OPERATIONS.SUBSCRIBE,{error:M.getPIISafeObject(s)},r),this._callOperationHandler.rejectOperation(p.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY),s;case 4:return[2]}}))}))},t.prototype._assertSlimcoreObjectId=function(e,t){if(0===e)throw new Error(t+" Failed. Slimcore returned objectId of 0")},t.prototype.joinPreheatedCall=function(e,t){return void 0===t&&(t=D.generateCauseId()),c(this,void 0,void 0,(function(){var n;return l(this,(function(r){if(n=this._logger.createFnLogger(p.CALL_OPERATIONS.JOIN_PREHEATED_CALL,t),11!==this.state&&12!==this.state)return n.logFailure("Trying to join a call that is not in preheating state"),[2,Promise.reject(new Error("Trying to join a call that is not in preheating state"))];1==(1&e.muteFlags)&&(n.info("isMuted set to true in joinPreheatedCall"),this.isMuted=!0),2==(2&e.muteFlags)&&(n.info("isSpeakerMuted set to true in joinPreheatedCall"),this.isSpeakerMuted=!0),this._setCallState(2,t),this.connectCallPromise=this._callOperationHandler.waitForOperation(p.CALL_OPERATIONS.JOIN_PREHEATED_CALL);try{this._slimcoreCallHandler.joinPreheatedCall(this.slimcoreCallId,t,e.muteFlags)}catch(e){throw this.stopInternal(t),n.logFailure(e),e}return[2,this._callOperationHandler.waitForOperation(p.CALL_OPERATIONS.JOIN_PREHEATED_CALL,void 0,t)]}))}))},t.prototype.startVideoSafe=function(e){var t=this;return this.startVideo(e).catch((function(n){t._logger.createFnLogger(p.CALL_OPERATIONS.START_VIDEO,e).logFailure(n)}))},t.prototype.startVideo=function(e,t){return void 0===t&&(t=D.generateCauseId()),c(this,void 0,void 0,(function(){var n,r,i=this;return l(this,(function(o){return n=this._logger.createFnLogger(p.CALL_OPERATIONS.START_VIDEO,t),this.callStateCanToggleVideo()?(r=Promise.resolve().then((function(){return i._startLocalVideo(e,t)})).then((function(){return i._setVideoOn(!0,t)})),[2,this._callOperationHandler.registerPromise(p.CALL_OPERATIONS.START_VIDEO,r).catch((function(n){throw i._callTelemetry.updateOperationData(p.CALL_OPERATIONS.START_VIDEO,{error:M.getPIISafeObject(n)},t),i._logger.logFailure(n),i.stopVideo(e,t).catch(k.noop),n}))]):(n.info("startVideo called but call is not in togglable state - starting preview only, video will start once available"),this._videoRequestedOnWhileConnecting=!0,this._videoRequestedOffWhileConnecting=!1,this._setVideoOn(!0,t),[2])}))}))},t.prototype.stopVideo=function(e,t){return void 0===t&&(t=D.generateCauseId()),c(this,void 0,void 0,(function(){var n,r,i,o=this;return l(this,(function(a){return n=this._logger.createFnLogger(p.CALL_OPERATIONS.STOP_VIDEO,t),this.callStateCanToggleVideo()?(r=function(){o._localVideo&&(o._localVideo.dispose(t),o._localVideo=null),o._setVideoOn(!1,t)},i=Promise.resolve().then((function(){return c(o,void 0,void 0,(function(){return l(this,(function(r){switch(r.label){case 0:return this._localVideo?[4,S.forgetAndLog(this._localVideo.stop(t,e),n,"stopVideo: stopping localVideo failed")]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))})),[2,this._callOperationHandler.registerPromise(p.CALL_OPERATIONS.STOP_VIDEO,i).then(r,(function(e){o._callTelemetry.updateOperationData(p.CALL_OPERATIONS.STOP_VIDEO,{error:M.getPIISafeObject(e)},t),n.logFailure(e),r()}))]):(this._videoRequestedOnWhileConnecting?(n.info("stopVideo called but call is not in togglable state - video will stop once available"),this._videoRequestedOffWhileConnecting=!0):n.info("stopVideo called but call is not in togglable state - enabling video was not requested anyway, so ignoring"),[2,Promise.resolve()])}))}))},Object.defineProperty(t.prototype,"endpointId",{get:function(){return this._endpointId},enumerable:!0,configurable:!0}),t.prototype._setEndpointId=function(e){this._endpointId=e,this._callTelemetry.setEndpointId(e)},t.prototype._setFailureType=function(e){this._callTelemetry.setFailureType(e),this.failureType=e},t.prototype._setThreadId=function(e){this._logger.info("Set threadId:"+e),this.threadId=e,this._callTelemetry.setThreadId(e)},t.prototype._setMessageId=function(e){this._logger.info("Set messageId:"+e),this.messageId=e,this._callTelemetry.setMesageId(e)},t.prototype._setCallType=function(e){this._logger.info("Set callType:"+e),this.callType=e,this._callTelemetry.setCallType(e)},t.prototype._setCallerMri=function(e,t){this._logger.info("["+t+"]Set callerMri:"+e),this.callerMri=e},t.prototype._setCallOrigin=function(e){this._logger.info("Set origin:"+e),this._origin=e,this._callTelemetry.setCallOrigin(e)},t.prototype._setIsCast=function(e){this._logger.info("Set isCast:"+e),this.isCast=e,this._callTelemetry.setIsCast(e)},t.prototype._setIsEmergency=function(e){this._logger.info("Set isEmergency:"+e),this.isEmergency=e,this._callTelemetry.setIsEmergency(e)},t.prototype._startLocalVideo=function(e,t){return this._localVideo||(this._localVideo=new A.default(this._logger,this._settings,this._slimcoreInstance,this,this.slimcoreCallId,this._slimcoreCallHandler,this._deviceManager)),this._localVideo.start(t,e)},t.prototype.dumpVideoSourceImages=function(){return c(this,void 0,void 0,(function(){return l(this,(function(e){return this._localVideo?[2,this._localVideo.dumpVideoSourceImages()]:[2,Promise.reject(new Error("Cannot dump video effects debug images when there is no local video"))]}))}))},t.prototype.startScreenSharing=function(e,t,n,r){return void 0===r&&(r=D.generateCauseId()),c(this,void 0,void 0,(function(){var i=this;return l(this,(function(o){return this.screenSharingControl&&this.screenSharingControl.isScreenSharingControlEnabled()&&this.screenSharingControl.shutdownControlForViewer(),[2,Promise.resolve().then((function(){i._localScreenShareStream||(i._localScreenShareStream=new b.default(i._logger,i._settings,i._slimcoreInstance,i.slimcoreCallId,i._slimcoreCallHandler,i._deviceManager,i._appHooks,i.screenSharingControl,i._callTelemetry),i._localScreenShareStream.changed((function(){return i._onLocalScreenShareStreamChanged(r)})),i._localScreenShareStream.on("sharingSourceLost",(function(){return i._onLocalScreenShareSourceLost()})),i._localScreenShareStream.on("windowClosed",(function(){return i.stopScreenSharing(!1,n,r)})),i._localScreenShareStream.on("scraperEvent",(function(e){return i._onScraperEvent(e)})))})).then((function(){return i._localScreenShareStream.start(r,e,t,n)}))]}))}))},t.prototype.changeCropRegion=function(e){this._localScreenShareStream&&this._localScreenShareStream.changeCropRegion(e)},t.prototype._onLocalScreenShareSourceLost=function(){this.screenSharingControl&&this.screenSharingControl.isScreenSharingControlEnabled()&&this.screenSharingControl.shutdownControlForSharer(),this._localScreenShareStream.isStreaming&&this.event("sharingDropped").raise()},t.prototype._onScraperEvent=function(e){var t={event:e.event,data:e.data};this.event("scraperEvent").raise(t)},t.prototype.raiseRenderedAtViewer=function(e){this.event("sharingRenderedAtViewer").raise(e)},t.prototype._onLocalScreenShareStreamChanged=function(e){this._localScreenShareStream.isStreaming?(!this.isScreenSharingOn&&this._dataChannel&&this.screenSharingControl&&this.screenSharingControl.isScreenSharingControlEnabled()&&(this.screenSharingControl.initControlForSharer(this._localScreenShareStream.negotiationTag),this._dataChannel.start()),this._setScreenSharingOn(!0,e)):this._localScreenShareStream.isAvailable||(this.isScreenSharingOn&&this.screenSharingControl&&this.screenSharingControl.isScreenSharingControlEnabled()&&this.screenSharingControl.shutdownControlForSharer(),this._setScreenSharingOn(!1,e))},t.prototype.stopScreenSharing=function(e,t,n){return void 0===n&&(n=D.generateCauseId()),c(this,void 0,void 0,(function(){var e,r,i,o=this;return l(this,(function(a){return e=this._logger.createFnLogger(p.CALL_OPERATIONS.STOP_SCREEN_SHARING,n),r=function(){o._localScreenShareStream&&(o._localScreenShareStream.dispose(n),o._localScreenShareStream=null),o._setScreenSharingOn(!1,n),o.screenSharingControl&&o.screenSharingControl.isScreenSharingControlEnabled()&&o.screenSharingControl.shutdownControlForSharer()},i=Promise.resolve().then((function(){return c(o,void 0,void 0,(function(){return l(this,(function(r){switch(r.label){case 0:return this._localScreenShareStream?[4,S.forgetAndLog(this._localScreenShareStream.stop(n,t),e,"stopScreenSharing: stopping screen sharing failed")]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))})),[2,this._callOperationHandler.registerPromise(p.CALL_OPERATIONS_INTERNAL.ELECTRON_STOP_SCREEN_SHARING,i).then(r,(function(t){throw e.logFailure(t),r(),t}))]}))}))},t.prototype.startDataChannel=function(e,t){return void 0===t&&(t=D.generateCauseId()),c(this,void 0,void 0,(function(){return l(this,(function(t){switch(t.label){case 0:return[4,this._dataChannelCreatedPromise];case 1:return t.sent(),[2,this._dataChannel.start(e)]}}))}))},t.prototype.stopDataChannel=function(e,t){return void 0===t&&(t=D.generateCauseId()),c(this,void 0,void 0,(function(){return l(this,(function(t){switch(t.label){case 0:return[4,this._dataChannelCreatedPromise];case 1:return t.sent(),[2,this._dataChannel.stop(e)]}}))}))},t.prototype.sendUserEvents=function(e,t){return c(this,void 0,void 0,(function(){return l(this,(function(n){switch(n.label){case 0:return[4,this._dataChannelCreatedPromise];case 1:return n.sent(),[2,this._dataChannel.sendUserEvents(e,t)]}}))}))},t.prototype.shareSystemSound=function(e){return c(this,void 0,void 0,(function(){var t=this;return l(this,(function(n){return this._logger.info("shareSystemSound: "+e),[2,Promise.resolve().then((function(){t._slimcoreCallHandler.callShareSystemSound(t.slimcoreCallId,e)}))]}))}))},t.prototype.transferCall=function(e){return this._logger.warn("transferCall is deprecated, please use callBlindTransfer instead"),this.callBlindTransfer(e)},t.prototype.callBlindTransfer=function(e,t){return void 0===t&&(t=D.generateCauseId()),c(this,void 0,void 0,(function(){var n;return l(this,(function(r){return n={transferTarget:e,transferType:0,transferStatusSuccessList:[N.CallStatus.Transferring,N.CallStatus.Transferred]},[2,this._transferCall(n,t)]}))}))},t.prototype.callSafeTransfer=function(e,t){return void 0===t&&(t=D.generateCauseId()),c(this,void 0,void 0,(function(){var n;return l(this,(function(r){return n={transferTarget:e,transferType:0,transferStatusSuccessList:[N.CallStatus.Transferred]},[2,this._transferCall(n,t)]}))}))},t.prototype.transferCallToVoicemail=function(e,t){void 0===t&&(t=D.generateCauseId());var n={transferTarget:e.transferTargetMri,transferType:2,transferStatusSuccessList:[N.CallStatus.Transferred]};return this._transferCall(n,t)},t.prototype.callConsultativeTransfer=function(e,t){return void 0===t&&(t=D.generateCauseId()),c(this,void 0,void 0,(function(){var n;return l(this,(function(r){return n={targetCallId:e.slimcoreCallId,transferType:0,transferStatusSuccessList:[N.CallStatus.Transferred]},[2,this._transferCall(n,t)]}))}))},t.prototype.consultativeTransferWithPickupCode=function(e,t){return c(this,void 0,void 0,(function(){return l(this,(function(e){return[2,Promise.reject("not yet implemented")]}))}))},t.prototype._transferCall=function(e,t){return c(this,void 0,void 0,(function(){var n;return l(this,(function(r){if(this._logger.createFnLogger("Transfer",t).info("start"),this._setTransferState(1,t),n=this._waitForTransferSuccessOrFailure(e.transferStatusSuccessList,0,t),e.transferTarget&&2===e.transferType)this._slimcoreCallHandler.startCallTransfer(this.slimcoreCallId,e.transferTarget,N.TransferType.TransferToVoicemail);else if(e.transferTarget)this._slimcoreCallHandler.startCallTransfer(this.slimcoreCallId,e.transferTarget,N.TransferType.TransferStandard);else{if(!e.targetCallId)return[2,Promise.reject(new Error("Either transferTarget/transfereeCallId should be present"))];this._slimcoreCallHandler.startConsultativeCallTransfer(e.targetCallId,this.slimcoreCallId)}return[2,n]}))}))},t.prototype.park=function(e,t){return void 0===t&&(t=D.generateCauseId()),c(this,void 0,void 0,(function(){var n,r,i=this;return l(this,(function(o){return n={context:e,parkStatusSuccessList:[N.CallStatus.Parked]},this._setParkState(1,t),this._parkCompletePromise=this._waitForTransferSuccessOrFailure(n.parkStatusSuccessList,1,t),(r=this.mapParkContext(n.context))===N.ParkContext.Invalid?[2,Promise.reject(32)]:(this._slimcoreCallHandler.startCallPark(this.slimcoreCallId,r),[2,this._parkCompletePromise.then((function(){try{var e=i.getStrProperty(N.Property.CallParkPickupCode);return i._serverHoldLocation=i.getStrProperty(N.Property.CallServerHoldLocation),Promise.resolve(e)}catch(e){return Promise.reject(32)}}))])}))}))},t.prototype.getServerHoldLocation=function(){return c(this,void 0,void 0,(function(){var e=this;return l(this,(function(t){return[2,this._parkCompletePromise.then((function(){return e._logger.info("getServerHoldLocation="+e._serverHoldLocation),Promise.resolve(e._serverHoldLocation)}))]}))}))},t.prototype.mapParkContext=function(e){switch(e){case 0:return N.ParkContext.Team;case 1:return N.ParkContext.Sharedline;case 2:return N.ParkContext.Serverhold;default:return N.ParkContext.Invalid}},t.prototype._waitForTransferSuccessOrFailure=function(e,n,r){var i=this,o=this._logger.createFnLogger("WaitForTransfer",r);o.info("successStatusList="+e+", type="+n);var a=this._callOperationHandler.createPendingOperation(p.CALL_OPERATIONS_INTERNAL.CALL_TRANSFER_IN_PROGRESS,void 0,r),s=0===n?N.Property.CallTransferStatus:N.Property.CallParkStatus,c=0===n?N.Property.CallTransferFailureReason:N.Property.CallParkFailureReason,l=this._slimcoreInstance.handle("object-property-changed",{objectId:this.slimcoreCallId,propKey:s},(function(n){return function(n){if(o.info("status changed: "+n+" ("+N.CallStatus[n]+")"),-1!==e.indexOf(n)||n===N.CallStatus.Failed)if(l&&(l.dispose(),l=null),-1!==e.indexOf(n))i._callOperationHandler.resolveOperation(p.CALL_OPERATIONS_INTERNAL.CALL_TRANSFER_IN_PROGRESS,1);else{var a=i.getIntProperty(c),s=t.convertParticipantReasonToTerminatedReason(O.convertFailureReasonToParticipantReason(a)),u={reason:a,code:i.transferDiagnosticsInfo&&i.transferDiagnosticsInfo.callControllerCode,subcode:i.transferDiagnosticsInfo&&i.transferDiagnosticsInfo.callControllerSubCode};i._callTelemetry.updateOperationData(p.CALL_OPERATIONS_INTERNAL.CALL_TRANSFER_IN_PROGRESS,u,r),o.logFailure("failureReason="+a+" => terminatedReason="+s+", diagnostic info: "+M.getPrintableObject(i.transferDiagnosticsInfo)),i._callOperationHandler.rejectOperation(p.CALL_OPERATIONS_INTERNAL.CALL_TRANSFER_IN_PROGRESS,s)}}(n.value)}));return a},t.prototype.mute=function(e){return void 0===e&&(e=D.generateCauseId()),c(this,void 0,void 0,(function(){return l(this,(function(t){return this.isMuteDisabled()?[2,Promise.reject(new Error("Cannot mute when already locally muted"))]:[2,this._muteUnmute(!0,e)]}))}))},t.prototype.unmute=function(e){return void 0===e&&(e=D.generateCauseId()),c(this,void 0,void 0,(function(){return l(this,(function(t){return this.isUnMuteDisabled()?[2,Promise.reject(new Error("Cannot unmute when already locally and server unmuted"))]:[2,this._muteUnmute(!1,e)]}))}))},t.prototype.muteSpeaker=function(e){return void 0===e&&(e=D.generateCauseId()),c(this,void 0,void 0,(function(){return l(this,(function(t){return this.isSpeakerMuted?[2,Promise.reject(new Error("Cannot mute speaker when already muted"))]:[2,this._muteUnmuteSpeaker(!0,e)]}))}))},t.prototype.unmuteSpeaker=function(e){return void 0===e&&(e=D.generateCauseId()),c(this,void 0,void 0,(function(){return l(this,(function(t){return this.isSpeakerMuted?[2,this._muteUnmuteSpeaker(!1,e)]:[2,Promise.reject(new Error("Cannot unmute speaker when already unmuted"))]}))}))},t.prototype.muteParticipants=function(e,t,n){return void 0===n&&(n=D.generateCauseId()),c(this,void 0,void 0,(function(){return l(this,(function(r){return[2,this._muteParticipants(e,t,n)]}))}))},t.prototype.hold=function(e,t){return void 0===t&&(t=D.generateCauseId()),c(this,void 0,void 0,(function(){return l(this,(function(n){return[2,this._holdUnhold(!0,t,e)]}))}))},t.prototype.unhold=function(e,t){return void 0===t&&(t=D.generateCauseId()),c(this,void 0,void 0,(function(){return l(this,(function(n){return[2,this._holdUnhold(!1,t,e)]}))}))},t.prototype.updateEndpointMetadata=function(e,t){return void 0===t&&(t=D.generateCauseId()),c(this,void 0,void 0,(function(){return l(this,(function(n){return 3!==this.state?(this._logger.warn("Trying to updateEndpointMetadata in a call which is not connected, callId = "+this.callId),[2,Promise.reject(new Error("cannot updateEndpointMetadata in a call which is not connected"))]):(this._endpointMetadata=e,[2,this._updateEndpointMetadata(this._endpointMetadata,t)])}))}))},t.prototype.sendDtmfTone=function(e,t){return void 0===t&&(t=D.generateCauseId()),c(this,void 0,void 0,(function(){return l(this,(function(n){return this._logger.info("DTMF tone <omitted>"),[2,this._sendDtmfTone(e,t)]}))}))},t.prototype.setAudioUsageMode=function(e,t){return void 0===t&&(t=D.generateCauseId()),c(this,void 0,void 0,(function(){return l(this,(function(n){return[2,this._setAudioUsageMode(e,t)]}))}))},t.prototype.getTechnicalInformationJson=function(){return c(this,void 0,void 0,(function(){var e=this;return l(this,(function(t){return[2,Promise.resolve().then((function(){try{return e._slimcoreCallHandler.callGetTechnicalInformationJson(e.slimcoreCallId)}catch(t){throw e._logger.error("Error in callGetTechnicalInformationJson callId: "+e.callId+", error: "+t),t}}))]}))}))},t.prototype.startAudio=function(e,t){return void 0===t&&(t=D.generateCauseId()),c(this,void 0,void 0,(function(){var n,r;return l(this,(function(i){return n=this._logger.createFnLogger(p.CALL_OPERATIONS.START_AUDIO,t),3!==this.state?(n.logFailure("cannot startAudio when call is not connected"),[2,Promise.reject(60)]):(r=this._callOperationHandler.waitForOperation(p.CALL_OPERATIONS.START_AUDIO,void 0,t),this._slimcoreCallHandler.callStartAudio(this.slimcoreCallId,e),[2,r])}))}))},t.prototype.stopAudio=function(e,t){return void 0===t&&(t=D.generateCauseId()),c(this,void 0,void 0,(function(){var n,r;return l(this,(function(i){return n=this._logger.createFnLogger(p.CALL_OPERATIONS.STOP_AUDIO,t),3!==this.state?(n.logFailure("cannot stopAudio when call is not connected"),[2,Promise.reject(60)]):(r=this._callOperationHandler.waitForOperation(p.CALL_OPERATIONS.STOP_AUDIO,void 0,t),this._slimcoreCallHandler.callStopAudio(this.slimcoreCallId,e),[2,r])}))}))},t.prototype.assimilate=function(e,t,n,r){return void 0===r&&(r=D.generateCauseId()),c(this,void 0,void 0,(function(){return l(this,(function(i){return this._logger.createFnLogger(p.CALL_OPERATIONS.ASSIMILATE,r).info("assimilate: "+e.callId+" threadId: "+t+", messageId: "+n+", causeId: "+r),this._slimcoreCallHandler.callAssimilate(this.slimcoreCallId,e.slimcoreCallId,t,n),[2,Promise.resolve({code:0})]}))}))},t.prototype._onMediaNegotiationStatusChanged=function(e){var t;switch(this._logger.createFnLogger("onMediaNegotiationStatusChanged",e.causeId).info("_onMediaNegotiationStatusChanged modalityType: "+e.modalityType+"\n            mediaNegotiationStatusCode: "+e.mediaNegotiationStatusCode),e.modalityType){case N.ModalityType.Audio:t=this._callOperationHandler.hasPendingOperation(p.CALL_OPERATIONS.START_AUDIO)?p.CALL_OPERATIONS.START_AUDIO:p.CALL_OPERATIONS.STOP_AUDIO;break;case N.ModalityType.Video:t=p.CALL_OPERATIONS.SET_MAX_VIDEO_CHANNELS;break;default:return}this._callOperationHandler.hasPendingOperation(t)&&(e.mediaNegotiationStatusCode===N.MediaNegotiationStatusCode.Succeeded?this._callOperationHandler.maybeResolveOperation(t,e.mediaNegotiationStatusCode,void 0,e.causeId):this._callOperationHandler.maybeRejectOperation(t,e.mediaNegotiationStatusCode,void 0,e.causeId))},t.prototype.stop=function(e,t){void 0===e&&(e=!1),void 0===t&&(t=D.generateCauseId());var n=this._logger.createFnLogger(p.CALL_OPERATIONS.STOP_CALL,t);return 6===this.state?(n.logFailure("Trying to stop a call which is already Disconnecting, callId = "+this.callId),Promise.reject(new Error("cannot stop call in Disconnecting state"))):7===this.state?(n.logFailure("Trying to stop a call which is already Disconnected, callId = "+this.callId),Promise.reject(new Error("cannot stop call in Disconnected state"))):this.stopInternal(t,void 0,e)},t.prototype.reject=function(e){return void 0===e&&(e=D.generateCauseId()),1!==this.state?Promise.reject(60):this.stopInternal(e)},t.prototype.stopInternal=function(e,t,n){var r=this;void 0===t&&(t=0),void 0===n&&(n=!1);var i=this._logger.createFnLogger("stopInternal",e);return 6===this.state?(i.info("Trying to stop a call which is already Disconnecting"),this.disconnectingPromise):7===this.state?(i.info("Trying to stop a call which is already Disconnected"),this.disconnectingPromise):(this._setCallState(6,e,t),this.disconnectingPromise=Promise.resolve().then((function(){return i.info("Leaving from call"),r._leaveSlimCoreCall(n,e)})).catch((function(t){throw r._callTelemetry.updateOperationData(p.CALL_OPERATIONS.STOP_CALL,{error:M.getPIISafeObject(t)},e),i.logFailure(t),r._setCallState(7,e,t),t})),this.disconnectingPromise)},t.prototype._leaveSlimCoreCall=function(e,t){var n=this,r=this._logger.createFnLogger(p.CALL_OPERATIONS_INTERNAL.ELECTRON_LEAVE_CALL,t);if(r.info("forEveryone: "+e),0===this.slimcoreCallId)return r.logFailure("slimcoreCallId == 0"),Promise.reject(32);var i=this._callOperationHandler.createPendingOperation(p.CALL_OPERATIONS_INTERNAL.CALL_ENDED);return Promise.resolve().then((function(){e?n._slimcoreCallHandler.endCallForAll(n.slimcoreCallId):n._slimcoreCallHandler.leaveCall(n.slimcoreCallId)})).then((function(){return r.info("Waiting for SlimCore to end call")})).then((function(){return i})).then((function(){r.info("SlimCore ended the call")}),(function(e){return r.logFailure("Error in leaveSlimCoreCall().. ignoring, error = "+M.getPrintableObject(e)+", reason = 25"),Promise.reject(25)}))},t.prototype.incomingCallInit=function(e,t){void 0===t&&(t=D.generateCauseId());var n=this._logger.createFnLogger(p.CALL_OPERATIONS_INTERNAL.INCOMING_INITIALIZE,t);try{if(this.callerMri=g.stripMriAliases(this._getStrProperty(this._slimcoreCallHandler,e,N.Property.CallerMriIdentity)),!this.callerMri)return void n.logFailure("Unable to get callerMRI from call object. Ignoring incoming call");var r=this._getProperties(this._slimcoreCallHandler,e,{callQueueInfo:{propKey:N.Property.CallQueueInfo},transferorMri:{propKey:N.Property.CallTransferorMri},transferorDisplayName:{propKey:N.Property.CallTransferorDisplayName},transferorType:{propKey:N.Property.CallTransferorType},onBehalfOfMri:{propKey:N.Property.CallOnBehalfOfMri},incomingCallType:{propKey:N.Property.CallIncomingType},consultativeCallId:{propKey:N.Property.CallConsultativeTransferCallId},messageId:{propKey:N.Property.CallMessageId}},{status:{propKey:N.Property.CallStatus},isIncomingOneOnOneVideoCall:{propKey:N.Property.CallIsIncomingOneOnOneVideoCall}});this.transferorMri=g.stripMriAliases(r.transferorMri),this.transferorDisplayName=r.transferorDisplayName,this.transferorType=r.transferorType,this.onBehalfOfMri=g.stripMriAliases(r.onBehalfOfMri),this.callQueueInfo=r.callQueueInfo&&JSON.parse(r.callQueueInfo).callQueueInfo,this.incomingCallType=r.incomingCallType,this.consultativeCallId=r.consultativeCallId,this.isIncomingOneOnOneVideoCall=!!r.isIncomingOneOnOneVideoCall,this.messageId=r.messageId,this.attachSlimCoreCallObject(e,t),r.status===N.CallStatus.RingingIn&&(this._setCallState(1,t),this._callTelemetry.setDirection(f.DIRECTION.INCOMING),this._callTelemetry.setSelfParticipantRole(f.SELF_PARTICIPANT_ROLE.CALLEE))}catch(e){throw n.logFailure("sync failure, cleaning up slimcore ready operation: error="+M.getPrintableObject(e)),this._callTelemetry.updateOperationData(p.CALL_OPERATIONS_INTERNAL.INCOMING_INITIALIZE,{error:M.getPIISafeObject(e)},t),this._callOperationHandler.rejectOperation(p.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY),e}},t.prototype.acknowledge=function(e,n){var r=this;void 0===n&&(n=D.generateCauseId());var i=this._logger.createFnLogger(p.CALL_OPERATIONS.ACKNOWLEDGE,n);if(0!==this.state&&8!==this.state)return this._callTelemetry.maybeRecordOperationSuccess(p.CALL_OPERATIONS.ACKNOWLEDGE,{code:4}),Promise.reject(new Error("Trying to acknowledge a call that has already been acted on"));this._setCallerMri(g.stripMriAliases(e.callerId),n),this._callTelemetry.setDirection(f.DIRECTION.INCOMING),this._callTelemetry.setSelfParticipantRole(f.SELF_PARTICIPANT_ROLE.CALLEE);var o={callId:e.convoCallId,callerId:e.callerId,launchTime:e.launchTime.toString(),pushReceivedTime:e.pushReceivedTime.toString(),registrationId:e.registrationId,participantId:e.participantId},a=this._slimcoreInstance.handlePushNotification({eventType:e.body.evt,servicePayload:e.body.gp,correlationIdsJson:JSON.stringify(o),callKey:e.callKey,connectionType:t.convertConnectionType(e.connectionType),accountIdentity:this.currentUserSkypeIdentity.id,mediaConfigurationJson:S.mapToEmptyStrIfFalsy(JSON.stringify(e.mediaConfiguration))}),s=[],c=this._callOperationHandler.createPendingOperation(p.CALL_OPERATIONS_INTERNAL.ELECTRON_WAIT_FOR_HANDLE_PUSH,void 0,n);s.push(this._slimcoreInstance.handle("push-handling-complete",{token:a},(function(e){if(e.token===a)if(i.info("HandlePushNotification: Received event for token: "+e.token+" result: "+e.result),e.result===N.PushHandlingResult.CallSetupSucceeded)i.logSuccess("HandlePushNotification: Succeeded"),r._callOperationHandler.resolveOperation(p.CALL_OPERATIONS_INTERNAL.ELECTRON_WAIT_FOR_HANDLE_PUSH,{code:1,success:!0},void 0,n).catch((function(e){i.logFailure("HandlePushNotification: Failed "+e)}));else if(e.result===N.PushHandlingResult.CallSetupProgress)i.info("HandlePushNotification: In progress, keep waiting...");else{var o="HandlePushNotification: Failed "+e.result;i.logFailure(o),r._callOperationHandler.resolveOperation(p.CALL_OPERATIONS_INTERNAL.ELECTRON_WAIT_FOR_HANDLE_PUSH,t.convertPushHandlingResult(e.result),void 0,n).catch((function(e){i.logFailure("HandlePushNotification: Failed "+e)}))}else i.logFailure("HandlePushNotification: Received unexpected token "+e.token+" (expected "+a+")")})));var l=this._callOperationHandler.createPendingOperation(p.CALL_OPERATIONS_INTERNAL.ELECTRON_WAIT_FOR_RINGING);l.catch(k.noop),s.push(this._slimcoreInstance.handle("object-property-changed",{objectType:N.ObjectType.Call},(function(e){var t=r._getStrProperty(r._slimcoreCallHandler,e.objectId,N.Property.CallName),o=r._getIntProperty(r._slimcoreCallHandler,e.objectId,N.Property.CallStatus);t===r.callId?o===N.CallStatus.RingingIn&&(r.attachSlimCoreCallObject(e.objectId,n,!1,"acknowledge"),r._fillIncomingCallProperties(n),r._callOperationHandler.hasPendingOperation(p.CALL_OPERATIONS_INTERNAL.ELECTRON_WAIT_FOR_RINGING)&&r._callOperationHandler.resolveOperation(p.CALL_OPERATIONS_INTERNAL.ELECTRON_WAIT_FOR_RINGING,void 0,void 0,n).then((function(){i.logSuccess("Reached ringing/active state for call pending acknowledgement")}),(function(e){i.logFailure("Reached ringing/active state for call pending acknowledgement "+e)})),r.raiseChanged()):i.info("Ignoring SlimCore event for incorrect call "+e.objectId+"/"+t)})));var u=function(){return d.each(s,(function(e){return e.dispose()}))},h=function(e){r._callOperationHandler.maybeRejectOperation(p.CALL_OPERATIONS_INTERNAL.ELECTRON_WAIT_FOR_RINGING,e,void 0,n),r._callOperationHandler.maybeRejectOperation(p.CALL_OPERATIONS_INTERNAL.ELECTRON_WAIT_FOR_HANDLE_PUSH,e,void 0,n)};return c.then((function(e){return e.success?l.then((function(){return r._setCallState(1,n),e})):(h(e),e)})).then((function(e){return i.logSuccess("Acknowledge done"),u(),e})).catch((function(e){throw i.logFailure("sync failure, cleaning up slimcore ready operation: error="+M.getPrintableObject(e)),r._callTelemetry.updateOperationData(p.CALL_OPERATIONS_INTERNAL.INCOMING_INITIALIZE,{error:M.getPIISafeObject(e)},n),r._callOperationHandler.rejectOperation(p.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY),u(),h(e),e}))},t.prototype.accept=function(e,t){return void 0===t&&(t=D.generateCauseId()),c(this,void 0,void 0,(function(){var n,r,i;return l(this,(function(o){switch(o.label){case 0:(n=this._logger.createFnLogger(p.CALL_OPERATIONS.ACCEPT,t)).info("accept, answerMediaType: "+e.answerMediaType+",\n                            withVideo: "+e.withVideo+",\n                            muted: "+e.muted),e.muted&&n.logFailure("Accepting call muted is not implemented"),this._setCallState(2,t),this.connectCallPromise=this._callOperationHandler.waitForOperation(p.CALL_OPERATIONS.ACCEPT),r=this._callOperationHandler.createPendingOperation(p.CALL_OPERATIONS_INTERNAL.CONNECT_CALL,void 0,t),o.label=1;case 1:return o.trys.push([1,5,,6]),this._acceptCall(e,t),this._updateCallType(this.getIntProperty(N.Property.CallIsConference),t),1!==e.answerMediaType?[3,3]:(n.info("Call has been answered - turning on video"),[4,this.startVideoSafe(t)]);case 2:o.sent(),o.label=3;case 3:return[4,r];case 4:return o.sent(),this._setCallState(3,t),[3,6];case 5:throw i=o.sent(),this._callTelemetry.updateOperationData(p.CALL_OPERATIONS.ACCEPT,{error:M.getPIISafeObject(i)},t),this.stopInternal(t),this._logger.error("Error in accept(), callId = "+this.callId+", error = "+i),i;case 6:return[2]}}))}))},t.prototype.mergeWithPickupCode=function(e,t){return void 0===t&&(t=D.generateCauseId()),c(this,void 0,void 0,(function(){var n,r,i=this;return l(this,(function(o){return(n=this._logger.createFnLogger(p.CALL_OPERATIONS.MERGE_WITH_PICKUP_CODE,t)).info("mergeWithPickupCode: pickup code: "+e.pickupCode+", threadId: "+e.threadId+" messageId: "+e.messageId),e.pickupCode?(r=this._callOperationHandler.waitForOperation(p.CALL_OPERATIONS.MERGE_WITH_PICKUP_CODE,e.pickupCode,t),[2,Promise.resolve().then((function(){return i._mergeWithPickupCode(e.pickupCode,e.threadId,e.messageId,t)})).catch((function(e){i._callTelemetry.updateOperationData(p.CALL_OPERATIONS.MERGE_WITH_PICKUP_CODE,{error:M.getPIISafeObject(e)},t),n.logFailure(e);var r=e;return r=F(e)?e:{code:p.TRANSACTION_END_CODE.CLIENT_ERROR,subcode:p.TRANSACTION_END_SUBCODE.TRANSACTION_NOT_ALLOWED,phrase:M.getPrintableObject(e)},Promise.reject(r)})).then((function(){return r}))]):(n.info("mergeWithPickupCode: pickup code cannot be empty"),[2,Promise.reject({code:p.TRANSACTION_END_CODE.CLIENT_ERROR,subcode:p.TRANSACTION_END_SUBCODE.LOCAL_REJECT,phrase:p.TRANSACTION_END_PHRASE.TRANSACTION_DISALLOWED})])}))}))},t.prototype.merge=function(e,t,n){return void 0===n&&(n=D.generateCauseId()),c(this,void 0,void 0,(function(){var r,i,o,a,s=this;return l(this,(function(c){return(r=this._logger.createFnLogger(p.CALL_OPERATIONS.MERGE_CALL,n)).info("merge: "+e.callId+" threadId: "+t.threadId+", messageId: "+t.messageId),e.participants&&1===e.participants.length?(i=e.participants[0].id,o=this._getOrCreateParticipant(i,n),this._addParticipantToCall(o,n),a=this._participantOperationHandler.createPendingOperation(p.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,o.id,n),[2,Promise.resolve().then((function(){return s._slimcoreCallHandler.callMerge(s.slimcoreCallId,e.slimcoreCallId,t.threadId,t.messageId,n)})).catch((function(e){s._callTelemetry.updateOperationData(p.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,{error:M.getPIISafeObject(e)},n,i),r.logFailure(e),s._handleParticipantRemoved(i,n,e);var t=e;return t=F(e)?e:{code:p.TRANSACTION_END_CODE.CLIENT_ERROR,subcode:p.TRANSACTION_END_SUBCODE.TRANSACTION_NOT_ALLOWED,phrase:M.getPrintableObject(e)},Promise.reject(t)})).then((function(){return a})).then((function(){return Promise.resolve({code:p.TRANSACTION_END_CODE.SUCCESS,subCode:0,phrase:p.TRANSACTION_END_PHRASE.TRANSACTION_COMPLETE})})).catch((function(e){r.logFailure(e),s._handleParticipantRemoved(i,n,e);var t=e;return F(e)&&(t=e),Promise.reject(t)}))]):(r.error("error invalid number of participants on call to be merged "+e.participants.length),[2,Promise.reject({code:p.TRANSACTION_END_CODE.CLIENT_ERROR,subcode:p.TRANSACTION_END_SUBCODE.LOCAL_REJECT,phrase:p.TRANSACTION_END_PHRASE.TRANSACTION_DISALLOWED})])}))}))},t.prototype._acceptCall=function(e,n){try{e.withVideo&&(e.answerMediaType=1),this._slimcoreCallHandler.acceptCall(this.slimcoreCallId,t.toAnswerMediaType(e.answerMediaType))}catch(t){this._logger.info("acceptCall is missing from the slimcore electron module: "+t),1===e.answerMediaType&&(e.withVideo=!0),this._slimcoreCallHandler.answerCall(this.slimcoreCallId,e.withVideo)}},t.prototype.reconnect=function(){return Promise.reject(new Error("Retargeting is not supported"))},t.prototype.provideCallQualityFeedback=function(e,t,n,r){var i=this;return this._logger.info("provideCallQualityFeedback"),Promise.resolve().then((function(){try{i._slimcoreCallHandler.provideCallQualityFeedback(i.callId,i.participantId,e,t,n,r)}catch(e){throw i._logger.error("Error in provideCallQualityFeedback callId: "+i.callId+", error: "+e),e}}))},t.prototype._mergeWithPickupCode=function(e,t,n,r){this._logger.info("_mergeWithPickupCode: pickupCode = "+e+" threadId = "+t+" messageId = "+n+" causeId = "+r),this._slimcoreCallHandler.mergeCall(this.slimcoreCallId,e,S.mapToEmptyStrIfFalsy(t),S.mapToEmptyStrIfFalsy(n),S.mapToEmptyStrIfFalsy(r))},t.prototype._onCallOriginChanged=function(e){e===N.OriginType.Transfer?this._setCallOrigin(1):e===N.OriginType.Park?this._setCallOrigin(2):e===N.OriginType.Unspecified?this._setCallOrigin(0):e===N.OriginType.TransferToVoicemail?this._setCallOrigin(3):this._logger.info("Unknown origin")},t.prototype._onCallMutedUnmuted=function(e){var t=10===this.state;this._logger.info("onCallMutedUnmuted current: "+this.isMuted+" new: "+e),this._logger.info("onCallMutedUnmuted isServerMuted: "+this.isServerMuted+" inLobby: "+t),this.isServerMuted&&!t||e||(this._callOperationHandler.maybeResolveOperation(p.CALL_OPERATIONS.MUTE),this._callOperationHandler.maybeResolveOperation(p.CALL_OPERATIONS.UNMUTE)),e&&(this._callOperationHandler.maybeResolveOperation(p.CALL_OPERATIONS.MUTE),this._callOperationHandler.maybeResolveOperation(p.CALL_OPERATIONS.UNMUTE)),this.isMuted!==e&&(this._logger.info("isMuted set to "+e+" in _onCallMutedUnmuted"),this.isMuted=e,this._logger.info("onCallMutedUnmuted isMuted: "+this.isMuted),this._updateCapabilities(D.generateCauseId()),this.raiseChanged())},t.prototype._onCallMutedUnmutedSpeaker=function(e,t){void 0===t&&(t=D.generateCauseId()),this._logger.createFnLogger("onCallMutedUnmutedSpeaker",t).info("current: "+this.isSpeakerMuted+" new: "+e),e?this._callOperationHandler.maybeResolveOperation(p.CALL_OPERATIONS.MUTE_SPEAKER,void 0,void 0,t):this._callOperationHandler.maybeResolveOperation(p.CALL_OPERATIONS.UNMUTE_SPEAKER,void 0,void 0,t),this._setMutedSpeaker(e,t)},t.prototype._onCallIsServerMuted=function(e,t){void 0===t&&(t=D.generateCauseId()),this._logger.info("_onCallIsServerMuted "+e),e!==this.isServerMuted&&(this.isServerMuted=e,this._callTelemetry.recordEvent(p.PARTICIPANT_OPERATIONS_INTERNAL.SELF_PARTICIPANT_UPDATED,{isServerMuted:this.isServerMuted},t),this.event("serverMutedChanged").raise(e),this._updateCapabilities(t),this.raiseChanged())},t.prototype._onCallCapabilitiesChanged=function(e){e!==this._capabilityFlags&&(this._logger.info("_onCallCapabilitiesChanged: new value is "+e),this._capabilityFlags=e,this._updateCapabilities(D.generateCauseId(),!0))},t.prototype._updateCapabilities=function(e,t){void 0===t&&(t=!1);var n=!1,r=!1;C.callStateIsAnyOf(this.state,[11,12])||(n=!(this.isUnMuteDisabled()||this.isServerMuted&&!(this._capabilityFlags&N.SelfCapability.UnmuteSelf)),r=!!(this._capabilityFlags&N.SelfCapability.MuteOthers)),this._capabilities.canUnmuteSelf===n&&this._capabilities.canMuteOthers===r||(this._capabilities.canUnmuteSelf=n,this._capabilities.canMuteOthers=r,this._logger.info("["+e+"]_updateCapabilities Computed capabilities: "+JSON.stringify(this._capabilities)),t&&this.raiseChanged())},t.prototype._getCallParticipantMriMap=function(){for(var e={},t=this._slimcoreCallHandler.callGetParticipants(this.slimcoreCallId)||[],n={},r=0,i=t;r<i.length;r++){var o=i[r];n[o]={objectId:o,propKey:N.Property.ParticipantMriIdentity}}for(var a=this._getProperties(this._slimcoreCallHandler,0,n,{}),s=0,c=t;s<c.length;s++){var l=c[s],u=a[l];u&&(e[u]=l)}return e},t.prototype._getParticipantsData=function(e){for(var t={},n={},r={},i=function(e,t){return e+"_"+t},o=0,a=e;o<a.length;o++){for(var s=a[o],c=0,l=Object.keys(T.participantStrProps);c<l.length;c++){var u=l[c];t[i(s.objectId,u)]={objectId:s.objectId,propKey:T.participantStrProps[u].propKey,fallback:T.participantStrProps[u].fallback}}for(var d=0,h=Object.keys(T.participantIntProps);d<h.length;d++)u=h[d],n[i(s.objectId,u)]={objectId:s.objectId,propKey:T.participantIntProps[u].propKey,fallback:T.participantIntProps[u].fallback};r[s.objectId]=s.mri}var p={};if(e.length)for(var f=this._getProperties(this._slimcoreCallHandler,0,t,n),g=0,_=Object.keys(f);g<_.length;g++){var m=_[g],v=m.split("_"),y=v[0],C=v[1];p[y]||(p[y]={objectId:Number(y),mri:r[y],props:{}}),p[y].props[C]=f[m]}for(var S=[],I=0,P=Object.keys(p);I<P.length;I++)y=P[I],S.push(p[y]);return S},t.prototype._callGetParticipantsData=function(e,t){var n=this._getCallParticipantMriMap(),r=[],i=[];return this._logger.info("["+t+"]onParticipantJoinedOrRemoved # of participants in roster="+Object.keys(n).length),e.forEach((function(e){var t;t=e,n.hasOwnProperty(t.mri)?function(e){return e.objectId}(e)?function(e){return e.objectId===n[e.mri]}(e)||i.push(e):(r.push(e),delete n[e.objectId]):i.push(e)})),Object.keys(n).forEach((function(e){return r.push({mri:e,objectId:n[e]})})),{newParticipantsData:this._settings.enableParticipantsGetPropsAggregation?this._getParticipantsData(r):r,participantsToRemove:i}},t.prototype._onParticipantJoinedOrRemoved=function(e){var t=this,n=this._callGetParticipantsData(this.participants.map((function(e){return{objectId:e.slimcoreObjectId,mri:e.id}})),e),r=n.newParticipantsData;n.participantsToRemove.forEach((function(n){return t._handleParticipantRemoved(n.mri,e,t.participantMap[n.mri].stateReason)})),Object.keys(r).forEach((function(n){return t._handleParticipantJoined(r[n],e)}))},t.prototype._updateDominantSpeakerList=function(){var e=this;if(this._isOptimizedSpeakerEventingEnabled)return{fullOrderMatches:!0,topSpeakerMatches:!1};var t=d.map(d.sortBy(d.map(d.filter(this.participants,(function(e){return 3===e.state})),(function(t){return{mri:t.id,rank:t.dominantSpeakerRank?t.dominantSpeakerRank:e.participants.length+1}})),"rank"),(function(e){return e.mri})),n=d.isEqual(this.dominantSpeakerInfo.speakerList,t),r=n;return r||(r=!d.isEmpty(this.dominantSpeakerInfo.speakerList)&&!d.isEmpty(t)&&d.head(this.dominantSpeakerInfo.speakerList)===d.head(t)),this.dominantSpeakerInfo={speakerList:t,timestamp:new Date},n||this._logger.info("_updateDominantSpeakerList: "+this.dominantSpeakerInfo.speakerList.length),{fullOrderMatches:n,topSpeakerMatches:r}},t.prototype._handleParticipantRemoved=function(e,t,n){void 0===n&&(n=0);var r=this._logger.createFnLogger("handleParticipantRemoved",t);r.info("reason="+n),this.screenSharingControl&&this.screenSharingControl.isScreenSharingControlEnabled()&&this.screenSharingControl.handleParticipantRemoved(e);var i=this._removeParticipantEntry(e);i?(i.setState(4,t,n),this._participantOperationHandler.maybeRejectOperation(p.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,n,e),this._participantOperationHandler.maybeResolveOperation(p.PARTICIPANT_OPERATIONS.REMOVE_PARTICIPANT,n,e),i.rejectAdmitParticipantDeferred(n),i.dispose(),this._updateDominantSpeakerList(),this.event("participantRemoved").raise(i),this.raiseChangedDeferred()):r.logFailure("unable to remove participant")},t.prototype._handleParticipantJoined=function(e,t){var n=this;this._logger.debug("["+t+"]handleParticipantJoined: "+v.scrubMriOrOmit(e.mri));var r=this._getOrCreateParticipant(e.mri,t,e.objectId,e);T.default.isParticipantActive(r.state)&&this._participantOperationHandler.hasPendingOperation(p.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,e.mri)&&(this._participantOperationHandler.resolveOperation(p.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,r,e.mri),this._callTelemetry.recordOperationSuccess(p.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,null,e.mri),this._callTelemetry.recordOperationSuccess(p.PARTICIPANT_OPERATIONS_INTERNAL.PARTICIPANT_JOINED,f.getEndpointInformationForTelemetry(function(e){return e&&e.endpoints&&e.endpoints.endpointDetails||[]}(r)),e.mri,t)),this._handleParticipantJoinedDefer||(this._handleParticipantJoinedDefer=d.defer((function(){delete n._handleParticipantJoinedDefer,n._updateDominantSpeakerList().fullOrderMatches||n.raiseChangedDeferred()})))},t.prototype._admitParticipantToSlimCoreElectronCall=function(e){var t=[e];return this._slimcoreCallHandler.admitParticipants(this.slimcoreCallId,t),Promise.resolve()},t.prototype.admitParticipant=function(e,t){return void 0===t&&(t=D.generateCauseId()),c(this,void 0,void 0,(function(){var n,r,i,o,a=this;return l(this,(function(s){return(n=this._logger.createFnLogger(p.PARTICIPANT_OPERATIONS.ADMIT_PARTICIPANT,t)).info("participantId = "+v.scrubMriOrOmit(e)),0===this.slimcoreCallId?[2,Promise.reject(11)]:7!==(r=this._getOrCreateParticipant(e,t)).state?[2,Promise.reject(43)]:(i=h.defer(),o=this._admitParticipantToSlimCoreElectronCall(e).then((function(){return r.addAdmitParticipantDeferred(i)})).then((function(){return i.promise})).then((function(){return n.logSuccess("admitted")})).catch((function(r){return n.logFailure(r),a._handleParticipantOperationFailure(p.PARTICIPANT_OPERATIONS.ADMIT_PARTICIPANT,r,t,e),Promise.reject(r)})),this.raiseChanged(),[2,o])}))}))},t.prototype._addParticipantToSlimCoreElectronCall=function(e,t,n,r){this._logger.info("addParticipantToSlimCoreElectronCall: participantId = "+v.scrubMriOrOmit(e)+" threadId = "+t+" messageId = "+n+" participantInvitationData = "+v.scrubMriOrOmit(r));var i=this._slimcoreCallHandler.addParticipant(this.slimcoreCallId,e,S.mapToEmptyStrIfFalsy(t),S.mapToEmptyStrIfFalsy(n),S.mapToEmptyStrIfFalsy(r));return 0===i?Promise.reject(new Error("AddParticipant call to slimcore failed")):Promise.resolve(i)},t.prototype.callMeBack=function(e,t,n){return void 0===n&&(n=D.generateCauseId()),c(this,void 0,void 0,(function(){var r,i,o,a=this;return l(this,(function(s){return(r=this._logger.createFnLogger(p.PARTICIPANT_OPERATIONS.CALL_ME_BACK,n)).info("callMeBack: participantMri = "+v.scrubMriOrOmit(e)+" assertedMri = "+v.scrubMriOrOmit(t)),0===this.slimcoreCallId?(r.logFailure("call is not initialized yet"),[2,Promise.reject(new Error("call is not initialized yet"))]):(i=this._participantOperationHandler.waitForOperation(p.PARTICIPANT_OPERATIONS.CALL_ME_BACK,e),o=g.generateAliasedMri(""+g.MRI_SKYPE_PREFIX+this.currentUserSkypeIdentity.id,this.currentUserSkypeIdentity.sipUri),[2,Promise.resolve().then((function(){return a._slimcoreCallHandler.callMeBack(a.slimcoreCallId,e,t||o,n),i})).catch((function(t){throw a._callTelemetry.updateOperationData(p.PARTICIPANT_OPERATIONS.CALL_ME_BACK,{error:M.getPIISafeObject(t)},n,e),a._participantOperationHandler.maybeRejectOperation(p.PARTICIPANT_OPERATIONS.CALL_ME_BACK,1,e,n),r.logFailure("Error in callMeBack(), callId = "+a.callId+", error = "+t),t}))])}))}))},t.prototype.nudgeParticipants=function(e,t,n,r){return void 0===n&&(n={}),void 0===r&&(r=D.generateCauseId()),c(this,void 0,void 0,(function(){var i,o,a,s=this;return l(this,(function(c){if((i=this._logger.createFnLogger(p.CALL_OPERATIONS.NUDGE_PARTICIPANTS,r)).info("nudgeParticipants: context = "+e),2!==this.state&&3!==this.state)return[2,Promise.reject(48)];if(0===this.slimcoreCallId)return[2,Promise.reject(new Error("call is not initialized yet"))];if(n.sipUri)return[2,Promise.reject(new Error("sipUri not supported yet"))];if(n.participantInvitationData)try{o=JSON.stringify(n.participantInvitationData)}catch(e){return i.logFailure(e),[2,Promise.reject(e)]}return i.info("nudgeParticipants: context = "+e+" threadId = "+n.threadId+" messageId = "+n.messageId+" participantInvitationData = "+v.scrubMriOrOmit(o)),a=this._participantOperationHandler.waitForOperation(p.CALL_OPERATIONS.NUDGE_PARTICIPANTS,e),[2,Promise.resolve().then((function(){return s._slimcoreCallHandler.nudgeParticipants(s.slimcoreCallId,t,S.mapToEmptyStrIfFalsy(e),S.mapToEmptyStrIfFalsy(n.threadId),S.mapToEmptyStrIfFalsy(n.messageId),S.mapToEmptyStrIfFalsy(o)),a})).catch((function(t){throw s._callTelemetry.updateOperationData(p.CALL_OPERATIONS.NUDGE_PARTICIPANTS,{error:M.getPIISafeObject(t)},r,e),s._participantOperationHandler.rejectOperation(p.CALL_OPERATIONS.NUDGE_PARTICIPANTS,38,e,r),i.logFailure("Error in NudgeParticipants(), callId = "+s.callId+", context = "+e+", error = "+t),t}))]}))}))},t.prototype._handleParticipantOperationFailure=function(e,t,n,r){this._callTelemetry.updateOperationData(e,{error:M.getPIISafeObject(t)},n,r);var i=O.convertFailureReasonToParticipantReason(t),o={callId:this.callId,reason:i},a=this._getOrCreateParticipant(r,n);return a.callEndDiagnosticsInfo&&(o.code=a.callEndDiagnosticsInfo.callControllerCode,o.subCode=a.callEndDiagnosticsInfo.callControllerSubCode),this._callTelemetry.recordOperationFailure(e,o,r,n),i},t.prototype.updateMeetingRoles=function(e,t,n){return void 0===n&&(n=D.generateCauseId()),c(this,void 0,void 0,(function(){var r,i,o=this;return l(this,(function(a){return(r=this._logger.createFnLogger(p.CALL_OPERATIONS.UPDATE_MEETING_ROLE,n)).info("updateMeetingRole: participants = "+v.scrubMriOrOmitList(e)+", role = "+t),2!==this.state&&3!==this.state||!S.hasFeature(N.Feature.StructuredMeetings)?[2,Promise.reject({code:y.CONSTANTS.CODE.CLIENT_ERROR_CODE,subCode:y.CONSTANTS.SUB_CODE.ACTION_NOT_ALLOWED,phrase:"ActionNotAllowed"})]:(i=this._participantOperationHandler.waitForOperation(p.CALL_OPERATIONS.UPDATE_MEETING_ROLE,n),[2,Promise.resolve().then((function(){return o._slimcoreCallHandler.updateMeetingRoles(o.slimcoreCallId,e,t,n),i})).catch((function(e){throw r.logFailure("Error in UpdateMeetingRoles(), callId = "+o.callId+", error = "+e),o._callTelemetry.updateOperationData(p.CALL_OPERATIONS.UPDATE_MEETING_ROLE,{error:M.getPIISafeObject(e)},n),o._participantOperationHandler.rejectOperation(p.CALL_OPERATIONS.UPDATE_MEETING_ROLE,38,n,n),e}))])}))}))},t.prototype.addParticipant=function(e,t,n){return void 0===t&&(t={}),void 0===n&&(n=D.generateCauseId()),c(this,void 0,void 0,(function(){var r,i,o,a,s,c=this;return l(this,(function(l){if(r=this._logger.createFnLogger(p.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,n),this.isEmergency&&0===this.slimcoreCallId&&0!==this.participants.length)return[2,Promise.reject(new Error("Only 1 participant (the emergency operator) may be added to unstarted emergency calls"))];if(t.sipUri&&r.logFailure("sipUri not supported yet"),t.participantInvitationData)try{i=JSON.stringify(t.participantInvitationData)}catch(e){throw r.logFailure(e),e}return r.info("participantId = "+v.scrubMriOrOmit(e)+" threadId = "+t.threadId+" messageId = "+t.messageId+" participantInvitationData = "+v.scrubMriOrOmit(i)),o=this._getOrCreateParticipant(e,n),0===this.slimcoreCallId||-1===[0,4].indexOf(o.state)?[2,Promise.resolve(o)]:(a=this._participantOperationHandler.waitForOperation(p.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,o.id),s=Promise.resolve().then((function(){return c._addParticipantToCall(o,n)})).then((function(){return c._addParticipantToSlimCoreElectronCall(o.id,t.threadId,t.messageId,i)})).then((function(e){return o.attachSlimcoreObjectId(e,n)})).catch((function(t){return c._callTelemetry.updateOperationData(p.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,{error:M.getPIISafeObject(t)},n,e),r.logFailure(t),Promise.reject(1)})).then((function(){return a})).then((function(){return o})).catch((function(t){return r.logFailure(t),c._handleParticipantOperationFailure(p.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,t,n,e),c._handleParticipantRemoved(e,n,t),Promise.reject(t)})),this.raiseChanged(),[2,s])}))}))},t.prototype.addParticipants=function(e,t,n){return void 0===t&&(t={}),void 0===n&&(n=D.generateCauseId()),c(this,void 0,void 0,(function(){var r,i,o,a,s,c,u=this;return l(this,(function(l){if(r=this._logger.createFnLogger(p.PARTICIPANT_OPERATIONS.ADD_PARTICIPANTS,n),this.isEmergency&&0===this.slimcoreCallId&&(0!==this.participants.length||1!==e.length))return[2,Promise.reject(new Error("Only 1 participant (the emergency operator) may be added to unstarted emergency calls"))];if(t.participantInvitationData)try{i=JSON.stringify(t.participantInvitationData)}catch(e){throw r.logFailure(e),e}return r.info("threadId = "+t.threadId+" messageId = "+t.messageId+" participantInvitationData = "+v.scrubMriOrOmit(i)),o=[],a=[],s=[],c=[0,4],e.forEach((function(e){var t=u._getOrCreateParticipant(e,n);0===u.slimcoreCallId?s.push(Promise.resolve(t)):-1!==c.indexOf(t.state)?(o.push(t),a.push(e),u._addParticipantToCall(t,n),s.push(u._participantOperationHandler.createPendingOperation(p.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,t.id,n))):u._participantOperationHandler.hasPendingOperation(p.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,t.id)?s.push(u._participantOperationHandler.waitForOperation(p.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT,t.id)):s.push(Promise.resolve(t))})),0===o.length?[2,Promise.resolve(s)]:[2,Promise.resolve().then((function(){return u._slimcoreCallHandler.addParticipantsToCall(u.slimcoreCallId,a,S.mapToEmptyStrIfFalsy(t.threadId),S.mapToEmptyStrIfFalsy(t.messageId),S.mapToEmptyStrIfFalsy(i),void 0!==t.disableUnmute&&t.disableUnmute,n)})).then((function(e){if(!e||0===e.length)throw new Error("addParticipants: participantObjectIds null or empty");for(var t=0;t<e.length;t++)o[t].attachSlimcoreObjectId(e[t],n);return s})).catch((function(e){return r.logFailure(e),a.forEach((function(t){u._handleParticipantRemoved(t,n,e)})),Promise.reject(1)}))]}))}))},t.prototype.removeParticipant=function(e,t,n,r){return void 0===t&&(t=D.generateCauseId()),c(this,void 0,void 0,(function(){var i,o,a,s,c,u=this;return l(this,(function(l){return(i=this._logger.createFnLogger(p.PARTICIPANT_OPERATIONS.REMOVE_PARTICIPANT,t)).info("removeParticipant: participantId = "+v.scrubMriOrOmit(e)+", endpointScope ="+r),this.participantMap.hasOwnProperty(e)&&(o=this.participantMap[e]),o&&(i.info("removeParticipant: current participant state: "+o.state),0===o.state||4===o.state)?(i.logFailure("Participant in invalid state, None or Disconnected"),[2,Promise.reject(new Error("Participant already in disconnected state"))]):(a=S.convertEndpointScope(r),r&&!a?(this._logger.error("Slimcore mapping for endpointScope failed: "+r+" => "+a),[2,Promise.reject(60)]):(s=h.defer(),c=Promise.resolve().then((function(){o?(u._assertSlimcoreObjectId(o.slimcoreObjectId,"removeParticipant"),u._slimcoreCallHandler.removeParticipant(o.slimcoreObjectId,a),o.addRemoveParticipantDeferred(s)):(u._assertSlimcoreObjectId(u.slimcoreCallId,"removeParticipantByMri"),u._slimcoreCallHandler.removeParticipantByMri(u.slimcoreCallId,e,n,a),s.resolve())})).then((function(){return S.hasFeature(N.Feature.AttendeeBlackList)||s.resolve(),s.promise})).then((function(){return i.logSuccess("removed")})).catch((function(n){return i.logFailure(n),u._handleParticipantOperationFailure(p.PARTICIPANT_OPERATIONS.REMOVE_PARTICIPANT,n,t,e),Promise.reject(n)})),this.raiseChanged(),[2,c]))}))}))},t.prototype._startTransferTargetCall=function(e,t,n){var r=this;return this._logger.info("Transfer: _startTransferTargetCall",e),this.attachSlimCoreCallObject(e,n,!1,"_startTransferTargetCall").then((function(){return r._slimcoreCallHandler.startTransferTargetCall(e,t,r.threadId,r.messageId)}))},t.prototype._getSlimCoreCallProperties=function(e){if(this._logger.info("_getSlimCoreCallProperties"),!S.isSlimCoreRTModuleAvailable())return e;try{var t=new window.SlimCoreRT.SlimCore.CallProperties;return t.audioDirection=e.audioDirection,t.videoDirection=e.videoDirection,t.screenshareDirection=e.screenshareDirection,t.datachannelDirection=e.datachannelDirection,t.muteFlags=e.muteFlags,t.mediaPeerType=e.mediaPeerType,t.isVideoEnabled=e.isVideoEnabled,t.isGoLive=e.isGoLive,t.isHostless=e.isHostless,t.participantLegId=e.participantLegId,t.enableGroupCallMeetupGeneration=e.enableGroupCallMeetupGeneration,t.threadId=e.threadId,t.messageId=e.messageId,t.subject=e.subject,t.conversationType=e.conversationType,t.meetingInfo=e.meetingInfo,t.endpointMetadata=e.endpointMetadata,t.onBehalfOf=e.onBehalfOf,t.enableLightWeightMeeting=e.enableLightWeightMeeting,t.emergencyContent=e.emergencyContent,t.broadcastContext=e.broadcastContext,t.callKey=e.callKey,t.encryptedKey=e.encryptedKey,t.invitationType=e.invitationType,t.connectionType=e.connectionType,t.maxVideoChannels=e.maxVideoChannels,t.negotiationTag=e.negotiationTag,t.routingFlags=e.routingFlags,t.scenario=e.scenario,t.preheatFlags=e.preheatFlags,t.locationContent=e.locationContent,t.mediaConfigurationJson=e.mediaConfigurationJson,this._logger.info("_getSlimCoreCallProperties created RT CallProperties"),t}catch(e){this._logger.info("_getSlimCoreCallProperties failed, reverting back to property bag ",e)}return e},t.prototype._isEnterpriseMultiParty=function(e){return 5===e||10===e},t.prototype._joinOrStartSlimCoreCall=function(e,n){var r=this,i=this._logger.createFnLogger("joinOrStartSlimCoreCall",n),o=0,a=!e.ringOthers;if(e.conversationUrl||e.isExistingCallInObservingState){i.info("options: "+M.getPrintableObject(e));var s=this._getSlimCoreCallProperties({audioDirection:void 0!==e.audioDirection?t.toMediaDirection(e.audioDirection):N.MediaDirection.Bidirectional,videoDirection:void 0!==e.videoDirection?t.toMediaDirection(e.videoDirection):N.MediaDirection.ReceiveFromPeer,screenshareDirection:void 0!==e.screenshareDirection?t.toMediaDirection(e.screenshareDirection):this._isEnterpriseMultiParty(this._mediaPeerType)?N.MediaDirection.ReceiveFromPeer:N.MediaDirection.Disabled,datachannelDirection:void 0!==e.datachannelDirection?t.toMediaDirection(e.datachannelDirection):N.MediaDirection.Disabled,muteFlags:e.muteFlags,mediaPeerType:t.convertToSlimCoreMediaPeerType(this._mediaPeerType),isVideoEnabled:4===e.videoDirection,isGoLive:a,isHostless:!0,participantLegId:this.participantId,enableGroupCallMeetupGeneration:this._enableGroupCallMeetupGeneration,threadId:S.mapToEmptyStrIfFalsy(this.threadId),messageId:S.mapToEmptyStrIfFalsy(this.messageId),subject:S.mapToEmptyStrIfFalsy(e.label),conversationType:S.mapToEmptyStrIfFalsy(e.conversationType),meetingInfo:S.mapToEmptyStrIfFalsy(JSON.stringify(this._meetingInfo)),endpointMetadata:S.mapToEmptyStrIfFalsy(this._endpointMetadata),onBehalfOf:S.mapToEmptyStrIfFalsy(this.onBehalfOfMri),enableLightWeightMeeting:e.enableLightWeightMeeting,emergencyContent:S.mapToEmptyStrIfFalsy(this._emergencyContent),broadcastContext:this.broadcastMeeting&&this.broadcastMeeting.context?JSON.stringify(this.broadcastMeeting.context):null,callKey:e.callKey,encryptedKey:e.encryptedKey,invitationType:N.InvitationType.None,connectionType:t.convertConnectionType(e.connectionType),maxVideoChannels:void 0!==e.maxVideoChannels?e.maxVideoChannels:0,negotiationTag:S.mapToEmptyStrIfFalsy(e.negotiationTag),routingFlags:e.routingFlags,scenario:S.mapToEmptyStrIfFalsy(e.scenario),preheatFlags:e.preheatFlags,locationContent:S.mapToEmptyStrIfFalsy(this._locationContent),mediaConfigurationJson:S.mapToEmptyStrIfFalsy(JSON.stringify(e.mediaConfiguration))});o=this._slimcoreCallHandler.joinCall(JSON.stringify({conversationUrl:e.conversationUrl,conversationId:this.callId,conversationType:e.conversationType}),s),this._assertSlimcoreObjectId(o,"JoinCall"),i.logSuccess("slimcoreCallHandler.JoinCall()")}else if(e.callToVoicemail){if(i.info("Calling slimcoreCallHandler.PlaceCallToVoicemail"),1!==this.participants.length)throw new Error("PlaceCallToVoicemail Failed. Participant size should be one");this._addParticipantToCall(this.participants[0],n),o=this._slimcoreCallHandler.placeCallToVoicemail(this.callId,t.convertToSlimCoreMediaPeerType(this._mediaPeerType),this.participants[0].id,{threadId:this.threadId,voicemailResourcePath:e.voicemailResourcePath,voicemailItemId:e.voicemailItemId}),this._assertSlimcoreObjectId(o,"PlaceCallToVoicemail"),i.logSuccess("slimcoreCallHandler.PlaceCallToVoicemail()")}else if(void 0!==e.parkContext&&void 0!==e.pickupCode){var c=this.mapParkContext(e.parkContext);this._setCallType(1),s=this._getSlimCoreCallProperties({audioDirection:void 0!==e.audioDirection?t.toMediaDirection(e.audioDirection):N.MediaDirection.Bidirectional,videoDirection:void 0!==e.videoDirection?t.toMediaDirection(e.videoDirection):N.MediaDirection.ReceiveFromPeer,screenshareDirection:N.MediaDirection.Disabled,datachannelDirection:void 0!==e.datachannelDirection?t.toMediaDirection(e.datachannelDirection):N.MediaDirection.Disabled,muteFlags:e.muteFlags,mediaPeerType:t.convertToSlimCoreMediaPeerType(this._mediaPeerType),isVideoEnabled:4===e.videoDirection,isGoLive:a,isHostless:!0,participantLegId:this.participantId,enableGroupCallMeetupGeneration:this._enableGroupCallMeetupGeneration,threadId:S.mapToEmptyStrIfFalsy(this.threadId),messageId:S.mapToEmptyStrIfFalsy(this.messageId),subject:S.mapToEmptyStrIfFalsy(e.label),conversationType:S.mapToEmptyStrIfFalsy(e.conversationType),meetingInfo:S.mapToEmptyStrIfFalsy(JSON.stringify(this._meetingInfo)),endpointMetadata:S.mapToEmptyStrIfFalsy(this._endpointMetadata),onBehalfOf:S.mapToEmptyStrIfFalsy(this.onBehalfOfMri),enableLightWeightMeeting:e.enableLightWeightMeeting,emergencyContent:S.mapToEmptyStrIfFalsy(this._emergencyContent),broadcastContext:this.broadcastMeeting&&this.broadcastMeeting.context?JSON.stringify(this.broadcastMeeting.context):null,callKey:e.callKey,encryptedKey:e.encryptedKey,connectionType:t.convertConnectionType(e.connectionType),invitationType:e.invitationType,maxVideoChannels:void 0!==e.maxVideoChannels?e.maxVideoChannels:0,routingFlags:e.routingFlags,negotiationTag:S.mapToEmptyStrIfFalsy(e.negotiationTag),scenario:S.mapToEmptyStrIfFalsy(e.scenario),locationContent:S.mapToEmptyStrIfFalsy(this._locationContent),mediaConfigurationJson:S.mapToEmptyStrIfFalsy(JSON.stringify(e.mediaConfiguration))}),o=this._slimcoreCallHandler.startCallUnpark(this.callId,s,c,e.pickupCode),this._assertSlimcoreObjectId(o,"StartCallUnpark"),i.logSuccess("slimcoreCallHandler.StartCallUnpark()")}else{i.info("Calling slimcoreCallHandler.PlaceCall");var l=[];e.invitationType===N.InvitationType.Nudge&&e.participantsToNudge?l=e.participantsToNudge:this.participants.forEach((function(e){r._addParticipantToCall(e,n),l.push(e.id)}));var u=!!this.threadId||1!==l.length;this._setCallType(u?2:1),s=this._getSlimCoreCallProperties({audioDirection:void 0!==e.audioDirection?t.toMediaDirection(e.audioDirection):N.MediaDirection.Bidirectional,videoDirection:void 0!==e.videoDirection?t.toMediaDirection(e.videoDirection):N.MediaDirection.ReceiveFromPeer,screenshareDirection:void 0!==e.screenshareDirection?t.toMediaDirection(e.screenshareDirection):2===this.callType&&this._isEnterpriseMultiParty(this._mediaPeerType)?N.MediaDirection.ReceiveFromPeer:N.MediaDirection.Disabled,datachannelDirection:void 0!==e.datachannelDirection?t.toMediaDirection(e.datachannelDirection):N.MediaDirection.Disabled,muteFlags:e.muteFlags,mediaPeerType:t.convertToSlimCoreMediaPeerType(this._mediaPeerType),isVideoEnabled:4===e.videoDirection,isGoLive:a,isHostless:!0,participantLegId:this.participantId,enableGroupCallMeetupGeneration:this._enableGroupCallMeetupGeneration,threadId:S.mapToEmptyStrIfFalsy(this.threadId),messageId:S.mapToEmptyStrIfFalsy(this.messageId),subject:S.mapToEmptyStrIfFalsy(e.label),conversationType:S.mapToEmptyStrIfFalsy(e.conversationType),meetingInfo:S.mapToEmptyStrIfFalsy(JSON.stringify(this._meetingInfo)),endpointMetadata:S.mapToEmptyStrIfFalsy(this._endpointMetadata),onBehalfOf:S.mapToEmptyStrIfFalsy(this.onBehalfOfMri),enableLightWeightMeeting:e.enableLightWeightMeeting,emergencyContent:S.mapToEmptyStrIfFalsy(this._emergencyContent),broadcastContext:this.broadcastMeeting&&this.broadcastMeeting.context?JSON.stringify(this.broadcastMeeting.context):null,callKey:e.callKey,encryptedKey:e.encryptedKey,connectionType:t.convertConnectionType(e.connectionType),invitationType:e.invitationType,maxVideoChannels:void 0!==e.maxVideoChannels?e.maxVideoChannels:0,routingFlags:e.routingFlags,negotiationTag:S.mapToEmptyStrIfFalsy(e.negotiationTag),scenario:S.mapToEmptyStrIfFalsy(e.scenario),preheatFlags:e.preheatFlags,locationContent:S.mapToEmptyStrIfFalsy(this._locationContent),mediaConfigurationJson:S.mapToEmptyStrIfFalsy(JSON.stringify(e.mediaConfiguration))}),o=this._slimcoreCallHandler.placeCall(this.callId,l,s),this._assertSlimcoreObjectId(o,"PlaceCall"),i.logSuccess("slimcoreCallHandler.PlaceCall()")}this.attachSlimCoreCallObject(o,n,!1,"_joinOrStartSlimCoreCall"),this._callOperationHandler.maybeResolveOperation(p.CALL_OPERATIONS_INTERNAL.CALL_START_OR_JOIN_INITIATED,void 0,void 0,n)},t.prototype._fillIncomingCallProperties=function(e){var t=this._getProperties(this._slimcoreCallHandler,this.slimcoreCallId,{callQueueInfo:{propKey:N.Property.CallQueueInfo},callerMri:{propKey:N.Property.CallerMriIdentity},transferorMri:{propKey:N.Property.CallTransferorMri},transferorDisplayName:{propKey:N.Property.CallTransferorDisplayName},transferorType:{propKey:N.Property.CallTransferorType},onBehalfOfMri:{propKey:N.Property.CallOnBehalfOfMri},incomingCallType:{propKey:N.Property.CallIncomingType},consultativeTransferCallId:{propKey:N.Property.CallConsultativeTransferCallId}},{isIncomingOneOnOneVideoCall:{propKey:N.Property.CallIsIncomingOneOnOneVideoCall}});this._setCallerMri(g.stripMriAliases(t.callerMri),e),this.transferorMri=g.stripMriAliases(t.transferorMri),this.transferorDisplayName=t.transferorDisplayName,this.transferorType=t.transferorType,this.onBehalfOfMri=g.stripMriAliases(t.onBehalfOfMri),this.callQueueInfo=t.callQueueInfo&&JSON.parse(t.callQueueInfo),this.incomingCallType=t.incomingCallType,this._setConsultativeCallId(this.consultativeCallId),this.isIncomingOneOnOneVideoCall=!!t.isIncomingOneOnOneVideoCall},t.prototype._onCallPropertyChanged=function(e,t){this._onObjectPropertyChanged(this.slimcoreCallId,e,t)},t.prototype.attachSlimCoreCallObject=function(e,t,n,r){var i=this;void 0===n&&(n=!1),void 0===r&&(r="attachSlimCoreCallObject");var o=this._logger.createFnLogger("attachSlimCoreCallObject",t),a=this._callOperationHandler.getPendingOperation(p.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY),s=this.slimcoreCallId;if(this.slimcoreCallId===e)return this._callTelemetry.recordEvent(p.CALL_OPERATIONS_INTERNAL.ELECTRON_ATTACH_SLIMCORE_CALL_FAILED,{slimCoreCallObjectId:e,reason:"Call already attached to a SlimCore object"},t),o.logFailure("Call already attached to a SlimCore object"),a;0!==this.slimcoreCallId&&o.info("Call already attached to a different SlimCore object, attaching to new object"),o.info("new slimCoreCallObjectId="+e),this.slimcoreCallId=e;try{this._isOptimizedSpeakerEventingEnabled=this._slimcoreInstance.ecsGetSettingAsBool("SkypeCalling","enableOptimizedSpeakerChangeEvents",!1),this._isSetVideoChannelsRenegotiated=this._slimcoreInstance.ecsGetSettingAsBool("SkypeCalling","renegotiateVideoChannels",!1)}catch(e){o.logFailure("Assuming optimized speaker event feature is disabled via ECS."),o.logFailure(e)}this._slimCoreElectronRemoteManager=new w.default(this._logger,this._settings,this._slimcoreInstance,this._slimcoreCallHandler,this.slimcoreCallId,this.mediaStreams,this._streamContextMap,n),this._slimCoreElectronRemoteManager.changed((function(){return i.raiseChanged()})),this._onCallPropertyChanged(N.Property.CallOrigin,(function(e){return i._onCallOriginChanged(e.value)})),this._onCallPropertyChanged(N.Property.CallStatus,(function(e){return i._onCallStatusChanged(e.value)})),this._onCallPropertyChanged(N.Property.CallTransferStatus,(function(e){return i._onCallTransferStatusChanged(e.value)})),this._onCallPropertyChanged(N.Property.CallParkStatus,(function(e){return i._onCallParkStatusChanged(e.value)})),this._onCallPropertyChanged(N.Property.CallIsMuted,(function(e){return i._onCallMutedUnmuted(!!e.value)})),this._onCallPropertyChanged(N.Property.CallIsMutedSpeaker,(function(e){return i._onCallMutedUnmutedSpeaker(!!e.value)})),this._onCallPropertyChanged(N.Property.CallIsServerMuted,(function(e){return i._onCallIsServerMuted(!!e.value)})),this._onCallPropertyChanged(N.Property.CallActiveMembers,(function(e){return i._onParticipantJoinedOrRemovedDeferred()})),this._onCallPropertyChanged(N.Property.CallThreadId,(function(e){return i._onThreadIdChanged(e.value)})),this._onCallPropertyChanged(N.Property.CallMessageId,(function(e){return i._onMessageIdChanged(e.value)})),this._onCallPropertyChanged(N.Property.CallEndpointDetails,(function(e){return i._updateEndpointDetails(e.value)})),this._onCallPropertyChanged(N.Property.SelfParticipantRole,(function(e){return i._onSelfParticipantRoleChanged(e.value)})),this._onCallPropertyChanged(N.Property.SelfParticipantTenantId,(function(e){return i._onSelfParticipantTenantIdChanged(e.value)})),this._onCallPropertyChanged(N.Property.CallMeetingDetails,(function(e){return i._updateMeetingDetails(e.value)})),this._onCallPropertyChanged(N.Property.CallMemberCountChanged,(function(e){return i._onParticipantJoinedOrRemovedDeferred()})),this._onCallPropertyChanged(N.Property.CallIsConference,(function(e){return i._updateCallType(e.value,t)})),this._onCallPropertyChanged(N.Property.CallIsHostless,(function(e){return i._updateIsHostless(e.value)})),this._onCallPropertyChanged(N.Property.CallForwardingDestinationType,(function(e){return i._updateForwardingDestinationType(e.value)})),this._onCallPropertyChanged(N.Property.CallOptimalRemoteVideoCount,(function(e){return i._onCallOptimalVideoCountChanged(e.value)})),this._onCallPropertyChanged(N.Property.CallName,(function(e){return i._onCallIdChanged(e.value)})),this._onCallPropertyChanged(N.Property.CallDataChannelObjectId,(function(e){return i._updateDataChannel(e.value)})),this._onCallPropertyChanged(N.Property.CallBroadcastMetadata,(function(e){return i._onBroadcastMetadataChanged(e.value)})),this._onCallPropertyChanged(N.Property.CallProgressStatus,(function(e){return i._onCallProgressStatusChanged(e.value)})),this._onCallPropertyChanged(N.Property.CallEndDiagnosticsCode,(function(e){return i._onDiagnosticsCodeChanged(e.value)})),this._onCallPropertyChanged(N.Property.TransferDiagnosticsCode,(function(e){return i._onTransferDiagnosticsCodeChanged(e.value)})),this._onCallPropertyChanged(N.Property.CallInvitationData,(function(e){return i._updateCallInvitationData(e.value)})),this._onCallPropertyChanged(N.Property.SelfMeetingRole,(function(e){return i._updateMeetingRole(e.value)})),this._onCallPropertyChanged(N.Property.CallTransferorMri,(function(e){return i._updateTransferorMri(e.value)})),this._onCallPropertyChanged(N.Property.CallCapabilities,(function(e){return i._onCallCapabilitiesChanged(e.value)})),this._onCallPropertyChanged(N.Property.CallActiveVideoChannelCount,(function(e){return i._updateActiveVideoChannelCount(e.value)})),this._registerDisposable(this._slimcoreInstance.handle("object-property-changed",{propKey:N.Property.ContentSharingStatus},(function(e){return i._onContentSharingChanged()}))),this._registerDisposable(this._slimcoreCallHandler.handle("audio-stream-state-changed",{callObjectId:this.slimcoreCallId},(function(e){return i._onAudioStreamStateChanged(e)}))),this._registerDisposable(this._slimcoreCallHandler.handle("transfer-requested",{callObjectId:this.slimcoreCallId},(function(e){return i._onTransferRequested(e)}))),this._registerDisposable(this._slimcoreCallHandler.handle("callmeback-operation-status-changed",{callObjectId:this.slimcoreCallId},(function(e){return i._onCallMeBackOperationStatusChanged(e)}))),this._registerDisposable(this._slimcoreCallHandler.handle("unmuteself-operation-status-changed",{callObjectId:this.slimcoreCallId},(function(e){return i._onUnmuteOperationStatusChanged(e)}))),this._registerDisposable(this._slimcoreCallHandler.handle("media-negotiation-status-changed",{callObjectId:this.slimcoreCallId},(function(e){return i._onMediaNegotiationStatusChanged(e)}))),this._registerDisposable(this._slimcoreCallHandler.handle("nudge-participants-operation-status-changed",{callObjectId:this.slimcoreCallId},(function(e){return i._onNudgeParticipantOperationStatusChanged(e)}))),this._registerDisposable(this._slimcoreCallHandler.handle("update-meeting-roles-operation-status-changed",{callObjectId:this.slimcoreCallId},(function(e){return i._onUpdateMeetingRoleOperationStatusChanged(e)}))),this._registerDisposable(this._slimcoreCallHandler.handle("mute-participants-operation-status-changed",{callObjectId:this.slimcoreCallId},(function(e){return i._onMuteParticipantOperationStatusChanged(e)}))),this._registerDisposable(this._slimcoreCallHandler.handle("active-speaker-list-changed",{callObjectId:this.slimcoreCallId},(function(e){return i._onActiveSpeakerListChanged(e)}))),this._registerDisposable(this._slimcoreCallHandler.handle("dominant-speaker-list-changed",{callObjectId:this.slimcoreCallId},(function(e){return i._onDominantSpeakerListChanged(e)}))),this._registerDisposable(this._slimcoreCallHandler.handle("remote-user-events-received",{callObjectId:this.slimcoreCallId},(function(e){return i._onRemoteUserEventsReceived(e)}))),this._registerDisposable(this._slimcoreCallHandler.handle("operation-status-changed",{callObjectId:this.slimcoreCallId},(function(e){return i._onOperationStatusChanged(e)}))),this._registerDisposable(this._slimcoreInstance.handle("quality-changed",void 0,(function(e){return i._onQualityChanged(e)})));var c=this._getProperties(this._slimcoreCallHandler,this.slimcoreCallId,{callId:{propKey:N.Property.CallName},threadId:{propKey:N.Property.CallThreadId},messageId:{propKey:N.Property.CallMessageId},meetingDetails:{propKey:N.Property.CallMeetingDetails},tenantId:{propKey:N.Property.SelfParticipantTenantId},role:{propKey:N.Property.SelfParticipantRole},broadcastMetadata:{propKey:N.Property.CallBroadcastMetadata},invitationData:{propKey:N.Property.CallInvitationData},meetingRole:{propKey:N.Property.SelfMeetingRole}},{status:{propKey:N.Property.CallStatus},isConference:{propKey:N.Property.CallIsConference},isServerMuted:{propKey:N.Property.CallIsServerMuted},capabilityFlags:{propKey:N.Property.CallCapabilities},activeVideoChannelCount:{propKey:N.Property.CallActiveVideoChannelCount}});return this._updateCallType(c.isConference,t),this._onCallIdChanged(c.callId),this._onThreadIdChanged(c.threadId),this._onMessageIdChanged(c.messageId),this._onCallStatusChanged(c.status,t),this._updateMeetingDetails(c.meetingDetails),this._onSelfParticipantTenantIdChanged(c.tenantId),this._onSelfParticipantRoleChanged(c.role),this._onCallIsServerMuted(!!c.isServerMuted),this._onBroadcastMetadataChanged(c.broadcastMetadata),this._updateCallInvitationData(c.invitationData),this._updateMeetingRole(c.meetingRole),this._onCallCapabilitiesChanged(c.capabilityFlags),this._updateActiveVideoChannelCount(c.activeVideoChannelCount),this._callTelemetry.recordEvent(p.CALL_OPERATIONS_INTERNAL.ELECTRON_ATTACH_SLIMCORE_CALL,{slimCoreCallObjectId:e,oldSlimcoreCallId:s,callId:c.callId,threadId:c.threadId,messageId:c.messageId,role:c.role},t),this._onParticipantJoinedOrRemoved(t),this._callOperationHandler.resolveOperation(p.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY,void 0,void 0,void 0,!0),this._assertSlimcoreObjectId(this.slimcoreCallId,r),a},t.prototype.getStrProperty=function(e,t){return this._getStrProperty(this._slimcoreCallHandler,this.slimcoreCallId,e,S.mapToEmptyStrIfFalsy(t))},t.prototype.getIntProperty=function(e,t,n){return this._getIntProperty(this._slimcoreCallHandler,n||this.slimcoreCallId,e,t)},t.prototype._updateCallInvitationData=function(e){try{e&&(this.invitationData=JSON.parse(e),this._logger.info("_updateCallInvitationData updated: "+(this.invitationData.length>0)),this.raiseChanged())}catch(t){this._logger.info("Failed to parse invitation data. Error: "+t+", diagnosticsCode: "+e)}},t.prototype._updateCallType=function(e,t){var n=this._logger.createFnLogger("updateCallType",t,"current="+this.callType),r=0===e?1:1===e?2:-1;2!==this.callType||1!==r?(n.info("newValue: "+r),r!==this.callType&&(2===r&&this._callTelemetry.recordEvent(p.CALL_OPERATIONS_INTERNAL.CALL_ESCALATED_TO_CONFERENCE,void 0,t),this._setCallType(r),this._updateCapabilities(t),this.raiseChanged())):n.logFailure("De-escalating to P2P not allowed!")},t.prototype._updateForwardingDestinationType=function(e){e!==this.forwardingDestinationType&&(this.forwardingDestinationType=e,this.raiseChanged())},t.prototype._setupCallTelemetry=function(){this._callTelemetry=new f.default(this._logger,this._callStartTime);try{this._callTelemetry.setStackConfig({ConversationServiceUrl:this._slimcoreInstance.setupGetStr("*Lib/Call/NG/ConversationServiceUrl"),UdpTransportUrl:this._slimcoreInstance.setupGetStr("*Lib/Call/NG/UdpTransportUrl"),KeyDistributionUrl:this._slimcoreInstance.setupGetStr("*Lib/Call/NG/KeyDistributionUrl"),PotentialCallRequestUrl:this._slimcoreInstance.setupGetStr("*Lib/Call/NG/PotentialCallRequestUrl"),UploadLogUrl:this._slimcoreInstance.setupGetStr("*Lib/Call/NG/UploadLogUrl"),UdpEnabled:this._slimcoreInstance.setupGetStr("*Lib/Call/NG/UdpEnabled"),SlimCoreVersion:SlimCore.getVersion()})}catch(e){this._logger.info("Failed to log stack config")}},t.prototype._updateDataChannel=function(e){if(this._logger.info("_updateDataChannel()"),e){this._dataChannel&&this._dataChannel.dispose();var t=void 0;try{t=this._slimcoreInstance.getDataChannel(e)}catch(e){return this._logger.error("failed to get data channel: "+e),void this._callOperationHandler.maybeRejectOperation(p.CALL_OPERATIONS_INTERNAL.ELECTRON_DATA_CHANNEL_CREATED)}this._dataChannel=new u.default(this._logger,this._settings,this._slimcoreInstance,this,this._slimcoreCallHandler,t,this._dataChannelUsers,e),this._dataChannel.setAdapterSourceSinkCallback(this.dataChannelAdapter.setInternalSourceSink),this._callOperationHandler.maybeResolveOperation(p.CALL_OPERATIONS_INTERNAL.ELECTRON_DATA_CHANNEL_CREATED),this._logger.info("Data channel set")}},t.prototype.mapDataChannelSourceIdToParticipant=function(e){var t=null;return(t=1===this.callType?this.participants[0]:d.find(this.participants,(function(t){return t.hasSourceId(4,e)})))&&t.id?this._logger.info("ParticipantId: "+v.scrubMriOrOmit(t.id)+" to SourceId: "+e):this._logger.warn("No Participant found for SourceId: "+e),t},t.prototype._onAudioStreamStateChanged=function(e){this.event("mediaStreamStateChanged").raise(),e.direction===SlimCore.Enums.MediaDirection.ReceiveFromPeer&&(this.isAudioStreamConnected=e.streamState===SlimCore.Enums.MediaStreamState.StreamInactive||e.streamState===SlimCore.Enums.MediaStreamState.StreamActive),e.streamState===SlimCore.Enums.MediaStreamState.StreamFail&&this.event("mediaConnectionFailed").raise()},t.prototype._onTransferRequested=function(e){var t=this;this._logger.info("Transfer: _onTransferRequested",e);var n,r=this.getIntProperty(N.Property.CallOrigin,N.OriginType.Unspecified,e.targetCallObjectId);r===N.OriginType.Park?n=1:r===N.OriginType.Transfer?n=0:r===N.OriginType.TransferToVoicemail?n=2:this._logger.info("Unkown transfer type based on new call origin"),this._logger.info("onTransferRequested newCallOrigin="+r+" transferType="+n);var i={transferorMri:e.transferorMri,targetMri:e.transferTargetMri,transferType:n,context:{newCallObjectId:e.targetCallObjectId}};this.event("transferRequested").raise({transferContext:i,onCompleted:function(e){t._logger.debug("Transfer: transferCompleted called: "+e),1!==e&&t._slimcoreCallHandler.leaveCall(i.context.newCallObjectId)}})},t.prototype._operationStatusChanged=function(e,t,n){this._logger.info("["+e+"][OperationStatusChanged]: "+n);var r=n.causeId||D.generateCauseId();if(e.hasPendingOperation(t)){var i={reason:O.convertFailureReasonToParticipantReason(n.failureReason)};i.code=n.code,i.subCode=n.subCode,i.phrase=n.phrase,this._callTelemetry.updateOperationData(t,i,r)}},t.prototype._onCallMeBackOperationStatusChanged=function(e){this._operationStatusChanged(this._participantOperationHandler,p.PARTICIPANT_OPERATIONS.CALL_ME_BACK,e);var t=O.convertFailureReasonToParticipantReason(e.failureReason),n={code:e.code,subCode:e.subCode,phrase:e.phrase};n.failureReason=t,e.failureReason===N.ParticipantFailureReason.NoFailure||this._participantOperationHandler.rejectOperation(p.PARTICIPANT_OPERATIONS.CALL_ME_BACK,n,e.participantMri,e.causeId)},t.prototype._onUnmuteOperationStatusChanged=function(e){this._operationStatusChanged(this._callOperationHandler,p.CALL_OPERATIONS.UNMUTE,e);var n=D.generateCauseId(),r=t.convertParticipantReasonToTerminatedReason(O.convertFailureReasonToParticipantReason(e.failureReason));e.operationResult===N.OperationResultCode.Success?this._callOperationHandler.resolveOperation(p.CALL_OPERATIONS.UNMUTE,r,void 0,n):this._callOperationHandler.rejectOperation(p.CALL_OPERATIONS.UNMUTE,r,void 0,n)},t.prototype._onNudgeParticipantOperationStatusChanged=function(e){this._operationStatusChanged(this._participantOperationHandler,p.CALL_OPERATIONS.NUDGE_PARTICIPANTS,e);var t=D.generateCauseId(),n=O.convertFailureReasonToParticipantReason(e.failureReason);e.failureReason===N.ParticipantFailureReason.NoFailure?this._participantOperationHandler.resolveOperation(p.CALL_OPERATIONS.NUDGE_PARTICIPANTS,n,e.context,t):this._participantOperationHandler.rejectOperation(p.CALL_OPERATIONS.NUDGE_PARTICIPANTS,n,e.context,t)},t.prototype._onUpdateMeetingRoleOperationStatusChanged=function(e){this._operationStatusChanged(this._participantOperationHandler,p.CALL_OPERATIONS.UPDATE_MEETING_ROLE,e);var t={code:e.code,subCode:e.subCode,phrase:e.phrase};0===t.code&&0===t.subCode?this._participantOperationHandler.resolveOperation(p.CALL_OPERATIONS.UPDATE_MEETING_ROLE,t,e.causeId,e.causeId):this._participantOperationHandler.rejectOperation(p.CALL_OPERATIONS.UPDATE_MEETING_ROLE,t,e.causeId,e.causeId)},t.prototype._onMuteParticipantOperationStatusChanged=function(e){this._operationStatusChanged(this._callOperationHandler,p.CALL_OPERATIONS.MUTE_PARTICIPANTS,e);var t={code:e.code,subCode:e.subCode,phrase:e.phrase};0===t.code&&0===t.subCode?this._callOperationHandler.resolveOperation(p.CALL_OPERATIONS.MUTE_PARTICIPANTS,t,e.causeId,e.causeId):this._callOperationHandler.rejectOperation(p.CALL_OPERATIONS.MUTE_PARTICIPANTS,t,e.causeId,e.causeId)},t.prototype._onActiveSpeakerListChanged=function(e){for(var t={},n=0,r=e.activeSpeakers?Array.from(e.activeSpeakers):[];n<r.length;n++)t[r[n]]=1;for(var i=0,o=this.participants;i<o.length;i++){var a=o[i];a.setVoiceLevel(t[a.id]||0)}this._logger.debug("_onActiveSpeakerListChanged: number of active speakers "+Object.keys(t).length)},t.prototype._onDiagnosticsCodeChanged=function(e){if(this._rawCallEndDiagnosticsInfo!==e&&e&&!d.isEmpty(e)){this._logger.info("_onDiagnosticsCodeChanged diagnosticsCode: "+e);try{this._rawCallEndDiagnosticsInfo=e,this.callEndDiagnosticsInfo=JSON.parse(e),this.raiseChanged()}catch(t){this._logger.info("Failed to parse raw diagnostis details. Error: "+t+", diagnosticsCode: "+e)}}},t.prototype._onTransferDiagnosticsCodeChanged=function(e){if(this._rawTransferDiagnosticsInfo!==e&&e&&!d.isEmpty(e)){this._logger.info("_onTransferDiagnosticsCodeChanged: "+e);try{this._rawTransferDiagnosticsInfo=e,this.transferDiagnosticsInfo=JSON.parse(e),this.raiseChanged()}catch(t){this._logger.info("Failed to parse raw diagnostis details. Error: "+t+", diagnosticsCode: "+e)}}},t.prototype._onDominantSpeakerListChanged=function(e){this.dominantSpeakerInfo.speakerList=e.dominantSpeakers?Array.from(e.dominantSpeakers):[],this._logger.info("_onDominantSpeakerListChanged: number of dominant speakers "+this.dominantSpeakerInfo.speakerList.length),this.raiseChanged()},t.prototype._onRemoteUserEventsReceived=function(e){this.event("remoteUserEventsReceived").raise(e.participantId,e.events)},t.prototype._updateCallLegIdChanged=function(e){this.participantId!==e&&(this._logger.info("updateCallLegIdChanged: new value is "+e),this._setParticipantId(e),this.event("callLegIdChanged").raise(e),this.raiseChanged())},t.prototype._onOperationStatusChanged=function(e){var t;this._logger.info("_onOperationStatusChanged: eventData "+JSON.stringify(e,null,4));try{t=JSON.parse(e.result)}catch(e){return void this._logger.info("_onOperationStatusChanged: exception when parsing result "+e)}if(t){for(var n in t)if(n&&t.hasOwnProperty(n))for(var r in t[n])if(r&&t[n].hasOwnProperty(r)){var i=t[n][r];this._callTelemetry.updateOperationData(p.CALL_OPERATIONS.MERGE_WITH_PICKUP_CODE,i,n,r),0===i.code&&0===i.subCode?this._callOperationHandler.maybeResolveOperation(p.CALL_OPERATIONS.MERGE_WITH_PICKUP_CODE,i,r,n):this._callOperationHandler.maybeRejectOperation(p.CALL_OPERATIONS.MERGE_WITH_PICKUP_CODE,i,r,n)}}else this._logger.info("_onOperationStatusChanged: not a valid object "+t)},t.prototype._updateIsHostless=function(e){var t=1===e;this.isHostless!==t&&(this._logger.info("_updateIsHostless: new value is "+t),this.isHostless=t,this.raiseChanged())},t.prototype._onCallOptimalVideoCountChanged=function(e){this._logger.info("_onCallOptimalVideoCountChanged "+e),e!==this.optimalVideoCount&&(this.optimalVideoCount=e,this.raiseChanged())},t.prototype._onCallIdChanged=function(e){this._logger.info("_onCallIdChanged "+e),e!==this.callId&&(this._setCallId(e),this.event("callIdChanged").raise(this.callId),this.raiseChanged())},t.prototype._setCallId=function(e){this.callId=e,this._callTelemetry.setCallId(this.callId)},t.prototype._setParticipantId=function(e){this.participantId=e,this._callTelemetry.setParticipantId(this.participantId)},t.prototype._setConsultativeCallId=function(e){this.consultativeCallId=e,this._callTelemetry.setConsultativeCallId(this.consultativeCallId)},t.prototype._onCallTransferStatusChanged=function(e){var t=D.generateCauseId();this._logger.info("["+t+"]onCallTransferStatusChanged status: "+e+" ("+N.CallStatus[e]+")"),this._callOperationHandler.hasPendingOperation(p.CALL_OPERATIONS_INTERNAL.CALL_TRANSFER_IN_PROGRESS)&&(e===N.CallStatus.Transferring?this._setTransferState(2,t):e===N.CallStatus.Transferred?this._setTransferState(3,t):e===N.CallStatus.Failed&&this._setTransferState(4,t))},t.prototype._onCallParkStatusChanged=function(e){var t=D.generateCauseId();this._logger.info("["+t+"]_onCallParkStatusChanged status: "+e+" ("+N.CallStatus[e]+")"),this._callOperationHandler.hasPendingOperation(p.CALL_OPERATIONS_INTERNAL.CALL_TRANSFER_IN_PROGRESS)&&(e===N.CallStatus.Parking?this._setParkState(2,t):e===N.CallStatus.Parked?this._setParkState(3,t):e===N.CallStatus.Failed&&this._setParkState(4,t))},t.prototype._onCallStatusChanged=function(e,n){var r=this;void 0===n&&(n=D.generateCauseId());var i=this._logger.createFnLogger("onCallStatusChanged",n);if(i.info("new status="+e+", mapped to=("+N.CallStatus[e]+")"),this._updateCallLegIdChanged(this.getStrProperty(N.Property.CallLegId)),this._callTelemetry.recordEvent(p.CALL_OPERATIONS_INTERNAL.SIGNALING_STATE_CHANGED,{status:e,statusToEnum:N.CallStatus[e]},n),t.isCallConnecting(e))this._setCallState(2,n);else if(t.isCallPreheating(e))i.info("status=Preheating"),this._setCallState(11,n);else if(t.isCallEarlyMedia(e))i.info("status=EarlyMedia"),this._setCallState(9,n);else if(t.isCallRinging(e))i.info("status=Ringing"),this.participants.forEach((function(e){return e.setState(2,n)})),this._updateCallType(this.getIntProperty(N.Property.CallIsConference),n);else if(t.isCallInLobby(e))this._callIsSetupComplete=!0,i.info("status=InLobby"),this._setCallState(10,n),this.participants.forEach((function(e){return e.setState(7,n)})),this._updateCallType(this.getIntProperty(N.Property.CallIsConference),n),this._callOperationHandler.maybeResolveOperation(p.CALL_OPERATIONS.HOLD,void 0,void 0,n),this._callOperationHandler.maybeResolveOperation(p.CALL_OPERATIONS.UNHOLD,void 0,void 0,n),this._callOperationHandler.maybeResolveOperation(p.CALL_OPERATIONS_INTERNAL.CONNECT_CALL,void 0,void 0,n),this._callOperationHandler.maybeResolveOperation(p.CALL_OPERATIONS.JOIN_PREHEATED_CALL,void 0,void 0,n),this._reportTsCallingTelemetry(!0);else if(t.isCallPreheated(e))i.info("status=Preheated"),this._setCallState(12,n),this._updateIsHostless(this.getIntProperty(N.Property.CallIsHostless)),this._updateCallType(this.getIntProperty(N.Property.CallIsConference),n),this._updateEndpointDetails(this.getStrProperty(N.Property.CallEndpointDetails)),this._callOperationHandler.maybeResolveOperation(p.CALL_OPERATIONS_INTERNAL.CONNECT_CALL,void 0,void 0,n);else if(t.isCallConnected(e))this._callIsSetupComplete=!0,i.info("status=Connected"),this._setCallState(3,n),this._updateIsHostless(this.getIntProperty(N.Property.CallIsHostless)),this._updateCallType(this.getIntProperty(N.Property.CallIsConference),n),this._updateEndpointDetails(this.getStrProperty(N.Property.CallEndpointDetails)),this._onCallMutedUnmuted(!!this.getIntProperty(N.Property.CallIsMuted)),this._callOperationHandler.maybeResolveOperation(p.CALL_OPERATIONS.HOLD,void 0,void 0,n),this._callOperationHandler.maybeResolveOperation(p.CALL_OPERATIONS.UNHOLD,void 0,void 0,n),this._callOperationHandler.maybeResolveOperation(p.CALL_OPERATIONS_INTERNAL.CONNECT_CALL,void 0,void 0,n),this._callOperationHandler.maybeResolveOperation(p.CALL_OPERATIONS.JOIN_PREHEATED_CALL,void 0,void 0,n),this._reportTsCallingTelemetry(!0);else if(t.isObserving(e))this._callOperationHandler.maybeResolveOperation(p.CALL_OPERATIONS.SUBSCRIBE,void 0,void 0,n);else if(e===N.CallStatus.LocalHold)i.info("status=LocalHold"),this._setCallState(4,n),this._callOperationHandler.maybeResolveOperation(p.CALL_OPERATIONS.HOLD,void 0,void 0,n),this._callOperationHandler.maybeResolveOperation(p.CALL_OPERATIONS.UNHOLD,void 0,void 0,n);else if(e===N.CallStatus.RemoteHold)i.info("status=RemoteHold"),this._setCallState(5,n),this._callOperationHandler.maybeResolveOperation(p.CALL_OPERATIONS.HOLD,void 0,void 0,n),this._callOperationHandler.maybeResolveOperation(p.CALL_OPERATIONS.UNHOLD,void 0,void 0,n);else if(t.isCallTerminated(e)){var o=t.convertStatusToTerminatedReason(e),a=o;i.info("status=Terminated, reason="+o);var s=this.getIntProperty(N.Property.CallFailureReason),c=this.getStrProperty(N.Property.CallEndDiagnosticsCode),l=this.getIntProperty(N.Property.CallIsConference),u=this._getFirstParticipantFailureReason(i);if(e!==N.CallStatus.Failed&&e!==N.CallStatus.Dropped&&s!==N.ParticipantFailureReason.CallNotFound||(a=this._getTerminatedReason(s,o)),8===this.state&&(this._callOperationHandler.hasPendingOperation(p.CALL_OPERATIONS.START_CALL)||this._callOperationHandler.hasPendingOperation(p.CALL_OPERATIONS.JOIN_CALL)))return this.slimcoreCallId=0,this._callOperationHandler.maybeRejectOperation(p.CALL_OPERATIONS.SUBSCRIBE,a,void 0,n),void i.info("Subscribe failed, there is pending start/join operation, ignore call end message");this._callTelemetry.recordEvent(p.CALL_OPERATIONS_INTERNAL.CALL_TERMINATION_INFO,{terminatedReasonFromStatus:o,slimcoreCallFailureReason:s,firstParticipantFailureReason:u,finalReason:a,slimcoreCallType:l},n),i.info("status=Terminated, statusToReason="+o+", slimcoreCallFailureReason="+s+", finalReason="+a),this._callOperationHandler.maybeRejectOperation(p.CALL_OPERATIONS_INTERNAL.CONNECT_CALL,a,void 0,n),this._callOperationHandler.maybeResolveOperation(p.CALL_OPERATIONS_INTERNAL.CALL_ENDED,a,void 0,n),this._setCallState(7,n,a,c),this.participants.forEach((function(e){return e.setState(4,n)})),this._updateDominantSpeakerList(),this.disconnectingPromise=this.cleanUp(n).catch((function(e){i.logFailure("Error when cleaning up the call, callId = "+r.callId+", error = "+e)}))}this.raiseChanged()},t.prototype._reportTsCallingTelemetry=function(e){return c(this,void 0,void 0,(function(){var t;return l(this,(function(n){switch(n.label){case 0:return e&&this.setupTelemetryReported||!e&&this.inCallTelemetryReported?[2]:[4,this.connectCallPromise.catch(k.noop)];case 1:return n.sent(),t=e?"skypecosi_concore_native_ts_calling_call_setup_session":"skypecosi_concore_native_ts_calling_in_call_session",this._callTelemetry.setCallEndDiagnosticInfo(this.callEndDiagnosticsInfo),this._telemetryService&&this._telemetryService.sendEvent(t,this._callTelemetry.getEvent(e)),e?(this.setupTelemetryReported=!0,this._callTelemetry.switchToInCallTelemetry()):this.inCallTelemetryReported=!0,[2]}}))}))},t.prototype._getTerminatedReason=function(e,n){if(this._isRelayWhiteListingIssue)return 53;if(!d.isUndefined(e)&&e!==N.ParticipantFailureReason.NoFailure)return t.convertParticipantReasonToTerminatedReason(O.convertFailureReasonToParticipantReason(e));if(this.participants.length){var r=d.head(this.participants).getIntProperty(N.Property.ParticipantFailureReason);return t.convertParticipantReasonToTerminatedReason(O.convertFailureReasonToParticipantReason(r))}return n||0},t.prototype._addParticipantToCall=function(e,t){e.setState(1,t),this._logger.info("["+t+"]starting adding participant to call, participantId = "+v.scrubMriOrOmit(e.id))},t.prototype._joinOrStartCall=function(e,t){return c(this,void 0,void 0,(function(){var n,r;return l(this,(function(i){switch(i.label){case 0:if(n=this._logger.createFnLogger("joinOrStartCall",t),0!==this.state&&8!==this.state)throw new Error("Trying to start a call that has already been acted on");this._setIsCast("cast"===e.conversationType),this.label=e.label,this.raiseChanged(),1==(1&e.muteFlags)&&(n.info("isMuted set to true in _joinOrStartCall"),this.isMuted=!0),2==(2&e.muteFlags)&&(n.info("isSpeakerMuted set to true in _joinOrStartCall"),this.isSpeakerMuted=!0),e.isExistingCallInObservingState=8===this.state,1==(1&e.preheatFlags)?(n.info("Call set to preheating in _joinOrStartCall"),this._setCallState(11,t)):(n.info("Call set to connecting in _joinOrStartCall"),this._setCallState(2,t)),r=this._callOperationHandler.createPendingOperation(p.CALL_OPERATIONS_INTERNAL.CONNECT_CALL,void 0,t);try{this._joinOrStartSlimCoreCall(e,t)}catch(e){throw n.logFailure("sync failure, cleaning up slimcore ready operation: error="+M.getPrintableObject(e)),this._callTelemetry.updateOperationData(p.CALL_OPERATIONS_INTERNAL.INCOMING_INITIALIZE,{error:M.getPIISafeObject(e)},t),this._callOperationHandler.rejectOperation(p.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY),this.stopInternal(t),e}return 4!==e.videoDirection?[3,2]:(n.info("Call has been started; turning on video"),[4,this.startVideoSafe(t)]);case 1:i.sent(),i.label=2;case 2:return[2,r]}}))}))},t.prototype._muteUnmute=function(e,t){var n,r=this,i=this._logger.createFnLogger("muteUnmute",t);return i.info("muteUnmute, value = "+e+" isMuted = "+this.isMuted+" isServerMuted = "+this.isServerMuted),C.callStateIsAnyOf(this.state,[11,12])?(i.logFailure("Can not mute/unmute during preheat call"),Promise.reject(60)):(n=e?this._callOperationHandler.waitForOperation(p.CALL_OPERATIONS.MUTE):this._callOperationHandler.waitForOperation(p.CALL_OPERATIONS.UNMUTE),Promise.resolve().then((function(){return r._slimcoreCallHandler.callMute(r.slimcoreCallId,e)})).then((function(){return n})).catch((function(e){throw i.logFailure(e),e})))},t.prototype._muteUnmuteSpeaker=function(e,t){var n,r=this,i=this._logger.createFnLogger("muteUnmuteSpeaker",t);return i.info("muteUnmuteSpeaker, value = "+e+" isSpeakerMuted = "+this.isSpeakerMuted),n=e?this._callOperationHandler.waitForOperation(p.CALL_OPERATIONS.MUTE_SPEAKER):this._callOperationHandler.waitForOperation(p.CALL_OPERATIONS.UNMUTE_SPEAKER),Promise.resolve().then((function(){return r._slimcoreCallHandler.callMuteSpeaker(r.slimcoreCallId,e)})).then((function(){return n})).then((function(){return r._setMutedSpeaker(e,t)})).catch((function(e){throw i.logFailure(e),e}))},t.prototype._muteParticipants=function(e,n,r){var i=this,o=t.convertMuteScope(e),a=this._logger.createFnLogger("muteParticipants",r);if(void 0===o)return a.logFailure("Unrecognized "+e),Promise.reject(new Error("Unrecognized muteScope"));if(C.callStateIsAnyOf(this.state,[11,12]))return a.logFailure("Can not mute/unmute during preheat call"),Promise.reject(60);var s=[];n.forEach((function(e){s.push(e.id)}));var c=this._callOperationHandler.waitForOperation(p.CALL_OPERATIONS.MUTE_PARTICIPANTS,"",r);return Promise.resolve().then((function(){return i._slimcoreCallHandler.callMuteParticipants(i.slimcoreCallId,o,s,r),S.hasFeature(N.Feature.AttendeeBlackList)?c:i._callOperationHandler.resolveOperation(p.CALL_OPERATIONS.MUTE_PARTICIPANTS,null,r,r).then()})).catch((function(e){throw a.logFailure("mute participants failed with "+e),e}))},t.prototype._holdUnhold=function(e,t,n){return c(this,void 0,void 0,(function(){var r,i,o;return l(this,(function(a){switch(a.label){case 0:if(r=4===this.state,(i=this._logger.createFnLogger("holdUnhold",t)).info("_holdUnhold, value: "+e+" currentState: "+r),r===e)return[2,Promise.resolve()];a.label=1;case 1:return a.trys.push([1,6,,7]),this._slimcoreCallHandler.callHold(this.slimcoreCallId,e,n),e?[4,this._callOperationHandler.waitForOperation(p.CALL_OPERATIONS.HOLD)]:[3,3];case 2:return a.sent(),[3,5];case 3:return[4,this._callOperationHandler.waitForOperation(p.CALL_OPERATIONS.UNHOLD)];case 4:a.sent(),a.label=5;case 5:return[3,7];case 6:throw o=a.sent(),i.logFailure(o),o;case 7:return[2]}}))}))},t.prototype._updateEndpointMetadata=function(e,t){var n=this,r=this._logger.createFnLogger("updateEndpointMetadata",t);return Promise.resolve().then((function(){return n._slimcoreCallHandler.callUpdateEndpointMetadata(n.slimcoreCallId,n._endpointMetadata)})).catch((function(e){throw r.logFailure(e),e}))},t.prototype._sendDtmfTone=function(e,n){var r=this,i=this._logger.createFnLogger("sendDtmfTone",n);return Promise.resolve().then((function(){var n=t.convertToSlimCoreDtmfTone(e);if(void 0===n)throw i.logFailure("Unrecognized dtmfTone"),new Error("Unrecognized dtmfTone");try{r._slimcoreCallHandler.callSendDtmf(r.slimcoreCallId,n)}catch(e){throw i.logFailure(e),e}}))},t.prototype.setMaxVideoChannels=function(e,t,n){var r=this;void 0===n&&(n=D.generateCauseId());var i=this._logger.createFnLogger("setMaxVideoChannels",n);return i.info("setMaxVideoChannels: "+e),Promise.resolve().then((function(){return r._slimcoreCallHandler.callSetMaxVideoChannels(r.slimcoreCallId,e,t,n),r._isSetVideoChannelsRenegotiated?r._callOperationHandler.waitForOperation(p.CALL_OPERATIONS.SET_MAX_VIDEO_CHANNELS):Promise.resolve()})).catch((function(e){throw i.logFailure(e),e}))},t.prototype._setAudioUsageMode=function(e,n){var r=this,i=this._logger.createFnLogger("setAudioUsageMode",n);return Promise.resolve().then((function(){var n=t.convertToSlimCoreAudioUsageMode(e);if(void 0===n)throw new Error("Unrecognized audioUsageMode");r._slimcoreCallHandler.callSetAudioUsageMode(r.slimcoreCallId,n)})).catch((function(e){throw i.logFailure(e),e}))},t.prototype._getOrCreateParticipant=function(e,t,n,r){var i,o=this,a=8===this.state;if(this.participantMap.hasOwnProperty(e)){var s=this.participantMap[e];return n&&s.attachSlimcoreObjectId(n,t,a,r),s}return this._logger.info("getOrCreateParticipant: creating new participant "+v.scrubMriOrOmit(e)+" "+n),(i=new T.default(this._logger,this._settings,this._slimcoreInstance,e,this._slimcoreCallHandler,this._streamContextMap,n,this._callTelemetry,a,r)).changed((function(){return o._participantChangedCallback(i)})),this._addParticipantEntry(i),this._monitorCallStart(),this.event("participantAdded").raise(i),this.raiseChangedDeferred(),i},t.prototype._participantChangedCallback=function(e){var t=this;e.previousId&&(this._callOperationHandler.updateOperationId(e.previousId,e.id),this._participantOperationHandler.updateOperationId(e.previousId,e.id),e.previousId=null),d.each(e.streams[1],(function(n){t._localScreenShareStream&&!t._callOperationHandler.hasPendingOperation(p.CALL_OPERATIONS.START_SCREEN_SHARING)&&n.isAvailable&&(S.forgetAndLog(t.stopScreenSharing(!0),t._logger,"ParticipantChanged: Cleaning up local screenshare because remote screenshare is running"),t.event("sharingStolen").raise()),t.screenSharingControl&&t.screenSharingControl.isScreenSharingControlEnabled()&&(t.screenSharingControl.reportSharingSessionChangeForViewer(e,n.negotiationTag),n.isActive()&&3===t.state?t.screenSharingControl.initControlForViewer(e,n.negotiationTag):t.screenSharingControl.shutdownControlForViewer(e))})),this._updateDominantSpeakerListDeferred(),this.event("participantUpdated").raise(e),this.raiseChangedDeferred()},t.prototype._setCallState=function(e,n,r,i){if(this.state!==e){var o=this._logger.createFnLogger("setCallState",n);if(o.info("currentState="+this.state+", newState="+e+", terminatedReason="+this.terminatedReason),C.validStateTransitions[this.state].indexOf(e)>=0){if(this.state=e,this._onDiagnosticsCodeChanged(i),this._callTelemetry.recordEvent(p.CALL_OPERATIONS_INTERNAL.SET_CALL_STATE,{state:e,reason:r},n),3===e)this._callGotConnected=!0,this.callHeldAt=null;else if(5!==e&&4!==e||this.callHeldAt){if(7===e){this.terminatedReason=r,this._setFailureType(t.convertTerminatedReasonToFailureType(r,this._callGotConnected,this._wasAudioStreamConnected));var a={};this.callEndDiagnosticsInfo&&(a.code=this.callEndDiagnosticsInfo.callControllerCode,a.subCode=this.callEndDiagnosticsInfo.callControllerSubCode),this._callTelemetry.updateOperationData(p.CALL_OPERATIONS_INTERNAL.SET_CALL_STATE,a,n)}}else this.callHeldAt=new Date;this.screenSharingControl&&this.screenSharingControl.isScreenSharingControlEnabled()&&this.screenSharingControl.callStateChanged(this.state),o.logSuccess("changed to "+e+", terminatedReason: "+this.terminatedReason+", failureType="+this.failureType),this._startInitialVideoIfReady(n),this._monitorCallStart(),this.event("callStateChanged").raise(),this._updateCapabilities(n),this.raiseChanged()}else this._logger.warn("invalid state transition")}},t.prototype._setVideoOn=function(e,t){this.isVideoOn!==e&&(this.isVideoOn=e,this._callTelemetry.recordEvent(p.CALL_OPERATIONS_INTERNAL.SET_LOCAL_VIDEO,{value:e},t),this.raiseChanged())},t.prototype._setScreenSharingOn=function(e,t){this.isScreenSharingOn!==e&&(this.isScreenSharingOn=e,this._callTelemetry.recordEvent(p.CALL_OPERATIONS_INTERNAL.SET_SCREEN_SHARING,{value:e},t),this.raiseChanged()),this.event("userActivityChanged").raise()},t.prototype._setMutedSpeaker=function(e,t){this.isSpeakerMuted!==e&&(this.isSpeakerMuted=e,this._callTelemetry.recordEvent(p.CALL_OPERATIONS_INTERNAL.SET_MUTED_SPEAKER,{value:e},t),this.raiseChanged())},t.prototype._monitorCallStart=function(){3===this.state&&this.participants.length&&!this.callStartedAt&&(this.callStartedAt=new Date)},t.prototype._addParticipantEntry=function(e){this.participantMap[e.id]=e,this.participants.push(e)},t.prototype._removeParticipantEntry=function(e){if(!this.participantMap.hasOwnProperty(e))return null;var t=this.participantMap[e];return delete this.participantMap[e],d.pull(this.participants,t),t&&this.raiseChanged(),t},t.prototype._onThreadIdChanged=function(e){e&&this.threadId!==e&&(this.threadId=e,this.raiseChanged())},t.prototype._onMessageIdChanged=function(e){e&&this.messageId!==e&&(this.messageId=e,this.raiseChanged())},t.prototype._onSelfParticipantRoleChanged=function(e){e!==this.role&&(this._logger.info("Role for self is set to "+e),this.role=e,this.raiseChanged())},t.prototype._updateMeetingRole=function(e){e!==this.meetingRole&&(this.meetingRole=e,this._logger.info("_updateMeetingRole: "+this.meetingRole),this.event("meetingRoleUpdated").raise(this.meetingRole),this.raiseChanged())},t.prototype._updateTransferorMri=function(e){var t=g.stripMriAliases(e);t!==this.transferorMri&&(this.transferorMri=t,this._logger.info("_transferorMri: "+this.transferorMri),this.raiseChanged())},t.prototype._updateActiveVideoChannelCount=function(e){e!==this.activeVideoChannelCount&&(this._logger.info("_updateActiveVideoChannelCount to "+e),this.activeVideoChannelCount=e,this.raiseChanged())},t.prototype._onSelfParticipantTenantIdChanged=function(e){e!==this.tenantId&&(this._logger.info("TenantId for self is set to "+e),this.tenantId=e,this.raiseChanged())},t.prototype._updateEndpointDetails=function(e){var t=this,n=D.generateCauseId();if(this._rawEndpoints!==e&&e){try{this.endpoints=JSON.parse(e),this._rawEndpoints=e,this.endpoints.endpointDetails.forEach((function(e){e.originalId&&t._participantOperationHandler.resolveOperation(p.PARTICIPANT_OPERATIONS.CALL_ME_BACK,null,e.originalId,n).catch((function(e){t._logger.error("["+n+"]Failed to update call me back participant "+e)}))}))}catch(t){this._logger.info("["+n+"]Failed to parse raw endpoint details. Error: "+t+", EndpointDetails: "+e)}this._updateCapabilities(n),this.raiseChanged()}},t.prototype._updateMeetingDetails=function(e){if(this._rawMeetingDetails!==e)try{!e||d.isEmpty(e)?this.meetingDetails=null:this.meetingDetails=JSON.parse(e),this._rawMeetingDetails=e,this.raiseChanged()}catch(t){this._logger.warn("Failed to parse the raw meeting details. Error: "+t+", MeetingDetails: "+e)}},t.prototype._onBroadcastMetadataChanged=function(e){if(e)try{this.broadcastMetadata=JSON.parse(e),this._logger.info("broadcast metadata updated"),this.broadcastMeeting&&this.broadcastMeeting.metadataChanged(e),this.raiseChanged()}catch(e){this._logger.info("broadcast metadata invalid, failed to parse")}},t.prototype._onCallProgressStatusChanged=function(e){e!==this._callProgressStatus&&(this._callProgressStatus=e,this.callProgressStatus=e,this.event("callProgressStatusChanged").raise(e))},t.prototype._getParticipantByObjectId=function(e){return d.find(this.participants,(function(t){return t.slimcoreObjectId===e}))},t.prototype._onQualityChanged=function(e){if(this._logger.info("onQualityChanged: oid="+e.objectId+", mtype="+e.mediaType+", otype="+e.objectType+", type="+e.type+", value="+e.value),!(e.mediaType!==N.MediaType.Audio&&e.mediaType!==N.MediaType.Video||e.objectType===N.ObjectType.Call&&e.objectId!==this.slimcoreCallId)){var n={type:t.convertQualityEventType(e.type),value:t.convertQualityLevel(e.value),mediaType:t.convertMediaType(e.mediaType),isLocalSource:e.objectType===N.ObjectType.Call};if(e.objectType===N.ObjectType.Participant){var r=this._getParticipantByObjectId(e.objectId);if(!r)return;n.id=r.id}n.type&&n.value&&(e.mediaType===N.MediaType.Audio&&e.type===N.QualityEventType.RelayWhiteListing?(this._isRelayWhiteListingIssue=!0,this.event("mediaConnectionWhitelistingWarning").raise(),this.event("mediaConnectionFailed").raise()):this.event("callQualityChanged").raise(n))}},t.prototype.getContentSharing=function(e){var t=this._slimcoreInstance.getContentSharing(e);return t?S.wrap(t,this._settings):null},t.prototype.createContentSharingSession=function(e,t,n,r){var i=this;return Promise.resolve().then((function(){var o=i._slimcoreCallHandler.createContentSharing(i.slimcoreCallId,e,t,n,r);if(!o)throw new Error("Failed to create ContentSharing SlimCore object");var a=i.getContentSharing(o);if(!a)throw new Error("Failed to create ContentSharing SlimCore native object");var s=new P.default(i._logger,i._settings,i._slimcoreInstance,i._slimcoreCallHandler,o,a,i._callTelemetry);return i.contentSharingSessions.push(s),i.event("contentSharingChanged").raise(),s}))},t.prototype._onContentSharingChanged=function(){var e=this,t=this._slimcoreCallHandler.getContentSharingSessions(this.slimcoreCallId),n=!1;d.remove(t,(function(t){return e._getIntProperty(e._slimcoreCallHandler,t,SlimCore.Enums.Property.ContentSharingCallId)!==e.slimcoreCallId}));var r=d.remove(this.contentSharingSessions,(function(e){return-1===d.indexOf(t,e.slimCoreContentSharingObjectId)}));d.forEach(t,(function(t){if(!d.find(e.contentSharingSessions,(function(e){return e.slimCoreContentSharingObjectId===t}))){var r=e.getContentSharing(t);if(r){var i=new P.default(e._logger,e._settings,e._slimcoreInstance,e._slimcoreCallHandler,t,r,e._callTelemetry);e.contentSharingSessions.push(i),e._logger.info("Added new content sharing session with guid "+i.contentSharingGuid),n=!0}}})),r.forEach((function(t){e._logger.info("Removed content sharing session with guid "+t.contentSharingGuid),t.setContentSharingStatus(7),t.dispose()})),(n||r.length)&&this.event("contentSharingChanged").raise()},t.prototype.raiseChangedDeferred=function(){var e=this;this._raiseChangedDefer||(this._raiseChangedDefer=d.defer((function(){delete e._raiseChangedDefer,e.raiseChanged()})))},t.prototype._onParticipantJoinedOrRemovedDeferred=function(e){var t=this;void 0===e&&(e=D.generateCauseId()),this._onParticipantJoinedOrRemovedDefer||(this._onParticipantJoinedOrRemovedDefer=d.defer((function(){delete t._onParticipantJoinedOrRemovedDefer,t._onParticipantJoinedOrRemoved(e)})))},t.prototype._updateDominantSpeakerListDeferred=function(){var e=this;this._updateDominantSpeakerListDefer||(this._updateDominantSpeakerListDefer=d.defer((function(){delete e._updateDominantSpeakerListDefer,e._updateDominantSpeakerList()})))},t.prototype.callStateCanToggleVideo=function(){return 3===this.state||4===this.state||5===this.state||10===this.state},t.prototype._startInitialVideoIfReady=function(e){return c(this,void 0,void 0,(function(){return l(this,(function(t){switch(t.label){case 0:return this.callStateCanToggleVideo()&&this._videoRequestedOnWhileConnecting?(this._logger.info("["+e+"]Call has been started; turning on video"),this._videoRequestedOnWhileConnecting=!1,[4,this.startVideoSafe(e)]):[3,3];case 1:return t.sent(),this._videoRequestedOffWhileConnecting?(this._logger.info("["+e+"]Call has been started and video turned on; turning off video"),this._videoRequestedOffWhileConnecting=!1,[4,this.stopVideo(e)]):[3,3];case 2:t.sent(),t.label=3;case 3:return[2]}}))}))},t.convertConnectionType=function(e){switch(e){case 0:return N.ConnectionType.AllSupported;case 1:return N.ConnectionType.NoDirectConnection;default:return N.ConnectionType.AllSupported}},t.convertStatusToTerminatedReason=function(e){switch(e){case N.CallStatus.Failed:return 7;case N.CallStatus.Finished:return 1;case N.CallStatus.Missed:return 9;case N.CallStatus.Refused:return 10;case N.CallStatus.Busy:return 11;case N.CallStatus.Cancelled:case N.CallStatus.Unplaced:return 12;case N.CallStatus.Dropped:return 4;case N.CallStatus.DeniedInLobby:return 55;case N.CallStatus.TimedOutInLobby:return 56;default:return 0}},t.convertParticipantReasonToTerminatedReason=function(e){switch(e){case 0:return 1;case 1:case 5:case 6:case 7:case 43:return 5;case 46:return 59;case 59:return 73;case 2:return 9;case 3:return 10;case 4:return 2;case 8:return 24;case 9:return 3;case 10:return 4;case 12:return 14;case 11:return 0;case 13:return 15;case 14:return 16;case 15:return 17;case 16:return 18;case 17:return 19;case 18:return 20;case 19:return 11;case 20:return 21;case 21:return 22;case 22:return 23;case 25:return 33;case 26:return 36;case 27:return 37;case 30:return 41;case 28:return 39;case 31:return 42;case 29:return 40;case 32:return 43;case 33:return 44;case 34:return 45;case 35:return 46;case 36:return 47;case 37:return 48;case 38:return 49;case 39:return 50;case 40:return 51;case 41:return 52;case 42:return 54;case 47:return 61;case 53:return 66;case 54:return 67;case 55:return 68;case 56:return 69;case 57:return 71;case 58:return 72;default:return 0}},t.convertTerminatedReasonToFailureType=function(e,t,n){switch(e){case 0:case 1:case 9:case 10:case 11:case 12:case 2:case 60:return 2;case 3:case 5:case 6:case 7:case 8:case 14:case 36:case 37:case 15:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 44:case 46:case 47:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 59:case 73:case 66:case 67:case 68:case 69:case 71:case 72:return 0;case 4:return t&&n?1:0;default:return 2}},t.convertToSlimCoreDtmfTone=function(e){switch(e){case 0:return N.DtmfTone.Num0;case 1:return N.DtmfTone.Num1;case 2:return N.DtmfTone.Num2;case 3:return N.DtmfTone.Num3;case 4:return N.DtmfTone.Num4;case 5:return N.DtmfTone.Num5;case 6:return N.DtmfTone.Num6;case 7:return N.DtmfTone.Num7;case 8:return N.DtmfTone.Num8;case 9:return N.DtmfTone.Num9;case 10:return N.DtmfTone.Star;case 11:return N.DtmfTone.Pound;case 12:return N.DtmfTone.A;case 13:return N.DtmfTone.B;case 14:return N.DtmfTone.C;case 15:return N.DtmfTone.D;case 16:return N.DtmfTone.Flash;default:return}},t.convertToSlimCoreAudioUsageMode=function(e){switch(e){case"Default":return N.AudioUsageMode.Default;case"LongrangeSpeaker":return N.AudioUsageMode.LongrangeSpeaker;case"Auditorium":return N.AudioUsageMode.Auditorium;default:return}},t.convertQualityEventType=function(e){switch(e){case N.QualityEventType.NetworkSendQuality:return 1;case N.QualityEventType.NetworkRecvQuality:return 2;case N.QualityEventType.NetworkDelay:return 3;case N.QualityEventType.NetworkBandwidthLow:return 4;case N.QualityEventType.NetworkReconnect:return 5;case N.QualityEventType.NetworkPacketLoss:return 6;case N.QualityEventType.NetworkJitter:return 7;case N.QualityEventType.NetworkRateMatching:return 8;case N.QualityEventType.DeviceCaptureNotFunctioning:return 9;case N.QualityEventType.DeviceRenderNotFunctioning:return 10;case N.QualityEventType.DeviceRenderGlitches:return 11;case N.QualityEventType.DeviceLowSNR:return 12;case N.QualityEventType.DeviceLowSpeechLevel:return 13;case N.QualityEventType.DeviceClipping:return 14;case N.QualityEventType.DeviceEcho:return 15;case N.QualityEventType.PresentationAudioQuality:return 16;case N.QualityEventType.DeviceHalfDuplexAec:return 17;case N.QualityEventType.DeviceMultipleEndpoints:return 18;case N.QualityEventType.DeviceHowling:return 19;case N.QualityEventType.DeviceRenderZeroVolume:return 20;case N.QualityEventType.DeviceRenderMute:return 21;case N.QualityEventType.NetworkSendCatastrophic:return 22;case N.QualityEventType.NetworkRecvCatastrophic:return 23;case N.QualityEventType.CpuInsufficient:return 24;case N.QualityEventType.DeviceCaptureMute:return 25;case N.QualityEventType.DeviceCaptureNotMuteButSilent:return 26;case N.QualityEventType.DeviceSpeakWhileMuted:return 27;case N.QualityEventType.VideoVbssRendered:return 28;case N.QualityEventType.NetworkEthernetInterfaceUsed:return 29;case N.QualityEventType.NetworkWlanInterfaceUsed:return 30;case N.QualityEventType.NetworkWwanInterfaceUsed:return 31;case N.QualityEventType.RelayWhiteListing:return 32;case N.QualityEventType.VideoCapturerDeviceStartFailed:return 33;case N.QualityEventType.VideoCapturerDeviceStartTimedOut:return 34;case N.QualityEventType.VideoCapturerDeviceStartFailureLackSystemRes:return 35;case N.QualityEventType.VideoCapturerDeviceStartFailureMFResConflict:return 36;case N.QualityEventType.ZeroCaptureDevicesEnumerated:return 43;case N.QualityEventType.ZeroRenderDevicesEnumerated:return 44;case N.QualityEventType.NoNetwork:return 37;case N.QualityEventType.NetworkNotWorking:return 38;case N.QualityEventType.DeviceCaptureNotFunctioningAudioSrvNotRunning:return 41;case N.QualityEventType.DeviceRenderNotFunctioningAudioSrvNotRunning:return 42;case N.QualityEventType.DeviceCaptureNotFunctioningDeviceInUse:return 39;case N.QualityEventType.DeviceRenderNotFunctioningDeviceInUse:return 40;case N.QualityEventType.VideoCaptureDeviceFreeze:return 45;case N.QualityEventType.AudioCapturePermissionDenied:return 46;case N.QualityEventType.VideoCapturePermissionDenied:return 47;case N.QualityEventType.VideoCaptureFreezeRecovered:return 48;case N.QualityEventType.DeviceRenderHowling:return 49;case N.QualityEventType.LowFarEndInput:return 50;case N.QualityEventType.RemoteNetworkConnectivityIssue:return 52;case N.QualityEventType.PresentationAudioLoopbackDeviceState:return 53;default:return}},t.convertQualityLevel=function(e){switch(e){case N.QualityLevel.Unknown:return 0;case N.QualityLevel.Good:return 1;case N.QualityLevel.Poor:return 2;case N.QualityLevel.Bad:return 3;default:return}},t.convertMediaType=function(e){switch(e){case N.MediaType.Audio:return 0;case N.MediaType.Video:return 1;case N.MediaType.PanoramicCamera:return 2;case N.MediaType.AppSharing:return 3;case N.MediaType.Data:return 4;default:return}},t.toMediaDirection=function(e){switch(e){case 0:return N.MediaDirection.Disabled;case 3:return N.MediaDirection.Inactive;case 2:return N.MediaDirection.SendToPeer;case 1:return N.MediaDirection.ReceiveFromPeer;case 4:return N.MediaDirection.Bidirectional;default:return N.MediaDirection.Disabled}},t.toAnswerMediaType=function(e){switch(e){case 0:return N.AnswerMediaType.AnswerWithAudioOnly;case 1:return N.AnswerMediaType.AnswerWithAudioVideo;case 2:return N.AnswerMediaType.AnswerWithScreenshareOnly;default:return N.AnswerMediaType.AnswerWithAudioOnly}},t.convertMuteScope=function(e){switch(e){case 0:return N.MuteScope.All;case 1:return N.MuteScope.Specified;default:return}},t.convertToSlimCoreMediaPeerType=function(e){switch(e){case 0:return N.MediaPeerType.ConsumerTwoParty;case 1:return N.MediaPeerType.ConsumerPstn;case 2:return N.MediaPeerType.ConsumerMultiParty;case 3:return N.MediaPeerType.EnterpriseTwoPartyOnlineOnly;case 4:return N.MediaPeerType.EnterpriseTwoPartyHybrid;case 6:return N.MediaPeerType.EnterprisePstnOnlineOnly;case 7:return N.MediaPeerType.EnterprisePstnHybrid;case 5:return N.MediaPeerType.EnterpriseMultiParty;case 8:return N.MediaPeerType.EnterpriseFederated;case 9:return N.MediaPeerType.EnterpriseUnknown;case 10:return N.MediaPeerType.EnterpriseMultiPartyBroadcasting;default:return}},t.convertPushHandlingResult=function(e){switch(e){case N.PushHandlingResult.BadNotificationPayload:return{code:0,fatal:!0};case N.PushHandlingResult.CallSetupSucceeded:return{code:1,success:!0};case N.PushHandlingResult.BadNotificationEventType:return{code:3,fatal:!0};case N.PushHandlingResult.CallSetupSucceededCallAlreadyExists:return{code:4};case N.PushHandlingResult.CallSetupFailedCannotConnect:return{code:5,fatal:!0};case N.PushHandlingResult.CallSetupFailedNoSignaling:return{code:6,fatal:!0};case N.PushHandlingResult.CallSetupFailedConflict:return{code:7};case N.PushHandlingResult.CallSetupFailedPushIgnored:return{code:8};case N.PushHandlingResult.CallSetupFailedAnsweredElsewhere:return{code:9};case N.PushHandlingResult.CallSetupFailedAlreadyEnded:return{code:10};case N.PushHandlingResult.CallSetupProgress:return{code:11,success:!0};case N.PushHandlingResult.CallSetupFailed:case N.PushHandlingResult.CallSetupFailedNoPermission:case N.PushHandlingResult.CallSetupFailedNoCommonCodec:default:return{code:2,fatal:!0}}},Object.defineProperty(t.prototype,"origin",{get:function(){return this._origin},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isAudioStreamConnected",{get:function(){return this._isAudioStreamConnected},set:function(e){this._isAudioStreamConnected!==e&&(this._isAudioStreamConnected=e,this._wasAudioStreamConnected=this._wasAudioStreamConnected||e,this.raiseChanged())},enumerable:!0,configurable:!0}),t.isCallConnected=function(e){return e===N.CallStatus.InProgress},t.isObserving=function(e){return e===N.CallStatus.Observing},t.isCallRinging=function(e){switch(e){case N.CallStatus.RingingOut:case N.CallStatus.RingingIn:return!0;default:return!1}},t.isCallConnecting=function(e){return e===N.CallStatus.Routing},t.isCallEarlyMedia=function(e){return e===N.CallStatus.EarlyMedia},t.isCallInLobby=function(e){return e===N.CallStatus.InLobby},t.isCallPreheating=function(e){return e===N.CallStatus.Preheating},t.isCallPreheated=function(e){return e===N.CallStatus.Preheated},t.isCallTerminated=function(e){switch(e){case N.CallStatus.Missed:case N.CallStatus.Refused:case N.CallStatus.Busy:case N.CallStatus.Cancelled:case N.CallStatus.Finished:case N.CallStatus.Failed:case N.CallStatus.Dropped:case N.CallStatus.DeniedInLobby:case N.CallStatus.TimedOutInLobby:return!0;default:return!1}},t.prototype._cleanCallResources=function(e){return c(this,void 0,void 0,(function(){var t,n;return l(this,(function(r){switch(r.label){case 0:t=this._logger.createFnLogger("cleanCallResources",e),r.label=1;case 1:return r.trys.push([1,,7,8]),n=d.map(this.participants,(function(e){return S.forgetAndLog(e.stopVideos(),t,"cleanCallResources: stopping participant videos failed")})),[4,Promise.all(n)];case 2:return r.sent(),this._localScreenShareStream?[4,S.forgetAndLog(this.stopScreenSharing(!1,e),t,"cleanCallResources: LocalScreenShare stop failed")]:[3,4];case 3:r.sent(),r.label=4;case 4:return this._localVideo?[4,S.forgetAndLog(this._localVideo.stop(e),t,"cleanCallResources: LocalVideo stop failed")]:[3,6];case 5:r.sent(),r.label=6;case 6:return this.contentSharingSessions.forEach((function(t){t.setContentSharingStatus(7),t.dispose(e)})),this.contentSharingSessions=[],[3,8];case 7:return this.dispose(e),[7];case 8:return[2]}}))}))},t.prototype.dispose=function(t){var n=this._logger.createFnLogger("dispose",t);n.info("start"),this.subscriptions.length&&n.info(this.subscriptions.length+" subscriptions will be lost"),this._slimCoreElectronRemoteManager&&this._slimCoreElectronRemoteManager.dispose(),this.mediaStreams[0]=[],this.mediaStreams[1]=[],this._localScreenShareStream&&(this._localScreenShareStream.dispose(t),this._localScreenShareStream=null),this._localVideo&&(this._localVideo.dispose(t),this._localVideo=null),this.screenSharingControl&&(this.screenSharingControl.dispose(),this.screenSharingControl=null),this.dataChannelAdapter&&(this.dataChannelAdapter.dispose(),this.dataChannelAdapter=null),this._dataChannel&&(this._dataChannel.dispose(),this._dataChannel=null),this._dataChannelUsers&&(this._dataChannelUsers=null),this.participants.forEach((function(e){return e.dispose()})),e.prototype.dispose.call(this,t)},t.prototype.testTriggerMediaRelayWhiteListingIssue=function(){throw new Error("testTriggerMediaRelayWhiteListingIssue not implemented in electron call")},t.prototype.testSetCallState=function(e){this._logger.info("Overwriting call state for test purposes: "+this.state+" -> "+e),this.state=e},t.prototype.addGroupModality=function(e,t){var n=this;void 0===t&&(t=D.generateCauseId());var r,i=this._logger.createFnLogger(p.CALL_OPERATIONS.ADD_GROUP_MODALITY,t);if(0===this.slimcoreCallId)return Promise.reject(new Error("call is not initialized yet"));if(e.additionalData)try{r=JSON.stringify(e.additionalData)}catch(e){throw i.logFailure(e),e}return i.info("threadId = "+e.threadId+" messageId = "+e.messageId+" additionalData = "+v.scrubMriOrOmit(r)),Promise.resolve().then((function(){return n._slimcoreCallHandler.addGroupModality(n.slimcoreCallId,e.threadId,e.messageId,r,t)})).catch((function(e){throw i.logFailure(e),e}))},t.prototype.getMediaTelemetry=function(){return Promise.reject("Not supported")},o([_.callOperation(p.CALL_OPERATIONS.INITIALIZE,{type:_.OPERATION_TYPE.SYNC}),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",void 0)],t.prototype,"init",null),o([_.callOperation(p.CALL_OPERATIONS.JOIN_CALL,{type:_.OPERATION_TYPE.CHAINED,triggerAttach:!0}),s(1,_.callStartOptions),s(2,_.causeId),a("design:type",Function),a("design:paramtypes",[Object,Object,Object]),a("design:returntype",Promise)],t.prototype,"join",null),o([_.callOperation(p.CALL_OPERATIONS.START_CALL,{type:_.OPERATION_TYPE.CHAINED,triggerAttach:!0}),s(0,_.callStartOptions),s(1,_.causeId),a("design:type",Function),a("design:paramtypes",[Object,Object]),a("design:returntype",Promise)],t.prototype,"start",null),o([_.callOperation(p.CALL_OPERATIONS.START_CALL_TO_VOICE_MAIL,{type:_.OPERATION_TYPE.CHAINED,triggerAttach:!0}),s(1,_.causeId),a("design:type",Function),a("design:paramtypes",[Object,Object]),a("design:returntype",Promise)],t.prototype,"startCallToVoicemail",null),o([_.callOperation(p.CALL_OPERATIONS.START_CALL_WITH_NUDGE,{type:_.OPERATION_TYPE.CHAINED,triggerAttach:!0}),s(1,_.callStartOptions),s(2,_.causeId),a("design:type",Function),a("design:paramtypes",[Array,Object,Object]),a("design:returntype",Promise)],t.prototype,"startCallWithNudge",null),o([_.callOperation(p.CALL_OPERATIONS.START_CALL_AND_UNPARK,{type:_.OPERATION_TYPE.CHAINED,triggerAttach:!0}),s(2,_.callStartOptions),s(3,_.causeId),a("design:type",Function),a("design:paramtypes",[Number,String,Object,Object]),a("design:returntype",Promise)],t.prototype,"startAndUnpark",null),o([_.callOperation(p.CALL_OPERATIONS.SUBSCRIBE,{type:_.OPERATION_TYPE.CHAINED,triggerAttach:!0}),s(2,_.causeId),a("design:type",Function),a("design:paramtypes",[Object,Object,Object]),a("design:returntype",Promise)],t.prototype,"joinCallWithoutCallModality",null),o([_.callOperation(p.CALL_OPERATIONS.JOIN_PREHEATED_CALL,{waitFor:p.CALL_OPERATIONS_INTERNAL.CALL_START_OR_JOIN_INITIATED}),s(1,_.causeId),a("design:type",Function),a("design:paramtypes",[Object,Object]),a("design:returntype",Promise)],t.prototype,"joinPreheatedCall",null),o([_.callOperation(p.CALL_OPERATIONS.START_VIDEO,{waitFor:p.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),s(1,_.causeId),a("design:type",Function),a("design:paramtypes",[String,Object]),a("design:returntype",Promise)],t.prototype,"startVideo",null),o([_.callOperation(p.CALL_OPERATIONS.STOP_VIDEO,{waitFor:p.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),s(1,_.causeId),a("design:type",Function),a("design:paramtypes",[String,Object]),a("design:returntype",Promise)],t.prototype,"stopVideo",null),o([_.callOperation(p.CALL_OPERATIONS_INTERNAL.START_LOCAL_VIDEO,{waitFor:p.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),s(1,_.causeId),a("design:type",Function),a("design:paramtypes",[String,String]),a("design:returntype",Promise)],t.prototype,"_startLocalVideo",null),o([_.callOperation(p.CALL_OPERATIONS.DUMP_VIDEO_SOURCE_IMAGES,{waitFor:p.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),a("design:type",Function),a("design:paramtypes",[]),a("design:returntype",Promise)],t.prototype,"dumpVideoSourceImages",null),o([_.callOperation(p.CALL_OPERATIONS.START_SCREEN_SHARING,{type:_.OPERATION_TYPE.CHAINED}),s(3,_.causeId),a("design:type",Function),a("design:paramtypes",[Object,Object,String,Object]),a("design:returntype",Promise)],t.prototype,"startScreenSharing",null),o([_.callOperation(p.CALL_OPERATIONS.STOP_SCREEN_SHARING,{type:_.OPERATION_TYPE.CHAINED}),s(2,_.causeId),a("design:type",Function),a("design:paramtypes",[Boolean,String,Object]),a("design:returntype",Promise)],t.prototype,"stopScreenSharing",null),o([_.callOperation(p.CALL_OPERATIONS.START_DATA_CHANNEL,{type:_.OPERATION_TYPE.CHAINED}),s(1,_.causeId),a("design:type",Function),a("design:paramtypes",[String,Object]),a("design:returntype",Promise)],t.prototype,"startDataChannel",null),o([_.callOperation(p.CALL_OPERATIONS.STOP_DATA_CHANNEL,{type:_.OPERATION_TYPE.CHAINED}),s(1,_.causeId),a("design:type",Function),a("design:paramtypes",[String,Object]),a("design:returntype",Promise)],t.prototype,"stopDataChannel",null),o([_.callOperation(p.CALL_OPERATIONS.SHARE_SYSTEM_SOUNDS,{waitFor:p.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),a("design:type",Function),a("design:paramtypes",[Boolean]),a("design:returntype",Promise)],t.prototype,"shareSystemSound",null),o([_.callOperation(p.CALL_OPERATIONS.BLIND_TRANSFER,{singular:!0,type:_.OPERATION_TYPE.CHAINED}),s(1,_.causeId),a("design:type",Function),a("design:paramtypes",[String,Object]),a("design:returntype",Promise)],t.prototype,"callBlindTransfer",null),o([_.callOperation(p.CALL_OPERATIONS.SAFE_TRANSFER,{singular:!0,type:_.OPERATION_TYPE.CHAINED}),s(1,_.causeId),a("design:type",Function),a("design:paramtypes",[String,Object]),a("design:returntype",Promise)],t.prototype,"callSafeTransfer",null),o([_.callOperation(p.CALL_OPERATIONS.TRANSFER_TO_VOICEMAIL,{singular:!0,type:_.OPERATION_TYPE.CHAINED}),s(1,_.causeId),a("design:type",Function),a("design:paramtypes",[Object,Object]),a("design:returntype",Promise)],t.prototype,"transferCallToVoicemail",null),o([_.callOperation(p.CALL_OPERATIONS.CONSULTATIVE_TRANSFER,{singular:!0,type:_.OPERATION_TYPE.CHAINED}),s(1,_.causeId),a("design:type",Function),a("design:paramtypes",[Object,Object]),a("design:returntype",Promise)],t.prototype,"callConsultativeTransfer",null),o([_.callOperation(p.CALL_OPERATIONS.PARK_CALL,{type:_.OPERATION_TYPE.CHAINED}),s(1,_.causeId),a("design:type",Function),a("design:paramtypes",[Number,Object]),a("design:returntype",Promise)],t.prototype,"park",null),o([_.callOperation(p.CALL_OPERATIONS.MUTE,{waitFor:p.CALL_OPERATIONS.UNMUTE}),s(0,_.causeId),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],t.prototype,"mute",null),o([_.callOperation(p.CALL_OPERATIONS.UNMUTE,{waitFor:p.CALL_OPERATIONS.MUTE}),s(0,_.causeId),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],t.prototype,"unmute",null),o([_.callOperation(p.CALL_OPERATIONS.MUTE_SPEAKER,{waitFor:p.CALL_OPERATIONS.UNMUTE_SPEAKER}),s(0,_.causeId),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],t.prototype,"muteSpeaker",null),o([_.callOperation(p.CALL_OPERATIONS.UNMUTE_SPEAKER,{waitFor:p.CALL_OPERATIONS.MUTE_SPEAKER}),s(0,_.causeId),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],t.prototype,"unmuteSpeaker",null),o([_.callOperation(p.CALL_OPERATIONS.MUTE_PARTICIPANTS,{waitFor:p.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),s(2,_.causeId),a("design:type",Function),a("design:paramtypes",[Number,Array,Object]),a("design:returntype",Promise)],t.prototype,"muteParticipants",null),o([_.callOperation(p.CALL_OPERATIONS.HOLD,{type:_.OPERATION_TYPE.CHAINED}),s(1,_.causeId),a("design:type",Function),a("design:paramtypes",[String,Object]),a("design:returntype",Promise)],t.prototype,"hold",null),o([_.callOperation(p.CALL_OPERATIONS.UNHOLD,{type:_.OPERATION_TYPE.CHAINED}),s(1,_.causeId),a("design:type",Function),a("design:paramtypes",[String,Object]),a("design:returntype",Promise)],t.prototype,"unhold",null),o([_.callOperation(p.CALL_OPERATIONS.UPDATE_ENDPOINT_METADATA,{waitFor:p.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),s(1,_.causeId),a("design:type",Function),a("design:paramtypes",[String,Object]),a("design:returntype",Promise)],t.prototype,"updateEndpointMetadata",null),o([_.callOperation(p.CALL_OPERATIONS.SEND_DTMF_TONE),s(1,_.causeId),a("design:type",Function),a("design:paramtypes",[Number,Object]),a("design:returntype",Promise)],t.prototype,"sendDtmfTone",null),o([_.callOperation(p.CALL_OPERATIONS.SET_AUDIO_USAGE,{waitFor:p.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),s(1,_.causeId),a("design:type",Function),a("design:paramtypes",[String,Object]),a("design:returntype",Promise)],t.prototype,"setAudioUsageMode",null),o([_.callOperation(p.CALL_OPERATIONS.START_AUDIO,{type:_.OPERATION_TYPE.CHAINED}),s(1,_.causeId),a("design:type",Function),a("design:paramtypes",[String,Object]),a("design:returntype",Promise)],t.prototype,"startAudio",null),o([_.callOperation(p.CALL_OPERATIONS.STOP_AUDIO,{type:_.OPERATION_TYPE.CHAINED}),s(1,_.causeId),a("design:type",Function),a("design:paramtypes",[String,Object]),a("design:returntype",Promise)],t.prototype,"stopAudio",null),o([_.callOperation(p.CALL_OPERATIONS.ASSIMILATE,{waitFor:p.CALL_OPERATIONS.ASSIMILATE}),s(3,_.causeId),a("design:type",Function),a("design:paramtypes",[Object,String,String,Object]),a("design:returntype",Promise)],t.prototype,"assimilate",null),o([_.callOperation(p.CALL_OPERATIONS.STOP_CALL,{waitFor:p.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),s(1,_.causeId),a("design:type",Function),a("design:paramtypes",[Object,Object]),a("design:returntype",Promise)],t.prototype,"stop",null),o([_.callOperation(p.CALL_OPERATIONS.REJECT,{waitFor:p.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),s(0,_.causeId),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],t.prototype,"reject",null),o([_.callOperation(p.CALL_OPERATIONS_INTERNAL.ELECTRON_LEAVE_CALL,{waitFor:p.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),a("design:type",Function),a("design:paramtypes",[Boolean,String]),a("design:returntype",Promise)],t.prototype,"_leaveSlimCoreCall",null),o([_.callOperation(p.CALL_OPERATIONS_INTERNAL.INCOMING_INITIALIZE,{triggerAttach:!0}),s(1,_.causeId),a("design:type",Function),a("design:paramtypes",[Number,Object]),a("design:returntype",void 0)],t.prototype,"incomingCallInit",null),o([_.callOperation(p.CALL_OPERATIONS.ACKNOWLEDGE,{type:_.OPERATION_TYPE.CHAINED,triggerAttach:!0}),s(1,_.causeId),a("design:type",Function),a("design:paramtypes",[Object,Object]),a("design:returntype",Promise)],t.prototype,"acknowledge",null),o([_.callOperation(p.CALL_OPERATIONS.ACCEPT,{waitFor:p.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),s(1,_.causeId),a("design:type",Function),a("design:paramtypes",[Object,Object]),a("design:returntype",Promise)],t.prototype,"accept",null),o([_.callOperation(p.CALL_OPERATIONS.MERGE_WITH_PICKUP_CODE,{operationIdKey:"pickupCode"}),s(0,_.operationId),s(1,_.causeId),a("design:type",Function),a("design:paramtypes",[Object,Object]),a("design:returntype",Promise)],t.prototype,"mergeWithPickupCode",null),o([_.callOperation(p.CALL_OPERATIONS.MERGE_CALL,{singular:!0,waitFor:p.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),s(2,_.causeId),a("design:type",Function),a("design:paramtypes",[Object,Object,Object]),a("design:returntype",Promise)],t.prototype,"merge",null),o([_.callOperation(p.CALL_OPERATIONS_INTERNAL.RECONNECT),a("design:type",Function),a("design:paramtypes",[]),a("design:returntype",Promise)],t.prototype,"reconnect",null),o([_.callOperation(p.CALL_OPERATIONS.ELECTRON_PROVIDE_CQF,{waitFor:p.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),a("design:type",Function),a("design:paramtypes",[String,String,Number,String]),a("design:returntype",Promise)],t.prototype,"provideCallQualityFeedback",null),o([_.participantOperation(p.PARTICIPANT_OPERATIONS.ADMIT_PARTICIPANT),s(0,_.operationId),s(1,_.causeId),a("design:type",Function),a("design:paramtypes",[String,Object]),a("design:returntype",Promise)],t.prototype,"admitParticipant",null),o([_.participantOperation(p.PARTICIPANT_OPERATIONS.CALL_ME_BACK),s(0,_.operationId),s(2,_.causeId),a("design:type",Function),a("design:paramtypes",[String,String,Object]),a("design:returntype",Promise)],t.prototype,"callMeBack",null),o([_.participantOperation(p.CALL_OPERATIONS.NUDGE_PARTICIPANTS),s(0,_.operationId),s(3,_.causeId),a("design:type",Function),a("design:paramtypes",[String,Array,Object,Object]),a("design:returntype",Promise)],t.prototype,"nudgeParticipants",null),o([_.participantOperation(p.CALL_OPERATIONS.UPDATE_MEETING_ROLE),s(2,_.causeId),a("design:type",Function),a("design:paramtypes",[Array,String,Object]),a("design:returntype",Promise)],t.prototype,"updateMeetingRoles",null),o([_.participantOperation(p.PARTICIPANT_OPERATIONS.ADD_PARTICIPANT),s(0,_.operationId),s(2,_.causeId),a("design:type",Function),a("design:paramtypes",[String,Object,Object]),a("design:returntype",Promise)],t.prototype,"addParticipant",null),o([_.participantOperation(p.PARTICIPANT_OPERATIONS.ADD_PARTICIPANTS),s(0,_.operationId),s(2,_.causeId),a("design:type",Function),a("design:paramtypes",[Array,Object,Object]),a("design:returntype",Promise)],t.prototype,"addParticipants",null),o([_.participantOperation(p.PARTICIPANT_OPERATIONS.REMOVE_PARTICIPANT),s(0,_.operationId),s(1,_.causeId),a("design:type",Function),a("design:paramtypes",[String,Object,String,Number]),a("design:returntype",Promise)],t.prototype,"removeParticipant",null),o([_.callOperation(p.CALL_OPERATIONS.SET_MAX_VIDEO_CHANNELS,{type:_.OPERATION_TYPE.CHAINED}),s(2,_.causeId),a("design:type",Function),a("design:paramtypes",[Number,String,Object]),a("design:returntype",Promise)],t.prototype,"setMaxVideoChannels",null),o([_.callOperation(p.CALL_OPERATIONS.CREATE_CONTENT_SHARING_SESSION,{waitFor:p.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),a("design:type",Function),a("design:paramtypes",[String,String,String,String]),a("design:returntype",Promise)],t.prototype,"createContentSharingSession",null),o([_.callOperation(p.CALL_OPERATIONS.ADD_GROUP_MODALITY,{waitFor:p.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY}),s(1,_.causeId),a("design:type",Function),a("design:paramtypes",[Object,Object]),a("design:returntype",Promise)],t.prototype,"addGroupModality",null),t}(I.default);t.default=j},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),a=n(24),s=n(8),c=n(0),l=n(3),u=SlimCore.Enums;t.DATA_SOURCE_ID_ANY=4294967294;var d=function(e){function t(t,n,r,i,o,s,c,l){var d=e.call(this,t.createChild((function(){return"SlimCoreElectronDataChannel"})),n,r)||this;d._call=i,d._slimcoreCallHandler=o,d._dataChannel=s,d._dataChannelUsers=c,d.id=l,d._dataChannelActive=!1,d._protocolDataSource=null,d._protocolDataSink=null,d._dataChannelAdapterSetInternalSourceSink=null,d._lastDataChannelState=u.DataChannelStatus.Unknown,d._asyncOperationHandler=new a.default(d._logger),d._logger.info("Setting DataChannel on all users");for(var h=0;h<d._dataChannelUsers.length;h++)if(d._dataChannelUsers[h])try{d._dataChannelUsers[h].setDataChannel(d)}catch(e){d._logger.error("Exception calling setDataChannel for i="+h+" error="+e)}return d._hookSlimCorePropertyChangedEvents(),d}return i(t,e),t.prototype.setAdapterSourceSinkCallback=function(e){this._dataChannelAdapterSetInternalSourceSink=e},t.prototype._hookSlimCorePropertyChangedEvents=function(){var e=this;this._registerDisposable(this._slimcoreInstance.handle("object-property-changed",{objectId:this.id,propKey:u.Property.DataChannelStatus},(function(t){return e._onDataChannelStatusChanged(t.value)})));var t=this._getIntProperty(this._slimcoreCallHandler,this.id,u.Property.DataChannelStatus);this._onDataChannelStatusChanged(t)},t.prototype.start=function(e){var t=this;return this._dataChannelActive?(this._logger.info("start() called when channel already active"),Promise.resolve()):(this._asyncOperationHandler.hasPendingOperation(s.CALL_OPERATIONS.START_DATA_CHANNEL)?this._logger.info("start promise already exists, returning previous promise"):(this._asyncOperationHandler.createPendingOperation(s.CALL_OPERATIONS.START_DATA_CHANNEL),o.asap((function(){return t._startDataChannel(e)}))),this._asyncOperationHandler.waitForOperation(s.CALL_OPERATIONS.START_DATA_CHANNEL))},t.prototype.stop=function(e){var t=this;return this._dataChannelActive?(this._asyncOperationHandler.hasPendingOperation(s.CALL_OPERATIONS.STOP_DATA_CHANNEL)?this._logger.info("stop promise already exists, returning previous promise"):(this._asyncOperationHandler.createPendingOperation(s.CALL_OPERATIONS.STOP_DATA_CHANNEL),o.asap((function(){return t._stopDataChannel(e)}))),this._asyncOperationHandler.waitForOperation(s.CALL_OPERATIONS.STOP_DATA_CHANNEL)):(this._logger.info("stop() called when channel not active"),Promise.resolve())},t.prototype.registerDataSource=function(e){var t=this;return o.asap((function(){return t._dataChannel.registerDataSource(e)}))},t.prototype.unregisterDataSource=function(e){var t=this;return o.asap((function(){return t._dataChannel.unregisterDataSource(e)}))},t.prototype.registerDataSink=function(e){var t=this;return o.asap((function(){return t._dataChannel.registerDataSink(e)}))},t.prototype.unregisterDataSink=function(e){var t=this;return o.asap((function(){return t._dataChannel.unregisterDataSink(e)}))},t.prototype.sendUserEvents=function(e,t){var n=this;return o.asap((function(){return n._dataChannel.sendUserEvents(e,t)}))},t.prototype._onDataChannelStatusChanged=function(e){if(this._logger.info("Data channel status = "+e),e===u.DataChannelStatus.Active){this._asyncOperationHandler.maybeResolveOperation(s.CALL_OPERATIONS.START_DATA_CHANNEL);try{this._dataChannel.setDataDevices()}catch(e){this._logger.error("setDataDevices threw exception: "+e)}this._dataChannel&&!this._dataChannelActive&&(this._dataChannelActive=!0,this._createAndAttachProtocolDevices(),this._dataChannelAdapterSetInternalSourceSink&&this._dataChannelAdapterSetInternalSourceSink(u.DataDeviceId.Protocol,this._protocolDataSource,this._protocolDataSink),this._logger.info("Data channel ready"))}else e===u.DataChannelStatus.Available&&(this._asyncOperationHandler.maybeResolveOperation(s.CALL_OPERATIONS.STOP_DATA_CHANNEL),this._dataChannel&&this._dataChannelActive&&(this._dataChannelActive=!1,this._detachAndDeleteProtocolDevices(),this._logger.info("Data channel disposed")));this._lastDataChannelState===u.DataChannelStatus.Starting&&e!==u.DataChannelStatus.Active?this._asyncOperationHandler.maybeRejectOperation(s.CALL_OPERATIONS.START_DATA_CHANNEL):this._lastDataChannelState===u.DataChannelStatus.Stopping&&e!==u.DataChannelStatus.Available&&this._asyncOperationHandler.maybeRejectOperation(s.CALL_OPERATIONS.STOP_DATA_CHANNEL);for(var n=0;n<this._dataChannelUsers.length;n++)try{this._dataChannelUsers[n].onDataChannelStatusChanged(e)}catch(e){this._logger.error("Exception calling onDataChannelStatusChanged for i="+n+" error="+e)}this._lastDataChannelState!==e&&(this.event("stateChange").raise(t._mapDataChannelStatus(e)),this._lastDataChannelState=e)},t.prototype._updateProtocolDataSource=function(e){this._logger.info("Setting Protocol DataSource on all users");for(var t=0;t<this._dataChannelUsers.length;t++)if(this._dataChannelUsers[t])try{this._dataChannelUsers[t].setProtocolDataSource(e)}catch(e){this._logger.error("Exception calling setProtocolDataSource for i="+t+" error="+e)}},t.prototype._createAndAttachProtocolDevices=function(){var e=this;if(this._logger.info("_createAndAttachProtocolDevices()"),c.hasCreateDataSource(this._slimcoreInstance)&&c.hasCreateDataSink(this._slimcoreInstance))if(this._dataChannel){if(!this._protocolDataSource){this._protocolDataSource=c.createDataSource(this._slimcoreInstance,u.DataDeviceId.Protocol);try{this._dataChannel.registerDataSource(this._protocolDataSource),this._logger.info("created Protocol data source")}catch(e){this._logger.error("registerDataSource threw exception: "+e)}}if(!this._protocolDataSink){this._protocolDataSink=c.createDataSink(this._slimcoreInstance,u.DataDeviceId.Protocol);try{this._dataChannel.registerDataSink(this._protocolDataSink),this._logger.info("created Protocol data sink")}catch(e){this._logger.error("registerDataSink threw exception: "+e)}}this._protocolDataSink.on("data",(function(t){try{var n=JSON.parse(c.bufferToString(t.data));if(1!==n.type){n.type>=e._dataChannelUsers.length&&e._logger.error("Error calling processProtocolMessage i="+n.type+" error=Index out of bounds");try{var r=e._call.mapDataChannelSourceIdToParticipant(t.sourceID),i=void 0;r&&(i=r.getParticipantIdForSourceId(4,t.sourceID)),e._dataChannelUsers[n.type].processProtocolMessage(n.message,r,i,t.sourceID)}catch(t){e._logger.error("Error calling processProtocolMessage i="+n.type+" error="+t)}}}catch(t){e._logger.error("Error handling protocol message error="+t)}})),this._updateProtocolDataSource(this._protocolDataSource)}else this._logger.warn("_createAndAttachProtocolDevices() null dataChannel");else this._logger.warn("createDataSource or createDataSink not implemented")},t.prototype._detachAndDeleteProtocolDevices=function(){if(this._logger.info("_detachAndDeleteProtocolDevices()"),this._protocolDataSink&&this._protocolDataSink.removeAllListeners("data"),this._dataChannel){if(this._protocolDataSource){try{this._dataChannel.unregisterDataSource(this._protocolDataSource)}catch(e){this._logger.warn("unregisterDataSource threw exception for protocol, call probably ended: "+e)}this._protocolDataSource=null,this._updateProtocolDataSource(null),this._logger.info("deleted Protocol data source")}if(this._protocolDataSink){try{this._dataChannel.unregisterDataSink(this._protocolDataSink)}catch(e){this._logger.warn("unregisterDataSink threw exception for protocol, call probably ended: "+e)}this._protocolDataSink=null,this._logger.info("deleted Protocol data sink")}}else this._logger.warn("_detachAndDeleteProtocolDevices() null dataChannel")},t.prototype._startDataChannel=function(e){if(this._logger.info("_startDataChannel()"),this._dataChannel){try{this._dataChannel.start(e)}catch(e){this._logger.error("_dataChannel.start threw exception: "+e)}this._logger.info("Data channel started")}},t.prototype._stopDataChannel=function(e){if(this._logger.info("_stopDataChannel()"),this._dataChannel){try{this._dataChannel.stop(e)}catch(e){this._logger.error("_dataChannel.stop threw exception: "+e)}this._logger.info("Data channel stopping")}},t._mapDataChannelStatus=function(e){switch(e){case u.DataChannelStatus.Available:return 1;case u.DataChannelStatus.Starting:return 2;case u.DataChannelStatus.Active:return 3;case u.DataChannelStatus.Stopping:return 4;case u.DataChannelStatus.NotStarted:return 5;case u.DataChannelStatus.Unknown:default:return 0}},t.prototype.dispose=function(){this._logger.info("SlimCoreElectronDataChannel.dispose()"),this._detachAndDeleteProtocolDevices(),this._call=null,this._dataChannel&&(this._dataChannel.dispose&&this._dataChannel.dispose(),this._dataChannel=null),e.prototype.dispose.call(this)},t}(l.default);t.default=d},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o,a,s=n(7),c=n(2),l=n(9),u=n(5),d=n(10);!function(e){e.Pending="Pending",e.Success="Success",e.Failure="Failure"}(o||(o={})),function(e){e[e.Event=0]="Event",e[e.Operation=1]="Operation"}(a||(a={}));var h=function(){function e(e,t,n,r,i){this.eventName=e,this.eventStartTime=t,this.type=n,this.causeId=r,this.status=o.Pending,this.eventStartTimestamp=(new Date).getTime(),this.data=[],this.type===a.Event&&delete this.status,i&&this.data.push(i)}return Object.defineProperty(e.prototype,"variant",{set:function(e){this.eventVariant=e},enumerable:!0,configurable:!0}),e.prototype.recordSuccess=function(e,t){this.recordResult(!0,e,t)},e.prototype.recordFailure=function(e,t){this.recordResult(!1,e,t)},e.prototype.addData=function(e){this.data.push(e)},e.prototype.isPending=function(){return this.status===o.Pending},e.prototype.getEvent=function(){var e,t=this,n={start:this.eventStartTime,duration:this.duration,status:this.status,result:this.result,causeId:this.causeId,resultCauseId:this.resultCauseId,variant:this.eventVariant,data:this.data.map((function(e){return t.prepareData(e,!0)})).filter((function(e){return!!e}))};return this.type===a.Event&&delete n.status,n.data.length||delete n.data,n.causeId||delete n.causeId,n.resultCauseId||delete n.resultCauseId,n.result||delete n.result,n.variant||delete n.variant,(e={})[this.eventName]=n,e},e.prototype.recordResult=function(e,t,n){this.status=e?o.Success:o.Failure,this.result=this.prepareData(t),this.causeId!==n&&(this.resultCauseId=n),this.duration=(new Date).getTime()-this.eventStartTimestamp},e.prototype.prepareData=function(e,t){void 0===t&&(t=!1);var n=typeof e;if(null==e)return"";if("string"===n)return u.scrubMriOrOmit(e);if("number"===n||"boolean"===n)return String(e);if("function"===n)return"";if(e instanceof Error)return e.toString();try{return Object.keys(e).length?t?e:l.getPIISafeObject(e):""}catch(e){return"invalid"}},e}();!function(e){e.LOCAL="Local",e.REMOTE="Remote"}(t.CALL_TERMINATING_END||(t.CALL_TERMINATING_END={})),function(e){e.SUCCESS="Success",e.FAILURE="Failure"}(t.RESULT_VALUE||(t.RESULT_VALUE={})),function(e){e.INCOMING="Incoming",e.OUTGOING="Outgoing"}(t.DIRECTION||(t.DIRECTION={})),function(e){e.CALLER="caller",e.CALLEE="callee",e.JOIN="join",e.SUBSCRIBE="SUBSCRIBE"}(t.SELF_PARTICIPANT_ROLE||(t.SELF_PARTICIPANT_ROLE={}));var p=function(){function e(e,t,n){this.logger=e,this.startTime=t,this.maxEventsExceeded=n,this.recordedEvents=[],this.ongoingOperations={}}return e.prototype.recordEvent=function(e,t,n){void 0===n&&(n=c.generateCauseId()),this.logger.debug("Event:",e,s.pii.Omit(t));var r=new h(e,this.getEventStartTime(),a.Event,n,t);return this.pushToRecordedEvents(r),r},e.prototype.recordOperationSuccess=function(e,t,n,r){void 0===t&&(t=null),this.logger.info("Event success:",r,e,s.pii.Omit(n),s.pii.Omit(t)),this.recordOperationResult(e,t,!0,n,r)},e.prototype.recordOperationFailure=function(e,t,n,r){this.logger.info("Event failure:",e,s.pii.Omit(n),t),this.recordOperationResult(e,t,!1,n,r)},e.prototype.maybeRecordOperationSuccess=function(e,t,n,r){void 0===t&&(t=null),this.hasOngoingEvent(e,n)&&this.recordOperationSuccess(e,t,n,r)},e.prototype.maybeRecordOperationFailure=function(e,t,n,r){this.hasOngoingEvent(e,n)&&this.recordOperationFailure(e,t,n,r)},e.prototype.recordOperationResult=function(e,t,n,r,i){this.hasOngoingEvent(e,r)||this.recordOperation(e,i,r);var o=this.ongoingOperations[e];r&&(o=o[r]),n?o.recordSuccess(t,i):o.recordFailure(t,i),r?delete this.ongoingOperations[e][r]:delete this.ongoingOperations[e]},e.prototype.recordOperation=function(e,t,n){this.logger.debug("Event create: "+n,e,s.pii.Omit(n));var r=new h(e,this.getEventStartTime(),a.Operation,t);return this.logger.debug("Event create: "+l.getPIISafeObject(this.ongoingOperations)),this.ongoingOperations[e]||(this.ongoingOperations[e]={}),n?this.ongoingOperations[e][n]=r:this.ongoingOperations[e]=r,this.pushToRecordedEvents(r),r},e.prototype.setOperationVariant=function(e,t,n){var r;(r=n?this.ongoingOperations[e][n]:this.ongoingOperations[e])?r.variant=t:this.logger.error("Could not find operation "+e+" to set variant "+t)},e.prototype.updateOperationData=function(e,t,n,r){try{if(!this.ongoingOperations[e])return void this.recordEvent(e,t,n);r?this.ongoingOperations[e][r]&&this.ongoingOperations[e][r].addData(t):this.ongoingOperations[e].addData(t)}catch(t){return void this.logger.info("Unable to update operation: "+e+" data")}},e.prototype.pushToRecordedEvents=function(e){this.maxEventsExceeded&&this.maxEventsExceeded()&&this.recordedEvents.shift(),this.recordedEvents.push(e)},e.prototype.hasOngoingEvent=function(e,t){return this.ongoingOperations[e]?!(t&&!this.ongoingOperations[e][t]&&(this.logger.warn("Unable to find event for name\\id "+e+"\\"+s.pii.Omit(t)),1)):(this.logger.warn("Unable to find event for name "+e),!1)},e.prototype.getEventStartTime=function(){return(new Date).getTime()-this.startTime},e.prototype.getEventTimestampBag=function(e){var t=JSON.stringify({eventStart:this.startTime,events:this.recordedEvents.filter((function(t){return!e||!t.isPending()})).map((function(e){return e.getEvent()}))});return this.logger.info("Call eventTimestampBag "+s.pii.Omit(t)),t},e}();t.TelemetryUtilities=p;var f=function(e){function t(t,n){var r=e.call(this,t,n,(function(){return r.inCallMode&&r.recordedEvents.length>150}))||this;return r.inCallMode=!1,r.getHostName=function(){try{return location.host}catch(e){return"unknown"}},r.tsCallingVersion=d.getTsCallingVersion(),r.logger=t.createChild("CallTelemetry"),r}return i(t,e),t.prototype.setCallId=function(e){this.currentCallId&&(this.previousCallId=this.currentCallId),this.currentCallId=e},t.prototype.setConsultativeCallId=function(e){this.consultativeCallId=e},t.prototype.setEndpointId=function(e){this.endpointId=e},t.prototype.setParticipantId=function(e){this.participantId=e},t.prototype.setPreheatFlags=function(e){this.preheatFlags=e},t.prototype.setCallOrigin=function(e){this.origin=e},t.prototype.setThreadId=function(e){this.threadId=e},t.prototype.setMesageId=function(e){this.messageId=e},t.prototype.setTenantId=function(e){this.tenantId=e},t.prototype.setFailureType=function(e){this.failureType=e},t.prototype.setIsCast=function(e){this.isCast=e?"True":"False"},t.prototype.setIsEmergency=function(e){this.isEmergency=e?"True":"False"},t.prototype.setRole=function(e){this.isAnonymous="admin"===e?"False":"True"},t.prototype.setCallType=function(e){this.callType=e},t.prototype.setDirection=function(e){this.direction=e},t.prototype.setSelfParticipantRole=function(e){this.selfParticipantRole=e},t.prototype.setTerminationState=function(e){this.terminationState=e},t.prototype.setTerminationReason=function(e){this.terminationReason=e},t.prototype.setCallEndDiagnosticInfo=function(e){this.callEndDiagnosticInfo=e},t.prototype.setStackConfig=function(e){this.stackConfig=e},t.prototype.getEvent=function(e){var t=function(e){return void 0===e?"":e};return{CorrelationId:t(this.currentCallId),PreviousCorrelationId:t(this.previousCallId),ConsultativeCallId:t(this.consultativeCallId),EndpointId:t(this.endpointId),ParticipantId:t(this.participantId),PreheatFlags:t(this.preheatFlags),CallType:t(this.callType),Direction:t(this.direction),Origin:t(this.origin),SelfParticipantRole:t(this.selfParticipantRole),IsAnonymous:t(this.isAnonymous),ThreadId:t(this.threadId),MessageId:t(this.messageId),TenantId:t(this.tenantId),FailureType:t(this.failureType),IsCast:t(this.isCast),IsEmergency:t(this.isEmergency),TsCallingVersion:t(this.tsCallingVersion),TerminationState:t(this.terminationState),TerminationReason:t(this.terminationReason),StackConfig:t(this.stackConfig),EventTimestampBag:this.getEventTimestampBag(e),HostName:this.getHostName(),DiagnosticInfo:this.callEndDiagnosticInfo}},t.prototype.switchToInCallTelemetry=function(){this.recordedEvents=this.recordedEvents.filter((function(e){return e.isPending()})),this.inCallMode=!0},t}(p);t.default=f,t.getEndpointInformationForTelemetry=function(e){return Array.isArray(e)?e.map((function(e){return{endpointId:e.endpointId,participantId:e.participantId}})):null}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,i,o=n(8),a=n(2),s=n(6);!function(e){e.CHAINED="Chained",e.SYNC="Sync",e.ASYNC="Async"}(r=t.OPERATION_TYPE||(t.OPERATION_TYPE={})),function(e){e[e.CALL=0]="CALL",e[e.PARTICIPANT=1]="PARTICIPANT"}(i||(i={})),t.callOperation=function(e,t){return c(i.CALL,e,t)},t.participantOperation=function(e,t){return c(i.PARTICIPANT,e,t)},t.operationId=function(e,t,n){if(e[t]._operationIdValue_)throw new Error("can not specify more than one operation id");e[t]._operationIdValue_=n},t.causeId=function(e,t,n){if(e[t]._causeIdValue_)throw new Error("can not specify more than one cause id");e[t]._causeIdValue_=n},t.callStartOptions=function(e,t,n){if(e[t]._callStartOptionsValue_)throw new Error("can not specify options more than once");e[t]._callStartOptionsValue_=n};var c=function(e,t,n){return function(i,c,d){var h=d.value,p=i[c]&&i[c]._operationIdValue_,f=i[c]&&i[c]._causeIdValue_,g=i[c]&&i[c]._callStartOptionsValue_,_=n&&n.type||r.ASYNC;return d.value=function(){for(var i=this,c=[],d=0;d<arguments.length;d++)c[d]=arguments[d];var m=this,v=void 0!==p?c[p]:void 0;if(void 0!==v)if(Array.isArray(v))try{var y=v.map((function(e){return e.toString()})).sort().concat().toString();v=u(y).toString()}catch(e){return Promise.reject(32)}else if(v&&"object"==typeof v)try{var C=JSON.stringify(v);n&&n.operationIdKey&&v.hasOwnProperty(n.operationIdKey)&&(C=v[n.operationIdKey]),v=C}catch(e){return Promise.reject(32)}var S=a.generateCauseId();void 0!==f&&(c[f]&&a.validateCauseId(c[f])?S=c[f]:c[f]=S);var I=l(m,e);if(I.logOperation(S,t),n&&n.singular&&I.hasPendingOperation(t))return I.logOperation(S,t,"Not allowed, pending operation exists"),Promise.reject(60);try{void 0!==g&&c[g]&&m.processCallStartOptions(c[g],S)}catch(e){return Promise.reject(32)}var T=function(){return _===r.CHAINED?I.executeChained(h.bind.apply(h,[i].concat(c)),t,v,S):_===r.SYNC?I.executeSync(h.bind.apply(h,[i].concat(c)),t,v,S):I.execute(h.bind.apply(h,[i].concat(c)),t,v,S)};if(t!==o.CALL_OPERATIONS.START_CALL&&t!==o.CALL_OPERATIONS.JOIN_CALL||I.hasPendingOperation(o.CALL_OPERATIONS_INTERNAL.CALL_START_OR_JOIN_INITIATED)||I.createPendingOperation(o.CALL_OPERATIONS_INTERNAL.CALL_START_OR_JOIN_INITIATED).catch(s.noop),n&&n.triggerAttach&&(I.hasPendingOperation(o.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY)||I.createPendingOperation(o.CALL_OPERATIONS_INTERNAL.ELECTRON_SLIMCORE_READY).catch(s.noop)),n&&n.type!==r.SYNC){var P=n&&n.waitFor;if(P&&I.hasPendingOperation(P))return I.waitForOperation(P,void 0,S).then(T,T)}return T()},d}},l=function(e,t){if(t===i.CALL)return e._callOperationHandler;if(t===i.PARTICIPANT)return e._participantOperationHandler;throw new Error("Unsupported operation handler type!")};function u(e){for(var t=0,n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return t}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(5),c=n(24),l=n(2),u=n(16),d=n(41),h=function(e){function t(t,n){var r=e.call(this,t)||this;return r.callTelemetry=n,r.logSuccess=function(e,t,n){r._logger.info(e+" execution succeeded, result="+(t?r.stringifyForLogging(t):"void")+", time="+n.duration())},r.logFailure=function(e,t,n){r._logger.info(e+" execution failed, reason="+r.stringifyForLogging(t)+", time="+n.duration())},r.stringifyForLogging=function(e){var t;if(e instanceof Error)t=e.toString()||"Unknown Error";else try{t=JSON.stringify(e)}catch(e){t="Unable to stringify data"}return t},r._logger=t.createChild("[Operation]"),r._chainedPromise=new u.default(r._logger.createChild("[Chained]")),r}return i(t,e),t.prototype.resetOperationChain=function(e){this._chainedPromise.reset(e)},t.prototype.executeSync=function(e,t,n,r){void 0===r&&(r=l.generateCauseId());var i=this.getOperationInfoForLogging(r,t,n),o=d.build();this._logger.info(i+"API calledSync");var a,s=this.callTelemetry.recordOperation(t,r,n);try{a=e(),s.recordSuccess(a,r),this.logSuccess(i,a,o)}catch(e){s.recordFailure(e,r),this.logFailure(i,e,o)}return a},t.prototype.executeChained=function(e,t,n,r){return void 0===r&&(r=l.generateCauseId()),o(this,void 0,void 0,(function(){return a(this,(function(i){return[2,this.checkPendingOperationAndExecute(e,!0,t,n,r)]}))}))},t.prototype.execute=function(e,t,n,r){return void 0===r&&(r=l.generateCauseId()),o(this,void 0,void 0,(function(){return a(this,(function(i){return[2,this.checkPendingOperationAndExecute(e,!1,t,n,r)]}))}))},t.prototype.logOperation=function(e,t){for(var n=this,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];var o=r.length&&r.map((function(e){return n.stringifyForLogging(s.scrubMriOrOmit(e))}));this._logger.info("["+e+"]["+t+"]API called, "+(o?"with args="+o:""))},t.prototype.checkPendingOperationAndExecute=function(e,t,n,r,i){var o=this;void 0===i&&(i=l.generateCauseId());var a=this.getOperationInfoForLogging(i,n,r),s=null,c=null;return this.hasPendingOperation(n,r)?(this._logger.info(a+"already pending, returning existing operation"),s=this.waitForOperation(n,r,i)):c=this.createPendingOperation(n,r,i),t?(this._logger.info(a+"chained"),this._chainedPromise.chainPromise((function(){return s||o.executeInternal(c,i,e,n,r)}),n,i)):s||this.executeInternal(c,i,e,n,r)},t.prototype.executeInternal=function(e,t,n,r,i){return o(this,void 0,void 0,(function(){var o,s,c,l;return a(this,(function(a){switch(a.label){case 0:o=this.getOperationInfoForLogging(t,r,i),this._logger.info(o+" executing operation..."),s=d.build(),this.callTelemetry.recordOperation(r,t,i),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,n()];case 2:return c=a.sent(),this.callTelemetry.maybeRecordOperationSuccess(r,c,i),this.logSuccess(o,c,s),this.maybeResolveOperation(r,c,i,t),[3,4];case 3:return l=a.sent(),this.callTelemetry.maybeRecordOperationFailure(r,l,i),this.logFailure(o,l,s),this.maybeRejectOperation(r,l,i,t),[3,4];case 4:return[2,e]}}))}))},t}(c.default);t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),i=function(){function e(e){this._logger=e,this._promise=Promise.resolve(void 0),this._actionQueue=[]}return e.prototype.chainPromise=function(e,t,n,i){var o=this;void 0===n&&(n=r.generateCauseId()),void 0===i&&(i=!1);var a=Date.now(),s=(("function"==typeof t?t():t)||"").toString();this._actionQueue.push(s),this._logger.info("["+n+"]["+s+"]enqueueing, queue=["+this._actionQueue+"], reset="+i);var c=function(){o._actionQueue=o._actionQueue.filter((function(e){return e!==s}))};return i&&this.reset(n),this._promise=this._promise.catch((function(){})).then((function(){var t=Date.now()-a;return o._logger.info("["+n+"]["+s+"]begin, delayMs="+t),e()})),this._promise.then((function(){c();var e=Date.now()-a;o._logger.info("["+n+"]["+s+"]success, durationMs="+e)}),(function(e){c();var t=Date.now()-a;o._logger.warn("["+n+"]["+s+"]failed="+e+", drationMs="+t)})),this._promise},e.prototype.reset=function(e){this._logger.info("["+e+"] resetting"),this._promise=Promise.resolve(void 0)},e}();t.default=i},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(0),s=n(3),c=n(18),l=SlimCore.Enums,u=n(6),d=function(e){function t(t,n,r,i,o,s,c,u){void 0===u&&(u=!1);var d=e.call(this,t.createChild((function(){return"SlimCoreElectronRemoteStreamManager["+d._slimcoreParticipantObjectId+"]"})),n,r)||this;return d._callHandler=i,d._slimcoreParticipantObjectId=o,d._streams=s,d._streamContextMap=c,d._logger.info("constructor"),a.hasFeature(l.Feature.RemoteVideosCountChanged)||d._registerDisposable(d._slimcoreInstance.handle("object-property-changed",{objectId:d._slimcoreParticipantObjectId,propKey:l.Property.ParticipantVideoCountChanged},(function(e){return d._onVideoCountChangedDeferred()}))),d._registerDisposable(d._callHandler.handle("remote-videos-count-changed",{participantObjectId:d._slimcoreParticipantObjectId},(function(e){return d._onVideoCountChangedDeferred()}))),u||d._onVideoCountChangedDeferred(),d}return i(t,e),t.prototype._onVideoCountChangedDeferred=function(){var e=this;this._onVideoCountChangedDefer||(this._onVideoCountChangedDefer=o.defer((function(){delete e._onVideoCountChangedDefer,e._onVideoCountChanged()})))},t.prototype._onVideoCountChanged=function(){var e=this,t=this._callHandler.callGetParticipantVideos(this._slimcoreParticipantObjectId);if(t){var n={};n[l.VideoType.Video]=[],n[l.VideoType.ScreenShare]=[],t.forEach((function(t){var r=e._getIntProperty(e._callHandler,t,l.Property.VideoType),i=e._getIntProperty(e._callHandler,t,l.Property.VideoStatus);r!==l.VideoType.Augmented&&n[r].push({videoObjectId:t,videoType:r,videoStatus:i})})),this._handleVideoCountChanged(l.VideoType.Video,n[l.VideoType.Video]),this._handleVideoCountChanged(l.VideoType.ScreenShare,n[l.VideoType.ScreenShare]),this.raiseChanged()}},t.prototype._handleVideoCountChanged=function(e,n){var r=this,i=t.SlimcoreVideoTypeToStreamType(e),a=this._streams[i],s=o.filter(a,(function(e){return!o.some(n,(function(t){return t.videoObjectId===e.id}))}));o.each(s,(function(e){r._logger.info("_handleVideoCountChanged: removing stream "+e.id+" (stream type: "+i+")"),o.remove(a,e),e.dispose()})),o.each(n,(function(e){if(!o.some(a,(function(t){return t.id===e.videoObjectId}))){r._logger.info("_handleVideoCountChanged: adding stream "+e.videoObjectId+" (stream type: "+i+")");var t=new c.default(r._logger,r._settings,r._slimcoreInstance,r._slimcoreParticipantObjectId,e.videoObjectId,i,r._callHandler,r._streamContextMap[i]);r._streams[i].push(t),t.changed((function(){return r.raiseChanged()}))}}))},t.prototype.stopVideos=function(){this._logger.info("stopVideos");var e=function(e){return e.disposeInternal()};return Promise.all(o.flatMap(o.values(this._streams),(function(t){return o.map(t,e)}))).then(u.noop)},t.prototype.dispose=function(){this._logger.info("dispose"),o.each(o.values(this._streams),(function(e){return o.each(e,(function(e){return e.dispose()}))})),this._streams[0]=[],this._streams[1]=[],e.prototype.dispose.call(this)},t.SlimcoreVideoTypeToStreamType=function(e){switch(e){case l.VideoType.ScreenShare:return 1;case l.VideoType.Video:return 0;default:return}},t}(s.default);t.default=d},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(4),c=n(2),l=n(16),u=n(0),d=n(3),h=n(27),p=SlimCore.Enums,f=function(e){this.nrRunningStreams=0,this.videoStoppedEvent=new u.VideoStateCancelEvent};t.SlimCoreElectronRemoteStreamContext=f;var g=0,_=function(e){function t(t,n,r,i,o,a,s,d){var h=e.call(this,t.createChild((function(){return"RemoteStream("+h._context.nrRunningStreams+")["+h._remoteVideoId+":"+h.rank+":"+h._mediaType+":"+h._videoStatus+"]"})),n,r)||this;h._participantId=i,h.id=o,h.type=a,h._callHandler=s,h._context=d,h._remoteVideoId=0,h._videoStatus=p.VideoStatus.None,h._stateCancelEvent=new u.VideoStateCancelEvent,h._shouldRun=!1,h._isDisposed=!1,h._nrRenderers=0,h._nrOngoingStreamStarts=0,h._msi=0,h._chainedApiPromise=new l.default(t.createChild((function(){return"RemoteStreamChain("+h._context.nrRunningStreams+")"}))),h._remoteVideoId=o,h.rank=g++;var f=h._getProperties(h._callHandler,h._remoteVideoId,{endpointId:{propKey:p.Property.VideoEndpointId},participantId:{propKey:p.Property.VideoParticipantLegId},negotiationTag:{propKey:p.Property.VideoNegotiationTag}},{mediaType:{propKey:p.Property.VideoType},videoStatus:{propKey:p.Property.VideoStatus},msi:{propKey:p.Property.VideoRank}});h._mediaType=f.mediaType,h._videoStatus=f.videoStatus;var _=c.generateCauseId();return h._logger.info("constructor causeId: "+_),h._onVideoObjectPropertyChanged(p.Property.VideoStatus,(function(e){return h._onVideoObjectStateChanged(_)})),h._onVideoObjectPropertyChanged(p.Property.VideoNegotiationTag,(function(e){return h._onVideoNegotiationTagChanged(e.value)})),h.endpointId=f.endpointId,h.participantId=f.participantId,h._msi=f.msi,h.negotiationTag=f.negotiationTag,h}return i(t,e),t.prototype.getDiagnosticData=function(){return JSON.stringify({id:this.id,rank:this.rank,type:this.type,isAvailable:this.isAvailable,isStreaming:this.isStreaming,negotiationTag:this.negotiationTag,video_status:this._videoStatus,msi:this._msi,shouldRun:this._shouldRun,nrRenderers:this._nrRenderers,isDisposed:this._isDisposed})},Object.defineProperty(t.prototype,"isAvailable",{get:function(){return u.isVideoAvailable(this._videoStatus)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isStreaming",{get:function(){return this._videoStatus===p.VideoStatus.Running},enumerable:!0,configurable:!0}),t.prototype.isActive=function(){return this.isAvailable&&this.isStreaming},t.prototype.start=function(e,t){return o(this,void 0,void 0,(function(){var n,r,i,o,s,l,d,h,p=this;return a(this,(function(a){switch(a.label){case 0:n=Date.now(),r=n,i=n,o=c.generateCauseId(),this._shouldRun=!0,this._nrOngoingStreamStarts++,this._logger.info("start causeId: "+o),a.label=1;case 1:return a.trys.push([1,8,9,10]),[4,u.waitForVideoObjectToBeAvailable(this._slimcoreInstance,this._callHandler,this._remoteVideoId,this._logger,0,this._stateCancelEvent)];case 2:return a.sent(),r=Date.now(),[4,this._chainedApiPromise.chainPromise((function(){return p._startVideo(o,e,t)}),this._chainActionFn("start"),o)];case 3:s=a.sent(),i=Date.now(),a.label=4;case 4:return a.trys.push([4,6,,7]),this._throwIfDisposed(o,"disposed while in start"),[4,u.waitForVideoObjectToBeRunning(this._slimcoreInstance,this._callHandler,this._remoteVideoId,this._logger,0,this._stateCancelEvent)];case 5:return a.sent(),this._updateVideoStatus(o),h=Date.now(),this._logger.info("start causeId: "+o+" successful. duration: "+(h-n)+" ("+(r-n)+"+"+(i-r)+"+"+(h-i)+")"),[2,s];case 6:throw l=a.sent(),s.dispose(),l;case 7:return[3,10];case 8:throw d=a.sent(),h=Date.now(),this._logger.warn("start causeId: "+o+" failed. duration: "+(h-n)+" ("+(r-n)+"+"+(i-r)+"+"+(h-i)+") error: "+d),d;case 9:return this._nrOngoingStreamStarts--,[7];case 10:return[2]}}))}))},t.prototype.stop=function(){return o(this,void 0,void 0,(function(){var e;return a(this,(function(t){switch(t.label){case 0:return e=c.generateCauseId(),[4,this._stopWithCauseId(this._chainActionFn("stop"),e)];case 1:return t.sent(),[2]}}))}))},t.prototype.dispose=function(){var e=c.generateCauseId();this._disposeWithCauseId(this._chainActionFn("dispose"),e)},t.prototype.disposeInternal=function(){return o(this,void 0,void 0,(function(){var e;return a(this,(function(t){switch(t.label){case 0:return e=c.generateCauseId(),[4,this._disposeWithCauseId(this._chainActionFn("disposeInternal"),e)];case 1:return t.sent(),[2]}}))}))},t.prototype._stopWithCauseId=function(e,t){return o(this,void 0,void 0,(function(){var n=this;return a(this,(function(r){switch(r.label){case 0:return this._shouldRun=!1,this._stateCancelEvent.fire(),[4,this._chainedApiPromise.chainPromise((function(){return n._stopVideo(t,!1)}),e,t)];case 1:return r.sent(),[2]}}))}))},t.prototype.registerRenderer=function(e){this._nrRenderers++},t.prototype.unregisterRenderer=function(e){if(0==--this._nrRenderers&&0===this._nrOngoingStreamStarts){var t=c.generateCauseId();this._stopWithCauseId(this._chainActionFn("renderers disposed"),t)}},t.prototype._chainActionFn=function(e){var t=this;return function(){return e+" ["+t._participantId+":"+t._remoteVideoId+":"+t.rank+":"+t._mediaType+":"+t._videoStatus+"]"}},t.prototype._isVideoStatusInStopping=function(){return this._videoStatus===p.VideoStatus.Stopping},t.prototype._updateVideoStatus=function(e){var t=this._getIntProperty(this._callHandler,this._remoteVideoId,p.Property.VideoStatus);this._videoStatus!==t&&(this._logger.info("VideoStateChanged: causeId: "+e+" status: "+this._videoStatus+" -> "+t),this._videoStatus=t,this._isVideoStatusInStopping()&&this._videoWasStopped(e),this.raiseChanged())},t.prototype._disposeWithCauseId=function(e,t){return o(this,void 0,void 0,(function(){var n=this;return a(this,(function(r){switch(r.label){case 0:return this._isDisposed=!0,this._shouldRun=!1,this._stateCancelEvent.fire(),[4,this._chainedApiPromise.chainPromise((function(){return n._dispose(t)}),e,t)];case 1:return r.sent(),[2]}}))}))},t.prototype._onVideoObjectPropertyChanged=function(e,t){this._onObjectPropertyChanged(this.id,e,t)},t.prototype._onVideoObjectStateChanged=function(e){this._updateVideoStatus(e)},t.prototype._onVideoNegotiationTagChanged=function(e){this.negotiationTag!==e&&(this.negotiationTag=e,this.raiseChanged())},t.prototype._videoWasStopped=function(e){this._stopWithCauseId(this._chainActionFn("discovered video stopped"),e)},t.prototype._isRunning=function(){return!!this._videoBinding},t.prototype._stopVideo=function(e,t){return o(this,void 0,void 0,(function(){return a(this,(function(n){switch(n.label){case 0:return this._shouldRun&&!t&&!this._isVideoStatusInStopping()||!this._isRunning()?[3,3]:(this._logger.info("_stopVideo causeId: "+e+" force: "+t+" will stop remote video now"),this._slimcoreInstance.videoStop(this._remoteVideoId),[4,u.forgetAndLog(this._slimcoreInstance.videoReleaseBinding(this._remoteVideoId,this._videoBinding),this._logger,"_stopVideo causeId: "+e+" videoReleaseBinding on remote video failed")]);case 1:return n.sent(),this._videoBinding=null,[4,u.waitForVideoObjectToBeStopped(this._slimcoreInstance,this._callHandler,this._remoteVideoId,this._logger)];case 2:return n.sent(),this._context.nrRunningStreams--,this._logger.info("_stopVideo causeId: "+e+" force: "+t+" remote video is stopped"),this._updateVideoStatus(e),this._context.videoStoppedEvent.fire(),[3,4];case 3:this._logger.info("_stopVideo causeId: "+e+" noop, force: "+t+" should run: "+this._shouldRun+" is running: "+this._isRunning()+" already disposed: "+this._isDisposed),n.label=4;case 4:return[2]}}))}))},t.prototype._startVideo=function(e,t,n){return o(this,void 0,void 0,(function(){var r,i;return a(this,(function(o){switch(o.label){case 0:return[4,this._getStartedVideo(e)];case 1:r=o.sent(),o.label=2;case 2:return o.trys.push([2,3,,6]),this._updateVideoStatus(e),this._logger.info("_startVideo causeId: "+e+" create renderer"),[2,new h.default(this._logger,this._settings,null,t,this._mediaType,this._videoBinding,n,this)];case 3:return i=o.sent(),r?[4,u.forgetAndLog(this._stopVideo(e,!0),this._logger,"_startVideo causeId: "+e+" stopping remote video failed while got error while starting video")]:[3,5];case 4:o.sent(),o.label=5;case 5:throw i;case 6:return[2]}}))}))},t.prototype._dispose=function(t){return o(this,void 0,void 0,(function(){return a(this,(function(n){switch(n.label){case 0:return n.trys.push([0,,2,3]),[4,u.forgetAndLog(this._stopVideo(t,!0),this._logger,"_dispose causeId: "+t+" stopping remote video failed")];case 1:return n.sent(),[3,3];case 2:return e.prototype.dispose.call(this),[7];case 3:return[2]}}))}))},t.prototype._getStartedVideo=function(e){return o(this,void 0,void 0,(function(){var t;return a(this,(function(n){switch(n.label){case 0:if(this._throwIfDisposed(e,"disposed while in _getStartedVideo"),!this._shouldRun)throw new Error("_getStartedVideo causeId: "+e+" failing, should not run any more");return this._isRunning()?[3,5]:(this._logger.info("_getStartedVideo causeId: "+e+" will start remote video now"),t=this._createVideoBindingRenderer(e),this._slimcoreInstance.videoStart(this._remoteVideoId),this._settings.enableRemoteStreamVideoBindingRetry?[4,this._videoCreateBinding(e,this._remoteVideoId,t)]:[3,2]);case 1:return n.sent(),[3,4];case 2:return[4,this._slimcoreInstance.videoCreateBinding(this._remoteVideoId,t)];case 3:n.sent(),n.label=4;case 4:return this._context.nrRunningStreams++,this._videoBinding=t,this._logger.info("_getStartedVideo causeId: "+e+" remote video is started"),[2,!0];case 5:return[2,!1]}}))}))},t.prototype._throwIfDisposed=function(e,t){if(this._isDisposed)throw new Error("_throwIfDisposed causeId: "+e+" reason: "+t)},t.prototype._createVideoBindingRenderer=function(e){return this._slimcoreInstance.createVideoBindingRenderer?(this._logger.info("_createVideoBindingRenderer causeId: "+e+" createVideoBindingRenderer"),this._slimcoreInstance.createVideoBindingRenderer({enableDXVA:this._settings.enableDXVA,isLocalPreview:!1})):(this._logger.info("_createVideoBindingRenderer causeId: "+e+" old createVideoBindingRenderer"),SlimCore.createVideoBindingRenderer())},t.prototype._videoCreateBinding=function(e,t,n){return o(this,void 0,void 0,(function(){var r,i,c,l,d,h,p,f=this;return a(this,(function(g){switch(g.label){case 0:r=10,i=200,c=s.defer(),l=this._stateCancelEvent.subscribe((function(){c.reject(new Error("_videoCreateBinding causeId: "+e+" stateCancelEvent got signalled"))})),d=s.defer(),h=this._context.videoStoppedEvent.subscribe((function(){f._logger.info("_videoCreateBinding causeId: "+e+" one of the videos was stopped will wake up for binding retry"),d.resolve()})),g.label=1;case 1:return g.trys.push([1,,3,4]),[4,(p=function(l){return o(f,void 0,void 0,(function(){var o;return a(this,(function(a){switch(a.label){case 0:if(this._throwIfDisposed(e,"disposed while in _videoCreateBinding on retry attempt: "+l),!u.isVideoAvailable(this._videoStatus))throw new Error("_videoCreateBinding causeId: "+e+" video not available any more on retry attempt: "+l);o=d.promise,d=s.defer(),this._logger.info("_videoCreateBinding causeId: "+e+" try to create video binding from slimcore on retry attempt: "+l),a.label=1;case 1:return a.trys.push([1,3,,6]),[4,this._slimcoreInstance.videoCreateBinding(t,n)];case 2:return a.sent(),[3,6];case 3:if(a.sent(),!(l<r))throw new Error("_videoCreateBinding causeId: "+e+" retry attempt: "+l+" exceed");return[4,Promise.race([o,d.promise,c.promise,s.delay(i)])];case 4:return a.sent(),[4,p(l+1)];case 5:return a.sent(),[3,6];case 6:return[2]}}))}))})(1)];case 2:return g.sent(),[3,4];case 3:return l.dispose(),h.dispose(),[7];case 4:return[2]}}))}))},t}(d.default);t.default=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=SlimCore.Enums;function i(e){switch(e){case r.ParticipantFailureReason.NoFailure:case r.ParticipantFailureReason.HostEndedConf:case r.ParticipantFailureReason.AnsweredElsewhere:return 0;case r.ParticipantFailureReason.RecipientUserNotFound:case r.ParticipantFailureReason.RecipientNotOnline:case r.ParticipantFailureReason.PstnCouldNotConnectToSkypeProxy:case r.ParticipantFailureReason.CallNotificationDeliveryFailure:return 4;case r.ParticipantFailureReason.RecipientBlocked:return 5;case r.ParticipantFailureReason.CallerNotFriend:case r.ParticipantFailureReason.CallerNotAuthorized:return 6;case r.ParticipantFailureReason.ConfParticipantCountLimitReached:return 46;case r.ParticipantFailureReason.ConfLobbyParticipantCountLimitReached:return 59;case r.ParticipantFailureReason.PstnNoSkypeoutSubscription:return 7;case r.ParticipantFailureReason.CallNotFound:return 8;case r.ParticipantFailureReason.PstnNetworkError:case r.ParticipantFailureReason.PstnInternetConnectionLost:case r.ParticipantFailureReason.TrouterError:case r.ParticipantFailureReason.GeneralNetworkError:return 9;case r.ParticipantFailureReason.MediaDroppedError:case r.ParticipantFailureReason.SoundRecordingError:case r.ParticipantFailureReason.SoundPlaybackError:return 10;case r.ParticipantFailureReason.PstnInsufficientFunds:return 12;case r.ParticipantFailureReason.PstnCreditExpired:return 26;case r.ParticipantFailureReason.PstnCreditExpiredButEnough:return 27;case r.ParticipantFailureReason.MiscError:case r.ParticipantFailureReason.PstnMiscError:return 11;case r.ParticipantFailureReason.PstnSkypeoutAccountBlocked:return 13;case r.ParticipantFailureReason.PstnBlockedByUs:return 15;case r.ParticipantFailureReason.PstnBlockedRegulatoryIndia:return 16;case r.ParticipantFailureReason.PstnInvalidNumber:return 17;case r.ParticipantFailureReason.PstnNumberForbidden:return 18;case r.ParticipantFailureReason.PstnCallTimedOut:return 2;case r.ParticipantFailureReason.PstnBusy:return 19;case r.ParticipantFailureReason.PstnCallTerminated:return 20;case r.ParticipantFailureReason.PstnNumberUnavailable:return 21;case r.ParticipantFailureReason.PstnCallRejected:return 3;case r.ParticipantFailureReason.PstnEmergencyCallDenied:return 22;case r.ParticipantFailureReason.PstnNoSubscriptionCover:return 25;case r.ParticipantFailureReason.EnterprisePstnForbidden:return 30;case r.ParticipantFailureReason.EnterprisePstnInternalError:return 28;case r.ParticipantFailureReason.EnterprisePstnUnavailable:return 29;case r.ParticipantFailureReason.EnterprisePstnInvalidNumber:return 31;case r.ParticipantFailureReason.EnterprisePstnMiscError:return 32;case r.ParticipantFailureReason.Kicked:return 33;case r.ParticipantFailureReason.NetworkRequestTimeoutError:return 34;case r.ParticipantFailureReason.CallDoesNotExist:return 35;case r.ParticipantFailureReason.MediaSetupFailure:return 36;case r.ParticipantFailureReason.ServiceUnavailable:return 37;case r.ParticipantFailureReason.SignalingError:return 38;case r.ParticipantFailureReason.ConversationEstablishmentFailed:return 39;case r.ParticipantFailureReason.TemporarilyUnavailable:return 40;case r.ParticipantFailureReason.NetworkCannotConnectError:return 41;case r.ParticipantFailureReason.NoSignalingFromPeer:return 42;case r.ParticipantFailureReason.AnonymousJoinDisabledByPolicy:return 53;case r.ParticipantFailureReason.NoLobbyForBroadcastJoin:return 54;case r.ParticipantFailureReason.NotAllowedDueToInformationBarrier:return 55;case r.ParticipantFailureReason.BroadcastLimitReached:return 56;case r.ParticipantFailureReason.B2bJoinDisabledByPolicy:return 57;case r.ParticipantFailureReason.LocationBasedRoutingError:return 58;case r.ParticipantFailureReason.Forbidden:return 52;default:return 11}}t.convertVideoEffectType=function(e){switch(e){case 0:return r.VideoEffectType.Off;case 1:return r.VideoEffectType.BackgroundBlurDefault;case 2:return r.VideoEffectType.BackgroundBlurLight;case 4:return r.VideoEffectType.BackgroundBlurExperimental_1;case 8:return r.VideoEffectType.BackgroundBlurExperimental_2;case 16:return r.VideoEffectType.BackgroundReplacement;case 32:return r.VideoEffectType.WhiteboardZoom;case 64:return r.VideoEffectType.WhiteboardCleanup;case 96:return r.VideoEffectType.WhiteboardZoomAndCleanup;default:return r.VideoEffectType.Off}},t.convertStatusAndFailureReasonToParticipantReason=function(e,t){switch(e){case r.CallStatus.Busy:return 19;case r.CallStatus.CallTimedOut:return 9;case r.CallStatus.Cancelled:return 23;case r.CallStatus.Dropped:return 10;case r.CallStatus.Refused:return 3;case r.CallStatus.Missed:return 2;case r.CallStatus.Failed:return i(t);default:return 0}},t.convertFailureReasonToParticipantReason=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),i=function(){function e(e){var t=this;this._callingLogger=e,this._maybeLog=function(e){for(var n,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];try{(n=t._callingLogger)[e].apply(n,i)}catch(e){t._callingLogger.info("[failed to log]",r.getPrintableObject(e))}}}return e.prototype.getPrefix=function(e,t){var n="";return t&&(n+="["+t+"]"),e&&(n+="["+e+"]"),n},e.prototype.createChild=function(t,n){return new e(this._callingLogger.createChild(t,n))},e.prototype.createFnLogger=function(t,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return new e(this._callingLogger.createChild(this.getPrefix(t,n)+r.join(""),!1))},e.prototype.logSuccess=function(e){this._maybeLog("info","success="+e+"}")},e.prototype.logFailure=function(e){var t=r.getPrintableObject(e);this._maybeLog("info","failed="+t+"}")},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._maybeLog.apply(this,["log"].concat(e))},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._maybeLog.apply(this,["debug"].concat(e))},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._maybeLog.apply(this,["info"].concat(e))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._maybeLog.apply(this,["warn"].concat(e))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._maybeLog.apply(this,["error"].concat(e))},e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4),i=SlimCore.Enums,o=function(){function e(e){this._slimcoreInstance=e}return e.prototype.setEcsConfig=function(e){try{return this._slimcoreInstance.setEcsConfig(e.ecsBlob,e.userIdentity,e.etag,!0),Promise.resolve()}catch(e){return Promise.reject(e)}},e.prototype.shouldTriggerCQF=function(e,t,n){var o=this;return r.asap((function(){return function(n){var r=i.CallType.CallTypeS2s;return 0===n?r=i.CallType.CallTypeGroup:2===n?r=i.CallType.CallTypePstn:1===n&&(r=i.CallType.CallTypeS2s),o._slimcoreInstance.shouldTriggerCQF(e,t,r)}(n)}))},e.prototype.getEcsQueryParameters=function(){try{return Promise.resolve(this._slimcoreInstance.getEcsQueryParameters())}catch(e){return Promise.reject(e)}},e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=function(){function e(e,t){this._slimcoreInstance=e,this._accountIdentity=t}return e.prototype.getSetup=function(){var e=this;return new Promise((function(t,n){r.hasFeature(SlimCore.Enums.Feature.MultiUserSupport)?(e._setup||(e._setup=e._slimcoreInstance.getSetup(e._accountIdentity)),t(e._setup)):n("No Multiuser support")}))},e.prototype.setString=function(e,t){var n=this;return this.getSetup().then((function(){return n._setup.setStr(e,t)})).catch((function(){return n._slimcoreInstance.setupSetStr(e,t)}))},e.prototype.setNumber=function(e,t){var n=this;return this.getSetup().then((function(){return n._setup.setInt(e,t)})).catch((function(){return n._slimcoreInstance.setupSetInt(e,t)}))},e.prototype.getString=function(e){var t=this;return this.getSetup().then((function(){return t._setup.getStr(e)})).catch((function(){return t._slimcoreInstance.setupGetStr(e)}))},e.prototype.getNumber=function(e){var t=this;return this.getSetup().then((function(){return t._setup.getInt(e)})).catch((function(){return t._slimcoreInstance.setupGetInt(e)}))},e.prototype.delete=function(e){var t=this;return this.getSetup().then((function(){return t._setup.delete(e)})).catch((function(){return t._slimcoreInstance.setupDelete(e)}))},e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),i=function(){function e(e){this.subscriptions=[],this.eventLogger=e}return e.prototype.subscribe=function(e){return new o(this.subscriptions,e)},e.prototype.dispose=function(e){this.subscriptions=[]},e.prototype.raiseEvents=function(e){var t=this;this.subscriptions.slice().forEach((function(n){try{void 0!==n.eventHandler&&e(n.eventHandler)}catch(e){t.eventLogger&&t.eventLogger.warn&&t.eventLogger.warn("Event handler exception caught!",e)}}))},e}();t.EventSourceImpl=i;var o=function(){function e(e,t){this.subscriptions=e,this.eventHandler=t,this.subscriptions.push(this)}return e.prototype.dispose=function(){var e=this;r.remove(this.subscriptions,(function(t){return t===e})),this.eventHandler=void 0},e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(6),i=n(5),o=n(4),a=n(2),s=n(9),c=function(){function e(e){var t=this;this._disposed=!1,this._logger=e.createChild("[ASYNC]"),this._endOperationDeferred=o.defer(),this._endOperationDeferred.promise.catch((function(e){t._logger.info("Rejected all operations")})),this._deferredOperations={},this._deferredOperationsWithOperationId={},this._deferredOperationsWithCauseId={},this._logger=e}return e.prototype.registerPromise=function(e,t){var n=!1,r=function(){n=!0};t.then(r,r);var i=this._endOperationDeferred.promise.catch((function(t){if(!n)throw new Error("Operation "+e+" did not complete, reason:"+t)}));return Promise.race([i,t])},e.prototype.updateOperationId=function(e,t){var n=this;this._logger.info("updateOperationId "+e+" "+t),Object.keys(this._deferredOperationsWithOperationId).forEach((function(r){r&&n._deferredOperationsWithOperationId[r]&&(n._logger.info("_deferredOperationsWithOperationId "+r),Object.keys(n._deferredOperationsWithOperationId[r]).forEach((function(i){i&&n._deferredOperationsWithOperationId[r][i]&&(n._logger.info("_deferredOperationsWithOperationId "+i+" "+t),i===e&&(n._deferredOperationsWithOperationId[r][t]=n._deferredOperationsWithOperationId[r][i],delete n._deferredOperationsWithOperationId[r][i]))})))})),Object.keys(this._deferredOperationsWithCauseId).forEach((function(r){r&&n._deferredOperationsWithCauseId[r]&&(n._logger.info("_deferredOperationsWithCauseId "+r),Object.keys(n._deferredOperationsWithCauseId[r]).forEach((function(i){i&&n._deferredOperationsWithCauseId[r][i]&&(n._logger.info("_deferredOperationsWithCauseId "+i+" "+t),i===e&&(n._deferredOperationsWithOperationId[r][t]=n._deferredOperationsWithOperationId[r][i],delete n._deferredOperationsWithOperationId[r][i]))})))}))},e.prototype.createPendingOperation=function(e,t,n){var s=this;void 0===n&&(n=a.generateCauseId());var c=o.defer();c.promise.catch(r.noop);var l=this.getOperationInfoForLogging(n,e,t);if(this._logger.info(l+"[creating...]"),this._disposed)return this._logger.info(l+"[create failed, call is disposed]"),Promise.reject(60);if(t){if(this._deferredOperationsWithOperationId[e]||(this._deferredOperationsWithOperationId[e]={}),this._deferredOperationsWithOperationId[e][t])return this._logger.warn(l+" Deferred operation with given name and operation id is already defined"),Promise.reject(new Error("Deferred operation with given name is already defined:"+e+"/"+i.scrubMriOrOmit(t)));this._deferredOperationsWithOperationId[e][t]={deferred:c,causeId:n},this._deferredOperationsWithCauseId[n]||(this._deferredOperationsWithCauseId[n]={}),this._deferredOperationsWithCauseId[n][t]=c}else{if(this._deferredOperations[e])return this._logger.warn(l+" Deferred operation with given name is already defined"),Promise.reject(new Error("Deferred operation with given name is already defined:"+e));this._deferredOperationsWithCauseId[n]||(this._deferredOperationsWithCauseId[n]={}),this._deferredOperationsWithCauseId[n][""]=c,this._deferredOperations[e]={deferred:c,causeId:n}}var u=this._endOperationDeferred.promise.catch((function(n){return s.hasPendingOperation(e,t)?Promise.reject(new Error("Operation "+e+" did not complete, reason:"+n)):Promise.resolve(void 0)}));return Promise.race([u,c.promise])},e.prototype.hasPendingOperation=function(e,t){return t?!!this._deferredOperationsWithOperationId[e]&&!!this._deferredOperationsWithOperationId[e][t]:!!this._deferredOperations[e]},e.prototype.hasPendingOperationWithCauseId=function(e,t){return t||(t=""),!!this._deferredOperationsWithCauseId[e][t]},e.prototype.getPendingOperationWithCauseId=function(e,t){return this.hasPendingOperationWithCauseId(e,t)?this._deferredOperationsWithCauseId[e][t].promise:Promise.reject("["+e+"]["+t+"]: getPendingOperationWithCauseId for given causeId, operationId")},e.prototype.resolveOperationWithCauseId=function(e,t,n){if(this.hasPendingOperationWithCauseId(e)){t||(t="");var r=this._deferredOperationsWithCauseId[e][t],i=r.promise;return r.resolve(n),this._logger.info("["+e+"]["+t+"] resolved, result="+(s.getPrintableObject(n)||"void")),delete this._deferredOperationsWithCauseId[e][t],i}return Promise.reject("["+e+"]["+t+"] resolveOperationWithCauseId failed, operation not found")},e.prototype.rejectOperationWithCauseId=function(e,t,n){if(this.hasPendingOperationWithCauseId(e)){t||(t="");var i=this._deferredOperationsWithCauseId[e][t],o=i.promise;return o.catch(r.noop),i.reject(n),this._logger.info("["+e+"]["+t+"] rejected, result="+(s.getPrintableObject(n)||"void")),delete this._deferredOperationsWithCauseId[e][t],o}return Promise.reject("["+e+"]["+t+"] rejectOperationWithCauseId failed, operation not found")},e.prototype.maybeResolveOperationWithCauseId=function(e,t,n){var r=this;this.hasPendingOperationWithCauseId(e,t)?this.resolveOperationWithCauseId(e,t,n).catch((function(t){r._logger.info(e+"maybeResolveOperationWithCauseId failed, reason="+s.getPrintableObject(t))})):this._logger.info(e+"maybeResolveOperationWithCauseId ignored, operation does not exist")},e.prototype.maybeRejectOperationWithCauseId=function(e,t,n){this.hasPendingOperationWithCauseId(e,t)?this.rejectOperationWithCauseId(e,t,n).catch(r.noop):this._logger.info(e+"maybeRejectOperationWithCauseId ignored, operation does not exist")},e.prototype.getPendingOperation=function(e,t,n){return void 0===n&&(n=a.generateCauseId()),!t&&this._deferredOperations[e]?this._deferredOperations[e].deferred.promise:this._deferredOperationsWithOperationId[e]&&this._deferredOperationsWithOperationId[e][t]?this._deferredOperationsWithOperationId[e][t].deferred.promise:Promise.reject(this.getOperationInfoForLogging(n,e,t)+": Deferred operation with given name and operation does not exist")},e.prototype.waitForOperation=function(e,t,n){return void 0===n&&(n=a.generateCauseId()),this.hasPendingOperation(e)?this._deferredOperations[e].deferred.promise:this.hasPendingOperation(e,t)?this._deferredOperationsWithOperationId[e][t].deferred.promise:Promise.reject(this.getOperationInfoForLogging(n,e,t)+"failed=wait failed, operation not found")},e.prototype.resolveOperation=function(e,t,n,r,i){if(void 0===r&&(r=a.generateCauseId()),void 0===i&&(i=!1),!e)return Promise.reject("Unable to resolve deferred operation with empty name");if(this.hasPendingOperation(e)){var o=this._deferredOperations[e],c=this._deferredOperations[e].deferred.promise;return this._deferredOperations[e].deferred.resolve(t),this._logger.info(this.getOperationInfoForLogging(o.causeId,e,n)+"resolved, result="+(s.getPrintableObject(t)||"void")),i||delete this._deferredOperations[e],c}return this.hasPendingOperation(e,n)?(c=(o=this._deferredOperationsWithOperationId[e][n]).deferred.promise,o.deferred.resolve(t),this._logger.info(this.getOperationInfoForLogging(o.causeId,e,n)+"resolved, result="+(s.getPrintableObject(t)||"void")),i||delete this._deferredOperationsWithOperationId[e][n],c):Promise.reject(this.getOperationInfoForLogging(r,e,n)+"failed=resolve failed, operation not found")},e.prototype.rejectOperation=function(e,t,n,i){return void 0===i&&(i=a.generateCauseId()),e?this.hasPendingOperation(e)?((c=(o=this._deferredOperations[e]).deferred.promise).catch(r.noop),o.deferred.reject(t),this._logger.info(this.getOperationInfoForLogging(o.causeId,e,n)+"rejected, reason="+(s.getPrintableObject(t)||"void")),delete this._deferredOperations[e],c):this.hasPendingOperation(e,n)?((c=(o=this._deferredOperationsWithOperationId[e][n]).deferred.promise).catch(r.noop),o.deferred.reject(t),this._logger.info(this.getOperationInfoForLogging(o.causeId,e,n)+"rejected, reason="+(s.getPrintableObject(t)||"void")),delete this._deferredOperationsWithOperationId[e][n],c):Promise.reject(this.getOperationInfoForLogging(i,e,n)+"failed=reject failed, operation not found"):Promise.reject("Unable to reject deferred operation with empty name");var o,c},e.prototype.maybeResolveOperation=function(e,t,n,r){var i=this;void 0===r&&(r=a.generateCauseId());var o=this.getOperationInfoForLogging(r,e,n);this.hasPendingOperation(e,n)?this.resolveOperation(e,t,n,r).catch((function(e){i._logger.info(o+"maybeResolveOperation failed, reason="+s.getPrintableObject(e))})):this._logger.info(o+"maybeResolveOperation ignored, operation does not exist")},e.prototype.maybeRejectOperation=function(e,t,n,i){void 0===i&&(i=a.generateCauseId());var o=this.getOperationInfoForLogging(i,e,n);this.hasPendingOperation(e,n)?this.rejectOperation(e,t,n,i).catch(r.noop):this._logger.info(o+"maybeRejectOperation ignored, operation does not exist")},e.prototype.rejectPendingOperations=function(e,t){var n=this;void 0===t&&(t=a.generateCauseId()),this._disposed=!0,this._logger.info("["+t+"]rejectPendingOperations="+e),Object.keys(this._deferredOperations).forEach((function(r){n.maybeRejectOperation(r,e,void 0,t),n._deferredOperationsWithOperationId[t]&&delete n._deferredOperationsWithOperationId[t][""]})),Object.keys(this._deferredOperationsWithOperationId).forEach((function(r){Object.keys(n._deferredOperationsWithOperationId[r]).forEach((function(i){n.maybeRejectOperation(r,e,i,t),n._deferredOperationsWithOperationId[t]&&delete n._deferredOperationsWithOperationId[t][i]}))})),this._deferredOperations={},this._deferredOperationsWithOperationId={},this._endOperationDeferred.reject(e)},e.prototype.getOperationInfoForLogging=function(e,t,n){return void 0===n&&(n=""),"["+e+"]["+t+"]"+(n?"["+i.scrubMriOrOmit(n)+"]":"")},e}();t.default=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=/;aliases=.*$/i;t.MRI_SKYPE_PREFIX="8:",t.MRI_ALIAS_PREFIX=";aliases=",t.MRI_SIP_PREFIX="2:",t.stripMriAliases=function(e){return e?e.replace(r,""):e},t.generateAliasedMri=function(e,n){var r=e;return n&&(r+=t.MRI_ALIAS_PREFIX+t.MRI_SIP_PREFIX+n),r}},function(e,t,n){"use strict";var r,i,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(1),s=n(3),c=n(11),l=n(12),u=n(17),d=n(5),h=n(0),p=n(19),f=SlimCore.Enums,g=n(8),_=n(13),m=n(2),v=n(25),y=n(44),C=((i={})[0]=[1,2,3,4,6,7,5],i[1]=[2,3,4,6,7,0],i[2]=[0,1,3,4,6,7],i[3]=[2,1,4,5,0,7],i[4]=[0],i[5]=[3,4,0],i[6]=[3,4,0],i[7]=[3,4,0],i);t.participantStrProps={displayName:{propKey:f.Property.ParticipantDisplayName},role:{propKey:f.Property.ParticipantRole},tenantId:{propKey:f.Property.ParticipantTenantId},acceptedBy:{propKey:f.Property.ParticipantAcceptedBy},endpointDetails:{propKey:f.Property.ParticipantEndpointDetails},meetingRole:{propKey:f.Property.ParticipantMeetingRole}},t.participantIntProps={isServerMuted:{propKey:f.Property.ParticipantIsServerMuted},capabilities:{propKey:f.Property.ParticipantCapabilities,fallback:SlimCore.Enums.Capability.All},contentRole:{propKey:f.Property.ParticipantContentRole,fallback:f.ContentSharingRole.None},status:{propKey:f.Property.ParticipantStatus},failure:{propKey:f.Property.ParticipantFailureReason}};var S=function(e){function n(t,r,i,o,a,s,c,l,u,h){var p;void 0===c&&(c=0),void 0===u&&(u=!1);var f=e.call(this,t.createChild((function(){return"ICallParticipant["+d.scrubMriOrOmit(f.id)+"]["+f.state+"]["+f.slimcoreObjectId+"]"})),r,i)||this;return f._callHandler=a,f._streamContextMap=s,f._callTelemetry=l,f.streams=((p={})[0]=[],p[1]=[],p),f.voiceLevel=0,f.isServerMuted=!1,f.dominantSpeakerRank=0,f.state=0,f.id=null,f.role=null,f.tenantId=null,f.balanceUpdates={},f.enableParticipantLegToSourceIdMapping=!0,f._logger.info("created"),f.id=v.stripMriAliases(o),f.participantCapabilities=n.convertCapabilities(SlimCore.Enums.Capability.All),c&&0!==c&&f.attachSlimcoreObjectId(c,"ctor",u,h),f._slimcoreInstance.ecsGetSettingAsBool&&(f.enableParticipantLegToSourceIdMapping=f._slimcoreInstance.ecsGetSettingAsBool("SkypeCalling","enableParticipantLegToSourceIdMapping",!0)),f._logger.info("enableParticipantLegToSourceIdMapping = "+f.enableParticipantLegToSourceIdMapping),f}return o(n,e),n.prototype.getDiagnosticData=function(){return JSON.stringify({id:this.id,slimcoreObjectId:this.slimcoreObjectId,state:this.state,isServerMuted:this.isServerMuted})},n.prototype.attachSlimcoreObjectId=function(e,r,i,o){var a=this;if(void 0===i&&(i=!1),this.slimcoreObjectId&&0!==this.slimcoreObjectId)return this._callTelemetry.recordEvent(g.PARTICIPANT_OPERATIONS_INTERNAL.ELECTRON_ATTACH_SLIMCORE_PARTICIPANT_FAILED,{attachParticipantId:e,reason:"Participant already attached to a SlimCore object"},r),void this._logger.debug("Attach called on existing participant");this.slimcoreObjectId=e;var s=o&&o.props||this._getProperties(this._callHandler,this.slimcoreObjectId,t.participantStrProps,t.participantIntProps);this.displayName=s.displayName,this.role=s.role,this.tenantId=s.tenantId,this.participantCapabilities=n.convertCapabilities(s.capabilities),this.acceptedBy=s.acceptedBy,this.isServerMuted=!!s.isServerMuted,this.meetingRole=s.meetingRole,this._slimCoreElectronRemoteStreamManager=new u.default(this._logger,this._settings,this._slimcoreInstance,this._callHandler,this.slimcoreObjectId,this.streams,this._streamContextMap,i),this._slimCoreElectronRemoteStreamManager.changed((function(){return a.raiseChanged()})),this._updateEndpointDetails(s.endpointDetails),this._onParticipantPropertyChanged(f.Property.ParticipantStatus,(function(e){return a._onStatusChanged(e.value)})),this._onParticipantPropertyChanged(f.Property.ParticipantIsServerMuted,(function(e){return a._onIsServerMuted(!!e.value)})),this._onParticipantPropertyChanged(f.Property.ParticipantFailureReason,(function(e){return a._onFailureReasonChange(e.value)})),this._onParticipantPropertyChanged(f.Property.ParticipantAdmitFailureReason,(function(e){return a._onAdmitFailureReasonChange(e.value)})),this._onParticipantPropertyChanged(f.Property.ParticipantRemoveFailureReason,(function(e){return a._onRemoveFailureReasonChange(e.value)})),this._onParticipantPropertyChanged(f.Property.ParticipantIsActiveSpeaker,(function(e){return a.setVoiceLevel(e.value)})),this._onParticipantPropertyChanged(f.Property.ParticipantDominantSpeakerRank,(function(e){return a._onDominantSpeakerRankChanged(e.value)})),this._onParticipantPropertyChanged(f.Property.ParticipantEndpointDetails,(function(e){return a._updateEndpointDetails(e.value)})),this._onParticipantPropertyChanged(f.Property.ParticipantCapabilities,(function(e){return a._onCapabilitiesChanged(e.value)})),this._onParticipantPropertyChanged(f.Property.ParticipantAcceptedBy,(function(e){return a._onAcceptedByChanged(e.value)})),this._onParticipantPropertyChanged(f.Property.ParticipantRole,(function(e){return a._onRoleChanged(e.value)})),this._onParticipantPropertyChanged(f.Property.ParticipantTenantId,(function(e){return a._onTenantIdChanged(e.value)})),this._onParticipantPropertyChanged(f.Property.ParticipantContentRole,(function(e){return a._onParticipantContentSharingRoleChanged(e.value)})),this._onParticipantPropertyChanged(f.Property.ParticipantBalanceUpdate,(function(e){return a._onBalanceUpdateChanged(e.value)})),this._onParticipantPropertyChanged(f.Property.ParticipantDiagnosticsCode,(function(e){return a._onParticipantDiagnosticsCodeChanged(e.value)})),this._onParticipantPropertyChanged(f.Property.ParticipantMeetingRole,(function(e){return a._onMeetingRoleChanged(e.value)})),this._onParticipantPropertyChanged(f.Property.ParticipantMriIdentity,(function(e){return a._onMriChanged(e.value)})),this._onParticipantPropertyChanged(f.Property.ParticipantDisplayName,(function(e){return a._onDisplayNameChanged(e.value)})),this._onStatusChanged(s.status,!1,s.failure),this._onParticipantContentSharingRoleChanged(s.contentRole)},n.prototype.getStrProperty=function(e,t){return this._getStrProperty(this._callHandler,this.slimcoreObjectId,e,t)},n.prototype.getIntProperty=function(e,t){return this._getIntProperty(this._callHandler,this.slimcoreObjectId,e,t)},n.prototype._onParticipantPropertyChanged=function(e,t){this._onObjectPropertyChanged(this.slimcoreObjectId,e,t)},n.prototype._onCapabilitiesChanged=function(e){var t=n.convertCapabilities(e);t!==this.participantCapabilities&&(this._logger.info("Computed capabilities: "+JSON.stringify(t)),this.participantCapabilities=t,this.raiseChangedDeferred())},n.prototype._onAcceptedByChanged=function(e){e!==this.acceptedBy&&(this._logger.info("Accepted by is set to "+d.scrubMriOrOmit(e)),this.acceptedBy=e,this.raiseChanged())},n.prototype._onRoleChanged=function(e){e!==this.role&&(this._logger.info("Role is set to "+e),this.role=e,this.raiseChanged())},n.prototype._onTenantIdChanged=function(e){e!==this.tenantId&&(this._logger.info("TenantId is set to "+e),this.tenantId=e,this.raiseChanged())},n.prototype._onMeetingRoleChanged=function(e){e!==this.meetingRole&&(this._logger.info("_onMeetingRoleChanged meetingRole: "+e),this.meetingRole=e,this.raiseChanged())},n.prototype._onMriChanged=function(e){e!==this.id&&(this._logger.info("_onMriChanged from old mri "+d.scrubMriOrOmit(this.id)+" to new Mri: "+d.scrubMriOrOmit(e)),this.previousId=this.id,this.id=e,this.raiseChanged())},n.prototype._onDisplayNameChanged=function(e){e!==this.displayName&&(this._logger.info("_onDisplayNameChanged new displayName: "+d.scrubMriOrOmit(e)),this.displayName=e,this.raiseChanged())},n.prototype.raiseChangedDeferred=function(){var e=this;this._raiseChangedDefer||(this._raiseChangedDefer=a.defer((function(){delete e._raiseChangedDefer,e.raiseChanged()})))},n.prototype._getParticipantIdForSourceId=function(e,t){try{if(null!=this.endpoints)for(var n=0,r=this.endpoints.endpointDetails;n<r.length;n++){var i=r[n];if(null!=i&&null!=i.mediaStreams)for(var o=0,a=i.mediaStreams;o<a.length;o++){var s=a[o];if(t===s.sourceId&&h.mapMediaTypeStringToMediaType(s.type)===e)return null!=i.participantId?i.participantId:null}}}catch(e){this._logger.error("getSourceIdForMediaType caught exception error="+e)}},n.prototype.getParticipantIdForSourceId=function(e,t){var n=this._getParticipantIdForSourceId(e,t);return n||this._logger.warn("participantId is "+n+" for mediaType: "+e+", sourceId: "+t),n},n.prototype.hasSourceId=function(e,t){return this.enableParticipantLegToSourceIdMapping?void 0!==this._getParticipantIdForSourceId(e,t):this.getSourceIdForMediaType(e)===t},n.prototype.getSourceIdForMediaType=function(e){var t=-1;try{if(this.endpoints)e:for(var n=0,r=this.endpoints.endpointDetails;n<r.length;n++){var i=r[n];if(null!==i&&void 0!==i.mediaStreams)for(var o=0,a=i.mediaStreams;o<a.length;o++){var s=a[o];if(h.mapMediaTypeStringToMediaType(s.type)===e){t=s.sourceId;break e}}else t=l.DATA_SOURCE_ID_ANY}}catch(e){this._logger.error("getSourceIdForMediaType caught exception error="+e)}return t},n.prototype.getSourceId=function(e,t){if(!this.enableParticipantLegToSourceIdMapping)return this.getSourceIdForMediaType(t);if(!this.endpoints)return this._logger.warn("endpoints is invalid"),-1;try{var n=a.find(this.endpoints.endpointDetails,(function(t){return null!=t&&t.participantId===e}));if(!n)return this._logger.warn("participantId not found: "+e),this.getSourceIdForMediaType(t);if(!n.mediaStreams)return this._logger.warn("participantLeg "+e+" does not have valid mediaStreams"),this.getSourceIdForMediaType(t);var r=a.find(n.mediaStreams,(function(e){return h.mapMediaTypeStringToMediaType(e.type)===t}));return r?r.sourceId:(this._logger.warn("participantLeg "+e+" has no channel of type "+t),-1)}catch(e){this._logger.error("getSourceId caught exception error="+e)}return-1},n.prototype._isScreenSharerStream=function(e){return"sendonly"===e.direction&&"applicationsharing-video"===e.label},n.prototype.getSharingParticipantLeg=function(){var e=this;if(this.endpoints&&this.endpoints.endpointDetails){if(1===this.endpoints.endpointDetails.length)return this.endpoints.endpointDetails[0].participantId;var t=a.find(this.endpoints.endpointDetails,(function(t){return null!=t&&null!=t.mediaStreams&&a.some(t.mediaStreams,(function(t){return e._isScreenSharerStream(t)}))}));if(t){if(t.participantId)return t.participantId;this._logger.warn("invalid participantId")}else this._logger.warn("could not find sharer")}else this._logger.warn("endpoints are not defined")},n.getEndpointDetailsLogString=function(e){if(!e||!e.endpointDetails)return"";var t=[];return e.endpointDetails.forEach((function(e){t.push({participantId:e.participantId,endpointId:e.endpointId,clientVersion:e.clientVersion,mediaStreams:e.mediaStreams})})),JSON.stringify(t)},n.prototype._updateEndpointDetails=function(e){var t=m.generateCauseId();if(this._rawEndpoints!==e&&e){try{this.endpoints=JSON.parse(e),this._rawEndpoints=e,this._logger.info("Updating endpointDetails: "+n.getEndpointDetailsLogString(this.endpoints)),this._callTelemetry.recordEvent(g.PARTICIPANT_OPERATIONS_INTERNAL.UPDATE_PARTICIPANT_STREAM,y.getStreamInformationFromEndpoints(this.endpoints),t)}catch(t){return void this._logger.warn("Failed to parse call member endpointDetails - "+t+" -"+e)}this.raiseChanged()}},n.prototype._onStatusChanged=function(e,t,r){void 0===t&&(t=!0);var i=m.generateCauseId();this._logger.info("["+i+"]Status changed "+e+" ("+f.CallStatus[e]+")");var o=void 0!==r?r:this.getIntProperty(f.Property.ParticipantFailureReason),a=n.convertParticipantStatus(e);void 0!==a?(this.setState(a,i,p.convertStatusAndFailureReasonToParticipantReason(e,o),t),this._admitParticipantDeffered&&n.isParticipantActive(this.state)&&(this._admitParticipantDeffered.resolve(),this._admitParticipantDeffered=null),this._removeParticipantDeffered&&!n.isParticipantActive(this.state)&&(this._removeParticipantDeffered.resolve(),this._removeParticipantDeffered=null)):this._logger.warn("Unrecognized "+a)},n.prototype._onParticipantContentSharingRoleChanged=function(e){this._logger.info("Content sharing role changed "+e+" ("+f.ContentSharingRole[e]+")"),this.setContentSharingRole(n.convertContentSharingRole(e))},n.prototype._onFailureReasonChange=function(e){var t=m.generateCauseId();this._logger.info("["+t+"]Failure reason changed "+e+" ("+f.ParticipantFailureReason[e]+")");var r=this.getIntProperty(f.Property.ParticipantStatus);this.setState(n.convertParticipantStatus(r),t,p.convertFailureReasonToParticipantReason(e))},n.prototype._onAdmitFailureReasonChange=function(e){this._logger.info("Admit failure reason changed "+e+" ("+f.ParticipantFailureReason[e]+")");var t=p.convertFailureReasonToParticipantReason(e);this.rejectAdmitParticipantDeferred(t)},n.prototype._onRemoveFailureReasonChange=function(e){this._logger.info("Remove failure reason changed "+e+" ("+f.ParticipantFailureReason[e]+")");var t=p.convertFailureReasonToParticipantReason(e);this.rejectRemoveParticipantDeferred(t)},n.prototype.setVoiceLevel=function(e){this.voiceLevel!==e&&(this.voiceLevel=e,this.raiseChanged())},n.prototype._onIsServerMuted=function(e){e!==this.isServerMuted&&(this.isServerMuted=e,this.raiseChanged())},n.prototype._onDominantSpeakerRankChanged=function(e){this.dominantSpeakerRank!==e&&(this._logger.info("DominantSpeakerRank changing from "+this.dominantSpeakerRank+" to "+e),this.dominantSpeakerRank=e,this.raiseChanged())},n.prototype._onBalanceUpdateChanged=function(e){if(a.isEmpty(e))a.isEmpty(this.balanceUpdates)||(this.balanceUpdates={},this.raiseChanged());else{try{var t=JSON.parse(e);if(a.isEqual(this.balanceUpdates[t.sender.endpointId],t))return;this.balanceUpdates[t.sender.endpointId]=t}catch(t){return void this._logger.warn("Failed to parse call member balanceUpdate - "+t+" -"+e)}this.raiseChanged()}},n.prototype._onParticipantDiagnosticsCodeChanged=function(e){this._logger.info("_onParticipantDiagnosticsCodeChanged diagnosticsCode: "+e),this._updateDiagnosticsCode(e)},n.prototype._updateDiagnosticsCode=function(e){if(this._rawCallEndDiagnosticsInfo!==e&&e)try{this.callEndDiagnosticsInfo=JSON.parse(e),this._rawCallEndDiagnosticsInfo=e,this.raiseChanged()}catch(t){this._logger.info("Failed to parse raw diagnostis details. Error: "+t+", diagnosticsCode: "+e)}},n.prototype.setContentSharingRole=function(e){this.contentSharingRole!==e&&(this.contentSharingRole=e,this.raiseChanged())},n.prototype.setState=function(e,t,n,r){if(void 0===r&&(r=!0),this.state!==e){var i=this._logger.createFnLogger("setState",t),o=C[this.state].indexOf(e)>=0,a={state:this.state,reason:this.stateReason,endpoints:[]};if(this.endpoints&&this.endpoints.endpointDetails&&this.endpoints.endpointDetails.length&&(a.endpoints=_.getEndpointInformationForTelemetry(this.endpoints.endpointDetails)),!o)return i.logFailure("Invalid state transition "+this.state+"->"+e+" attempted"),void this._callTelemetry.recordEvent(g.PARTICIPANT_OPERATIONS_INTERNAL.SET_PARTICIPANT_STATE_INVALID,a,t);if(i.info("state="+this.state+"->"+e+" reason="+this.stateReason+"->"+n),this._callTelemetry.recordEvent(g.PARTICIPANT_OPERATIONS_INTERNAL.SET_PARTICIPANT_STATE,a,t),this.state=e,this.stateReason=n,3===this.state&&r){var s=this.getStrProperty(f.Property.ParticipantEndpointDetails);this._updateEndpointDetails(s)}else if(4===this.state){var c=this.getStrProperty(f.Property.ParticipantDiagnosticsCode);this._updateDiagnosticsCode(c)}this.raiseChangedDeferred()}},n.convertParticipantStatus=function(e){return c.default.isCallRinging(e)?2:c.default.isCallTerminated(e)?4:c.default.isCallConnected(e)?3:c.default.isCallConnecting(e)?1:c.default.isCallEarlyMedia(e)?6:c.default.isCallInLobby(e)?7:e===f.CallStatus.LocalHold||e===f.CallStatus.RemoteHold?5:void 0},n.isParticipantActive=function(e){switch(e){case 3:case 6:case 5:return!0;default:return!1}},n.convertContentSharingRole=function(e){switch(e){case f.ContentSharingRole.Attendee:return 1;case f.ContentSharingRole.Presenter:return 2;default:return 0}},n.convertCapabilities=function(e){return{canConference:!!(e&f.Capability.Conference),canShareScreen:!!(e&f.Capability.ShareScreen),canMerge:!!(e&f.Capability.Merge)}},n.prototype.addAdmitParticipantDeferred=function(e){this._admitParticipantDeffered=e},n.prototype.rejectAdmitParticipantDeferred=function(e){this._admitParticipantDeffered&&(this._admitParticipantDeffered.reject(e),this._admitParticipantDeffered=null)},n.prototype.addRemoveParticipantDeferred=function(e){this._removeParticipantDeffered=e},n.prototype.rejectRemoveParticipantDeferred=function(e){this._removeParticipantDeffered&&(this._removeParticipantDeffered.reject(e),this._removeParticipantDeffered=null)},n.prototype.stopVideos=function(){return this._slimCoreElectronRemoteStreamManager.stopVideos()},n.prototype.dispose=function(){this._slimCoreElectronRemoteStreamManager&&this._slimCoreElectronRemoteStreamManager.dispose(),this.streams[0]=[],this.streams[1]=[],this._admitParticipantDeffered&&(this._admitParticipantDeffered.resolve(),this._admitParticipantDeffered=null),this._removeParticipantDeffered&&(this._removeParticipantDeffered.resolve(),this._removeParticipantDeffered=null),this.slimcoreObjectId=0,e.prototype.dispose.call(this)},n}(s.default);t.default=S},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(28),a=SlimCore.Enums,s=0,c=function(e){function t(t,n,r,i,o,c,l,u){var d=e.call(this,t.createChild((function(){return"RemoteVideoRenderer["+d._id+"]"})),n,r)||this;d._renderTarget=i,d._videoType=o,d._options=l,d._rendererTracker=u,d._id=s++,d._logger.info("constructor");var h=o===a.VideoType.ScreenShare;return d._videoBinding=c,d._options=l||{scalingMode:h?2:1,transparent:h,ignoreMirroring:!1},d._createVideoRenderer(d._renderTarget,d._options,!1),d._rendererTracker.registerRenderer(d),d}return i(t,e),Object.defineProperty(t.prototype,"renderTarget",{get:function(){return this._renderTarget},enumerable:!0,configurable:!0}),t.prototype.clone=function(e){return this._logger.info("clone"),new t(this._logger,this._settings,this._slimcoreInstance,e,this._videoType,this._videoBinding,this._options,this._rendererTracker)},t.prototype.dispose=function(){this._logger.info("dispose");try{e.prototype.dispose.call(this)}finally{this._renderTarget=null,this._rendererTracker&&(this._rendererTracker.unregisterRenderer(this),this._rendererTracker=null)}},t}(o.default);t.default=c},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(4),s=n(3),c=n(2),l=n(0),u=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this;return i.isRendering=!1,i._paused=!1,i._isFrameSinkSet=!1,i._videoElementSizeChangeIntervalHandle=0,i._isStartedLogged=!1,i._frameTypeChanged=function(e){i._logger.info("frame-type-changed: "+e.type),i.event("frameTypeChanged").raise(p(e.type))},i._frameSizeChanged=function(e){i._logger.info("frame-size-changed: "+e.width+" x "+e.height)},i._firstFrameRendered=function(e){i._logger.info("first-frame-rendered"),i.event("firstFrameRendered").raise()},i._fullFrameRenderRequired=function(e){i._logger.info("full-frame-render-required: "+e.fullFrameRenderRequired),i.event("fullFrameRenderRequired").raise(e.fullFrameRenderRequired)},i._videoUriChangedUwp=function(e){i._videoElement&&(i._videoElement.src=e.uri||"")},i._videoResizedUwp=function(){i._videoSizeChanged(i._videoElement.videoWidth,i._videoElement.videoHeight)},i._videoPausedUwp=function(){i._videoElement&&(i._videoElement.src=i._videoBindingRT.uri||"",i._videoElement.play())},i}return i(t,e),t.prototype.dispose=function(t){void 0===t&&(t=c.generateCauseId()),this._disposeVideoRenderer(t),e.prototype.dispose.call(this,t)},Object.defineProperty(t.prototype,"rendererType",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"frameType",{get:function(){return this._frameSink&&this._frameSink.getFrameType?p(this._frameSink.getFrameType()):-1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paused",{get:function(){return this._paused},set:function(e){if(this._settings.platform!==l.PlatformType.Electron)throw new Error("Only implemented for Electron renderer");e!==this._paused&&(this._frameSink&&this._controlFrameSink(!e),this._paused=e)},enumerable:!0,configurable:!0}),t.prototype.captureFrame=function(e){return this._videoBinding?this._videoBinding.captureFrame({timeout:e}).then((function(e){return new d(l.convertImageData(e.image),e.mirror)})):Promise.resolve()},t.prototype.getStats=function(){var e=this;return a.asap((function(){return e._getStats()}))},t.prototype.setScalingMode=function(e){var t=this;return this._renderer?this._renderer.setScalingMode(f(e)):this._videoElement?new Promise((function(){t._videoElement.msZoom=1===e})):Promise.reject("No video renderer")},t.prototype.dumpVideoSourceImages=function(){return Promise.reject(new Error("Supposed to be overriden by preview video renderer. Not implemented for remote video renderer"))},t.prototype._createVideoRenderer=function(e,t,n){switch(this._settings.platform){case l.PlatformType.Electron:return this._createVideoRendererElectron(e,t);case l.PlatformType.Uwp:return this._createVideoRendererUwp(e,t,n);default:throw new Error("Unsupported platform: "+this._settings.platform)}},t.prototype._createVideoRendererElectron=function(e,t){var n=this;!function(e){return void 0!==e.renderer}(e)?this._renderer=this._createVideoRendererImpl(e,t):this._renderer=e.renderer,this._renderer.on("video-size-changed",(function(e){return n._videoSizeChanged(e.width,e.height)})),this._frameSink&&(this._frameSink.on("frame-type-changed",this._frameTypeChanged),this._frameSink.on("frame-size-changed",this._frameSizeChanged),this._frameSink.on("first-frame-rendered",this._firstFrameRendered),this._frameSink.on("full-frame-render-required",this._fullFrameRenderRequired),!o.isUndefined(t.ignoreMirroring)&&this._frameSink.setIgnoreMirroring&&this._frameSink.setIgnoreMirroring(t.ignoreMirroring),this._controlFrameSink(!0))},t.prototype._createVideoRendererUwp=function(e,t,n){var r=this;this._logger.info("Creating uwp video renderer with uri "+this._videoBindingRT.uri),this._videoBindingRT.on("video-uri-changed",this._videoUriChangedUwp);var i=e;if(this._videoElement=i.ownerDocument.createElement("video"),i.appendChild(this._videoElement),this._videoElement.autoplay=!0,this._videoElement.msHorizontalMirror=!t.ignoreMirroring&&n,this._videoElement.msZoom=1===t.scalingMode,this._videoElement.style.backgroundColor=t.transparent?"":"black",this._videoElement.addEventListener("resize",this._videoResizedUwp),this._videoElement.src=this._videoBindingRT.uri||"",this._videoElement.addEventListener("pause",this._videoPausedUwp),!n&&this._videoBindingRT.setVideoPreference){var a={width:0,height:0};this._videoElementSizeChangeIntervalHandle=setInterval((function(){var e={width:r._videoElement.offsetWidth,height:r._videoElement.offsetHeight};o.isEqual(a,e)||(a=e,r._videoBindingRT.setVideoPreference(e.width,e.height))}),2e3)}},t.prototype._disposeVideoRenderer=function(e){this._frameSink&&(this._frameSink.removeListener("frame-type-changed",this._frameTypeChanged),this._frameSink.removeListener("frame-size-changed",this._frameSizeChanged),this._frameSink.removeListener("first-frame-rendered",this._firstFrameRendered),this._frameSink.removeListener("full-frame-render-required",this._fullFrameRenderRequired),this._controlFrameSink(!1)),this._renderer&&(this._renderer.removeAllListeners(),this._renderer.dispose(),this._renderer=null),this._videoBindingRT&&this._videoBindingRT.removeListener("video-uri-changed",this._videoUriChangedUwp),this._videoElementSizeChangeIntervalHandle&&(clearInterval(this._videoElementSizeChangeIntervalHandle),this._videoElementSizeChangeIntervalHandle=0),this._videoElement&&(this._videoElement.removeEventListener("resize",this._videoResizedUwp),this._videoElement.removeEventListener("pause",this._videoPausedUwp),this._videoElement.remove(),this._videoElement=null)},Object.defineProperty(t.prototype,"_frameSink",{get:function(){return this._renderer?this._renderer.getFrameSink():null},enumerable:!0,configurable:!0}),t.prototype._videoSizeChanged=function(e,t){this._logger.info("video-size-changed: "+e+" x "+t),this.streamSize={width:e,height:t},this.isRendering=e>0&&t>0,!this._isStartedLogged&&this.isRendering&&(this._logger.info("renderStarted"),this.event("renderStarted").raise(),this._isStartedLogged=!0),this.event("videoSizeChanged").raise(e,t),this.raiseChanged()},t.prototype._getStats=function(){if(!this._frameSink)throw new Error("Renderer is not initialized");if(this._frameSink.getStats)return this._frameSink.getStats();throw new Error("Renderer does not support stats")},Object.defineProperty(t.prototype,"frameSinkMetadata",{get:function(){return this._frameSink&&this._frameSink.getMetadata?this._frameSink.getMetadata():null},enumerable:!0,configurable:!0}),t.prototype._createVideoRendererImpl=function(e,t){var n={container:e,transparent:t.transparent,scalingMode:f(t.scalingMode),useBufferSharing:!!this._settings.enableBufferSharing,useFirstFrameRender:!!this._settings.enableFirstFrameRender,logger:this._logger};try{var r=SlimCore.createChromiumFrameSink?SlimCore.createChromiumFrameSink():SlimCore.createPepperFrameSink();return VideoRenderer.createChromiumVideoRenderer(r,n)}catch(e){throw this._logger.error("createChromiumVideoRenderer failed: "+e),new h(e,function(e){switch(e.reason){case 1:return 2;case 2:return 3;default:return 1}}(e))}},Object.defineProperty(t.prototype,"_videoBindingRT",{get:function(){return this._videoBinding},enumerable:!0,configurable:!0}),t.prototype._controlFrameSink=function(e){this._videoBinding&&this._isFrameSinkSet!==e&&(this._isFrameSinkSet=e,e?this._videoBinding.addFrameSink(this._frameSink):this._videoBinding.removeFrameSink(this._frameSink))},t}(s.default);t.default=u;var d=function(){function e(e,t){this._imageData=e,this._mirrored=t}return e.prototype.getSize=function(){return{width:this._imageData.width,height:this._imageData.height}},e.prototype.isMirrored=function(){return this._mirrored},e.prototype.getImageData=function(){return this._imageData},e}(),h=function(){function e(e,t){void 0===t&&(t=-1),this.reason=e,this.errorType=t}return e.prototype.toString=function(){return"Reason="+this.reason+", errorType="+this.errorType},e}();function p(e){switch(e){case 0:return 0;case 1:return 1;case 2:return 2;default:return-1}}function f(e){switch(e){case 0:return 0;case 1:return 1;case 2:return 2;default:return}}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}c((r=r.apply(e,t||[])).next())}))},c=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var l=n(1),u=n(0),d=n(3),h=n(30),p=SlimCore.Enums,f=n(8),g=n(2),_=n(14),m=n(15),v=function(e){function t(t,n,r,i,o,a,s,c,l){var u=e.call(this,t.createChild((function(){return"LocalScreenShare["+u._localVideoObjectId+"]"})),n,r)||this;u._callObjectId=i,u._callHandler=o,u._deviceManager=a,u._appHooks=s,u._screenSharingControl=c,u._callTelemetry=l,u.isStreaming=!1,u.isAvailable=!0,u._localVideoObjectId=0,u._previewVideoObjectId=0,u._editViewPPTWindowId=0,u._logger.info("constructor"),u._callOperationHandler=new m.default(u._logger,u._callTelemetry);try{u._screenScraper=new h.default(u._slimcoreInstance)}catch(e){u._logger.warn(""+e)}return u._screenScraper&&u._registerDisposable(u._appHooks.onDisplaysChanged((function(){return u.handleDisplaysChanged()}))),u}return i(t,e),t.prototype.isActive=function(){return this.isAvailable&&this.isStreaming},t.prototype._showSharingIndicator=function(e){var t=this;this._appHooks.showSharingIndicator(e);var n=this._appHooks.getControlInjector();n&&n.setInjectionRect&&n.setInjectionRect(e).catch((function(n){var r=JSON.stringify({errorMsg:n,region:e});t._screenSharingControl.enableScreenSharingControl(!1,0,r),t._logger.error("Set control Injector failure, disable screen sharing control. Error: "+n)}))},t.prototype._videoObjectChanged=function(e){var t=g.generateCauseId();this.isAvailable=u.isVideoAvailable(e),this.isStreaming=!1,u.isVideoInState(e,[p.VideoStatus.Starting,p.VideoStatus.Running])&&(this._selectedMonitor||this._selectedWindow||this._selectedCamera?(this.isStreaming=!0,this._selectedCamera||this._appHooks.showSharingIndicator(this._selectedRegion||this._selectedMonitor&&this._selectedMonitor.region||this._selectedWindow&&this._selectedWindow.windowId)):u.forgetAndLog(this.stop(t),this._logger,"stopping screen sharing due to no monitor/camera being selected")),u.isVideoInState(e,[p.VideoStatus.Paused])&&this._appHooks.hideSharingIndicator(),this.raiseChanged()},t.prototype._setCaptureRegionAndWindow=function(e,t){if(this._slimcoreInstance.setScreenCaptureRectangle)this._slimcoreInstance.setScreenCaptureRectangle(this._localVideoObjectId,e,void 0,t);else{if(!this._videoBindingScreenShare)throw new Error("Failed to set capture region / window");this._videoBindingScreenShare.setCaptureRegionAndWindow(e,t)}},t.prototype._handleScraperEvent=function(e){this._logger.info("Handle Scraper event, event = "+e.event+" data = "+e.data);var t=e.data;switch(e.event){case p.ScraperEvent.PPTPresenterView_Enter:this._editViewPPTWindowId=this._selectedWindow.windowId,this._selectedWindow.windowId=t,this._appHooks.showSharingIndicator(t),this._setCaptureRegionAndWindow(void 0,t),this._logger.info("shared PPT entered presenter mode");break;case p.ScraperEvent.PPTPresenterView_Exit:this._selectedWindow.windowId=this._editViewPPTWindowId,this._appHooks.showSharingIndicator(this._selectedWindow.windowId),this._setCaptureRegionAndWindow(void 0,this._selectedWindow.windowId),this._logger.info("shared PPT exited presenter mode");break;case p.ScraperEvent.WindowClosed:if(this._selectedWindow.windowId!==t)return;this._logger.info("Application window closed. Stopping the screenshare"),this.event("windowClosed").raise();break;default:this.event("scraperEvent").raise(e)}},t.prototype._startPreviewVideoObject=function(){var e=this;return this._shouldUseVideoBindingScreenShare()?this._deviceManager.getPreviewVideo(p.VideoType.ScreenShare).then((function(t){return e._deviceManager.getScreenShareBindingManager().acquire(e,t).then((function(n){e._previewVideoObjectId=t,e._videoBindingScreenShare=n,e._videoBindingScreenShare.on("scraper-event",(function(t){return e._handleScraperEvent(t)}))}))})):Promise.resolve()},t.prototype._stopPreviewVideoObject=function(){var e=this;if(this._shouldUseVideoBindingScreenShare()){if(this._previewVideoObjectId&&this._videoBindingScreenShare){this._logger.info("calling slimcore video release binding"),this._videoBindingScreenShare.removeAllListeners("scraper-event");var t=this._deviceManager.getScreenShareBindingManager().release(this,this._previewVideoObjectId).catch((function(t){return e._logger.error("Failed on releasing screen sharing binding. Error: "+t)}));return this._previewVideoObjectId=0,this._videoBindingScreenShare=null,t}return Promise.resolve()}return Promise.resolve()},t.prototype._shouldUseVideoBindingScreenShare=function(){return!this._slimcoreInstance.setScreenCaptureRectangle&&this._deviceManager.hasVideoBindingScreenShare()},t.prototype.start=function(e,t,n,r){var i=this,o=this._logger.createFnLogger(f.CALL_OPERATIONS_INTERNAL.ELECTRON_START_SCREEN_SHARING,e);o.info("local screen share start");var a=Promise.resolve().then((function(){return s(i,void 0,void 0,(function(){var e,i,a,s,l=this;return c(this,(function(c){switch(c.label){case 0:if(!(e=this.sourceToInfo(t)))throw new Error("Unable to start sharing, source could not be found");return o.info("calling slimcore create local video"),(i=!!t&&3===t.getType())?(a=e,this._localVideoObjectId=this._slimcoreInstance.createLocalVideo(p.VideoType.ScreenShare,a.label,a.id)):this._localVideoObjectId=this._slimcoreInstance.createLocalVideo(p.VideoType.ScreenShare,"",""),this._videoStatusChangedHandler=this._slimcoreInstance.handle("object-property-changed",{objectId:this._localVideoObjectId,propKey:p.Property.VideoStatus},(function(e){return l._videoObjectChanged(e.value)})),s=this._getIntProperty(this._callHandler,this._localVideoObjectId,p.Property.VideoStatus),this._videoObjectChanged(s),this._callHandler.callAttachSendVideo(this._callObjectId,this._localVideoObjectId),o.info("waiting for video object to be available"),[4,u.waitForVideoObjectToBeAvailable(this._slimcoreInstance,this._callHandler,this._localVideoObjectId,this._logger,500)];case 1:return c.sent(),i?[3,3]:(this._logger.info("start preview video object"),[4,this._startPreviewVideoObject()]);case 2:c.sent(),c.label=3;case 3:return o.info("calling slimcore video start"),this.selectSource(t,e,n),this.negotiationTag=r,this._slimcoreInstance.videoStart(this._localVideoObjectId,r),this.isStreaming=!0,this.raiseChanged(),[2]}}))}))}));return this._callOperationHandler.registerPromise(f.CALL_OPERATIONS_INTERNAL.ELECTRON_START_SCREEN_SHARING,a).catch((function(t){o.logFailure("Failed to start LocalScreenShare. Error: "+t),i.stop(void 0,e),Promise.reject(t)}))},t.prototype.changeCropRegion=function(e){var t=this.sourceToInfo(null);this.selectMonitorWithOptionalCrop(t,e)},t.prototype.stop=function(e,t){var n=this,r=this._logger.createFnLogger(f.CALL_OPERATIONS_INTERNAL.ELECTRON_STOP_SCREEN_SHARING,e),i=function(){n._localVideoObjectId=0,n.isStreaming=!1,n._selectedMonitor=null,n._selectedRegion=null,n._selectedWindow=null,n._selectedCamera=null,n._editViewPPTWindowId=0,n._appHooks.hideSharingIndicator(),n._videoStatusChangedHandler&&(n._videoStatusChangedHandler.dispose(),n._videoStatusChangedHandler=null),n.raiseChanged()},o=Promise.resolve().then((function(){return n._stopPreviewVideoObject()})).then((function(){0!==n._localVideoObjectId&&(r.info("calling slimcore video stop"),n.negotiationTag=t,n._slimcoreInstance.videoStop(n._localVideoObjectId,n.negotiationTag))})).then(i,(function(e){throw r.logFailure("Failed to stop LocalScreenShare. Error: "+e),i(),e}));return this._callOperationHandler.registerPromise(f.CALL_OPERATIONS_INTERNAL.ELECTRON_STOP_SCREEN_SHARING,o)},t.prototype.dispose=function(t){this._logger.info("Disposing of LocalScreenShare"),0===this._localVideoObjectId&&0===this._previewVideoObjectId||this.stop(t),this._videoStatusChangedHandler&&(this._videoStatusChangedHandler.dispose(),this._videoStatusChangedHandler=null),e.prototype.dispose.call(this)},t.prototype.selectSource=function(e,t,n){e&&2===e.getType()?this.selectWindow(t):e&&3===e.getType()?this._selectedCamera=t:this.selectMonitorWithOptionalCrop(t,n)},t.prototype.selectMonitorWithOptionalCrop=function(e,t){var n=t||e.region;this._logger.info("Selected region with optional crop, x = "+n.x+", y = "+n.y+", width = "+n.width+" height = "+n.height),this._showSharingIndicator(n),this._setCaptureRegionAndWindow(n),this._selectedMonitor=e,this._selectedRegion=t},t.prototype.selectWindow=function(e){this._appHooks.showSharingIndicator(e.windowId),this._setCaptureRegionAndWindow(void 0,e.windowId),this._selectedWindow=e},t.prototype.handleDisplaysChanged=function(){var e=g.generateCauseId(),t=this._logger.createFnLogger("HandleDisplaysChanged",e);if(this._selectedMonitor){var n=function(e){try{return JSON.stringify(e)}catch(e){return"unable to stringify"}};if(t.info("On display change, currenlty selected monitor: "+n(this._selectedMonitor)+" selected region:  "+n(this._selectedRegion)),!this._selectedRegion){for(var r=this._screenScraper.getMonitorList()||[],i=0,o=r;i<o.length;i++){var a=o[i];t.info("On display change, new listed monitor: "+n(a))}var s=u.selectMonitorForScreenSharing(this._selectedMonitor,r);if(s)return t.info("On display change, re-selected monitor: "+n(s)),void this.selectMonitorWithOptionalCrop(s)}t.info("stopping screen share because displays changed and could not resolve monitor info"),u.forgetAndLog(this.stop(e),t,"stopping screen share because sharing source lost"),this.event("sharingSourceLost").raise()}else t.logFailure("On display change, monitor not seleted yet")},t.prototype.sourceToInfo=function(e){if(!e){if(this._screenScraper){var t=this._screenScraper.getMonitorList()||[];return l.find(t,(function(e){return e.isPrimary}))}return this._logger.error("ScreenShare has no way to recover primary monitor"),null}switch(e.getType()){case 2:return t=this._screenScraper.getWindowList()||[],l.find(t,(function(t){return t.windowId===e.getId()}));case 1:return this._screenScraper?(t=this._screenScraper.getMonitorList()||[],l.find(t,(function(t){return t.monitorId===e.getId()||l.isEqual(t.region,e.getBounds())}))):{monitorId:0,name:e.getDescription(),region:e.getBounds(),isPrimary:!0,isInternal:!0,isDuplicated:!1};case 3:return this._deviceManager.getCamera(e.getDeviceId());default:throw new Error("Invalid source type: "+e.getType())}},o([_.callOperation(f.CALL_OPERATIONS_INTERNAL.ELECTRON_START_SCREEN_SHARING,{waitFor:f.CALL_OPERATIONS_INTERNAL.ELECTRON_STOP_SCREEN_SHARING}),a("design:type",Function),a("design:paramtypes",[String,Object,Object,String]),a("design:returntype",Promise)],t.prototype,"start",null),o([_.callOperation(f.CALL_OPERATIONS_INTERNAL.ELECTRON_STOP_SCREEN_SHARING,{waitFor:f.CALL_OPERATIONS_INTERNAL.ELECTRON_START_SCREEN_SHARING}),a("design:type",Function),a("design:paramtypes",[String,String]),a("design:returntype",Promise)],t.prototype,"stop",null),t}(d.default);t.default=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=function(){function e(e){if(this._slimcoreInstance=e,!this._slimcoreInstance.getMonitorList||!this._slimcoreInstance.getWindowList){var t=r.isSlimCoreRTModuleAvailable()?SlimCoreRT.SlimCore:SlimCore;if(!t.ScreenScraper)throw new Error("ScreenScraper not supported");this._screenScraper=new t.ScreenScraper}}return e.prototype.getMonitorList=function(){if(this._slimcoreInstance.getMonitorList)return this._slimcoreInstance.getMonitorList();if(this._screenScraper)return this._screenScraper.getMonitorList();throw new Error("not supported")},e.prototype.getMonitorPreview=function(e,t,n,i,o){return this._slimcoreInstance.getMonitorSnapshot?this._slimcoreInstance.getMonitorSnapshot(e,{width:t,height:n,asImage:i},o).then(r.convertImageData):this._screenScraper?this._screenScraper.getMonitorPreview(e,t,n,i):Promise.reject(new Error("not supported"))},e.prototype.getWindowList=function(){if(this._slimcoreInstance.getWindowList)return this._slimcoreInstance.getWindowList();if(this._screenScraper)return this._screenScraper.getWindowList();throw new Error("not supported")},e.prototype.getWindowPreview=function(e,t,n,i){return this._slimcoreInstance.getWindowSnapshot?this._slimcoreInstance.getWindowSnapshot(e,{width:t,height:n,asImage:i}).then(r.convertImageData):this._screenScraper?this._screenScraper.getWindowPreview(e,t,n,i):Promise.reject(new Error("not supported"))},e.prototype.getWindowIcon=function(e,t,n,i){return this._slimcoreInstance.getWindowIcon?this._slimcoreInstance.getWindowIcon(e,{width:t,height:n,asImage:i}).then(r.convertImageData):this._screenScraper?this._screenScraper.getWindowIcon(e,t,n,i):Promise.reject(new Error("not supported"))},e}();t.default=i},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(0),s=n(3),c=SlimCore.Enums,l=n(2),u=function(e){function t(t,n,r,i,o,a,s){var c=e.call(this,t.createChild((function(){return"LocalVideo["+c._videoObjectId+"]"})),n,r)||this;return c._call=i,c._callObjectId=o,c._callHandler=a,c._deviceManager=s,c._videoObjectId=0,c._logger.info("constructor"),c._registerDisposable(c._deviceManager.on("devicesChanged",(function(){return c._devicesChanged()}))),c}return i(t,e),t.prototype._devicesChanged=function(){var e=this,t=l.generateCauseId(),n=this._logger.createFnLogger("devicesChanged",t);n.info("Devices changed - checking if video needs to be restarted");var r=this._deviceManager.getSelectedDevices();this._currentCamera&&r.camera&&r.camera!==this._currentCamera.id&&(n.info("Changing video device to "+r.camera),this.stop(void 0,t).then((function(){return e.start(t,e.negotiationTag)})).catch((function(e){n.logFailure("Caught error while trying to stopstart local video after device change. Error: "+e)})))},t.prototype._executeOperationAndExpectVideoStateTransition=function(e,t,n,r){var i=this,a=this._logger.createFnLogger("LocalVideoOperation",r);return new Promise((function(r,s){var l=!1,u=null;setTimeout((function(){if(!l){u&&(u.dispose(),u=null);var e=i._getIntProperty(i._callHandler,t,c.Property.VideoStatus);if(a.info("_executeOperationAndExpectVideoStateTransition["+t+"] time out. Current State = "+e+"."),-1!==o.indexOf(n,e))r();else{var d="_executeOperationAndExpectVideoStateTransition["+t+"] time out. Video not in expected final state";a.info(d),s(d)}}}),500),u=i._slimcoreInstance.handle("object-property-changed",{objectId:t,propKey:c.Property.VideoStatus},(function(e){return i=e.value,a.info("Video state changed for monitored video ID["+t+"] -> "+i+" ("+c.VideoStatus[i]+")"),void(l||-1===o.indexOf(n,i)||(l=!0,u&&(u.dispose(),u=null),r()));var i})),e()}))},t.prototype._startInternalVideo=function(e,t){var n=this;if(this._internalVideoStartPromise)return this._internalVideoStartPromise;var r=this._logger.createFnLogger("startInternalVideo",t);return this._internalVideoStartPromise=Promise.resolve(void 0).then((function(){var e=n._deviceManager.getSelectedCamera();if(!e)throw new Error("No camera selected to start video on");if(r.info("Starting local video using camera: "+JSON.stringify(e)),n._currentCamera=e,n._videoObjectId=n._slimcoreInstance.createLocalVideo(c.VideoType.Video,e.label,e.id),0===n._videoObjectId)throw r.logFailure("SlimCore returned invalid video object ID 0"),new Error("SlimCore returned invalid video object ID 0");n._callHandler.callAttachSendVideo(n._callObjectId,n._videoObjectId)})).then((function(){return a.waitForVideoObjectToBeAvailable(n._slimcoreInstance,n._callHandler,n._videoObjectId,n._logger)})).then((function(){return r.info("Local Video is AVAILABLE. Starting Video"),n._executeOperationAndExpectVideoStateTransition((function(){e&&(n.negotiationTag=e),n._slimcoreInstance.videoStart(n._videoObjectId,n.negotiationTag)}),n._videoObjectId,[c.VideoStatus.Running,c.VideoStatus.Starting],t)})),this._internalVideoStartPromise},t.prototype.start=function(e,t){var n,r=this,i=this._logger.createFnLogger("start",e);return i.info("Local video START requested"),this._call.callStateCanToggleVideo()?this._currentStartPromise?(i.logSuccess("Start requested but pending start exists. Returning previous promise"),this._currentStartPromise):(this._currentStopPromise?(i.info("Start requested but pending stop exists. Waiting for previous stop promise"),n=this._currentStopPromise):n=Promise.resolve(),this._currentStartPromise=n.then((function(){return r._startInternalVideo(t,e)})).then((function(){r._currentStartPromise=null})).catch((function(t){throw i.logFailure(t),r._currentStartPromise=null,r.stop(void 0,e),t})),this._currentStartPromise):(i.logFailure("Local video start requested but call is not connected, skipping operation"),Promise.resolve(null))},t.prototype.stop=function(e,t){var n=this,r=this._logger.createFnLogger("stop",e);r.info("Local video STOP requested");var i,o=function(){n._videoObjectId=0,n._currentCamera=null,n._currentStopPromise=null,n._currentStartPromise=null,n._internalVideoStartPromise=null};return this._currentStopPromise?(r.info("Stop requested but pending stop exists. Returning previous promise"),this._currentStopPromise):(this._currentStartPromise?(r.info("Waiting for start promise to finish."),i=this._currentStartPromise):i=Promise.resolve(),this._currentStopPromise=i.then((function(){n._logger.info("Stopping SlimCore video objects"),0!==n._videoObjectId&&(n.negotiationTag=t,n._slimcoreInstance.videoStop(n._videoObjectId,n.negotiationTag))})).then((function(){return n._call.callStateCanToggleVideo()?a.waitForVideoObjectToBeAvailable(n._slimcoreInstance,n._callHandler,n._videoObjectId,n._logger):Promise.resolve()})).then((function(){r.info("VideoBinding was released")})).then(o,(function(e){throw r.logFailure(e),o(),e})),this._currentStopPromise)},t.prototype.dumpVideoSourceImages=function(){return 0===this._videoObjectId?Promise.reject(new Error("Cannot dump video effects debug images when video is not created")):this._slimcoreInstance.dumpVideoSourceImages(this._videoObjectId)},t.prototype.dispose=function(t){var n=this,r=function(){return e.prototype.dispose.call(n)};Promise.resolve((function(){return 0===n._videoObjectId||n.stop(void 0,t)})).then(r).catch(r)},t}(s.default);t.default=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(1),c=n(4),l=n(6),u=n(32),d=n(5),h=n(0),p=n(3),f=n(11),g=n(21),_=n(22),m=SlimCore.Enums,v=n(2),y=n(20),C=function(e){function t(t,n,r,i,o,a){var s=e.call(this,new y.default(t).createChild("CallRegistry"),n,r)||this;return s._deviceManager=i,s._appHooks=o,s._telemetryService=a,s.calls=[],s._loginPromiseDefered=c.defer(),s._logoutPromiseDefered=c.defer(),s._startSlimcorePromiseDefered=c.defer(),s.isDisposing=!1,s._disposedPromise=c.defer(),s.slimcoreInstanceStartCalled=!1,s._logger.info("constructor"),s._slimcoreInstance.setMaxListeners(0),s._ecsProvider=new g.default(s._slimcoreInstance),s}return i(t,e),t.prototype.dispose=function(t){return void 0===t&&(t=v.generateCauseId()),o(this,void 0,void 0,(function(){var n,r,i,o,s=this;return a(this,(function(a){return(n=this._logger.createFnLogger("dispose",t)).info("disposing call registry"),this.isDisposing?(n.warn("call registry is already in disposing stage!"),[2,this._disposedPromise.promise]):(this.isDisposing=!0,r=function(){s.calls=[],s._slimcoreCallHandler&&(s._slimcoreCallHandler.dispose(),s._slimcoreCallHandler=void 0),n.info("callhandler is disposed"),s._account&&(s._account.dispose(),s._account=void 0),n.info("account is disposed"),s.event("disposed").raise(),e.prototype.dispose.call(s),s._disposedPromise.resolve()},i=this.calls.map((function(e){return e.stop()})),o=function(){return s.logout(t)},Promise.all(i).then(o,o).then(r,r),[2,this._disposedPromise.promise])}))}))},Object.defineProperty(t.prototype,"loginPromise",{get:function(){return this._loginPromiseDefered.promise},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"disposePromise",{get:function(){return this._disposedPromise.promise},enumerable:!0,configurable:!0}),t.prototype._initCall=function(e,t,n){this._logger.createFnLogger("initCall[callId="+e.callId+"][participantId="+e.participantId+"]",n).info("callObjectId="+t),e.incomingCallInit(t,n)},t.prototype._incomingCallMonitor=function(e,t){var n=this._logger.createFnLogger("incomingCallMonitor",t);n.info("_incomingCallMonitor for objectPropertyChange objectId="+e.objectId);var r=this._getStrProperty(this._slimcoreCallHandler,e.objectId,m.Property.CallName);if(h.hasFeature(m.Feature.MultiUserSupport)){var i=this._getStrProperty(this._slimcoreCallHandler,e.objectId,m.Property.CallAccountIdentity);if(i!==this.identity)return void n.info("incoming call("+r+") for user("+d.mriOrId(i)+") but current user is "+d.mriOrId(this.identity))}var o=this._getStrProperty(this._slimcoreCallHandler,e.objectId,m.Property.CallLegId);this._getCall(r,o,t)||n.logFailure("getCall failed to find the call(callId: "+r+", localParticipantId: "+o+")")},t.prototype.init=function(e,t,n){var r=this;void 0===t&&(t={block:!0}),void 0===n&&(n=v.generateCauseId());var i=this._logger.createFnLogger("init",n);i.info("init"),t.block||h.hasFeature(m.Feature.AsyncStart)||(t.block=!0);var o=null;return this.slimcoreInstanceStartCalled?i.info("skipping slimcoreInstance start, because it was already started"):(t.block||this._registerDisposable(this._slimcoreInstance.handle("lib-status-changed",{libStatus:SlimCore.Enums.LibStatus.Running},(function(e){return r._onLibStatusChanged(e)}))),this._slimcoreInstance.setupSetStr("*Lib/SCT/Telemetry/DiagnosticLevel",t.telemetryDiagnosticLevel||""),this._slimcoreInstance.start(t.block),i.info("starting slimcoreInstance block="+t.block),this.slimcoreInstanceStartCalled=!0,t.block&&(this.libStatus=m.LibStatus.Running,this._startSlimcorePromiseDefered.resolve())),this._skypeIdentity=e,this.identity=e.id,this._skypeIdentity.tokenProvider().then((function(e){i.info("setting up stack callbacks"),o=r._slimcoreInstance.handle("object-property-changed",{propKey:m.Property.AccountStatus,value:m.AccountStatus.LoggedIn},(function(){var e=r._slimcoreInstance.createCallInterface();r._slimcoreCallHandler=h.wrap(e,r._settings),i.info("createCallInterface returned"),r._loginPromiseDefered.resolve(r._slimcoreCallHandler),o&&(o.dispose(),o=null),r._hookCallRegistryEvents()})),r._slimcoreInstance.handle("object-property-changed",{propKey:m.Property.CallStatus,value:m.CallStatus.RingingIn},(function(e){return r._incomingCallMonitor(e,n)})),r._initializeSlimCore(e),r._logger.info("initialize returned")})).catch((function(e){i.logFailure(e),r._loginPromiseDefered.reject(e)})),this.loginPromise.then(l.noop)},t.prototype.uninit=function(){var e=this;this.slimcoreInstanceStartCalled?this.libStatus!==m.LibStatus.Running&&(this._startSlimcorePromiseDefered.reject(new Error("Callregistry uninit called before slimcore reached Running state")),this._logoutPromiseDefered.reject(new Error("Callregistry uninit called before slimcore reached Running state"))):this._logoutPromiseDefered.reject(new Error("CallRegistry uninit called without slimcore::start()"));var t=null;try{this._logger.info("uninit: setting up stack callbacks"),t=this._slimcoreInstance.handle("object-property-changed",{propKey:m.Property.AccountStatus,value:m.AccountStatus.LoggedOut},(function(){e._logoutPromiseDefered.resolve(),t&&(t.dispose(),t=null)})),this._logger.info("uninit(): calling slimcore.logout()"),this._slimcoreInstance.logout()}catch(e){this._logger.error("slimcore.logout() failed.",e),this._logoutPromiseDefered.reject(e)}return this.slimcoreInstanceStartCalled=!1,this._logoutPromiseDefered.promise.then(l.noop)},t.prototype.login=function(e,t,n){var r=this;void 0===t&&(t=v.generateCauseId());var i=this._logger.createFnLogger("login",t);i.info("login");var o=null;return this._skypeIdentity=e,this.identity=e.id,this._setup=new _.default(this._slimcoreInstance,this.identity),this._skypeIdentity.tokenProvider().then((function(a){i.info("setting up stack callbacks"),o=r._slimcoreInstance.handle("object-property-changed",{propKey:m.Property.AccountStatus,value:m.AccountStatus.LoggedIn},(function(e){if(h.hasFeature(m.Feature.MultiUserSupport)&&r._account.getObjectId()!==e.objectId)i.error("accountObjectId: "+r._account.getObjectId+" does not match with "+e.objectId);else{var t=r._createCallHandler();r._slimcoreCallHandler=h.wrap(t,r._settings),i.info("createCallInterface returned"),r._loginPromiseDefered.resolve(r._slimcoreCallHandler),o&&(o.dispose(),o=null),r._hookCallRegistryEvents()}})),r._slimcoreInstance.handle("object-property-changed",{propKey:m.Property.CallStatus,value:m.CallStatus.RingingIn},(function(e){return r._incomingCallMonitor(e,t)})),r._login(a,e.displayName,i,n)})).catch((function(e){i.logFailure(e),r._loginPromiseDefered.reject(e)})),this.loginPromise.then((function(){return r.setAdditionalIdentities()}))},t.prototype._login=function(e,t,n,r){if(h.hasFeature(m.Feature.MultiUserSupport)){if(this._account)return n.info("already logged in. updating displayname and skypetoken!"),this._account.updateDisplayName(t),void this._account.updateSkypeToken(e);var i=this._slimcoreInstance.getAccount(this.identity);this._account=h.wrap(i,this._settings),this._account.login(e,t,h.mapToEmptyStrIfFalsy(r))}else this._slimcoreInstance.login(this.identity,e,t)},t.prototype._createCallHandler=function(){return h.hasFeature(m.Feature.MultiUserSupport)?this._slimcoreInstance.getCallHandler(this._account.getObjectId()):this._slimcoreInstance.createCallInterface()},t.prototype.logout=function(e){var t=this;void 0===e&&(e=v.generateCauseId());var n=this._logger.createFnLogger("logout",e);n.info("logout");var r=null;try{n.info("setting up stack callbacks"),r=this._slimcoreInstance.handle("object-property-changed",{propKey:m.Property.AccountStatus,value:m.AccountStatus.LoggedOut},(function(e){h.hasFeature(m.Feature.MultiUserSupport)&&t._account.getObjectId()!==e.objectId||(t._logoutPromiseDefered.resolve(),r&&(r.dispose(),r=null))})),n.info("calling slimcore.logout()"),this._logout()}catch(e){n.error("slimcore.logout() failed.",e),this._logoutPromiseDefered.reject(e)}return this._logoutPromiseDefered.promise.then(l.noop)},t.prototype._logout=function(){h.hasFeature(m.Feature.MultiUserSupport)?this._account.logout():this._slimcoreInstance.logout()},t.prototype.setRing=function(e){var t=this;return Promise.resolve().then((function(){return h.hasFeature(m.Feature.MultiUserSupport)&&t._account?t._account.setRing(e):t._setup.setString("*Lib/Call/NG/Ring",e)}))},t.prototype.setTenantId=function(e){var t=this;return Promise.resolve().then((function(){return h.hasFeature(m.Feature.MultiUserSupport)&&t._account?t._account.setTenantId(e):t._setup.setString("*Lib/Call/NG/TenantId",e)}))},t.prototype.setConfiguration=function(e){var t=this;return Promise.resolve().then((function(){h.hasFeature(m.Feature.MultiUserSupport)&&t._account&&t._account.setConfiguration&&t._account.setConfiguration(JSON.stringify(e))}))},t.prototype.updateDisplayName=function(e){var t=this;return Promise.resolve().then((function(){return h.hasFeature(m.Feature.MultiUserSupport)&&t._account?t._account.updateDisplayName(e):t._skypeIdentity.tokenProvider().then((function(n){return t._login(n,e,t._logger)}))}))},t.prototype.updateSkypeToken=function(e){h.hasFeature(m.Feature.MultiUserSupport)&&this._account?this._account.updateSkypeToken(e):this._slimcoreInstance.updateSkypeToken(e)},t.prototype.fireIntent=function(e,t){var n=this;return Promise.resolve().then((function(){h.hasFeature(m.Feature.MultiUserSupport)&&n._slimcoreInstance.fireIntent(m.Intent.CallPush,t,void 0,n.identity)}))},t.prototype.getSetup=function(){return this._setup},t.prototype.getEcsProvider=function(){return this._ecsProvider},t.prototype.createCall=function(e,t,n,r,i){var o=this;void 0===i&&(i=v.generateCauseId());var a=this._logger.createFnLogger("createCall",i);if(a.info("threadId:"+e+", callId:"+t+", localParticipantId: "+n+", messageId:"+r),null===this._slimcoreCallHandler||void 0===this._slimcoreCallHandler)throw a.logFailure("Stack not initialized yet"),new Error("Stack not initialized yet");this._skypeIdentity.tokenProvider().then((function(e){e&&(a.info("Updating Skype Token..."),o.updateSkypeToken(e),a.info("Token update complete"))}));var c=null;if(e&&(c=s.find(this.calls,(function(t){return t.threadId===e})))){if(t&&c.callId===t)return a.logFailure("Call Registry already has an entry for callId: "+c.callId+", threadId: "+c.threadId),c;if(r&&c.messageId===r)return a.logFailure("Call Registry already has an entry for threadId: "+c.threadId+", messageId: "+c.messageId),c}return(c=this._getCall(t,n,i))||(c=new f.default(this._logger,this._settings,this._slimcoreInstance,this._slimcoreCallHandler,this._deviceManager,this._appHooks,e,t||u.default(),this._skypeIdentity,n,this._telemetryService,r),this.calls.push(c),this.event("callAdded").raise(c),this.raiseChanged()),c},t.prototype.getCall=function(e,t,n){return void 0===n&&(n=v.generateCauseId()),this._getCall(e,t,n)},t.prototype._getCall=function(e,t,n){var r=this,i=this._logger.createFnLogger("getCall[callId="+e+"][participantId="+t+"]",n);if(!e&&!t)return i.logFailure("callId & participantId is undefined"),null;if(null===this._slimcoreCallHandler||void 0===this._slimcoreCallHandler)throw i.logFailure("Stack not initialized yet"),new Error("Stack not initialized yet");var o=s.find(this.calls,(function(t){return t.callId===e}));if(o)return 8===o.state?(this._initCall(o,o.slimcoreCallId,n),o):(i.info("Call Registry already has an entry for this call"),o);var a=s.find(this._slimcoreCallHandler.getActiveCalls(),(function(n){return r._slimcoreCallHandler.getStrProperty(n,m.Property.CallName)===e&&r._slimcoreCallHandler.getStrProperty(n,m.Property.CallLegId)===t}));if(!a)return i.logFailure("slimCoreCallObjectId not found"),null;var c=this._slimcoreCallHandler.getStrProperty(a,m.Property.CallThreadId),l=this._slimcoreCallHandler.getStrProperty(a,m.Property.CallMessageId);return o=new f.default(this._logger,this._settings,this._slimcoreInstance,this._slimcoreCallHandler,this._deviceManager,this._appHooks,c,e,this._skypeIdentity,t,this._telemetryService,l),this._initCall(o,a,n),this.calls.push(o),this.event("callAdded").raise(o),this.raiseChanged(),o},t.prototype.deleteCall=function(e,t,n){var r=this;void 0===t&&(t=!0),void 0===n&&(n=v.generateCauseId()),this._logger.info("deleteCall "+e.callId);var i=!1;return s.each(s.remove(this.calls,(function(t){return t===e})),(function(o){i=!0,t&&(r.event("callRemoved").raise(e),7!==o.state&&o.dispose(n))})),!!i&&(this.raiseChanged(),!0)},t.prototype.debugInformation=function(e){var t=this._slimcoreCallHandler.getDebugInformation("/callinfo");return!e||t&&!s.isEmpty(t)||(t="CallInformation\n * CallId="+e.callId),Promise.resolve(t)},t.prototype.setAdditionalIdentities=function(){var e=this;return Promise.resolve().then((function(){if(e._skypeIdentity.sipUri){var t="2:"+e._skypeIdentity.sipUri;h.hasFeature(m.Feature.MultiUserSupport)&&e._account?e._account.setAdditionalIdentities(t):e._slimcoreInstance.setAdditionalIdentities(t)}}))},t.prototype._initializeSlimCore=function(e){var t=this;try{this._startSlimcorePromiseDefered.promise.then((function(){t._logger.info("logging in to slimcore libStatus="+t.libStatus),t._slimcoreInstance.login(t._skypeIdentity.id,e,t._skypeIdentity.displayName)}))}catch(e){this._logger.error("initialization failed.",e)}},t.prototype._onSkypeTokenRequired=function(e){this.event("skypeTokenRequired").raise(e.invalidToken)},t.prototype._onLibStatusChanged=function(e){this._logger.info("_onLibStatusChanged from "+this.libStatus+" => "+e.libStatus),e.libStatus===m.LibStatus.Running?this._startSlimcorePromiseDefered.resolve():e.libStatus===m.LibStatus.FatalError&&this.libStatus===m.LibStatus.Constructed&&this._startSlimcorePromiseDefered.reject(new Error("Slimcore FatalError during start")),this.libStatus=e.libStatus},t.prototype._onProxiedPushNotification=function(e){var t={eventId:e.eventId,payload:e.payload};this.event("proxiedPushNotification").raise(t)},t.prototype._hookCallRegistryEvents=function(){var e=this;h.hasFeature(m.Feature.MultiUserSupport)&&this._account?(this._registerDisposable(this._account.handle("skype-token-required",void 0,(function(t){return e._onSkypeTokenRequired(t)}))),this._registerDisposable(this._slimcoreCallHandler.handle("proxied-push-notification",void 0,(function(t){return e._onProxiedPushNotification(t)})))):(this._registerDisposable(this._slimcoreInstance.handle("skype-token-required",void 0,(function(t){return e._onSkypeTokenRequired(t)}))),this._registerDisposable(this._slimcoreInstance.handle("proxied-push-notification",void 0,(function(t){return e._onProxiedPushNotification(t)}))))},t}(p.default);t.default=C},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(1),c=n(0),l=n(3),u=n(50),d=n(19),h=n(35),p=SlimCore.Enums,f=n(2),g=function(){function e(e,t){this._kind=e,this._logger=t,this._list=[],this._logger.info("constructor")}return e.prototype.update=function(e){this._list=e,this._logger.info("update: "+JSON.stringify(this._list))},e.prototype.isAvailable=function(e){return!(!e||!s.find(this._list,(function(t){return t.id===e})))},e.prototype.getBestDevice=function(){return this._getDeviceId(s.first(this._list))},e.prototype.getSelectedDevice=function(){if(this.isAvailable(this._selectedDevice))return this._logger.debug("getSelectedDevice: "+this._selectedDevice),this._selectedDevice;var e=this.getBestDevice();return this._logger.debug("getSelectedDevice - unknown device selected, returning preferred device: "+e),e},e.prototype.selectDevice=function(e){this.isAvailable(e)?(this._logger.info("selectDevice: "+e),this._selectedDevice=e):(this._logger.info("selectDevice - unknown device selected, selecting preferred device"),this._selectedDevice=null)},e.prototype._getDeviceId=function(e){return e?e.id:null},e}(),_=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.getBestDevice=function(){var t=this._findCamera(p.CameraFacing.External),n=this._findCamera(p.CameraFacing.Front),r=this._findCamera(p.CameraFacing.LeftFront),i=this._findCamera(p.CameraFacing.RightFront),o=this._findCamera(),a=e.prototype.getBestDevice.call(this);return t||n||r||i||o||a},t.prototype.enumerate=function(){var e=this;return s.map(this._list,(function(t){return{id:t.id,browserId:t.browserId,label:t.label,kind:e._kind,position:e._getCameraPosition(t.cameraFacing)}}))},t.prototype._findCamera=function(e){var t=s.find(this._list,(function(t){return t.deviceType!==p.DeviceType.Virtual&&(!e||t.cameraFacing===e)}));return this._getDeviceId(t)},t.prototype._getCameraPosition=function(e){switch(e){case p.CameraFacing.Front:return 1;case p.CameraFacing.LeftFront:return 4;case p.CameraFacing.RightFront:return 5;case p.CameraFacing.Back:return 2;case p.CameraFacing.External:return 3;default:return 0}},t}(g),m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.enumerate=function(){var e=this,t=s.find(this._list,(function(e){return e.isSystemDefault}))||s.first(this._list);return s.map(this._list,(function(n){return{id:n.id,browserId:n.browserId,label:n.label,kind:e._kind,productId:""+(n.productId||""),vendorId:""+(n.vendorId||""),isSystemDefault:n===t}}))},t}(g),v=function(){function e(e){this._logger=e,this._list=[],this._logger.info("constructor")}return e.prototype.update=function(e){this._list=e,this._logger.info("update: "+JSON.stringify(this._list))},e.prototype.enumerate=function(){var e=this;return s.map(this._list,(function(t){return{id:null,browserId:null,label:t.label,kind:4,microphoneId:t.microphoneId,speakerId:t.speakerId,formFactor:e._getCompositeDeviceFormFactor(t.deviceType),isPcInternalDevice:t.isPcInternalDevice}}))},e.prototype._getCompositeDeviceFormFactor=function(e){switch(e){case p.CompositeAudioDeviceType.Speakers:return 1;case p.CompositeAudioDeviceType.Headphones:return 2;case p.CompositeAudioDeviceType.Headset:return 3;case p.CompositeAudioDeviceType.Handset:return 4;case p.CompositeAudioDeviceType.Speakerphone:return 5;default:return 0}},e}(),y=function(e){function t(t,n,r,i,o){var a=e.call(this,t.createChild("DeviceManager"),n,r)||this;return a._mediaReadyPromise=i,a._appHooks=o,a._browserDevices=[],a._haveStartedMedia=!1,a._startPreviewVideo=function(e){return a._mediaReadyPromise.then((function(t){return a._logger.info("Wait AVAILABLE for preview video "+e),c.waitForVideoObjectState({slimcoreInstance:a._slimcoreInstance,slimcoreObject:t,videoObjectId:e,logger:a._logger,resolveStates:[p.VideoStatus.Available],rejectStates:[p.VideoStatus.NotAvailable],timeout:c.videoObjectTimeout(a._settings)}).then((function(){a._logger.info("Starting preview video "+e),a._slimcoreInstance.videoStart(e)})).then((function(){return c.waitForVideoObjectState({slimcoreInstance:a._slimcoreInstance,slimcoreObject:t,videoObjectId:e,logger:a._logger,resolveStates:[p.VideoStatus.Starting,p.VideoStatus.Running],rejectStates:[p.VideoStatus.NotAvailable],timeout:c.videoObjectTimeout(a._settings)})})).then((function(){return a._logger.info("Now can use preview video "+e)}))}))},a._stopPreviewVideo=function(e){return Promise.resolve().then((function(){a._logger.info("Stopping preview video "+e),a._slimcoreInstance.videoStop(e)}))},a._createRendererBinding=function(e){var t;return a._previewVideoManager.acquire(a._rendererBindingManager,e).then((function(){return t=a._slimcoreInstance.createVideoBindingRenderer?a._slimcoreInstance.createVideoBindingRenderer({enableDXVA:a._settings.enableDXVA,isLocalPreview:!0}):SlimCore.createVideoBindingRenderer(),a._logger.info("Create rendering binding for preview video "+e),a._slimcoreInstance.videoCreateBinding(e,t)})).then((function(){return a._logger.info("Created rendering binding for preview video "+e),t}))},a._releaseRendererBinding=function(e,t){return Promise.resolve().then((function(){return a._logger.info("Release rendering binding for preview video "+e),a._slimcoreInstance.videoReleaseBinding(e,t)})).then((function(){return a._logger.info("Released rendering binding for preview video "+e),a._previewVideoManager.release(a._rendererBindingManager,e)}))},a._createScreenShareBinding=function(e){var t;return a._previewVideoManager.acquire(a._screenShareBindingManager,e).then((function(){return t=a._createVideoBindingScreenShare(),a._logger.info("Create screenshare binding for preview video "+e),a._slimcoreInstance.videoCreateBinding(e,t)})).then((function(){return a._logger.info("Created screenshare binding for preview video "+e),t}))},a._releaseScreenShareBinding=function(e,t){return Promise.resolve().then((function(){return a._logger.info("Release screenshare binding for preview video "+e),a._slimcoreInstance.videoReleaseBinding(e,t)})).then((function(){return a._logger.info("Released screenshare binding for preview video "+e),a._previewVideoManager.release(a._screenShareBindingManager,e)}))},a._logger.info("constructor"),a._cameras=new _(1,a._logger.createChild("cameras")),a._microphones=new m(2,a._logger.createChild("microphones")),a._speakers=new m(3,a._logger.createChild("speakers")),a._compositeDevices=new v(a._logger.createChild("compositeaudiodevices")),a._devicesEnumeratedPromise=a._mediaReadyPromise.then((function(){return a._updateBrowserDevices()})).then((function(){a._updateAudioDevices(),a._updateVideoDevices(),a._handleDisplaysChanged()})),a._previewVideoManager=new u.SlimCoreElectronBindingManager(a._startPreviewVideo,a._stopPreviewVideo,a._logger),a._rendererBindingManager=new u.SlimCoreElectronBindingManager(a._createRendererBinding,a._releaseRendererBinding,a._logger),a._screenShareBindingManager=new u.SlimCoreElectronBindingManager(a._createScreenShareBinding,a._releaseScreenShareBinding,a._logger),a._registerDisposable(a._slimcoreInstance.handle("device-list-changed",void 0,(function(e){return a._slimCoreDevicesChangedHander(e)}))),a._registerDisposable(a._appHooks.onDisplaysChanged((function(){return a._handleDisplaysChanged()}))),a}return i(t,e),t.prototype.getRendererBindingManager=function(){return this._rendererBindingManager},t.prototype.getScreenShareBindingManager=function(){return this._screenShareBindingManager},t.prototype.getPreviewVideo=function(e,t,n){var r=this,i=0;return this._mediaReadyPromise.then((function(o){if(0===(i=r._slimcoreInstance.createPreviewVideo(e,t,n)))throw new Error("SlimCore returned invalid video object ID 0");return r._logger.info("Got preview video. Waiting for video to become AVAILABLE|STARTING|RUNNING"),c.waitForVideoObjectToBeAvailable(r._slimcoreInstance,o,i,r._logger,c.videoObjectTimeout(r._settings))})).then((function(){return i}))},Object.defineProperty(t.prototype,"isAudioOutputSelectionSupported",{get:function(){return!0},enumerable:!0,configurable:!0}),t.prototype._handleDisplaysChanged=function(){try{this._slimcoreInstance.setDeviceRotation(SlimCore.queryDeviceRotation())}catch(e){this._logger.warn("Displays Changed handling error: "+e)}},t.prototype._updateVideoDevices=function(){this._cameras.update(this._fillBrowserDeviceIds(this._slimcoreInstance.getCameraList(),"videoinput"))},t.prototype._updateAudioDevices=function(){this._microphones.update(this._fillBrowserDeviceIds(this._slimcoreInstance.getMicrophoneList(),"audioinput")),this._speakers.update(this._fillBrowserDeviceIds(this._slimcoreInstance.getSpeakerList(),"audiooutput")),this._slimcoreInstance.getCompositeAudioDevices&&this._compositeDevices.update(this._slimcoreInstance.getCompositeAudioDevices()),this._selectAudioDevices()},t.prototype._updateBrowserDevices=function(){var e=this;return"object"!=typeof navigator?(this._logger.warn("Browser-backed device list won't be fetched as navigator is not available"),Promise.resolve()):this._browserDevicesPromise?this._browserDevicesPromise:this._browserDevicesPromise=navigator.mediaDevices.enumerateDevices().then((function(t){e._browserDevices=t,e._browserDevicesPromise=void 0}))},t.prototype._fillBrowserDeviceIds=function(e,t){if(!e)return e;for(var n=function(e){var n=r._browserDevices.find((function(n){if(n.kind!==t)return!1;if(n.label===e.label)return!0;if(0===n.label.indexOf(e.label)){var r=function(e,t){var n=e.split(t)[1].trim().match(/\((.+):(.+)\)/);if(n){var r=n.slice(1);return"vid_"+r[0]+"&pid_"+r[1]}}(n.label,e.label);return e.id.indexOf(r)>-1}return!1}));n?e.browserId=n.deviceId:r._browserDevices.length>0&&r._logger.warn("No browser device found for device "+e.label)},r=this,i=0,o=e;i<o.length;i++)n(o[i]);return e},t.prototype._selectAudioDevices=function(){var e=this._microphones.getSelectedDevice(),t=this._speakers.getSelectedDevice();this._logger.info("SlimCore - selectAudioDevices: "+e+", "+t),this._slimcoreInstance.selectAudioDevices(e,t)},t.prototype._slimCoreDevicesChangedHander=function(e){var t=this;this._logger.info("SlimCore Devices changed: "+JSON.stringify(e)),this._updateBrowserDevices().then((function(){e.video?t._updateVideoDevices():t._updateAudioDevices(),t._raiseDevicesChanged(),t._logger.info("Raised device changed notification: "+JSON.stringify(e))})).catch((function(e){t._logger.error("Failed to raise device changed notification, error = "+e)}))},t.prototype._raiseDevicesChanged=function(){this.raiseChanged(),this.event("devicesChanged").raise(this._enumerateDevices())},t.prototype._enumerateDevices=function(){var e=this._cameras.enumerate(),t=this._microphones.enumerate(),n=this._speakers.enumerate(),r=this._compositeDevices.enumerate();return[].concat(e,t,n,r)},t.prototype.askDevicePermission=function(e){return Promise.resolve().then((function(){return{audio:!0,video:!0}}))},t.prototype._triggerMediaInitOnce=function(){c.hasFeature(p.Feature.LazyMediaInit)&&!this._haveStartedMedia&&(this._slimcoreInstance.fireIntent(p.Intent.MediaInit),this._haveStartedMedia=!0)},t.prototype.enumerateDevicesAsync=function(){var e=this;return new Promise((function(t,n){e._triggerMediaInitOnce(),e._devicesEnumeratedPromise.then((function(){return e._enumerateDevices()})).then(t,n)}))},t.prototype.selectDevices=function(e){var t=this;this._devicesEnumeratedPromise.then((function(){t._selectDevices(e)}))},t.prototype.selectDevicesAsync=function(e){return Promise.reject(new Error("Not implemented"))},t.prototype._selectDevices=function(e){this._logger.debug("selectDevices - "+JSON.stringify(e)),void 0!==e.camera&&this._cameras.selectDevice(e.camera),void 0!==e.microphone&&this._microphones.selectDevice(e.microphone),void 0!==e.speaker&&this._speakers.selectDevice(e.speaker),this._selectAudioDevices(),this._raiseDevicesChanged()},t.prototype.setVideoCaptureConfigAsync=function(e,t){var n=this;return this._mediaReadyPromise.then((function(){n._slimcoreInstance.setVideoCaptureConfig?n._slimcoreInstance.setVideoCaptureConfig(e,t):n._logger.warn("setVideoCaptureConfig is not available")})).catch((function(e){throw n._logger.error("Failed to set video capture config, Error = "+e),e}))},t.prototype.setDeviceEffectsAsync=function(e,t){var n=this;return this._mediaReadyPromise.then((function(){n._slimcoreInstance.setDeviceEffects?n._slimcoreInstance.setDeviceEffects(e,d.convertVideoEffectType(t)):n._logger.warn("setDeviceEffects is not available")})).catch((function(e){throw n._logger.error("Failed to set Video Effects, Error = "+e),e}))},t.prototype.getDeviceEffectsCapabilityAsync=function(e,t){var n=this;return this._mediaReadyPromise.then((function(){return n._slimcoreInstance.getDeviceEffectsCapability?n._slimcoreInstance.getDeviceEffectsCapability(e,t):(n._logger.warn("getDeviceEffectsCapability is not available"),0)})).catch((function(e){throw n._logger.error("Error in getDeviceEffectsCapabilityAsync, error = "+e),e}))},t.prototype.setBackgroundImageAsync=function(e,t){var n=this;return this._mediaReadyPromise.then((function(){n._slimcoreInstance.setBackgroundImage?n._slimcoreInstance.setBackgroundImage(e,t):n._logger.warn("setBackgroundImage is not available")})).catch((function(e){throw n._logger.error("Failed to set background image, Error = "+e),e}))},t.prototype.getSelectedDevices=function(){var e={camera:this._cameras.getSelectedDevice(),microphone:this._microphones.getSelectedDevice(),speaker:this._speakers.getSelectedDevice()};return this._logger.debug("getSelectedDevices - "+JSON.stringify(e)),e},t.prototype.getCamera=function(e){return s.find(this._cameras.enumerate(),(function(t){return t.id===e}))},t.prototype.getSelectedCamera=function(){var e=this._cameras.getSelectedDevice(),t=this.getCamera(e);return this._logger.debug("getSelectedCamera - "+JSON.stringify(t)),t},t.prototype.createPreview=function(e,t,n,r){return void 0===r&&(r=f.generateCauseId()),o(this,void 0,void 0,(function(){var i;return a(this,(function(o){switch(o.label){case 0:return[4,(i=new h.default(this._logger,this._settings,this._slimcoreInstance,e,this,t,n,r)).startVideoAsync(r)];case 1:return o.sent(),[2,i]}}))}))},t.prototype.createPreviewRenderer=function(e,t,n){return void 0===n&&(n=f.generateCauseId()),this.createPreview(e,{kind:"camera"},t,n)},t.prototype.createScreenSharingPreviewRenderer=function(e,t,n){return void 0===n&&(n=f.generateCauseId()),this.createPreview(e,{kind:"sharing"},t,n)},t.prototype.getDeviceNameAsync=function(e){var t=this;return Promise.resolve().then((function(){var n=s.find(t._enumerateDevices(),(function(t){return t.id===e}));if(!n)throw new Error("Device with id: "+e+" not found");return n.label}))},t.prototype.getSpeakerVolume=function(){var e=this;return this._mediaReadyPromise.then((function(){return e._slimcoreInstance.getSpeakerVolume()}))},t.prototype.getSpeakerSystemVolume=function(){var e=this;return this._mediaReadyPromise.then((function(){return e._slimcoreInstance.getSpeakerSystemVolume()}))},t.prototype.setSpeakerVolume=function(e){var t=this;return this._mediaReadyPromise.then((function(){return t._slimcoreInstance.setSpeakerVolume(e)}))},t.prototype.setSpeakerSystemVolume=function(e){var t=this;return this._mediaReadyPromise.then((function(){return t._slimcoreInstance.setSpeakerSystemVolume(e)}))},t.prototype.unmuteMicrophone=function(){var e=this;return this._mediaReadyPromise.then((function(){return e._slimcoreInstance.unmuteMicrophone()}))},t.prototype.unmuteSpeaker=function(){var e=this;return this._mediaReadyPromise.then((function(){return e._slimcoreInstance.unmuteSpeaker()}))},t.prototype.getNrgLevelsForDeviceTuner=function(e){var t=this;return this._mediaReadyPromise.then((function(){return t._slimcoreInstance.getNrgLevelsForDeviceTuner(e)}))},t.prototype.getMicrophoneVolume=function(){var e=this;return this._mediaReadyPromise.then((function(){return e._slimcoreInstance.getMicrophoneVolume()}))},t.prototype.setMicrophoneVolume=function(e){var t=this;return this._mediaReadyPromise.then((function(){return t._slimcoreInstance.setMicrophoneVolume(e)}))},t.prototype.addProbeDevices=function(){var e=this;return this._mediaReadyPromise.then((function(){return e._slimcoreInstance.addProbeDevices?e._slimcoreInstance.addProbeDevices():(e._logger.warn("addProbeDevices is not available"),Promise.reject(!1))})).catch((function(t){return e._logger.error("Error in addProbeDevices, Error = "+t),Promise.reject(!1)}))},t.prototype.hasVideoBindingScreenShare=function(){return!(!this._slimcoreInstance.createVideoBindingScreenShare&&!SlimCore.createVideoBindingScreenShare)},t.prototype._createVideoBindingScreenShare=function(){return this._slimcoreInstance.createVideoBindingScreenShare?this._slimcoreInstance.createVideoBindingScreenShare():SlimCore.createVideoBindingScreenShare()},t}(l.default);t.default=y},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(1),c=n(16),l=n(0),u=n(28),d=SlimCore.Enums,h=0,p=function(e){function t(t,n,r,i,o,a,l,u){var d=e.call(this,t.createChild((function(){return"LocalVideoPreview["+d._id+"]["+d._selection.kind+"]["+d._previewVideoObjectId+"]"})),n,r)||this;if(d._currentTarget=i,d._deviceManager=o,d._selection=a,d._options=l,d._id=h++,d._previewVideoObjectId=0,d._shouldRun=!1,d._logger.info("constructor device? "+d._selection.device+" causeId: "+u),"camera"!==d._selection.kind&&("sharing"!==d._selection.kind||!s.isUndefined(d._selection.device)))throw new Error("invalid selection parameters causeId: "+u);return d._chainedApiPromise=new c.default(t.createChild((function(){return"LocalVideoPreview["+d._id+"]["+d._selection.kind+"]["+d._previewVideoObjectId+"]"}))),"camera"===d._selection.kind&&s.isUndefined(d._selection.device)&&d._registerDisposable(d._deviceManager.on("devicesChanged",(function(){return d._devicesChanged(u)}))),d}return i(t,e),t.prototype._devicesChanged=function(e){var t=this;this._logger.info("_devicesChanged causeId: "+e),this._chainedApiPromise.chainPromise((function(){return t._swapVideoDevice(e)}),"swapVideoDevice",e)},t.prototype.startVideoAsync=function(e){var t=this;return this._logger.info("startVideoAsync causeId: "+e),this._shouldRun=!0,this._chainedApiPromise.chainPromise((function(){return t._startVideo(e)}),"startVideoAsync",e)},t.prototype.stop=function(e){var t=this;return this._logger.info("stop causeId: "+e),this._shouldRun=!1,this._chainedApiPromise.chainPromise((function(){return t._stopVideo(e,!1)}),"stopVideoAsync",e)},t.prototype.dumpVideoSourceImages=function(){return this._previewVideoObjectId?this._slimcoreInstance.dumpVideoSourceImages(this._previewVideoObjectId):Promise.reject(new Error("Cannot dump video fx debug images when there is no preview video"))},t.prototype.dispose=function(e){var t=this;this._logger.info("dispose causeId: "+e),this._shouldRun=!1,this._chainedApiPromise.chainPromise((function(){return t._dispose(e)}),"dispose",e)},t.prototype._isRunning=function(){return 0!==this._previewVideoObjectId&&!!this._videoBinding},t.prototype._dispose=function(t){var n=this;return l.forgetAndLog(this._stopVideo(t,!0),this._logger,"dispose causeId: "+t+" stopping video preview failed").then((function(){n._currentTarget=null,e.prototype.dispose.call(n,t)}))},t.prototype._swapVideoDevice=function(e){return o(this,void 0,void 0,(function(){var t;return a(this,(function(n){switch(n.label){case 0:return this._shouldRun&&this._isRunning()&&this._currentTarget?(t=this._deviceManager.getSelectedCamera())&&this._currentCamera&&t.id!==this._currentCamera.id?(this._logger.info("_swapVideoDevice causeId: "+e+" will change video preview device: "+this._currentCamera.id+" -> "+t.id),[4,this._stopVideo(e,!0)]):[3,3]:[3,4];case 1:return n.sent(),[4,this._startVideo(e)];case 2:n.sent(),n.label=3;case 3:return[3,5];case 4:this._logger.info("_swapVideoDevice causeId: "+e+" noop, should run: "+this._shouldRun+" is running: "+this._isRunning()+" has target: "+!!this._currentTarget),n.label=5;case 5:return[2]}}))}))},t.prototype._startVideo=function(e){return o(this,void 0,void 0,(function(){var t,n,r,i,o,c;return a(this,(function(a){switch(a.label){case 0:if(!this._shouldRun||this._isRunning()||!this._currentTarget)return[3,4];if(t="",n="",r=d.VideoType.ScreenShare,"camera"===this._selection.kind){if(s.isUndefined(this._selection.device)?this._currentCamera=this._deviceManager.getSelectedCamera():this._currentCamera=this._deviceManager.getCamera(this._selection.device),!this._currentCamera)throw new Error("_startVideo causeId: "+e+" no camera to start video preview");r=d.VideoType.Video,t=this._currentCamera.label,n=this._currentCamera.id}return this._logger.info("_startVideo causeId: "+e+" will start video preview now for device name: "+t+" path: "+n),i=this,[4,this._deviceManager.getPreviewVideo(r,t,n)];case 1:return i._previewVideoObjectId=a.sent(),o=this,[4,this._deviceManager.getRendererBindingManager().acquire(this,this._previewVideoObjectId)];case 2:return o._videoBinding=a.sent(),c=this._options||{scalingMode:1,transparent:!1},[4,this._createVideoRenderer(this._currentTarget,c,!0)];case 3:return a.sent(),[3,5];case 4:this._logger.info("_startVideo causeId: "+e+" noop, should run: "+this._shouldRun+" is running: "+this._isRunning()+" has target: "+!!this._currentTarget),a.label=5;case 5:return[2]}}))}))},t.prototype._stopVideo=function(e,t){return o(this,void 0,void 0,(function(){var n;return a(this,(function(r){switch(r.label){case 0:if(this._shouldRun&&!t||!this._isRunning())return[3,2];this._logger.info("_stopVideo causeId: "+e+" force: "+t+" will stop video preview now");try{this._disposeVideoRenderer(e)}catch(t){this._logger.warn("_stopVideo causeId: "+e+" _disposeVideoRenderer error: "+t+" falied @ "+(new Error).stack)}return n=this._deviceManager.getRendererBindingManager().release(this,this._previewVideoObjectId),this._previewVideoObjectId=0,this._videoBinding=null,[4,n];case 1:return r.sent(),[3,3];case 2:this._logger.info("_stopVideo causeId: "+e+" noop, force: "+t+" should run: "+this._shouldRun+" is running: "+this._isRunning()+" has target: "+!!this._currentTarget),r.label=3;case 3:return[2]}}))}))},t}(u.default);t.default=p},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),a=n(4),s=n(3),c=n(30),l=function(e){function t(t,n,r,i,o){var a=e.call(this,t.createChild("ScreenSharingManager"),n,r)||this;a._appHooks=i,a._deviceManager=o,a._logger.info("constructor");try{a._screenScraper=new c.default(a._slimcoreInstance)}catch(e){a._logger.warn(""+e)}return a._registerDisposable(a._appHooks.onDisplaysChanged((function(){return a._raiseScreensChanged()}))),a}return i(t,e),t.prototype.enumerateScreensAsync=function(){var e=this;return a.asap((function(){return e._enumerateScreens()}))},t.prototype.enumerateWindowsAsync=function(){var e=this;return a.asap((function(){return e._enumerateWindows()}))},t.prototype.enumerateCamerasAsync=function(){var e=this;try{return this._deviceManager?this._deviceManager.enumerateDevicesAsync().then((function(t){var n=t.filter((function(e){return 1===e.kind}));return e._logger.debug("enumerateCameras() result: "+JSON.stringify(n)),o.map(n,(function(e){return new h(e)}))})):Promise.resolve([])}catch(e){return this._logger.error("enumerateCameras() failed: "+e),Promise.reject("enumerateCameras() failed: "+e)}},t.prototype._enumerateScreens=function(){var e=this;try{var t=this._screenScraper&&this._screenScraper.getMonitorList()||[];return this._logger.debug("ScreenScraper.getMonitorList() result: "+JSON.stringify(t)),o.map(t,(function(t){return new u(t,e._logger,e._screenScraper)}))}catch(e){throw this._logger.error("ScreenScraper.getMonitorList() failed: "+e),e}},t.prototype._enumerateWindows=function(){var e=this;try{var t=this._screenScraper&&this._screenScraper.getWindowList()||[];return this._logger.debug("ScreenScraper.getWindowList() result: "+JSON.stringify(t)),o.map(t,(function(t){return new d(t,e._logger,e._screenScraper)}))}catch(e){throw this._logger.error("ScreenScraper.getWindowList() failed: "+e),e}},t.prototype._raiseScreensChanged=function(){this._logger.debug("raising onScreensChanged"),this.event("screensChanged").raise()},t}(s.default);t.default=l;var u=function(){function e(e,t,n){this._monitorInfo=e,this._logger=t,this._screenScraper=n}return e.prototype.getId=function(){return this._monitorInfo.monitorId},e.prototype.getDeviceId=function(){return String(this._monitorInfo.monitorId)},e.prototype.getType=function(){return 1},e.prototype.getPreview=function(e,t,n){return Promise.reject("not implemented")},e.prototype.getPreviewAsync=function(e,t,n){var r=this;return new Promise((function(i){i(r._screenScraper.getMonitorPreview(r.getId(),e,t,n,r._monitorInfo.region))})).then((function(e){return r._logger.debug("ScreenScraper.getMonitorPreview("+r.getId()+") result: "+e.width+"x"+e.height),e}),(function(e){throw r._logger.error("ScreenScraper.getMonitorPreview("+r.getId()+") failed: "+e),e}))},e.prototype.getDescription=function(){return this._monitorInfo.name},e.prototype.getIcon=function(e,t){return Promise.resolve(null)},e.prototype.getBounds=function(){return{x:this._monitorInfo.region.x,y:this._monitorInfo.region.y,width:this._monitorInfo.region.width,height:this._monitorInfo.region.height}},e}(),d=function(){function e(e,t,n){this._windowInfo=e,this._logger=t,this._screenScraper=n}return e.prototype.getId=function(){return this._windowInfo.windowId},e.prototype.getDeviceId=function(){return String(this._windowInfo.windowId)},e.prototype.getType=function(){return 2},e.prototype.getPreview=function(e,t,n){return Promise.reject("not implemented")},e.prototype.getPreviewAsync=function(e,t,n){var r=this;return new Promise((function(i){i(r._screenScraper.getWindowPreview(r.getId(),e,t,n))})).then((function(e){return r._logger.debug("ScreenScraper.getWindowPreview("+r.getId()+") result: "+e.width+"x"+e.height),e}),(function(e){throw r._logger.error("ScreenScraper.getWindowPreview("+r.getId()+") failed: "+e),e}))},e.prototype.getDescription=function(){return this._windowInfo.title},e.prototype.getAppName=function(){return this._windowInfo.applicationName},e.prototype.getIcon=function(e,t,n){var r=this;return new Promise((function(i){i(r._screenScraper.getWindowIcon(r.getId(),e,t,n))})).then((function(e){return r._logger.debug("ScreenScraper.getWindowIcon("+r.getId()+") result: "+e.width+"x"+e.height),e}),(function(e){throw r._logger.error("ScreenScraper.getWindowIcon("+r.getId()+") failed: "+e),e}))},e.prototype.getBounds=function(){},e}(),h=function(){function e(e){this._cameraDescription=e}return e.prototype.getId=function(){return null},e.prototype.getDeviceId=function(){return this._cameraDescription.id},e.prototype.getType=function(){return 3},e.prototype.getPreview=function(e,t,n){return Promise.reject("not implemented")},e.prototype.getPreviewAsync=function(e,t,n){return Promise.reject("not implemented")},e.prototype.getDescription=function(){return this._cameraDescription.label},e.prototype.getIcon=function(e,t,n){return Promise.reject("not implemented")},e.prototype.getBounds=function(){},e}()},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(1),c=n(4),l=n(5),u=n(10),d=n(51),h=n(0),p=n(3),f=n(33),g=n(34),_=n(21),m=n(36),v=n(22),y=n(59),C=SlimCore.Enums,S=n(2),I=n(6),T=n(20),P=function(e){function t(t,n){void 0===n&&(n=1);var r=e.call(this,t)||this;return r.callSupport=n,r}return i(t,e),t}(Error),E=function(e){function t(t){var n=e.call(this,new T.default(t.logger).createChild("CallingStack"),s.assign(t.settings,{platform:h.PlatformType.Electron}),h.wrap(t.slimCoreInstance,t.settings))||this;if(n.callRegistries=[],n._startSlimcorePromiseDefered=c.defer(),n._stackLoginPromise=c.defer(),n._mediaStartDeferredPromise=c.defer(),!SlimCore||!SlimCore.getVersion)throw new P("slimcore module is not available",1);if(b()<7)throw new P("slimcore module API version "+b()+" incompatible with required 7",2);t.settings.enableTsCallingULLogging&&d.initDelegate(n._slimcoreInstance,t),n._appHooks=t.appHooks,n._telemetryService=t.telemetryService,n._setup=new v.default(n._slimcoreInstance),n._ecsProvider=new _.default(n._slimcoreInstance),n._stackLoginPromise.promise.then((function(){return n._startSlimcorePromiseDefered.resolve(n._slimcoreInstance)}));var r=new T.default(t.logger),i=h.hasFeature(C.Feature.MultiUserSupport)?n._startSlimcorePromiseDefered.promise:n._stackLoginPromise.promise,o=h.hasFeature(C.Feature.LazyMediaInit)?i.then((function(){return n._mediaStartDeferredPromise.promise})):i;return n._deviceManager=new g.default(r,n._settings,n._slimcoreInstance,o,t.appHooks),n._screenSharingManager=new m.default(r,n._settings,n._slimcoreInstance,t.appHooks,n._deviceManager),n._registerDisposable(n._slimcoreInstance.handle("e911-info-changed",void 0,(function(e){return n._onE911Info(e)}))),n._registerDisposable(n._slimcoreInstance.handle("media-status-changed",void 0,(function(e){return n._onMediaStatus(e)}))),n._registerDisposable(n._slimcoreInstance.handle("probe-devices-status-changed",void 0,(function(e){return n._onProbeDevicesStatusChanged(e)}))),n}return i(t,e),t.prototype.dispose=function(t){var n=this;void 0===t&&(t=S.generateCauseId());var r=this._logger.createFnLogger("dispose",t);r.info("dispose"),this._libStatus!==C.LibStatus.Running&&this._startSlimcorePromiseDefered.reject(new Error("CallingStack dispose called before slimcore reached Running state")),this._mediaStartDeferredPromise.reject(new Error("CallingStack dispose called before media was initialized"));var i=function(){n.callRegistries=[],r.info("call registries are disposed"),n._screenSharingManager.dispose(t),n._screenSharingManager=void 0,r.info("screensharing manager is disposed"),n._deviceManager.dispose(t),n._deviceManager=void 0,r.info("device manager is disposed"),d.deinitLogging(),n._slimcoreInstance.dispose(),n._slimcoreInstance=void 0,r.info("slimcore instance is disposed"),e.prototype.dispose.call(n)},o=this.callRegistries.map((function(e){return e.dispose(t)}));Promise.all(o).then(i,i)},t.prototype.init=function(e,t){return void 0===e&&(e={block:!0}),void 0===t&&(t=S.generateCauseId()),o(this,void 0,void 0,(function(){var n,r=this;return a(this,(function(i){switch(i.label){case 0:return(n=this._logger.createFnLogger("init",t)).info("init"),this._slimcoreInstance?(h.hasFeature(C.Feature.AsyncStart)||(e.block=!0),e.block||this._registerDisposable(this._slimcoreInstance.handle("lib-status-changed",{libStatus:SlimCore.Enums.LibStatus.Running},(function(e){return r._onLibStatusChanged(e)}))),[4,Promise.all([this.getSetup().setNumber("*Lib/LazyMediaInit",h.hasFeature(C.Feature.LazyMediaInit)&&e.lazyMediaInit?1:0),this.getSetup().setString("*Lib/SCT/Telemetry/DiagnosticLevel",e.telemetryDiagnosticLevel||"")])]):[2,Promise.reject(new Error("slimcore instance is already disposed"))];case 1:return i.sent(),this._slimcoreInstance.start(e.block),n.info("starting slimcoreInstance block="+e.block),e.block&&(this._libStatus=C.LibStatus.Running,this._startSlimcorePromiseDefered.resolve(this._slimcoreInstance)),[2,this._startSlimcorePromiseDefered.promise.then(I.noop)]}}))}))},t.prototype._onLibStatusChanged=function(e){this._logger.info("_onLibStatusChanged from "+this._libStatus+" => "+e.libStatus),e.libStatus===C.LibStatus.Running?this._startSlimcorePromiseDefered.resolve(this._slimcoreInstance):e.libStatus===C.LibStatus.FatalError&&this._libStatus===C.LibStatus.Constructed&&this._startSlimcorePromiseDefered.reject(new Error("Slimcore FatalError during start")),this._libStatus=e.libStatus},t.prototype.getCallRegistry=function(e,t,n){var r=this;void 0===t&&(t=S.generateCauseId());var i=e?l.mriOrId(e.id):void 0,s=this._logger.createFnLogger("getCallRegistry[identity="+i+"]",t);if(!e)return s.info("returning default callRegistry"),this.callRegistries[0]?this.callRegistries[0]:this.createCallRegistry();var c=this.callRegistries.find((function(t){return t.identity===e.id}));if(c&&!c.isDisposing)return s.info("callRegistry already exists for "+l.mriOrId(e.id)),Promise.resolve(c);var u=c&&c.isDisposing?c.disposePromise:Promise.resolve().then(I.noop);return this._startSlimcorePromiseDefered.promise.then((function(){return o(r,void 0,void 0,(function(){return a(this,(function(r){switch(r.label){case 0:return[4,u];case 1:return r.sent(),[4,(c=this.createCallRegistry()).login(e,t,h.mapToEmptyStrIfFalsy(JSON.stringify(n))).catch((function(){return c.dispose(t)}))];case 2:return r.sent(),[2,c]}}))}))}))},t.prototype.createCallRegistry=function(){var e=this,t=new f.default(this._logger,this._settings,this._slimcoreInstance,this._deviceManager,this._appHooks,this._telemetryService);return t.on("disposed",(function(){e.callRegistries.splice(e.callRegistries.indexOf(t),1)})),t.loginPromise.then(this._stackLoginPromise.resolve,this._stackLoginPromise.reject),this.callRegistries.push(t),t},t.prototype.getDeviceManager=function(){return this._deviceManager},t.prototype.getScreenSharingManager=function(){return this._screenSharingManager},t.prototype.getSetup=function(){return this._setup},t.prototype.getEcsProvider=function(){return this._ecsProvider},t.prototype.fireIntent=function(e,n){if(this._slimcoreInstance){var r=t._callingIntentToSlimcoreIntent(e);r&&this._slimcoreInstance.fireIntent(r,n)}},t.prototype.getVersion=function(){return{build:u.getTsCallingVersion(),ovb:u.getOvb()}},t._callingIntentToSlimcoreIntent=function(e){switch(e){case 0:return C.Intent.CallPush;case 1:return C.Intent.CallUser;case 2:return C.Intent.CallPreheat;case 3:return C.Intent.MediaInit;default:return}},t.prototype._slimcoreMediaStatusToCallingMediaStatus=function(e){switch(e){case C.MediaStatus.Initialized:return 1;case C.MediaStatus.NotAvailable:return 0;case C.MediaStatus.Failed:return 2;case C.MediaStatus.Uninitialized:return 3;default:return}},t.prototype.getMediaStatus=function(){return this._slimcoreMediaStatusToCallingMediaStatus(this._slimcoreInstance.getMediaStatus())},t.prototype.setMediaConfig=function(e){var t=this;return new Promise((function(n){t._setMediaConfig(e,t._startSlimcorePromiseDefered.promise),n()}))},t.prototype._setMediaConfig=function(e,t){var n=this;if(this._slimcoreInstance.setMediaConfig)this._logger.info("Set Media Configuration, using setMediaConfig"),this._slimcoreInstance.setMediaConfig(e);else{var r=!!this._slimcoreInstance.setMediaPortRanges,i=!!this._slimcoreInstance.enableMediaQoS,o=!!this._slimcoreInstance.createMediaConfig,a=!!this._slimcoreInstance.setOpenCameraInMaxResolution,s=!!this._slimcoreInstance.enableTtySupport,c=!!this._slimcoreInstance.enableAGC,l=e.hasOwnProperty("mediaPortRanges"),u=e.hasOwnProperty("enableMediaQoS"),d=e.hasOwnProperty("openCameraInMaxResolution"),h=e.hasOwnProperty("enableTtySupport"),p=e.hasOwnProperty("enableAGC");if(a&&d&&(this._logger.info("Set Media Configuration, using OpenCameraInMaxResolution"),this._slimcoreInstance.setOpenCameraInMaxResolution(e.openCameraInMaxResolution)),u||l)if(i&&r)u&&(this._logger.info("Set Media Configuration, using set enableMediaQos"),this._slimcoreInstance.enableMediaQoS(e.enableMediaQoS)),l&&(this._logger.info("Set Media Configuration, using set Media port ranges"),this._slimcoreInstance.setMediaPortRanges(e.mediaPortRanges));else if(o){this._logger.info("Set Media Configuration, using CreateMediaConfig");var f=this._slimcoreInstance.createMediaConfig();u&&f.enableMediaQoS(e.enableMediaQoS),l&&f.setMediaPortRanges(e.mediaPortRanges)}else this._logger.error("Set Media Configuration, failed no suitable methods found for qos or port ranges");(h||p)&&(this._logger.info("Set Media Configuration, queuing operation to run when media is ready"),t.then((function(){if(h)if(s)n._logger.info("Set Media Configuration, using enableTtySupport"),n._slimcoreInstance.enableTtySupport(e.enableTtySupport);else if(o){var t=n._slimcoreInstance.createMediaConfig();t.enableTtySupport?(n._logger.info("Set Media Configuration, using CreateMediaConfig.enableTtySupport"),t.enableTtySupport(e.enableTtySupport)):n._logger.error("Set Media Configuration, failed no suitable methods found for enableTtySupport on CreateMediaConfig")}else n._logger.error("Set Media Configuration, failed no suitable methods found for enableTtySupport");p&&c&&(n._logger.info("Set Media Configuration, using enableAGC"),n._slimcoreInstance.enableAGC(e.enableAGC))})))}},t.prototype.getE911Info=function(){var e=this;return this._slimcoreInstance?this._slimcoreInstance.getE911Info?this._startSlimcorePromiseDefered.promise.then((function(){var t=e._slimcoreInstance.getE911Info();try{return JSON.parse(t)}catch(e){return Promise.reject(new Error("failed to parse e911Info"))}})):Promise.reject(new Error("getE911Info is not available")):Promise.reject(new Error("slimcore instance is already disposed"))},t.prototype._onE911Info=function(e){var t;try{t=JSON.parse(e.info)}catch(e){return void this._logger.error("failed to parse e911Info")}this.event("e911InfoChanged").raise(t)},t.prototype._onMediaStatus=function(e){var t=this._slimcoreMediaStatusToCallingMediaStatus(e.mediaStatus);this.event("mediaStatusChanged").raise(t),1===t?this._mediaStartDeferredPromise.resolve(this._slimcoreInstance):2===t&&this._mediaStartDeferredPromise.reject(new Error("Media initialization FatalError"))},t.prototype._onProbeDevicesStatusChanged=function(e){this.event("probeDevicesStatusChanged").raise(e.ready)},t}(p.default);t.SlimCoreElectronStack=E;var O=function(e){function t(t){var n=e.call(this,new T.default(t.logger).createChild("CallingStack",!0),s.assign(t.settings,{platform:h.PlatformType.Uwp}),h.wrap(new y.UwpEngineWrapped(t.slimCoreInstance).objectAsWrapped,t.settings))||this;if(n.callRegistries=[],n._startSlimcorePromiseDefered=c.defer(),n._stackLoginPromise=c.defer(),n._mediaStartDeferredPromise=c.defer(),!h.isSlimCoreRTModuleAvailable())throw new P("slimcore module is not available",1);n._appHooks=t.appHooks,n._telemetryService=t.telemetryService,n._setup=new v.default(n._slimcoreInstance),n._stackLoginPromise.promise.then((function(){return n._startSlimcorePromiseDefered.resolve(n._slimcoreInstance)}));var r=h.hasFeature(C.Feature.MultiUserSupport)?n._startSlimcorePromiseDefered.promise:n._stackLoginPromise.promise,i=h.hasFeature(C.Feature.LazyMediaInit)?r.then((function(){return n._mediaStartDeferredPromise.promise})):r;return n._deviceManager=new g.default(n._logger,n._settings,n._slimcoreInstance,i,t.appHooks),n._screenSharingManager=new m.default(n._logger,n._settings,n._slimcoreInstance,t.appHooks,n._deviceManager),n._registerDisposable(n._slimcoreInstance.handle("media-status-changed",void 0,(function(e){return n._onMediaStatus(e)}))),n}return i(t,e),t.prototype.dispose=function(t){var n=this;void 0===t&&(t=S.generateCauseId());var r=this._logger.createFnLogger("dispose",t);r.info("dispose"),this._libStatus!==C.LibStatus.Running&&this._startSlimcorePromiseDefered.reject(new Error("CallingStack dispose called before slimcore reached Running state")),this._mediaStartDeferredPromise.reject(new Error("CallingStack dispose called before media was initialized"));var i=function(){n.callRegistries=[],r.info("call registries are disposed"),n._screenSharingManager.dispose(t),n._screenSharingManager=void 0,r.info("screensharing manager is disposed"),n._deviceManager.dispose(t),n._deviceManager=void 0,r.info("device manager is disposed"),n._slimcoreInstance.dispose(),n._slimcoreInstance=void 0,r.info("slimcore instance is disposed"),e.prototype.dispose.call(n)},o=this.callRegistries.map((function(e){return e.dispose(t)}));Promise.all(o).then(i,i)},t.prototype.init=function(e,t){return void 0===e&&(e={block:!0}),void 0===t&&(t=S.generateCauseId()),o(this,void 0,void 0,(function(){var n,r=this;return a(this,(function(i){switch(i.label){case 0:return(n=this._logger.createFnLogger("init",t)).info("init"),this._slimcoreInstance?(h.hasFeature(C.Feature.AsyncStart)||(e.block=!0),e.block||this._registerDisposable(this._slimcoreInstance.handle("lib-status-changed",{libStatus:SlimCore.Enums.LibStatus.Running},(function(e){return r._onLibStatusChanged(e)}))),[4,Promise.all([this.getSetup().setNumber("*Lib/LazyMediaInit",h.hasFeature(C.Feature.LazyMediaInit)&&e.lazyMediaInit?1:0),this.getSetup().setString("*Lib/SCT/Telemetry/DiagnosticLevel",e.telemetryDiagnosticLevel||"")])]):[2,Promise.reject(new Error("slimcore instance is already disposed"))];case 1:return i.sent(),this._slimcoreInstance.start(e.block),n.info("starting slimcoreInstance block="+e.block),e.block&&(this._libStatus=C.LibStatus.Running,this._startSlimcorePromiseDefered.resolve(this._slimcoreInstance)),[2,this._startSlimcorePromiseDefered.promise.then(I.noop)]}}))}))},t.prototype._onLibStatusChanged=function(e){this._logger.info("_onLibStatusChanged from "+this._libStatus+" => "+e.libStatus),e.libStatus===C.LibStatus.Running?this._startSlimcorePromiseDefered.resolve(this._slimcoreInstance):e.libStatus===C.LibStatus.FatalError&&this._libStatus===C.LibStatus.Constructed&&this._startSlimcorePromiseDefered.reject(new Error("Slimcore FatalError during start")),this._libStatus=e.libStatus},t.prototype.getCallRegistry=function(e,t,n){var r=this;void 0===t&&(t=S.generateCauseId());var i=e?l.mriOrId(e.id):void 0,s=this._logger.createFnLogger("getCallRegistry[identity="+i+"]",t);if(!e)return s.info("returning default callRegistry"),this.callRegistries[0]?this.callRegistries[0]:this.createCallRegistry();var c=this.callRegistries.find((function(t){return t.identity===e.id}));if(c&&!c.isDisposing)return s.info("callRegistry already exists for "+l.mriOrId(e.id)),Promise.resolve(c);var u=c&&c.isDisposing?c.disposePromise:Promise.resolve().then(I.noop);return this._startSlimcorePromiseDefered.promise.then((function(){return o(r,void 0,void 0,(function(){return a(this,(function(r){switch(r.label){case 0:return[4,u];case 1:return r.sent(),[4,(c=this.createCallRegistry()).login(e,t,h.mapToEmptyStrIfFalsy(JSON.stringify(n))).catch((function(){return c.dispose(t)}))];case 2:return r.sent(),[2,c]}}))}))}))},t.prototype.createCallRegistry=function(){var e=this,t=new f.default(this._logger,this._settings,this._slimcoreInstance,this._deviceManager,this._appHooks,this._telemetryService);return t.on("disposed",(function(){e.callRegistries.splice(e.callRegistries.indexOf(t),1)})),t.loginPromise.then(this._stackLoginPromise.resolve,this._stackLoginPromise.reject),this.callRegistries.push(t),t},t.prototype.getDeviceManager=function(){return this._logger.info("retrieving device manager"),this._deviceManager},t.prototype.getScreenSharingManager=function(){return this._screenSharingManager},t.prototype.getSetup=function(){return this._setup},t.prototype.getEcsProvider=function(){return null},t.prototype.fireIntent=function(e,t){},t.prototype.getVersion=function(){return{build:u.getTsCallingVersion(),ovb:u.getOvb()}},t.prototype.getMediaStatus=function(){return null},t.prototype.setMediaConfig=function(e){var t=this;return new Promise((function(n){t._logger.info("Set Media Configuration, using new default method"),t._slimcoreInstance.setMediaConfig(e),n()}))},t.prototype._slimcoreMediaStatusToCallingMediaStatus=function(e){switch(e){case C.MediaStatus.Initialized:return 1;case C.MediaStatus.NotAvailable:return 0;case C.MediaStatus.Failed:return 2;case C.MediaStatus.Uninitialized:return 3;default:return}},t.prototype._onMediaStatus=function(e){var t=this._slimcoreMediaStatusToCallingMediaStatus(e.mediaStatus);this.event("mediaStatusChanged").raise(t),1===t?this._mediaStartDeferredPromise.resolve(this._slimcoreInstance):2===t&&this._mediaStartDeferredPromise.reject(new Error("Media initialization FatalError"))},t}(p.default);function b(){return SlimCore.getApiVersion&&SlimCore.getApiVersion()}t.SlimCoreUwpStack=O,t.slimCoreElectronStackFactory={build:function(e){return Promise.resolve().then((function(){return e.settings.enableTsCallingULLogging&&d.patchLogger(e),new E(e)})).catch((function(e){throw e instanceof P?e:new P(""+e)}))},getVersion:function(){return{build:u.getTsCallingVersion(),ovb:u.getOvb()}}},t.slimCoreUwpStackFactory={build:function(e){return Promise.resolve().then((function(){return new O(e)})).catch((function(e){throw e instanceof P?e:new P(""+e)}))},getVersion:function(){return{build:u.getTsCallingVersion(),ovb:u.getOvb()}}}},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){n(0),n(3),n(11),n(26),n(33),n(34),n(21),n(29),n(31),n(35),n(18),n(17),n(27),n(36),n(22),n(37),e.exports=n(60)},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){return e.call(this,t)||this}return i(t,e),t.prototype.changed=function(e){return this.subscribe({changed:e,on:void 0})},t.prototype.on=function(e,t){return this.subscribe({changed:void 0,on:{name:String(e),handler:this._toEventCallback(t)}})},t.prototype.once=function(e,t,n){var r,i=this;return r=this.on(e,this._fromEventCallback((function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];r.dispose(n),i._toEventCallback(t).apply(void 0,e)})))},t.prototype.raiseChanged=function(){this.raiseEvents((function(e){return e.changed&&e.changed()}))},t.prototype.event=function(e){var t=this;return{raise:this._fromEventCallback((function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return t._raiseEventImpl.apply(t,[String(e)].concat(n))}))}},t.prototype._raiseEventImpl=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.raiseEvents((function(n){var r;return n.on&&n.on.name===e&&(r=n.on).handler.apply(r,t)}))},t.prototype._toEventCallback=function(e){return e},t.prototype._fromEventCallback=function(e){return e},t}(n(23).EventSourceImpl);t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){var e=this;this.msElapsed=0,this.isPaused=!1,this._startTime=(new Date).getTime(),this.pause=function(){e.isPaused||(e.msElapsed+=(new Date).getTime()-e._startTime,e.isPaused=!0)},this.resume=function(){e.isPaused&&(e.isPaused=!1,e._startTime=(new Date).getTime())},this.duration=function(){return e.isPaused?e.msElapsed:e.msElapsed+(new Date).getTime()-e._startTime},this.durationInMinutes=function(){var t=e.duration()/6e4;return Math.ceil(t)},this.durationInSeconds=function(){var t=e.duration()/1e3;return Math.ceil(t)}}return Object.defineProperty(e.prototype,"startTime",{get:function(){return this._startTime},enumerable:!0,configurable:!0}),e}();t.Stopwatch=r,t.build=function(){return new r}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CONSTANTS={CODE:{CLIENT_ERROR_CODE:499},SUB_CODE:{ACTION_NOT_ALLOWED:3548}}},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.callStateIsAnyOf=function(e,t){return-1!==t.indexOf(e)},t.validStateTransitions=((r={})[0]=[1,2,8,6,10,11],r[1]=[2,6,7,10],r[2]=[1,3,6,7,9,10],r[3]=[6,7,4,5,10],r[8]=[1,11,10,2,6,7],r[4]=[6,7,3,5,10],r[5]=[6,7,3,4,10],r[9]=[3,6,7,10],r[10]=[3,6,7,9,4,5],r[11]=[12,1,2,6,7],r[12]=[2,6,7],r[6]=[7],r[7]=[],r)},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.getStreamInformationFromEndpoints=function(e){var t=[];if(!e||!e.endpointDetails.length)return null;try{e.endpointDetails.filter((function(e){return!!e.mediaStreams&&e.mediaStreams.length})).forEach((function(e){var n=e.mediaStreams.reduce((function(e,t){return e[t.type]=t.direction,e}),{});t.push(r({endpointId:e.endpointId,participantId:e.participantId},n))}))}catch(e){return[]}return t}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__decorate||function(e,t,n,r){var i,o=arguments.length,a=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o<3?i(a):o>3?i(t,n,a):i(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}};Object.defineProperty(t,"__esModule",{value:!0});var c=n(4),l=n(8),u=n(46),d=n(3),h=SlimCore.Enums,p=n(2),f=n(14),g=n(15),_=function(e){function t(t,n,r,i,o,a,s){var c=e.call(this,t.createChild((function(){return"ContentSharing["+c.slimCoreContentSharingObjectId+"]"})),n,r)||this;return c._slimcoreCallHandler=i,c.slimCoreContentSharingObjectId=o,c._nativeContentSharing=a,c.callTelemetry=s,c.noFailureReason=SlimCore.Enums.ContentSharingFailureReason.NoFailure,c._getCallEndOperation=function(){return c._callOperationHandler.hasPendingOperation(l.CONTENT_SHARING_OPERATIONS.STOP_CONTENT_SHARING)?c._callOperationHandler.waitForOperation(l.CONTENT_SHARING_OPERATIONS.STOP_CONTENT_SHARING):Promise.resolve()},c._logger.info("constructor"),c._session=new u.ContentSharingSession(c,c._logger),c._callOperationHandler=new g.default(c._logger,c.callTelemetry),c._onContentSharingPropertyChanged(SlimCore.Enums.Property.ContentSharingStatus,(function(e){return c._onContentSharingStatusChanged(e.value)})),c._onContentSharingPropertyChanged(SlimCore.Enums.Property.ContentSharingState,(function(e){return c._onContentSharingStateChanged(e.value)})),c._onContentSharingPropertyChanged(SlimCore.Enums.Property.ContentSharingFailureReason,(function(e){return c._onContentSharingResultCodeChanged(e.value)})),c.contentSharingStatus=c.convertContentSharingStatus(c.getIntProperty(SlimCore.Enums.Property.ContentSharingStatus)),c.contentSharingGuid=c.getStrProperty(SlimCore.Enums.Property.ContentSharingId),c.contentSharingState=c.getStrProperty(SlimCore.Enums.Property.ContentSharingState),c.contentSharingIdentity=c.getStrProperty(SlimCore.Enums.Property.ContentSharingIdentity),c._logger.info("Session created with status "+c.contentSharingStatus+", guid "+c.contentSharingGuid),c._registerDisposable(c._nativeContentSharing.handle("update-session-state-result",void 0,(function(e){return c._onSessionStateResult(e)}))),c._registerDisposable(c._nativeContentSharing.handle("take-control-result",void 0,(function(e){return c._onTakeControlResult(e)}))),c._registerDisposable(c._nativeContentSharing.handle("update-participant-state-result",void 0,(function(e){return c._onUpdateParticipantStateResult(e)}))),c._registerDisposable(c._nativeContentSharing.handle("join-result",void 0,(function(e){return c._onJoinResult(e)}))),c}return i(t,e),t.prototype._onContentSharingPropertyChanged=function(e,t){this._onObjectPropertyChanged(this.slimCoreContentSharingObjectId,e,t)},t.prototype.setContentSharingStatus=function(e){if(this._logger.info("setContentSharingStatus. currentStatus: "+this.contentSharingStatus+" newStatus: "+e),this.contentSharingStatus!==e&&7!==this.contentSharingStatus&&8!==this.contentSharingStatus){if(this._logger.info("Changing content sharing status to: "+e),this.contentSharingStatus=e,7===e||8===e){if(this.contentSharingTerminationReason&&0!==this.contentSharingTerminationReason.terminatedReason)return;var t=this.getIntProperty(h.Property.ContentSharingFailureReason),n=this.getIntProperty(h.Property.ContentSharingFailureCode),r=this.getIntProperty(h.Property.ContentSharingFailureSubCode),i=this.convertFailureReason(t);this._logger.info("setting failure reason for content sharing session. reason: "+i),this.contentSharingTerminationReason={terminatedReason:i,terminatedReasonCode:n,terminatedReasonSubCode:r,errorMessage:"Session is terminated"}}this._session.statusChanged(e),this.raiseChanged()}},t.prototype.getStrProperty=function(e,t){return this._getStrProperty(this._slimcoreCallHandler,this.slimCoreContentSharingObjectId,e,t)},t.prototype.getIntProperty=function(e,t){return this._getIntProperty(this._slimcoreCallHandler,this.slimCoreContentSharingObjectId,e,t)},t.prototype._onContentSharingStatusChanged=function(e){this._logger.info("_onContentSharingStateChanged called"),this.setContentSharingStatus(this.convertContentSharingStatus(e))},t.prototype._onContentSharingStateChanged=function(e){this._logger.info("_onContentSharingStateChanged called"),this.contentSharingState=e,this.raiseChanged()},t.prototype._onContentSharingResultCodeChanged=function(e){if(this._logger.info("_onContentSharingResultCodeChanged called"),!this.contentSharingTerminationReason||0===this.contentSharingTerminationReason.terminatedReason){var t=this.getIntProperty(h.Property.ContentSharingFailureCode),n=this.getIntProperty(h.Property.ContentSharingFailureSubCode),r=this.convertFailureReason(e);this._logger.info("setting failure reason for content sharing session. reason: "+r),this.contentSharingTerminationReason={terminatedReason:r,terminatedReasonCode:t,terminatedReasonSubCode:n,errorMessage:"Session is terminated"}}},t.prototype.convertContentSharingStatus=function(e){switch(e){case h.ContentSharingStatus.Routing:return 1;case h.ContentSharingStatus.Ringing:return 2;case h.ContentSharingStatus.Connected:return 4;case h.ContentSharingStatus.Presenting:return 3;case h.ContentSharingStatus.Viewing:return 5;case h.ContentSharingStatus.Finishing:return 6;case h.ContentSharingStatus.Done:case h.ContentSharingStatus.Failed:case h.ContentSharingStatus.TimedOut:return 7;default:return 0}},t.prototype.startContentSharing=function(e){return void 0===e&&(e=p.generateCauseId()),this._session.startContentSharing(e)},t.prototype.joinContentSharing=function(e){return void 0===e&&(e=p.generateCauseId()),this._session.joinContentSharing(e)},t.prototype.updateContentSharingParticipantStateToViewer=function(e){return void 0===e&&(e=p.generateCauseId()),this._session.updateContentSharingParticipantStateToViewer(e)},t.prototype.updateContentSharingSessionState=function(e,t,n){return void 0===n&&(n=p.generateCauseId()),this._session.updateContentSharingSessionState(e,t,n)},t.prototype.takeContentSharingControl=function(e){return void 0===e&&(e=p.generateCauseId()),this._session.takeContentSharingControl(e)},t.prototype.stopContentSharing=function(e){return void 0===e&&(e=p.generateCauseId()),this._session.stopContentSharing(e)},t.prototype._onJoinResult=function(e){this._session.onJoinResultEvent(e)},t.prototype._onUpdateParticipantStateResult=function(e){this._session.onUpdateParticipantStateResultEvent(e)},t.prototype._onSessionStateResult=function(e){this._session.onSessionStateResultEvent(e)},t.prototype._onTakeControlResult=function(e){this._session.onTakeControlResultEvent(e)},t.prototype.callStartContentSharing=function(){var e=this;return c.asap((function(){return e._nativeContentSharing.startContentSharing()}))},t.prototype.callStopContentSharing=function(){var e=this;return c.asap((function(){return e._nativeContentSharing.stopContentSharing()}))},t.prototype.callUpdateContentSharingSessionState=function(e,t){var n=this;return c.asap((function(){return n._nativeContentSharing.updateContentSharingSessionState(e,t)}))},t.prototype.callTakeContentSharingControl=function(){var e=this;return c.asap((function(){return e._nativeContentSharing.takeContentSharingControl()}))},t.prototype.callUpdateContentSharingParticipantState=function(){var e=this;return c.asap((function(){return e._nativeContentSharing.updateContentSharingParticipantState()}))},t.prototype.convertFailureReason=function(e){switch(e){case h.ContentSharingFailureReason.NoFailure:return 1;case h.ContentSharingFailureReason.SessionNotFound:return 34;case h.ContentSharingFailureReason.SessionTimedOut:return 35;case h.ContentSharingFailureReason.NetworkError:return 3;case h.ContentSharingFailureReason.NetworkCannotConnectError:return 52;case h.ContentSharingFailureReason.ServiceFailure:return 48;case h.ContentSharingFailureReason.RequestTimedOut:return 45;case h.ContentSharingFailureReason.AuthFailure:return 29;case h.ContentSharingFailureReason.ActionNotAllowed:return 60;case h.ContentSharingFailureReason.Forbidden:return 8;case h.ContentSharingFailureReason.Failure:default:return 32}},t.prototype.dispose=function(t){var n=this;void 0===t&&(t=p.generateCauseId());var r=this.contentSharingTerminationReason?this.contentSharingTerminationReason:{terminatedReason:12,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:"Call ended"};this.slimCoreContentSharingObjectId=0,this._getCallEndOperation().then((function(){n._callOperationHandler.rejectPendingOperations(r,t),e.prototype.dispose.call(n,t)}))},o([f.callOperation(l.CONTENT_SHARING_OPERATIONS.START_CONTENT_SHARING),s(0,f.causeId),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],t.prototype,"startContentSharing",null),o([f.callOperation(l.CONTENT_SHARING_OPERATIONS.JOIN_CONTENT_SHARING),s(0,f.causeId),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],t.prototype,"joinContentSharing",null),o([f.callOperation(l.CONTENT_SHARING_OPERATIONS.UPDATE_PARTICIPANT_STATE),s(0,f.causeId),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],t.prototype,"updateContentSharingParticipantStateToViewer",null),o([f.callOperation(l.CONTENT_SHARING_OPERATIONS.UPDATE_CONTENT_SHARING_SESSION_STATE,{type:f.OPERATION_TYPE.CHAINED}),s(2,f.causeId),a("design:type",Function),a("design:paramtypes",[String,String,Object]),a("design:returntype",Promise)],t.prototype,"updateContentSharingSessionState",null),o([f.callOperation(l.CONTENT_SHARING_OPERATIONS.TAKE_CONTENT_SHARING_CONTROL),s(0,f.causeId),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],t.prototype,"takeContentSharingControl",null),o([f.callOperation(l.CONTENT_SHARING_OPERATIONS.STOP_CONTENT_SHARING,{waitFor:l.CONTENT_SHARING_OPERATIONS.START_CONTENT_SHARING}),s(0,f.causeId),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],t.prototype,"stopContentSharing",null),t}(d.default);t.default=_},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),i=n(4),o=n(20),a={CANCELED_TERMINATION_REASON:{terminatedReason:12,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:"Content sharing is disconnected"},ACTION_NOT_ALLOWED:function(e){return{terminatedReason:60,terminatedReasonCode:0,terminatedReasonSubCode:0,errorMessage:e}}},s=function(){function e(e,t){var n=this;this._platformImpl=e,this._pendingDeferreds=[],this._updateContentSharingSessionStateDeferredPromises={},this.onJoinResultEvent=function(e){if(n._joinContenSharingDeferredPromise)if(n._logger.info("JoinContentSharing completed for: "+n._platformImpl.contentSharingGuid+", status: "+JSON.stringify(e)),e.failureReason===n._platformImpl.noFailureReason)n._invokeDeferred(n._joinContenSharingDeferredPromise);else{var t=e.code,r=e.subCode,i=n._platformImpl.convertFailureReason(e.failureReason),o="Join failed with reason "+i;n._logger.error(o),n._rejectDeferred(n._joinContenSharingDeferredPromise,{terminatedReason:i,terminatedReasonCode:t,terminatedReasonSubCode:r,errorMessage:o})}else n._logger.warn("No pending promise for join. Event data: "+e)},this.onUpdateParticipantStateResultEvent=function(e){if(n._updateParticipantStateDeferredPromise)if(n._logger.info("UpdateContentSharingParticipantStateToViewer completed for: "+n._platformImpl.contentSharingGuid+", status: "+JSON.stringify(e)),e.failureReason===n._platformImpl.noFailureReason)n._invokeDeferred(n._updateParticipantStateDeferredPromise);else{var t=e.code,r=e.subCode,i=n._platformImpl.convertFailureReason(e.failureReason),o="Update participant state failed with reason "+i;n._logger.error(o),n._rejectDeferred(n._updateParticipantStateDeferredPromise,{terminatedReason:i,terminatedReasonCode:t,terminatedReasonSubCode:r,errorMessage:o})}else n._logger.warn("No pending promise for update participant state. Event data: "+e)},this.onSessionStateResultEvent=function(e){if(n._logger.info("UpdateContentSharingSessionState completed for: "+n._platformImpl.contentSharingGuid+", status: "+JSON.stringify(e)),n._updateContentSharingSessionStateDeferredPromises.hasOwnProperty(e.id))if(e.failureReason===n._platformImpl.noFailureReason)n._updateContentSharingSessionStateDeferredPromises[e.id].resolve();else{var t=e.code,r=e.subCode,i=n._platformImpl.convertFailureReason(e.failureReason),o="Update SessionState failed with reason "+i;n._logger.error(o),n._updateContentSharingSessionStateDeferredPromises[e.id].reject({terminatedReason:i,terminatedReasonCode:t,terminatedReasonSubCode:r,errorMessage:o})}},this.onTakeControlResultEvent=function(e){if(n._takeControlDeferredPromise)if(n._logger.info("TakeContentSharingControl completed for: "+n._platformImpl.contentSharingGuid+", "+JSON.stringify(e)),e.failureReason===n._platformImpl.noFailureReason)n._invokeDeferred(n._takeControlDeferredPromise);else{var t=e.code,r=e.subCode,i=n._platformImpl.convertFailureReason(e.failureReason),o="Take content sharing control failed with reason "+i;n._logger.error(o),n._rejectDeferred(n._takeControlDeferredPromise,{terminatedReason:i,terminatedReasonCode:t,terminatedReasonSubCode:r,errorMessage:o})}else n._logger.warn("No pending promise for take control. Event data: "+e)},this._logger=new o.default(t)}return e.prototype.statusChanged=function(e){if(7===e||8===e){if(this._stopContentSharingDeferredPromise&&this._invokeDeferred(this._stopContentSharingDeferredPromise),this._startContentSharingDeferredPromise){var t=this._platformImpl.contentSharingTerminationReason&&0!==this._platformImpl.contentSharingTerminationReason.terminatedReason?this._platformImpl.contentSharingTerminationReason:a.CANCELED_TERMINATION_REASON;this._rejectDeferred(this._startContentSharingDeferredPromise,t)}this._logger.info("Content sharing is disconnected"),this._rejectPendingPromises(a.CANCELED_TERMINATION_REASON)}else if(2===e||5===e||4===e){if(this._stopContentSharingDeferredPromise){var n="Content sharing cannot be ended when not presenting";t=a.ACTION_NOT_ALLOWED(n),this._logger.error(n),this._rejectDeferred(this._stopContentSharingDeferredPromise,t)}}else 3===e&&(this._startContentSharingDeferredPromise&&this._invokeDeferred(this._startContentSharingDeferredPromise),this._takeControlDeferredPromise&&this._invokeDeferred(this._takeControlDeferredPromise))},e.prototype.startContentSharing=function(e){var t=this,n=this._logger.createFnLogger("startContentSharing",e);if(this._startContentSharingDeferredPromise)return this._startContentSharingDeferredPromise.promise;if(0!==this._platformImpl.contentSharingStatus){var r="Content sharing cannot be started as it is not in the initial state",o=a.ACTION_NOT_ALLOWED(r);return n.logFailure(r),Promise.reject(o)}n.info("Start content sharing for : "+this._platformImpl.contentSharingGuid),this._startContentSharingDeferredPromise=i.defer();var s=function(){t._startContentSharingDeferredPromise=null};return this._startContentSharingDeferredPromise.promise.then(s,s),Promise.resolve(void 0).then((function(){return t._platformImpl.callStartContentSharing()})).then((function(){return t._pendingDeferreds.push(t._startContentSharingDeferredPromise)})).then((function(){return t._startContentSharingDeferredPromise.promise})).catch((function(e){t.handleContentSharingOperationError(e,"startContentSharing",n)}))},e.prototype.joinContentSharing=function(e){var t=this,n=this._logger.createFnLogger("joinContentSharing",e);if(this._joinContenSharingDeferredPromise)return this._joinContenSharingDeferredPromise.promise;if(2!==this._platformImpl.contentSharingStatus){var r="Content sharing cannot be joined as it is not in ringing state",o=a.ACTION_NOT_ALLOWED(r);return n.logFailure(r),Promise.reject(o)}n.info("Join content sharing for : "+this._platformImpl.contentSharingGuid),this._joinContenSharingDeferredPromise=i.defer();var s=function(){t._joinContenSharingDeferredPromise=null};return this._joinContenSharingDeferredPromise.promise.then(s,s),Promise.resolve(void 0).then((function(){return t._platformImpl.callStartContentSharing()})).then((function(){return t._pendingDeferreds.push(t._joinContenSharingDeferredPromise)})).then((function(){return t._joinContenSharingDeferredPromise.promise})).catch((function(e){t.handleContentSharingOperationError(e,"joinContentSharing",n)}))},e.prototype.updateContentSharingParticipantStateToViewer=function(e){var t=this,n=this._logger.createFnLogger("updateContentSharingParticipantStateToViewer",e);if(this._updateParticipantStateDeferredPromise)return this._updateParticipantStateDeferredPromise.promise;if(4!==this._platformImpl.contentSharingStatus){var r="Cannot update participant state as content sharing is not in connected state",o=a.ACTION_NOT_ALLOWED(r);return n.logFailure(r),Promise.reject(o)}n.info("Update content sharing participant state for : "+this._platformImpl.contentSharingGuid),this._updateParticipantStateDeferredPromise=i.defer();var s=function(){t._updateParticipantStateDeferredPromise=null};return this._updateParticipantStateDeferredPromise.promise.then(s,s),Promise.resolve(void 0).then((function(){return t._platformImpl.callUpdateContentSharingParticipantState()})).then((function(){return t._pendingDeferreds.push(t._updateParticipantStateDeferredPromise)})).then((function(){return t._updateParticipantStateDeferredPromise.promise})).catch((function(e){t.handleContentSharingOperationError(e,"joinContentSharing",n)}))},e.prototype.updateContentSharingSessionState=function(e,t,n){var r=this,o=this._logger.createFnLogger("updateContentSharingSessionState",n);if(this._updateContentSharingSessionStateDeferredPromises[e])return this._updateContentSharingSessionStateDeferredPromises[e].promise;if(3!==this._platformImpl.contentSharingStatus){var s="Cannot update session state as content sharing is not in presenting state",c=a.ACTION_NOT_ALLOWED(s);return o.logFailure(s),Promise.reject(c)}var l=i.defer();this._updateContentSharingSessionStateDeferredPromises[e]=l;var u=function(){delete r._updateContentSharingSessionStateDeferredPromises[e]};return this._updateContentSharingSessionStateDeferredPromises[e].promise.then(u,u),o.info("Update content sharing session state for : "+this._platformImpl.contentSharingGuid),Promise.resolve(void 0).then((function(){return r._platformImpl.callUpdateContentSharingSessionState(e,t)})).then((function(){return r._updateContentSharingSessionStateDeferredPromises[e].promise})).catch((function(e){r.handleContentSharingOperationError(e,"updateContentSharingSessionState",o)}))},e.prototype.takeContentSharingControl=function(e){var t=this,n=this._logger.createFnLogger("takeContentSharingControl",e);if(this._takeControlDeferredPromise)return this._takeControlDeferredPromise.promise;if(5!==this._platformImpl.contentSharingStatus){var r="Cannot take control of content sharing as it is not in viewing state",o=a.ACTION_NOT_ALLOWED(r);return n.logFailure(r),Promise.reject(o)}n.info("Taking control of content sharing for : "+this._platformImpl.contentSharingGuid),this._takeControlDeferredPromise=i.defer();var s=function(){t._takeControlDeferredPromise=null};return this._takeControlDeferredPromise.promise.then(s,s),Promise.resolve(void 0).then((function(){return t._platformImpl.callTakeContentSharingControl()})).then((function(){return t._pendingDeferreds.push(t._takeControlDeferredPromise)})).then((function(){return t._takeControlDeferredPromise.promise})).catch((function(e){t.handleContentSharingOperationError(e,"takeContentSharingControl",n)}))},e.prototype.stopContentSharing=function(e){var t=this,n=this._logger.createFnLogger("stopContentSharing",e);if(this._stopContentSharingDeferredPromise)return this._stopContentSharingDeferredPromise.promise;if(2===this._platformImpl.contentSharingStatus||4===this._platformImpl.contentSharingStatus||5===this._platformImpl.contentSharingStatus){var r="Incoming content sharing cannot be stopped",o=a.ACTION_NOT_ALLOWED(r);return n.logFailure(r),Promise.reject(o)}this._stopContentSharingDeferredPromise=i.defer();var s=function(){t._stopContentSharingDeferredPromise=null};return this._stopContentSharingDeferredPromise.promise.then(s,s),n.info("Stop content sharing for : "+this._platformImpl.contentSharingGuid),Promise.resolve(void 0).then((function(){return t._platformImpl.callStopContentSharing()})).then((function(){return t._pendingDeferreds.push(t._stopContentSharingDeferredPromise)})).then((function(){return t._stopContentSharingDeferredPromise.promise})).catch((function(e){t.handleContentSharingOperationError(e,"stopContentSharing",n)}))},e.prototype.handleContentSharingOperationError=function(e,t,n){var r=e instanceof Error?e.toString():JSON.stringify(e);throw n.logFailure("Error in "+t+"(), contentSharingGuid = "+this._platformImpl.contentSharingGuid+", error = "+r),e&&e.hasOwnProperty("terminatedReason")?e:a.ACTION_NOT_ALLOWED(r)},e.prototype._rejectPendingPromises=function(e){this._logger.info("rejectPendingPromises"),this._pendingDeferreds.forEach((function(t){t.reject(e)})),this._pendingDeferreds=[],r.forEach(this._updateContentSharingSessionStateDeferredPromises,(function(t){t.reject(e)})),this._updateContentSharingSessionStateDeferredPromises={}},e.prototype._invokeDeferred=function(e){this._logger.info("_invokeDeferred"),e&&(r.pull(this._pendingDeferreds,e),e.resolve())},e.prototype._rejectDeferred=function(e,t){this._logger.info("_rejectDeferred"),e&&(r.pull(this._pendingDeferreds,e),e.reject(t))},e}();t.ContentSharingSession=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=function(e,t,n){this.dataId=e,this.handler=t,this.sourceSinkInternallyCreated=n,this.isAttached=!1},o=function(){function e(e,t){this.logger=e,this._slimcoreInstance=t,this._dataChannel=null,this._dataChannelStatus=SlimCore.Enums.DataChannelStatus.Unknown,this._handlers={},this._availableHandlers=0,this._dataChannelStartCalled=!1,this.setInternalSourceSink=this.setInternalSourceSink.bind(this)}return e.prototype.addHandler=function(e,t,n,r){if(void 0===n&&(n=!1),e<0||e>=64)return Promise.reject(new Error("Data Id "+e+" is outside the valid range of 0-63"));if(this._handlers.hasOwnProperty(e)&&this._handlers[e].handler)return Promise.reject(new Error("Data Id "+e+" is already registered to a non-null handler"));this.logger.info("Adding handler to dataId: "+e+", "+(n?"skipping source sink creation":"making source sink"));var o=null,a=!1;return e in this._handlers?((o=this._handlers[e]).handler=t,a=!0):(o=new i(e,t,n),this._handlers[e]=o,n||(a=!0)),a&&(this._availableHandlers++,this._isDataChannelAvailable&&(this._negotiationTag=r,this.start()),this._isDataChannelActive)?this._attachHandler(o):Promise.resolve()},e.prototype.removeHandler=function(e){var t=this._handlers[e];return t?(this._detachHandler(t),delete this._handlers[e],this._availableHandlers--,Promise.resolve()):Promise.reject(new Error("Handler associated with Data Id "+e+" wasn't attached in the first place"))},e.prototype.updateNegotiationTag=function(e){return this._negotiationTag=e,Promise.resolve()},e.prototype.dispose=function(){this._detachAllHandlers(),this._dataChannel&&(this._dataChannel=null)},e.prototype.setDataChannel=function(e){if(this._dataChannel)throw new Error("Unexpected setting of data channel when we already have one");return this._dataChannel=e,Promise.resolve()},e.prototype.onDataChannelStatusChanged=function(e){var t=this;return e!==SlimCore.Enums.DataChannelStatus.Active||this._isDataChannelActive?e===SlimCore.Enums.DataChannelStatus.Available&&(this._isDataChannelActive||this._isDataChannelStopping?(this._dataChannelStartCalled=!1,this._detachAllHandlers()):this._availableHandlers>0&&this.start()):this._attachAllHandlers().catch((function(e){t.logger.error("Failed to attach all handlers error: "+e)})),this._dataChannelStatus=e,Promise.resolve()},e.prototype.setProtocolDataSource=function(e){return Promise.resolve()},e.prototype.processProtocolMessage=function(e,t,n,r){return Promise.resolve()},Object.defineProperty(e.prototype,"_isDataChannelAvailable",{get:function(){return!!this._dataChannel&&this._dataChannelStatus===SlimCore.Enums.DataChannelStatus.Available},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_isDataChannelActive",{get:function(){return!!this._dataChannel&&this._dataChannelStatus===SlimCore.Enums.DataChannelStatus.Active},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_isDataChannelStopping",{get:function(){return!!this._dataChannel&&this._dataChannelStatus===SlimCore.Enums.DataChannelStatus.Stopping},enumerable:!0,configurable:!0}),e.prototype._attachAllHandlers=function(){var e=this;return Promise.all(Object.keys(this._handlers).map((function(t){var n=e._handlers[t];return n&&(n.handler&&n.dataSource&&n.dataSink||!n.sourceSinkInternallyCreated)?e._attachHandler(n):Promise.resolve(null)})))},e.prototype.setInternalSourceSink=function(e,t,n){if(e<0||e>=64)throw new Error("Data Id "+e+" is outside the valid range of 0-63");if(this._handlers.hasOwnProperty(e)&&(this._handlers[e].dataSource||this._handlers[e].dataSink))this.logger.info("Data Id "+e+" for internal source sink is already registered");else if(this.logger.info("Setting internal source sink for dataId: "+e),e in this._handlers)this._handlers[e].dataSource=t,this._handlers[e].dataSink=n,this.logger.info("Completed adapter details for dataId: "+e),this._availableHandlers++;else{var r=new i(e,null,!0);r.dataSource=t,r.dataSink=n,this._handlers[e]=r}},e.prototype._attachHandler=function(e){var t=this;if(e.isAttached)return Promise.resolve();try{if(this.logger.info("Attaching handler for dataId: "+e.dataId+", "+(e.sourceSinkInternallyCreated?"skipping source sink creation":"making source sink")),e.sourceSinkInternallyCreated){if(!e.dataSource||!e.dataSink)return this.logger.error("Attaching handler with null datasource or datasink"),Promise.reject(new Error("Attaching handler with null datasource or datasink"))}else e.dataSource=r.createDataSource(this._slimcoreInstance,e.dataId),this._dataChannel.registerDataSource(e.dataSource),e.dataSink=r.createDataSink(this._slimcoreInstance,e.dataId),this._dataChannel.registerDataSink(e.dataSink);return e.listener=function(n){try{e.handler.onDataReceived(e.dataId,n.data,n.sourceID)}catch(n){t.logger.error("Exception thrown from onDataReceived for data id "+e.dataId+", error: "+n)}},e.dataSink.on("data",e.listener),e.isAttached=!0,e.handler.onStarted(e.dataId,(function(t,n){try{return e.dataSource.sendData(t,n),Promise.resolve()}catch(e){return Promise.reject(e)}})),Promise.resolve()}catch(t){return this.logger.error("Attaching handler for data id "+e.dataId+" threw exception: "+t),Promise.reject(t)}},e.prototype._detachAllHandlers=function(){var e=this;Object.keys(this._handlers).forEach((function(t){e._detachHandler(e._handlers[t])}))},e.prototype._detachHandler=function(e){var t=this;if(e.isAttached)try{if(this.logger.info("Detaching data handler dataid: "+e.dataId),e.handler&&e.handler.onStopped(e.dataId).catch((function(e){t.logger.warn("Error in handler onStopped :"+e)})),e.sourceSinkInternallyCreated){if(e.dataSink)try{e.dataSink.removeListener("data",e.listener)}catch(e){this.logger.warn("Error removing internal listener, call probably ended: "+e)}}else e.dataSource&&this._dataChannel.unregisterDataSource(e.dataSource).catch((function(e){t.logger.warn("Failed to unregister data source, call probably ended: "+e)})).then((function(){e.dataSource.dispose(),e.dataSource=null})),e.dataSink&&(e.dataSink.removeAllListeners("data"),this._dataChannel.unregisterDataSink(e.dataSink).catch((function(e){t.logger.warn("Failed to unregister data sink, call probably ended: "+e)})).then((function(){e.dataSink.dispose(),e.dataSink=null})));e.isAttached=!1}catch(t){this.logger.error("Exception thrown while detaching handler for data id "+e.dataId+", error: "+t)}},e.prototype.start=function(){return this.logger.info("Data channel start called from adapter"),this._dataChannel?this._dataChannelStartCalled?(this.logger.warn("Data channel start called more than once"),Promise.resolve()):(this._dataChannelStartCalled=!0,this._dataChannel.start(this._negotiationTag)):Promise.reject(new Error("Attempted to call start without a data channel"))},e}();t.default=o},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}c((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var s,c,l=n(49),u=n(12),d=n(1),h=n(4),p=n(13),f=n(32),g=n(5),_=n(10),m=n(7),v=n(0),y=n(3);!function(e){e.INITIATED="Initiated",e.CALL_STATE="CallState",e.SHARING_STARTED="SharingStarted",e.DATA_CHANNEL_AVAILABLE="DataChannelAvailable",e.DATA_CHANNEL_UNAVAILABLE="DataChannelUnavailable",e.AVAILABLE_HANDSHAKE="AvailableHandshake",e.SESSION_SHUTDOWN="Shutdown",e.SESSION_SHUTDOWN_BY_ANOTHER_SESSION="ShutdownByOtherSession"}(s||(s={})),function(e){e.INITIATED="Initiated",e.CALL_STATE="CallState",e.DATA_CHANNEL_AVAILABLE="DataChannelAvailable",e.DATA_CHANNEL_UNAVAILABLE="DataChannelUnavailable",e.CONTROL_REQUEST="ControlRequest",e.SESSION_SHUTDOWN="Shutdown",e.SESSION_SHUTDOWN_BY_ANOTHER_SESSION="ShutdownByOtherSession"}(c||(c={}));var C=function(e){function t(t,n,r,i,o,a){var s=e.call(this,t,n,(function(){return s.recordedEvents.length>100}))||this;return s.negotiationTag=r,s.callId=i,s.participantId=o,s.endpointId=a,s.messagesFromUnknownSender={},s.tsCallingVersion=_.getTsCallingVersion(),s}return i(t,e),t.prototype.recordProtocolMessage=function(e,t){e||(t in this.messagesFromUnknownSender||(this.messagesFromUnknownSender[t]=0),this.messagesFromUnknownSender[t]++)},t.prototype.setCallId=function(e){this.callId=e},t.prototype.setEndpointId=function(e){this.endpointId=e},t.prototype.setParticipantId=function(e){this.participantId=e},t.prototype.setTenantId=function(e){this.tenantId=e},t}(p.TelemetryUtilities),S=function(e){function t(t,n,r,i,o,a,s){var c=e.call(this,t,n,r,i,o,a)||this,l=s.getSharingParticipantLeg();if(l){c.sharerParticipantId=l;var u=d.find(s.endpoints.endpointDetails,(function(e){return e.participantId===l}));u&&(c.sharerClientVersion=u.clientVersion)}return c}return i(t,e),t.prototype.getEvent=function(){var t=function(e){return void 0===e?"":e};return{CorrelationId:t(this.callId),ParticipantId:t(this.participantId),EndpointId:t(this.endpointId),NegotiationTag:t(this.negotiationTag),TsCallingVersion:t(this.tsCallingVersion),TenantId:t(this.tenantId),SharerParticipantId:t(this.sharerParticipantId),SharerClientVersion:t(this.sharerClientVersion),EventTimestampBag:e.prototype.getEventTimestampBag.call(this),ProtocolMessages:JSON.stringify({UnknownSender:this.messagesFromUnknownSender})}},t}(C),I=function(e){function t(t,n,r,i,o,a){return e.call(this,t,n,r,i,o,a)||this}return i(t,e),t.prototype.getEvent=function(){var t=function(e){return void 0===e?"":e};return{CorrelationId:t(this.callId),ParticipantId:t(this.participantId),EndpointId:t(this.endpointId),NegotiationTag:t(this.negotiationTag),TsCallingVersion:t(this.tsCallingVersion),TenantId:t(this.tenantId),EventTimestampBag:e.prototype.getEventTimestampBag.call(this),ProtocolMessages:JSON.stringify({UnknownSender:this.messagesFromUnknownSender})}},t}(C),T=function(e){function t(t,n,r,i,o,a){var s=e.call(this,t.createChild((function(){return"SlimCoreElectronScreenSharingControl"})),n,r)||this;return s._controlInjector=o,s._telemetryService=a,s.controlState=0,s.role=0,s.controlDataChannelStatus={id:null,readyForControl:!1,state:0},s._enabled=!1,s._availableAckEnabled=!0,s._dataChannelActive=!1,s._dataChannelAvailableSent=!1,s._protocolDataSource=null,s._controlDataSource=null,s._controlDataSink=null,s._controlRequest=null,s._controlRequestSubscription=null,s._controllerParticipant=null,s._controllerParticipantSubscription=null,s._screenSharingVideoRenderer=null,s._screenSharingVideoRendererSubscriptions=[],s._sharerParticipant=null,s._controlCapturer=null,s._captureEventSubscription=null,s._mouseControlEventSubscription=null,s._keyboardControlEventSubscription=null,s._requestControlTimer=null,s._grantControlTimer=null,s._acceptControlTimer=null,s._terminateControlTimer=null,s._availableAckTimer=null,s._retryAttempt=0,s._injectRawInputErrorTimer=null,s._lastInjectRawInputErrorCount=0,s._raiseRenderedAtViewer=null,s._participantSubscriptions={},s._completedViewerSessions=[],s._logger.info("constructor"),s._callId=i.callId,i.on("callIdChanged",(function(e){s._callId=e,s._currentViewerSessionTelemetry&&s._currentViewerSessionTelemetry.setCallId(e),s._currentSharerSessionTelemetry&&s._currentSharerSessionTelemetry.setCallId(e)})),s._participantId=i.participantId,i.on("callLegIdChanged",(function(e){s._participantId=e,s._currentViewerSessionTelemetry&&s._currentViewerSessionTelemetry.setParticipantId(e),s._currentSharerSessionTelemetry&&s._currentSharerSessionTelemetry.setParticipantId(e)})),s._endpointId=i.endpointId,s._slimcoreInstance.ecsGetSettingAsBool?s._enableControlSessionTelemetry=s._slimcoreInstance.ecsGetSettingAsBool("MediaAgent","EnableGtcTelemetry",!1):s._enableControlSessionTelemetry=!1,s}return i(t,e),t.prototype.enableScreenSharingControl=function(e,t,n,r){if(this._availableAckEnabled!==e||this._allowControlForUser!==r){if(this._allowControlForUser=r,e)this._raiseScreenSharingControlCapableEvent(!0,"");else{if(0===t){var i={reason:2,detail:n};this.event("sharingControlError").raise(i)}this._raiseScreenSharingControlCapableEvent(!1,"")}this._availableAckEnabled=e}},t.prototype.setRaiseRenderedAtViewer=function(e){this._raiseRenderedAtViewer=e},t.prototype.setScreenSharingControlFeatureFlag=function(e){this._enabled=e,this._availableAckEnabled=e},t.prototype.isScreenSharingControlEnabled=function(){return this._enabled},t.prototype._disposeRenderer=function(){this._disposeControlCapturer();for(var e=0,t=this._screenSharingVideoRendererSubscriptions;e<t.length;e++)t[e].dispose();this._screenSharingVideoRendererSubscriptions=[],this._screenSharingVideoRenderer=null},t.prototype.setRenderer=function(e,t){var n=this;if(this._disposeRenderer(),!e)return Promise.resolve();var r=e,i=t||r.renderTarget;return h.asap((function(){return n._setViewingRenderer(r,i)}))},t.prototype.setDataChannel=function(e){var t=this;return h.asap((function(){return t._setDataChannel(e)}))},t.prototype._setDataChannel=function(e){this._logger.info("Setting DataChannel "+(e&&e.id)),this._dataChannel&&!e&&this._detachAndDeleteControlDevices(),this._dataChannel=e,e&&(this.controlDataChannelStatus={id:e.id,readyForControl:!1,state:u.default._mapDataChannelStatus(e._lastDataChannelState)},this.event("controlDataChannelStateChanged").raise(this.controlDataChannelStatus))},t.prototype.setProtocolDataSource=function(e){var t=this;return h.asap((function(){return t._setProtocolDataSource(e)}))},t.prototype._setProtocolDataSource=function(e){this._protocolDataSource=e},t.prototype._raiseScreenSharingControlCapableEvent=function(e,t,n){if(this._enabled){this._logger.info("_raiseScreenSharingControlCapableEvent() enabled is true, raising control capability, capable="+e);var r={capable:e,id:t,disabledBySharer:n};this.event("sharingControlCapable").raise(r)}else this._logger.info("_raiseScreenSharingControlCapableEvent() enabled is false, disabling control capability"),r={capable:!1,id:t},this.event("sharingControlCapable").raise(r)},t.prototype.initControlForSharer=function(e){this._logger.info("initControlForSharer()"),this._resetControlState(),this._screenSharingVideoRenderer=null,this._disposeControlCapturer(),this.role=1,this._dataChannelAvailableSent=!1,this._setInjectorMode(0),this._raiseScreenSharingControlCapableEvent(!0,""),this._initiateSharerSessionTelemetry(e)},t.prototype.shutdownControlForSharer=function(){if(this._logger.info("shutdownControlForSharer()"),this._controlRequest){this._logger.warn("Rejecting pending control requests");var e=this._getDataSourceIdForParticipantLeg(this._controlRequest),t=this._controlRequest;this._clearControlRequest(),this._raiseControlRequestCanceled(t),this._sendRequest({action:4,terminatedReason:5},e)}if(this.role=0,this._controllerParticipant){var n={inControl:!1,id:this._controllerParticipant.participant.id,terminatedReason:5};this.event("sharingControlChanged").raise(n)}this._finalizeSharerSessionTelemetry(c.SESSION_SHUTDOWN),this._teardownSharerRemoteControl(),this._resetControlState(),this._resetParticipantSubscriptions(),this._availableAckEnabled=this._enabled},t.prototype._resetParticipantSubscriptions=function(){this._logger.info("resetParticipantSubscriptions(): Stopping tracking all participant state changes"),d.each(this._participantSubscriptions,(function(e){e.dispose()})),this._participantSubscriptions={}},t.prototype._initiateViewerSessionTelemetry=function(e,t,n){if(!n&&!t)return null;if(!n&&d.find(this._completedViewerSessions,(function(e){return t===e})))return null;if(this._currentViewerSessionTelemetry){if(this._currentViewerSessionTelemetry.negotiationTag===t)return null;this._finalizeViewerSessionTelemetry(s.SESSION_SHUTDOWN_BY_ANOTHER_SESSION)}return this._logger.info("initiating new viewer session telemetry for "+t),this._currentViewerSessionTelemetry=new S(this._logger,(new Date).getTime(),t,this._callId,this._participantId,this._endpointId,e),this._currentViewerSessionTelemetry.recordEvent(s.CALL_STATE,{state:this._callState}),this._dataChannel&&this._dataChannelActive&&this._currentViewerSessionTelemetry.recordEvent(s.DATA_CHANNEL_AVAILABLE),this._currentViewerSessionTelemetry},t.prototype._recordViewerSessionTelemetry=function(e,t){void 0===t&&(t=!0),this._currentViewerSessionTelemetry?e&&e(this._currentViewerSessionTelemetry):t&&this._logger.error("Cannot record telemetry without current session")},t.prototype._finalizeViewerSessionTelemetry=function(e){if(this._currentViewerSessionTelemetry){this._currentViewerSessionTelemetry.recordEvent(e);var t=this._currentViewerSessionTelemetry.getEvent();this._sendTelemetryEvent("mdsc_gtc_viewer_session",t),this._currentViewerSessionTelemetry.negotiationTag&&this._completedViewerSessions.push(this._currentViewerSessionTelemetry.negotiationTag),this._currentViewerSessionTelemetry.messagesFromUnknownSender&&Object.keys(this._currentViewerSessionTelemetry.messagesFromUnknownSender).length&&m.RootToolsManager.logExternalForDDL("ScreenSharingControl: messages received from unkonwn sender => "+t.ProtocolMessages),this._currentViewerSessionTelemetry=null}},t.prototype._initiateSharerSessionTelemetry=function(e){if(this._currentSharerSessionTelemetry){if(this._currentSharerSessionTelemetry.negotiationTag===e)return null;this._finalizeSharerSessionTelemetry(c.SESSION_SHUTDOWN_BY_ANOTHER_SESSION)}this._logger.info("initiating new sharer session telemetry for "+e),this._currentSharerSessionTelemetry=new I(this._logger,(new Date).getTime(),e,this._callId,this._participantId,this._endpointId),this._dataChannel&&this._dataChannelActive&&this._currentSharerSessionTelemetry.recordEvent(c.DATA_CHANNEL_AVAILABLE)},t.prototype._recordSharerSessionTelemetry=function(e,t){void 0===t&&(t=!0),this._currentSharerSessionTelemetry?e&&e(this._currentSharerSessionTelemetry):t&&this._logger.error("Cannot record telemetry without current session")},t.prototype._finalizeSharerSessionTelemetry=function(e){if(this._currentSharerSessionTelemetry){this._currentSharerSessionTelemetry.recordEvent(e);var t=this._currentSharerSessionTelemetry.getEvent();this._sendTelemetryEvent("mdsc_gtc_sharer_session",t),this._currentSharerSessionTelemetry.messagesFromUnknownSender&&Object.keys(this._currentSharerSessionTelemetry.messagesFromUnknownSender).length&&m.RootToolsManager.logExternalForDDL("ScreenSharingControl: messages received from unkonwn sender => "+t.ProtocolMessages),this._currentSharerSessionTelemetry=null}},t.prototype._sendTelemetryEvent=function(e,t){var n=this;this._enableControlSessionTelemetry?this._logger.info("sending event "+e+": "):this._logger.info(e+": "),Object.keys(t).forEach((function(e){n._logger.info("     "+e+" => "+t[e])})),this._enableControlSessionTelemetry&&this._telemetryService&&this._telemetryService.sendEvent(e,t)},t.prototype._recordProtocolMessage=function(e,t){this._currentViewerSessionTelemetry&&this._currentViewerSessionTelemetry.recordProtocolMessage(e,t),this._currentSharerSessionTelemetry&&this._currentSharerSessionTelemetry.recordProtocolMessage(e,t)},t.prototype.reportSharingSessionChangeForViewer=function(e,t){t&&this._initiateViewerSessionTelemetry(e,t,!1)},t.prototype.initControlForViewer=function(e,t){this._logger.info("initControlForViewer("+t+")");var n=!this._sharerParticipant||this._sharerParticipant&&this._sharerParticipant.id!==e.id||t!==this._currentNegotiationTag;this._currentNegotiationTag=t,this.role=2,this._sharerParticipant?this._sharerParticipant.id!==e.id&&(this._recordViewerSessionTelemetry((function(e){return e.recordEvent(s.SESSION_SHUTDOWN_BY_ANOTHER_SESSION,null,t)})),this._logger.info("initControlForViewer() sharer switched, new sharer id="+g.scrubMriOrOmit(e.id)),this._dataChannelAvailableSent=!1,4===this.controlState&&this._terminateControl(!1)):(this._logger.info("initControlForViewer() setting sharer to id="+g.scrubMriOrOmit(e.id)),this._sharerParticipant=e,this._dataChannelAvailableSent=!1),this._initiateViewerSessionTelemetry(e,t,!0),n&&this._recordViewerSessionTelemetry((function(e){return e.recordEvent(s.SHARING_STARTED)})),this._dataChannel&&this._dataChannelActive&&!this._dataChannelAvailableSent&&(this._resetControlState(),this.role=2,this._sharerParticipant=e,this._logger.info("initControlForViewer() sending Available message to sharer"),this._startAvailableHandshake())},t.prototype.shutdownControlForViewer=function(e){this._logger.info("shutdownControlForViewer()");var t=!1;if((!e||this._sharerParticipant&&e.id===this._sharerParticipant.id)&&(this._logger.info("shutdownControlForViewer: setting shouldShutdownControlForViewer to true"),t=!0),t&&this._isViewing()){if(1===this.controlState){if(this._sharerParticipant){var n=this._getSharerDataSourceId();this._sendRequest({action:2,terminatedReason:6},n)}else this._logger.warn("shutdownControlForViewer: sharer participant is null");var r={inControl:!1,id:"",terminatedReason:6};this._requestControlPromise?this._requestControlPromise.reject(new Error(JSON.stringify({controlInfo:r,details:""}))):this._logger.error("Unexpected, no promise could be resolved - state =ControlState.RequestSent action =shutdownControlForViewer")}else 4===this.controlState&&(r={inControl:!1,id:"",terminatedReason:6},this.event("sharingControlChanged").raise(r));this._teardownViewerRemoteControl(),this._resetControlState(),this._screenSharingVideoRenderer=null,this._disposeControlCapturer(),this._terminateAvailableHandshake&&this._terminateAvailableHandshake(2),this._dataChannelAvailableSent=!1,this._finalizeViewerSessionTelemetry(s.SESSION_SHUTDOWN),this._raiseScreenSharingControlCapableEvent(!1,"")}},t.prototype._resetControlRequest=function(e){this._clearControlRequest(),this._controlRequest=e,this._registerParticipantListener(e),3===e.participantState&&this.event("sharingIncomingControlRequest").raise(e.participant.id)},t.prototype._clearControlRequest=function(){this._stopListeningToParticipantChanges(this._controlRequest),this._controlRequest=null},t.prototype._stopListeningToParticipantChanges=function(e){this._controlRequestSubscription&&(this._logger.info("_stopListeningToParticipantChanges: stopping tracking changes for "+e.participant.id),this._controlRequestSubscription.dispose(),this._controlRequestSubscription=null)},t.prototype._registerParticipantListener=function(e){var t=this;this._logger.info("_registerParticipantListener: tracking changes for "+e.participant.id),this._controlRequestSubscription=e.participant.changed((function(){if(e.participant.state!==e.participantState)switch(e.participantState=e.participant.state,e.participantState){case 3:t.event("sharingIncomingControlRequest").raise(e.participant.id);break;case 0:case 5:case 4:t.denyControlRequest().catch((function(e){t._logger.info("it is ok if denyControlRequest rejects here as screensharing may have just been stopped. Err is "+e)})),t._logger.info("_registerParticipantListener: participant "+e.participant.id+" is no longer connected. resetting"),t._clearControlRequest(),t._raiseControlRequestCanceled(e);break;case 1:case 2:case 6:case 7:break;default:t._logger.error("unexpected participantState {request.participantState} unhandled")}}))},t.prototype._resetControllerParticipant=function(e){var t=this;this._controllerParticipantSubscription&&(this._logger.info("_resetControllerParticipant: stopping tracking changes for "+this._controllerParticipant.participant.id),this._controllerParticipantSubscription.dispose(),this._controllerParticipantSubscription=null),e&&(this._logger.info("_resetControllerParticipant: tracking changes for "+e.participant.id),this._controllerParticipantSubscription=e.participant.changed((function(){3!==e.participant.state&&t.handleParticipantRemoved(e.participant.id)}))),this._controllerParticipant=e},t.prototype.handleParticipantRemoved=function(e){if(this._participantSubscriptions[e]&&(this._logger.info("handleParticipantRemoved(): Stopping tracking state changes for "+e),this._participantSubscriptions[e].dispose(),delete this._participantSubscriptions[e]),this._isSharing()){if(this._controllerParticipant&&this._controllerParticipant.participant.id===e){this._logger.info("handleParticipantRemoved: controller left call, tearing down control session"),this._teardownSharerRemoteControl(),this.controlState=0,this._resetControllerParticipant();var t={inControl:!1,id:e,terminatedReason:5};this.event("sharingControlChanged").raise(t)}this._raiseScreenSharingControlCapableEvent(!1,e)}else this._sharerParticipant&&this._sharerParticipant.id===e&&4===this.controlState&&(this._logger.info("handleParticipantRemoved: sharer left call, tearing down control session"),this._teardownViewerRemoteControl(),this.controlState=0,t={inControl:!1,id:"",terminatedReason:6},this.event("sharingControlChanged").raise(t))},t.prototype.callStateChanged=function(e){this._callState=e,this._recordViewerSessionTelemetry((function(t){return t.recordEvent(s.CALL_STATE,{state:e})}),!1),this._recordSharerSessionTelemetry((function(t){return t.recordEvent(c.CALL_STATE,{state:e})}),!1),7===e&&this._handleCallDisconnected()},t.prototype._handleCallDisconnected=function(){this._logger.info("handleCallDisconnected()"),this._isSharing()?this.shutdownControlForSharer():this.shutdownControlForViewer()},t.prototype._videoSizeChanged=function(e,t){null!=this._controlCapturer&&this._controlCapturer.updateVideoSize(e,t)},t.prototype._onRenderStarted=function(){if(this._sharerParticipant){var e=this._getSharerDataSourceId();this._sendRequest({action:11,terminatedReason:0},e)}else this._logger.error("Attempted to send sharing rendered message to null sharerParticipant")},t.prototype._setViewingRenderer=function(e,t){var n=this;try{this._screenSharingVideoRenderer=e,this._screenSharingVideoRendererSubscriptions.push(this._screenSharingVideoRenderer.on("videoSizeChanged",(function(e,t){return n._videoSizeChanged(e,t)}))),this._screenSharingVideoRendererSubscriptions.push(this._screenSharingVideoRenderer.on("renderStarted",(function(){return n._onRenderStarted()}))),this._controlCapturer=new l.SlimCoreElectronControlCapturer(this._logger,t),4===this.controlState?(this._logger.info("_setViewingRenderer: detected local state is controlling"),this._setupViewerRemoteControl()):this._teardownViewerRemoteControl()}catch(e){this._logger.error("_setViewingRenderer: unable to set _screenSharingVideoRenderer error = "+e)}},t.prototype._isSharing=function(){return 1===this.role},t.prototype._isViewing=function(){return 2===this.role},t.prototype._createAndAttachControlDevices=function(){var e=this;if(this._logger.info("_createAndAttachControlDevices()"),v.hasCreateDataSource(this._slimcoreInstance)&&v.hasCreateDataSink(this._slimcoreInstance))if(this._dataChannel){var t=Promise.resolve(),n=Promise.resolve();this._controlDataSource||(this._controlDataSource=v.createDataSource(this._slimcoreInstance,SlimCore.Enums.DataDeviceId.Control),this._logger.info("created Control DataSource"),t=this._dataChannel.registerDataSource(this._controlDataSource).then((function(){return e._logger.info("registered Control DataSource")})).catch((function(t){return e._logger.error("registerDataSource threw exception: "+t)}))),this._controlDataSink||(this._controlDataSink=v.createDataSink(this._slimcoreInstance,SlimCore.Enums.DataDeviceId.Control),this._logger.info("created Control DataSink"),n=this._dataChannel.registerDataSink(this._controlDataSink).then((function(){return e._logger.info("registered Control DataSink")})).catch((function(t){return e._logger.error("registerDataSink threw exception: "+t)}))),Promise.all([t,n]).then((function(){e.controlDataChannelStatus.readyForControl=!0,e.event("controlDataChannelStateChanged").raise(e.controlDataChannelStatus)})),this._controlDataSink.on("data",(function(t){e._controlInjector.injectRawInput(t.data,t.sourceID).catch((function(n){e._lastInjectRawInputErrorCount++,null===e._injectRawInputErrorTimer&&(e._injectRawInputErrorTimer=setTimeout((function(){var r={reason:1,detail:JSON.stringify({dataChannelId:e._dataChannel.id,sourceId:t&&t.sourceID,count:e._lastInjectRawInputErrorCount,errorMsg:n})};e.event("sharingControlError").raise(r),e._lastInjectRawInputErrorCount=0,e._injectRawInputErrorTimer=null}),1e4))}))}))}else this._logger.warn("_createAndAttachControlDevices() null dataChannel");else this._logger.warn("createDataSource or createDataSink not implemented")},t.prototype._detachAndDeleteControlDevices=function(){var e=this;this._logger.info("_detachAndDeleteControlDevices()"),this._controlDataSink&&this._controlDataSink.removeAllListeners("data"),this._dataChannel?(this._controlDataSource&&(this._dataChannel.unregisterDataSource(this._controlDataSource).then((function(){return e._logger.info("Control DataSource unregistered")})).catch((function(t){return e._logger.warn("unregisterDataSource threw exception: "+t)})),this._controlDataSource=null,this._logger.info("deleted Control data source")),this._controlDataSink&&(this._dataChannel.unregisterDataSink(this._controlDataSink).then((function(){return e._logger.info("Control DataSink unregistered")})).catch((function(t){return e._logger.warn("unregisterDataSink threw exception: "+t)})),this._controlDataSink=null,this._logger.info("deleted Control data sink"))):this._logger.warn("_detachAndDeleteControlDevices() null dataChannel")},t.prototype.onDataChannelStatusChanged=function(e){var t=this;return h.asap((function(){return t._onDataChannelStatusChanged(e)}))},t.prototype._onDataChannelStatusChanged=function(e){this._logger.info("Data channel status = "+e),this.controlDataChannelStatus.readyForControl=this.controlDataChannelStatus.readyForControl&&e===SlimCore.Enums.DataChannelStatus.Active,this.controlDataChannelStatus.state=u.default._mapDataChannelStatus(e),this.event("controlDataChannelStateChanged").raise(this.controlDataChannelStatus),e===SlimCore.Enums.DataChannelStatus.Active?this._enabled&&this._dataChannel&&!this._dataChannelActive&&(this._dataChannelActive=!0,this._recordViewerSessionTelemetry((function(e){return e.recordEvent(s.DATA_CHANNEL_AVAILABLE)}),!1),this._recordSharerSessionTelemetry((function(e){return e.recordEvent(c.DATA_CHANNEL_AVAILABLE)}),!1),this._createAndAttachControlDevices(),this._isViewing()?this._dataChannelAvailableSent||(this._sharerParticipant?(this._logger.info("_onDataChannelStatusChanged() sending Available message to sharer"),this._startAvailableHandshake()):this._logger.error("Unexpected null _sharerParticipant trying to send Available to sharer")):this._isSharing()&&this._raiseScreenSharingControlCapableEvent(!0,"")):this._dataChannel&&this._dataChannelActive&&(this._recordViewerSessionTelemetry((function(e){return e.recordEvent(s.DATA_CHANNEL_UNAVAILABLE)}),!1),this._recordSharerSessionTelemetry((function(e){return e.recordEvent(c.DATA_CHANNEL_UNAVAILABLE)}),!1),this._dataChannelActive=!1,this._dataChannelAvailableSent=!1,this._terminateAvailableHandshake&&this._terminateAvailableHandshake(3),this._detachAndDeleteControlDevices(),this._raiseScreenSharingControlCapableEvent(!1,""))},t.prototype._handleAvailableRequest=function(e,t,n){var r=this,i=!1,o=0;if(!1===this._enabled)this._logger.info("feature flag is off. no need to answer the available ack"),i=!0,o=9;else if(!1===this._availableAckEnabled)this._logger.info("available ack is off. no need to answer the available ack"),i=!0,o=9;else if(t&&t.id){if(this._allowControlForUser&&typeof this._allowControlForUser==typeof Function)return void this._allowControlForUser(t).then((function(a){a||(i=!0,o=1),r._sendResponseToAvailableRequest(e,t,n,i,o)}))}else i=!0,o=10;this._sendResponseToAvailableRequest(e,t,n,i,o)},t.prototype._sendResponseToAvailableRequest=function(e,t,n,r,i){var o=this;r?(this._logger.info("Rejecting Available for handShake:"+n+":"+e.handshakeId),this.event("controlAvailableHandshake").raise(e.handshakeId,n,7,this._getAvailableHandshakeTerminatedFromControlTerminated(i)),this._sendRequest({action:10,terminatedReason:i,handshakeId:e.handshakeId},n)):(this._raiseScreenSharingControlCapableEvent(!0,t.id),this._participantSubscriptions[t.id]||(this._logger.info("Tracking participant status for "+t.id),this._participantSubscriptions[t.id]=t.changed((function(){3!==t.state&&(o._logger.info("Participant "+t.id+" is not connected. removing"),o.handleParticipantRemoved(t.id))}))),this._logger.info("Acking Available for handShake:"+n+":"+e.handshakeId),this.event("controlAvailableHandshake").raise(e.handshakeId,n,3),this._sendRequest({action:9,terminatedReason:0,handshakeId:e.handshakeId},n))},t.prototype.processProtocolMessage=function(e,t,n,r){var i=this;return h.asap((function(){return i._processProtocolMessage(e,t,n,r)}))},t.prototype._raiseControlRequestCanceled=function(e){this.event("sharingIncomingControlRequestCancelled").raise(e.participant.id)},t.prototype._processProtocolMessage=function(e,t,n,r){var i;this._recordProtocolMessage(t,r);try{i=JSON.parse(e)}catch(e){return void this._logger.error("Error parsing controlMessage")}if(this._logger.info("_processProtocolMessage action="+i.action+" sender="+r),t||this._logger.warn("protocol message from unknown sender with sourceId="+r),0===i.action)this._handleAvailableRequest(i,t,r);else if(1===i.action)!1===this._enabled?(this._logger.warn("Sharer control is disabled - rejecting request"),this._sendRequest({action:4,terminatedReason:9},r)):this._controlRequest?(this._logger.warn("Sharer is already processing a control request...rejecting new requests"),this._sendRequest({action:4,terminatedReason:3},r)):this._controllerParticipant&&this._controllerParticipant.participant===t?this._controllerParticipant.participantId&&this._controllerParticipant.participantId!==n?(this._logger.warn("rejecting control request from second endpoint. participantId: "+n),this._sendRequest({action:4,terminatedReason:3},r)):(this._logger.warn("Got control request for someone already in control"),this._sendRequest({action:3,terminatedReason:0},r)):t?this._resetControlRequest({participant:t,participantState:t.state,participantId:n}):this._logger.error("Got ControlRequest message but could not find a sender participant, ignoring");else if(3===i.action)1===this.controlState?(this._sendRequest({action:5,terminatedReason:0},r)?(this._setupViewerRemoteControl(),this.controlState=4,this._requestControlPromise?this._requestControlPromise.resolve():this._logger.error("Unexpected, no promise could be resolved - state =ControlState.RequestSent action ="+i.action)):this._requestControlPromise?this._requestControlPromise.reject(new Error(JSON.stringify({controlInfo:void 0,details:"request control is accepted, but fail to send ack"}))):this._logger.error("Unexpected, no promise could be resolved - state ="+this.controlState+" action ="+i.action),this._cancelRequestControlTimer()):this._logger.warn("AcceptRequest message received in controlState="+this.controlState);else if(4===i.action)if(1===this.controlState){this.controlState=0;var o={inControl:!1,id:"",terminatedReason:i.terminatedReason};this._requestControlPromise?this._requestControlPromise.reject(new Error(JSON.stringify({controlInfo:o,details:""}))):this._logger.error("Unexpected, no promise could be resolved - state =ControlState.RequestSent action ="+i.action),this._cancelRequestControlTimer()}else this._logger.warn("RejectRequest message received in controlState="+this.controlState+" reason="+i.terminatedReason);else if(2===i.action){if(this._controlRequest){var a=this._controlRequest;this._clearControlRequest(),this._raiseControlRequestCanceled(a)}}else if(6===i.action)this._sendRequest({action:5,terminatedReason:0},r)&&(this._setupViewerRemoteControl(),this.controlState=4,o={inControl:!0,id:"",terminatedReason:i.terminatedReason},this.event("sharingControlChanged").raise(o));else if(5===i.action)if(2===this.controlState)if(this._controllerParticipant&&this._controllerParticipant.participant===t){var c=this._getDataSourceIdForParticipantLeg(this._controllerParticipant);r!==c&&this._logger.warn("acknowledging source id: "+r+" does not match requesting source id: "+c),this._logger.info("Setting up remote control for controller source id="+c),this._setupSharerRemoteControl(c),this.controlState=3,o={inControl:!0,id:this._controllerParticipant.participant.id,terminatedReason:i.terminatedReason},this.event("sharingControlChanged").raise(o),this._grantControlPromise?(this._grantControlPromise.resolve(),this._cancelGrantControlTimer()):this._acceptControlPromise?(this._acceptControlPromise.resolve(),this._cancelAcceptControlTimer()):this._logger.error("Unexpected, no promise could be resolved - state =ControlState.WaitingForControlAck action ="+i.action)}else t?this._logger.warn("Ignoring ack from participant that does not match controller id = "+g.scrubMriOrOmit(t.id)):this._logger.warn("Ignoring ack from null participant source id = "+r);else 5===this.controlState?(this.controlState=0,this._resetControllerParticipant(),this._terminateControlPromise?(this._terminateControlPromise.resolve(),this._cancelTerminateControlTimer()):this._logger.error("Unexpected, no promise could be resolved - state =ControlState.WaitingForTerminateAck action ="+i.action)):this._logger.warn("Unexpected ack in control state = "+this.controlState);else if(7===i.action||8===i.action){var l=void 0;this._isViewing()?(this._teardownViewerRemoteControl(),l=""):(this._teardownSharerRemoteControl(),t?l=t.id:this._logger.error("Got terminate message but could not find a sender participant!")),this.controlState=0,this._resetControllerParticipant(),o={inControl:!1,id:l,terminatedReason:i.terminatedReason},this.event("sharingControlChanged").raise(o),8===i.action&&this._sendRequest({action:5,terminatedReason:0},r)}else if(9===i.action)this._terminateAvailableHandshake&&this._terminateAvailableHandshake(1,i.handshakeId),this._raiseScreenSharingControlCapableEvent(!0,"");else if(10===i.action){if(this._recordViewerSessionTelemetry((function(e){return e.updateOperationData(s.AVAILABLE_HANDSHAKE,{nackReason:i.terminatedReason},i.handshakeId)})),10===i.terminatedReason)return;this._terminateAvailableHandshake&&this._terminateAvailableHandshake(this._getAvailableHandshakeTerminatedFromControlTerminated(i.terminatedReason),i.handshakeId),1===i.terminatedReason?this._raiseScreenSharingControlCapableEvent(!0,"",!0):this._raiseScreenSharingControlCapableEvent(!1,"")}else 11===i.action?this._raiseRenderedAtViewer&&(t?this._raiseRenderedAtViewer(t.id):this._logger.error("Got RenderedAtViewer message but could not find a sender participant!")):this._logger.error("Unknown request action received on control protocol data sink, action="+i.action)},t.prototype._getAvailableHandshakeTerminatedFromControlTerminated=function(e){switch(e){case 10:return 6;case 1:return 7;case 9:default:return 0}},t.prototype._sendRequest=function(e,t){var n=!1,r=this._protocolDataSource;if(t<0)return this._logger.error("Unexpected: invalid sourceID="+t),n;if(r){this._logger.info("sending control message action="+e.action+" to sourceID="+t);var i={type:0,message:JSON.stringify(e)};try{var o=[t];r.sendData(v.stringToBuffer(JSON.stringify(i)),o),n=!0}catch(e){this._logger.error("Unexpected: failure in call to sendData. Error="+e);var a={reason:5,detail:JSON.stringify({sourceId:t,errorMsg:e})};this.event("sharingControlError").raise(a)}}else this._logger.error("Unexpected: null dataSource in _sendRequest");return n},t.prototype._resetControlState=function(){this._logger.info("_resetControlState()"),this.controlState=0,this._resetControllerParticipant(),this._sharerParticipant=null,this._clearControlRequest(),this._cancelRequestControlTimer(),this._cancelAcceptControlTimer(),this._cancelGrantControlTimer(),this._cancelTerminateControlTimer()},t.prototype._setupSharerRemoteControl=function(e){var t=this;this._logger.info("_setupSharerRemoteControl() sourceId="+e),this._setInjectorMode(1),this._controlInjector.allowSingleController(e).catch((function(n){var r={reason:3,detail:JSON.stringify({sourceId:e,errorMsg:n})};t.event("sharingControlError").raise(r)}))},t.prototype._teardownSharerRemoteControl=function(){var e=this;this._logger.info("_teardownSharerRemoteControl()"),this._controlInjector.allowSingleController(0).catch((function(t){var n={reason:3,detail:JSON.stringify({sourceId:0,errorMsg:t})};e.event("sharingControlError").raise(n)})),this._setInjectorMode(0)},t.prototype._setupViewerRemoteControl=function(){this._logger.info("_setupViewerRemoteControl()"),this._setCapturerMode(3)},t.prototype._teardownViewerRemoteControl=function(){this._logger.info("_teardownViewerRemoteControl()"),this._setCapturerMode(0)},t.prototype._setInjectorMode=function(e){var t=this;this._logger.info("_setInjectorMode() mode="+e);var n={mode:e,noMotionTimeoutMs:0,noMotionSharerTimeoutMs:0};this._controlInjector.setInjectorConfig(n).catch((function(n){var r={reason:0,detail:JSON.stringify({mode:e,errorMsg:n})};t.event("sharingControlError").raise(r)}))},t.prototype._clearCapturerEventSubscriptions=function(){this._logger.info("_clearCapturerEventSubscriptions()"),this._captureEventSubscription&&(this._captureEventSubscription.dispose(),this._captureEventSubscription=null),this._mouseControlEventSubscription&&(this._mouseControlEventSubscription.dispose(),this._mouseControlEventSubscription=null),this._keyboardControlEventSubscription&&(this._keyboardControlEventSubscription.dispose(),this._keyboardControlEventSubscription=null)},t.prototype.sendRemoteControlEvent=function(e,t){if(t)switch(e){case"mouseControlEvent":this._sendControlEvent(l.SlimCoreElectronControlCapturer.formatMouseEvent(t));break;case"keyboardControlEvent":this._sendControlEvent(l.SlimCoreElectronControlCapturer.formatKeyboardEvent(t));break;default:return void this._logger.error("sendRemoteControlEvent: Invalid type = ",e)}else this._logger.error("sendRemoteControlEvent: Invalid argument.")},t.prototype._sendControlEvent=function(e){if(this._controlDataSource&&this._sharerParticipant&&4===this.controlState){var t=[this._getSharerDataSourceId()];this._controlDataSource.sendData(e,t)}else this._logger.error("_sendControlEvent: Data channel not set up / Not in control")},t.prototype._setCapturerMode=function(e){var t=this;this._logger.info("_setCapturerMode() capturerMode="+e),this._controlCapturer?(this._controlCapturer.setCaptureMode(e),this._clearCapturerEventSubscriptions(),1===e?this._captureEventSubscription=this._controlCapturer.on("ctrlCaptureEvent",(function(e){0===e&&t.event("sharingRendererClicked").raise()})):2===e?this._captureEventSubscription=this._controlCapturer.on("ctrlCaptureEvent",(function(e){1===e?t.event("sharingRendererMouseEntering").raise():2===e&&t.event("sharingRendererMouseLeaving").raise()})):3===e&&(this._mouseControlEventSubscription=this._controlCapturer.on("mouseControlEvent",(function(e){return t._sendControlEvent(l.SlimCoreElectronControlCapturer.formatMouseEvent(e))})),this._keyboardControlEventSubscription=this._controlCapturer.on("keyboardControlEvent",(function(e){return t._sendControlEvent(l.SlimCoreElectronControlCapturer.formatKeyboardEvent(e))})),this._captureEventSubscription=this._controlCapturer.on("ctrlCaptureEvent",(function(e){1===e?t.event("sharingRendererMouseEntering").raise():2===e&&t.event("sharingRendererMouseLeaving").raise()})))):this._logger.warn("_controlCapturer not found when trying to setup viewer capture mode")},t.prototype.setPointerImage=function(e,t){return this._logger.warn("setPointerImage is deprecated. Use setLocalPointerImage or setRemotePointerImage"),e?this.setRemotePointerImage(e,t):this.setLocalPointerImage(t)},t.prototype.setLocalPointerImage=function(e){return 0===e.length?Promise.reject(new Error("setLocalPointerImage invalid image length")):this._setPointerImage(0,e)},t.prototype.setRemotePointerImage=function(e,t){return o(this,void 0,void 0,(function(){var n,r,i,o;return a(this,(function(a){switch(a.label){case 0:if(!e)throw new Error("setRemotePointerImage participant is null");if(0===t.length)throw new Error("setRemotePointerImage invalid image length");if(e.enableParticipantLegToSourceIdMapping)return[3,2];if((o=this._mapParticipantToSourceId(e))<0)throw new Error("setRemotePointerImage unable to map participant to sourceId");return[4,this._setPointerImage(o,t)];case 1:return a.sent(),[2];case 2:if(0===(n=this._getParticipantsDataSourceIds(e)).length)throw new Error("setRemotePointerImage unable to map participant to sourceIds");this._logger.info("set pointer image for "+n.length+" sources"),r=0,i=n,a.label=3;case 3:return r<i.length?(o=i[r],[4,this._setPointerImage(o,t)]):[3,6];case 4:a.sent(),a.label=5;case 5:return r++,[3,3];case 6:return[2]}}))}))},t.prototype._setPointerImage=function(e,t){return this._isSharing()||this._logger.warn("_setPointerImage called when not sharing"),this._controlInjector.setAvatar(v.stringToBuffer(t),e)},t.prototype.startPointerMode=function(){var e=this;return this._dataChannelActive?0!==this.controlState?Promise.reject(new Error("startPointerMode called in bad control state="+this.controlState)):this._isViewing()?h.asap((function(){return e._setCapturerMode(2)})):Promise.reject(new Error("startPointerMode when not viewing")):Promise.reject(new Error("startPointerMode when data channel not active"))},t.prototype.stopPointerMode=function(){var e=this;return 0!==this.controlState?Promise.reject(new Error("stopPointerMode called in bad control state="+this.controlState)):this._isViewing()?h.asap((function(){return e._setCapturerMode(1)})):Promise.reject(new Error("stopPointerMode when not viewing"))},t.prototype._startAvailableHandshake=function(){var e=this,t=this._getSharerDataSourceId();t<0&&this._logger.warn("sharer: "+this._sharerParticipant+" has no data channel");var n=f.default();this._logger.info("_startAvailableHandshake() - handshakeId: "+t+":"+n),this.event("controlAvailableHandshake").raise(n,t,1),this._terminateAvailableHandshake&&(this._logger.warn("Replacing existing availble handshake"),this._terminateAvailableHandshake(4)),this._recordViewerSessionTelemetry((function(e){return e.recordOperation(s.AVAILABLE_HANDSHAKE,n)})),this._sendRequest({action:0,terminatedReason:0,handshakeId:n},t)||this._logger.error("Failed to send Available message to sharer, will retry after backoff"),this._dataChannelAvailableSent=!0,this._waitForAvailableAck(n),this._terminateAvailableHandshake=function(r,i){void 0===r&&(r=0),e._logger.info("_terminateAvailableHandshake() - handshakeId: "+t+":"+n+", status: "+r),e._recordViewerSessionTelemetry((function(t){return t.updateOperationData(s.AVAILABLE_HANDSHAKE,{tries:e._retryAttempt},i)})),1===r?e._recordViewerSessionTelemetry((function(e){return e.recordOperationSuccess(s.AVAILABLE_HANDSHAKE,null,"",i)})):e._recordViewerSessionTelemetry((function(e){return e.recordOperationFailure(s.AVAILABLE_HANDSHAKE,{reason:r},"",i)})),e._terminateAvailableHandshake=null,e.event("controlAvailableHandshake").raise(n,t,1===r?5:6,r),i&&i!==n&&e._logger.warn("AvailableSeries: Got handshake from another series - expected: "+n+", received: "+i),e._availableAckTimer&&(clearTimeout(e._availableAckTimer),e._availableAckTimer=null),e._retryAttempt=0}},t.prototype._waitForAvailableAck=function(e){var t=this;this._logger.info("_waitForAvailableAck()"),this._availableAckTimer=setTimeout((function(){t._logger.warn("No Ack received for Available message from attempt="+t._retryAttempt),t._availableAckTimer=null;var n=t._getSharerDataSourceId();if(t._retryAttempt<=6)t._logger.info("Re-sending Available message handshakeId: "+n+":"+e),t.event("controlAvailableHandshake").raise(e,n,2),t._sendRequest({action:0,terminatedReason:0,handshakeId:e},n),t._waitForAvailableAck(e);else if(t._logger.error("Reached Available retry limit! Control capability will be false"),t._terminateAvailableHandshake)t._terminateAvailableHandshake(5);else{var r={reason:4,detail:JSON.stringify({sourceId:n,errorMsg:"Timed out after "+t._retryAttempt+" tries"})};t.event("sharingControlError").raise(r)}}),2e3*++this._retryAttempt)},t.prototype.requestControl=function(){return this._dataChannelActive?0!==this.controlState?Promise.reject(new Error("requestControl called in bad state="+this.controlState)):this._isViewing()?this._sharerParticipant?this._requestControlPromise?Promise.reject(new Error("request control promise has not been resolved yet while requesting control")):this._terminateControlPromise?Promise.reject(new Error("terminate control promise has not been resolved yet while requesting control")):this._requestControl():Promise.reject(new Error("requestControl unexpected null sharer")):Promise.reject(new Error("requestControl when not viewing")):Promise.reject(new Error("requestControl when data channel not active"))},t.prototype._requestControl=function(){var e=this;this._logger.info("_requestControl()"),this._requestControlPromise=h.defer();var t=function(){e._requestControlPromise=null};this._requestControlPromise.promise.then(t,t);var n=this._getSharerDataSourceId();if(!this._sendRequest({action:1,terminatedReason:0},n)){var r={inControl:!1,id:"",terminatedReason:7};return this._requestControlPromise.reject(new Error),Promise.reject(new Error(JSON.stringify({controlInfo:r,details:""})))}return this.controlState=1,this._requestControlTimer=setTimeout((function(){if(1===e.controlState){e.controlState=0,e._logger.warn("No response to control request - canceling"),e._sendRequest({action:2,terminatedReason:2},n)||e._logger.error("fail to send the cancel control request");var t={inControl:!1,id:"",terminatedReason:2};e._requestControlPromise?e._requestControlPromise.reject(new Error(JSON.stringify({controlInfo:t,details:"we did not get any response to the control - terminating control"}))):e._logger.error("Unexpected, no promise could be resolved - controlState = ControlState.RequestSent")}else e._requestControlPromise?e._requestControlPromise.reject(new Error(JSON.stringify({controlInfo:void 0,details:"request control - times out in bad state - do nothing"}))):e._logger.error("Unexpected, no promise could be resolved - controlState = "+e.controlState);e._requestControlTimer=null}),3e4),this._requestControlPromise.promise},t.prototype._cancelRequestControlTimer=function(){this._requestControlTimer&&(this._requestControlPromise&&this._requestControlPromise.reject(new Error("cancelled by _cancelRequestControlTimer")),clearTimeout(this._requestControlTimer),this._requestControlTimer=null)},t.prototype.cancelControl=function(){return this._dataChannelActive?1!==this.controlState?Promise.reject(new Error("cancelControl called in bad state="+this.controlState)):this._isViewing()?this._sharerParticipant?this._requestControlPromise?this._terminateControlPromise?Promise.reject(new Error("terminate control promise has not been resolved yet while cancelling control")):this._cancelControl():Promise.reject(new Error("request control promise has been resolved while cancelling control")):Promise.reject(new Error("cancelControl unexpected null sharer")):Promise.reject(new Error("cancelControl when not viewing")):Promise.reject(new Error("cancelControl when data channel not active"))},t.prototype._cancelControl=function(){this._logger.info("_cancelControl()");var e=this._getSharerDataSourceId();if(1!==this.controlState)return Promise.reject(new Error("cancel control - in bad state - do nothing"));if(this._cancelRequestControlTimer(),this.controlState=0,this._logger.info("Viewer cancel the control"),!this._sendRequest({action:2,terminatedReason:8},e))return Promise.reject(new Error("fail to send cancel control request"));var t={inControl:!1,id:"",terminatedReason:8};return this._requestControlPromise.reject(new Error(JSON.stringify({controlInfo:t,details:""}))),new Promise((function(e,t){e()}))},t.prototype.acceptControlRequest=function(){return this._dataChannelActive?this._controlRequest?this._isSharing()?this._acceptControlPromise?Promise.reject(new Error("accept control promise has not been resolved yet while accepting control")):this._grantControlPromise?Promise.reject(new Error("grant control promise has not been resolved yet while accepting control")):this._terminateControlPromise?Promise.reject(new Error("terminate control promise has not been resolved yet while accepting control")):this._acceptControlRequest():Promise.reject(new Error("acceptControlRequest when not sharing")):Promise.reject(new Error("acceptControlRequest while no control request pending")):Promise.reject(new Error("acceptControlRequest when data channel not active"))},t.prototype._acceptControlRequest=function(){var e=this;this._logger.info("_acceptControlRequest()"),this._acceptControlPromise=h.defer();var t=function(){e._acceptControlPromise=null};if(this._acceptControlPromise.promise.then(t,t),this._controllerParticipant){this._logger.warn("_acceptControlRequest called while another participant already has control - terminating control"),this._teardownSharerRemoteControl();var n=this._getDataSourceIdForParticipantLeg(this._controllerParticipant);this._sendRequest({action:7,terminatedReason:5},n)||this._logger.error("fail to send the terminateNoAck request"),this._resetControllerParticipant()}var r=this._getDataSourceIdForParticipantLeg(this._controlRequest),i=this._controlRequest.participant.id;return this._sendRequest({action:3,terminatedReason:0},r)?(this._resetControllerParticipant(this._controlRequest),this._clearControlRequest(),this.controlState=2,this._acceptControlTimer=setTimeout((function(){if(2===e.controlState){e.controlState=0,e._resetControllerParticipant(),e._logger.error("No ack received when accepting control request - terminating control"),e._sendRequest({action:7,terminatedReason:4},r)||e._logger.error("fail to send the TerminateNoAck request");var t={inControl:!1,id:i,terminatedReason:4};e.event("sharingControlChanged").raise(t),e._acceptControlPromise?e._acceptControlPromise.reject(new Error("No ack received when accept control - terminating control")):e._logger.error("Unexpected, no promise could be resolved - controlState = ControlState.WaitingForControlAck")}else e._acceptControlPromise?e._acceptControlPromise.reject(new Error("accept control - times out in bad state - do nothing")):e._logger.error("Unexpected, no promise could be resolved - controlState = "+e.controlState);e._acceptControlTimer=null}),1e4),this._acceptControlPromise.promise):(this._logger.error("fail to send the accept control request"),this._acceptControlPromise.reject(new Error),Promise.reject(new Error("fail to send the accept control request!")))},t.prototype._cancelAcceptControlTimer=function(){this._acceptControlTimer&&(this._acceptControlPromise&&this._acceptControlPromise.reject(new Error("cancelled by _cancelAcceptControlTimer")),clearTimeout(this._acceptControlTimer),this._acceptControlTimer=null)},t.prototype.denyControlRequest=function(){return this._dataChannelActive?this._controlRequest?this._isSharing()?this._acceptControlPromise?Promise.reject(new Error("accept control promise has not been resolved yet while denying control")):this._grantControlPromise?Promise.reject(new Error("grant control promise has not been resolved yet while denying control")):this._terminateControlPromise?Promise.reject(new Error("terminate control promise has not been resolved yet while denying control")):this._denyControlRequest():Promise.reject(new Error("denyControlRequest when not sharing")):Promise.reject(new Error("denyControlRequest while no control request pending")):Promise.reject(new Error("denyControlRequest when data channel not active"))},t.prototype._denyControlRequest=function(){this._logger.info("_denyControlRequest()");var e=this._getDataSourceIdForParticipantLeg(this._controlRequest);return this._clearControlRequest(),this._sendRequest({action:4,terminatedReason:1},e)?new Promise((function(e,t){e()})):Promise.reject(new Error("fail to send the deny control requst"))},t.prototype.grantControl=function(e){return this._dataChannelActive?this._controlRequest?Promise.reject(new Error("grantControl called while control request pending")):this._isSharing()?e?this._acceptControlPromise?Promise.reject(new Error("accept control promise has not been resolved yet while granting control")):this._grantControlPromise?Promise.reject(new Error("grant control promise has not been resolved yet while granting control")):this._terminateControlPromise?Promise.reject(new Error("terminate control promise has not been resolved yet while granting control")):this._grantControl(e):Promise.reject(new Error("grantControl null participant")):Promise.reject(new Error("grantControl when not sharing")):Promise.reject(new Error("grantControl when data channel not active"))},t.prototype._grantControl=function(e){var t=this;this._logger.info("_grantControl()"),this._grantControlPromise=h.defer();var n=function(){t._grantControlPromise=null};if(this._grantControlPromise.promise.then(n,n),3===this.controlState){if(this._controllerParticipant.participant===e)return this._logger.warn("grantControl called for participant who already has control"),this._grantControlPromise.resolve(),new Promise((function(e,t){e()}));this._logger.warn("_grantControl called while another participant already has control - terminating control"),this._teardownSharerRemoteControl();var r=this._getDataSourceIdForParticipantLeg(this._controllerParticipant);this._sendRequest({action:7,terminatedReason:5},r)||this._logger.error("fail to send the terminateNoAck request")}var i=this._mapParticipantToSourceId(e);if(!this._sendRequest({action:6,terminatedReason:0},i))return this._logger.error("fail to send the grant control request"),this._grantControlPromise.reject(new Error),Promise.reject(new Error("fail to send the grant control request!"));var o=this._getParticipantIdForDataSourceId(e,i);return this._resetControllerParticipant({participant:e,participantState:e.state,participantId:o}),this.controlState=2,this._grantControlTimer=setTimeout((function(){2===t.controlState?(t.controlState=0,t._resetControllerParticipant(),t._logger.error("No ack received when granting control - terminating control"),t._sendRequest({action:7,terminatedReason:4},i)||t._logger.error("fail to send the terminateNoAck request"),t._grantControlPromise?t._grantControlPromise.reject(new Error("No ack received when granting control - terminating control")):t._logger.error("Unexpected, no promise could be resolved - controlState = ControlState.WaitingForControlAck")):t._grantControlPromise?t._grantControlPromise.reject(new Error("grant control - times out in bad state - do nothing")):t._logger.error("Unexpected, no promise could be resolved - controlState = "+t.controlState),t._grantControlTimer=null}),1e4),this._grantControlPromise.promise},t.prototype._cancelGrantControlTimer=function(){this._grantControlTimer&&(this._grantControlPromise&&this._grantControlPromise.reject(new Error("cancelled by _cancelGrantControlTimer")),clearTimeout(this._grantControlTimer),this._grantControlTimer=null)},t.prototype._mapParticipantToSourceId=function(e){return this._dataChannel?e.getSourceIdForMediaType(4):(this._logger.error("Null data channel cannot map participant to source id"),-1)},t.prototype._getParticipantsDataSourceIds=function(e){var t=[];try{if(e&&e.endpoints&&e.endpoints.endpointDetails){if(!(1!==e.endpoints.endpointDetails.length||(i=e.endpoints.endpointDetails[0])&&i.mediaStreams))return t.push(u.DATA_SOURCE_ID_ANY),t;for(var n=0,r=e.endpoints.endpointDetails;n<r.length;n++){var i;if((i=r[n])&&i.mediaStreams)for(var o=0,a=i.mediaStreams;o<a.length;o++){var s=a[o];if(4===v.mapMediaTypeStringToMediaType(s.type)){if(t.push(s.sourceId),t.length>=8)return this._logger.error("excessive amount of data streams"),t;break}}}}}catch(e){this._logger.error("_getParticipantsDataSourceIds caught exception error="+e)}return t},t.prototype._getParticipantIdForDataSourceId=function(e,t){return e.getParticipantIdForSourceId(4,t)},t.prototype._getDataSourceIdForParticipantId=function(e,t){return this._dataChannel?e.getSourceId(t,4):(this._logger.error("Null data channel cannot map participant to source id"),-1)},t.prototype._getDataSourceIdForParticipantLeg=function(e){return this._getDataSourceIdForParticipantId(e.participant,e.participantId)},t.prototype._getSharerDataSourceId=function(){var e=this._sharerParticipant.getSharingParticipantLeg();return e?this._getDataSourceIdForParticipantId(this._sharerParticipant,e):(this._logger.warn("unable to identify the sharer participantId, falling back to first data channel"),this._mapParticipantToSourceId(this._sharerParticipant))},t.prototype.terminateControl=function(){if(this._isViewing()){if(4!==this.controlState)return Promise.reject(new Error("terminateControl called while not in control"));if(!this._sharerParticipant)return Promise.reject(new Error("terminateControl called but _sharerParticipant is null"))}else{if(!this._isSharing())return Promise.reject(new Error("terminateControl called but not sharing nor viewing"));if(!this._controllerParticipant)return Promise.reject(new Error("terminateControl called but controllerParticipant is null"))}return this._requestControlPromise?Promise.reject(new Error("request control promise has not been resolved yet while terminating control")):this._acceptControlPromise?Promise.reject(new Error("accept control promise has not been resolved yet while terminating control")):this._grantControlPromise?Promise.reject(new Error("grant control promise has not been resolved yet while terminating control")):this._terminateControlPromise?Promise.reject(new Error("terminate control promise has not been resolved yet while terminating control")):this._terminateControl()},t.prototype._terminateControl=function(e){var t=this;void 0===e&&(e=!0),this._logger.info("_terminateControl()"),this._terminateControlPromise=h.defer();var n=function(){t._terminateControlPromise=null};this._terminateControlPromise.promise.then(n,n);var r,i,o=0,a=e?8:7;if(this._isViewing()){if(4!==this.controlState)return this._logger.error("Local viewer called terminateControl when not controlling"),this._terminateControlPromise.reject(new Error),Promise.reject(new Error("Local viewer called terminateControl when not controlling"));this._teardownViewerRemoteControl(),o=6,r=this._getSharerDataSourceId(),i=""}else{if(3!==this.controlState||!this._controllerParticipant)return this._logger.error("Local sherer called terminateControl when no one is in control"),this._terminateControlPromise.reject(new Error),Promise.reject(new Error("Local sherer called terminateControl when no one is in control"));this._teardownSharerRemoteControl(),o=5,r=this._getDataSourceIdForParticipantLeg(this._controllerParticipant),i=this._controllerParticipant.participant.id}if(!this._sendRequest({action:a,terminatedReason:o},r)){if(e)return this._logger.error("fail to send the terminate control request"),this._terminateControlPromise.reject(new Error),Promise.reject(new Error("fail to send the grant control request!"));this._logger.error("fail to send the terminateNoAck request")}this.controlState=e?5:0;var s={inControl:!1,id:i,terminatedReason:o};return this.event("sharingControlChanged").raise(s),e?(this._terminateControlTimer=setTimeout((function(){5===t.controlState?(t.controlState=0,t._resetControllerParticipant(),t._logger.error("No ack received when terminating control - resending terminate request"),t._sendRequest({action:7,terminatedReason:4},r)||t._logger.error("fail to send the terminateNoAck request"),t._terminateControlPromise?t._terminateControlPromise.reject(new Error("No ack received when terminating control - resending terminate request")):t._logger.error("Unexpected, no promise could be resolved - controlState = ControlState.WaitingForTerminateAck")):t._terminateControlPromise?t._terminateControlPromise.reject(new Error("terminate control - times out in bad state - do nothing")):t._logger.error("Unexpected, no promise could be resolved - controlState = "+t.controlState),t._terminateControlTimer=null}),1e4),this._terminateControlPromise.promise):(this._terminateControlPromise.resolve(),new Promise((function(e,t){e()})))},t.prototype._cancelTerminateControlTimer=function(){this._terminateControlTimer&&(this._terminateControlPromise&&this._terminateControlPromise.reject(new Error("cancelled by _cancelTerminateControlTimer")),clearTimeout(this._terminateControlTimer),this._terminateControlTimer=null)},t.prototype._disposeControlCapturer=function(){this._logger.info("_disposeControlCapturer"),this._clearCapturerEventSubscriptions(),this._controlCapturer&&(this._controlCapturer.dispose(),this._controlCapturer=null)},t.prototype.dispose=function(){this._logger.info("SlimCoreElectronScreenSharingControl.dispose()"),this._detachAndDeleteControlDevices(),this._resetControlState(),this._dataChannel&&(this._dataChannel=null),this._disposeRenderer(),this._cancelRequestControlTimer(),this._cancelAcceptControlTimer(),this._cancelGrantControlTimer(),this._cancelTerminateControlTimer(),this._terminateAvailableHandshake&&this._terminateAvailableHandshake(2),this._resetParticipantSubscriptions(),this._finalizeViewerSessionTelemetry(s.SESSION_SHUTDOWN),this._finalizeSharerSessionTelemetry(c.SESSION_SHUTDOWN),e.prototype.dispose.call(this)},t}(y.default);t.default=T},function(e,t,n){var r;"undefined"!=typeof self&&self,r=function(e){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){e.exports=n(1)},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),a=function(e){function t(t,n,r){void 0===r&&(r=!0);var i=e.call(this)||this;return i._logger=t,i._element=n,i._captureRegionPreserveAspectRatio=r,i._mouseMoveCount=0,i._isMouseOnRenderer=!1,i._captureMode=0,i._pollTimerID=0,i._resizeTimerID=0,i._handleResizeEvents=function(){clearTimeout(i._resizeTimerID),i._resizeTimerID=window.setTimeout((function(){return i.updateCaptureRegion()}),250)},i._handleMouseLeave=function(e){!i._isOnScreenContent(e)&&i._isMouseOnRenderer&&(i._raiseCaptureEvent(2),i._logger.info("Mouse leaving render region")),i._isMouseOnRenderer=!1},i._handleMouseEnter=function(e){i._isOnScreenContent(e)&&(i._isMouseOnRenderer=!0,i._raiseCaptureEvent(1),i._logger.info("Mouse entering render region"))},i._handleLosingFocus=function(e){i._syncKeyStates(!0)},i._handleClick=function(e){i._isOnScreenContent(e)&&(i._raiseCaptureEvent(0),i._logger.info("Mouse clicked"))},i._handleMouseMove=function(e){if(!i._isOnScreenContent(e)&&i._isMouseOnRenderer)return i._raiseCaptureEvent(2),i._isMouseOnRenderer=!1,void i._logger.info("Mouse leaving render region");if(i._isOnScreenContent(e)&&!i._isMouseOnRenderer&&(i._raiseCaptureEvent(1),i._isMouseOnRenderer=!0,i._logger.info("Mouse entering render region")),(2===i._captureMode||3===i._captureMode)&&(i._mouseMoveCount++,i._isOnScreenContent(e)&&i._mouseMoveCount%2!=0)){var t={type:0};i._normalizeMousePosition(e,t),i._raiseMouseEvent(t)}},i._handleMouseDown=function(e){if((2===i._captureMode||3===i._captureMode)&&i._isOnScreenContent(e)){var t={type:2,buttonType:s(e.button),buttonDown:!0};i._normalizeMousePosition(e,t),i._raiseMouseEvent(t)}},i._handleMouseUp=function(e){if((2===i._captureMode||3===i._captureMode)&&i._isOnScreenContent(e)){var t={type:2,buttonType:s(e.button),buttonDown:!1};i._normalizeMousePosition(e,t),i._raiseMouseEvent(t)}},i._handleKeyDown=function(e){i._raiseKeyboardEvent({codeType:1,code:e.keyCode,repeat:e.repeat,keyUp:!1}),e.stopPropagation(),e.preventDefault()},i._handleKeyUp=function(e){i._raiseKeyboardEvent({codeType:1,code:e.keyCode,repeat:e.repeat,keyUp:!0}),e.stopPropagation(),e.preventDefault()},i._handleWheel=function(e){i._raiseMouseEvent({type:1,wheelRotation:e.deltaY>0?-120:120})},i._handleContextMenu=function(e){e.preventDefault()},i._ensureCanReceiveKeyboardInput(),i._element.ownerDocument&&i._element.ownerDocument.defaultView&&i._element.ownerDocument.defaultView.addEventListener("resize",i._handleResizeEvents,!1),i._captureRegion={left:0,top:0,width:i._element.clientWidth,height:i._element.clientHeight},i._videoSize={width:640,height:360},i._origElementSize={width:0,height:0},i._checkElementSize(),i}return i(t,e),Object.defineProperty(t.prototype,"captureMode",{get:function(){return this._captureMode},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"captureRegion",{get:function(){return this._captureRegion},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){this._logger.info("Disposing of Control Capturer"),window.clearTimeout(this._pollTimerID),this._element.ownerDocument&&this._element.ownerDocument.defaultView&&this._element.ownerDocument.defaultView.removeEventListener("resize",this._handleResizeEvents,!1)},t.prototype.updateVideoSize=function(e,t){this._videoSize.width=e,this._videoSize.height=t,this.updateCaptureRegion()},t.prototype.updateCaptureRegion=function(){this._captureRegionPreserveAspectRatio?(this._captureRegion.width=this._element.clientWidth,this._captureRegion.height=this._element.clientWidth*this._videoSize.height/this._videoSize.width,this._captureRegion.height>this._element.clientHeight?(this._captureRegion.width=this._element.clientHeight*this._videoSize.width/this._videoSize.height,this._captureRegion.height=this._element.clientHeight,this._captureRegion.left=(this._element.clientWidth-this._captureRegion.width)/2,this._captureRegion.top=0):(this._captureRegion.left=0,this._captureRegion.top=(this._element.clientHeight-this._captureRegion.height)/2)):(this._captureRegion.width=this._element.clientWidth,this._captureRegion.height=this._element.clientHeight,this._captureRegion.top=0,this._captureRegion.left=0)},t.prototype.setCaptureMode=function(e){3===this._captureMode&&3!==e&&this._syncKeyStates(!0),this._captureMode=e,0!==e?(this._element.addEventListener("click",this._handleClick),this._element.addEventListener("pointermove",this._handleMouseMove),this._element.addEventListener("pointerdown",this._handleMouseDown),this._element.addEventListener("pointerup",this._handleMouseUp),this._element.addEventListener("pointerenter",this._handleMouseEnter),this._element.addEventListener("pointerleave",this._handleMouseLeave),3===e?(this._element.addEventListener("wheel",this._handleWheel),this._element.addEventListener("keydown",this._handleKeyDown),this._element.addEventListener("keyup",this._handleKeyUp),this._element.addEventListener("contextmenu",this._handleContextMenu),this._element.addEventListener("blur",this._handleLosingFocus)):(this._element.removeEventListener("wheel",this._handleWheel),this._element.removeEventListener("keydown",this._handleKeyDown),this._element.removeEventListener("keyup",this._handleKeyUp),this._element.removeEventListener("contextmenu",this._handleContextMenu),this._element.removeEventListener("blur",this._handleLosingFocus))):(this._element.removeEventListener("pointermove",this._handleMouseMove),this._element.removeEventListener("pointerdown",this._handleMouseDown),this._element.removeEventListener("pointerup",this._handleMouseUp),this._element.removeEventListener("pointerenter",this._handleMouseEnter),this._element.removeEventListener("pointerleave",this._handleMouseLeave),this._element.removeEventListener("click",this._handleClick),this._element.removeEventListener("wheel",this._handleWheel),this._element.removeEventListener("keydown",this._handleKeyDown),this._element.removeEventListener("keyup",this._handleKeyUp),this._element.removeEventListener("contextmenu",this._handleContextMenu),this._element.removeEventListener("blur",this._handleLosingFocus))},t.prototype._ensureCanReceiveKeyboardInput=function(){this._element.tabIndex=this._element.tabIndex},t.prototype._checkElementSize=function(){var e=this;this._origElementSize.width===this._element.clientWidth&&this._origElementSize.height===this._element.clientHeight||(this.updateCaptureRegion(),this._origElementSize.width=this._element.clientWidth,this._origElementSize.height=this._element.clientHeight),this._pollTimerID=window.setTimeout((function(){return e._checkElementSize()}),3e3)},t.prototype._raiseMouseEvent=function(e){this.event("mouseControlEvent").raise(e)},t.prototype._raiseKeyboardEvent=function(e){this.event("keyboardControlEvent").raise(e)},t.prototype._raiseCaptureEvent=function(e){this.event("ctrlCaptureEvent").raise(e)},t.prototype._normalizeMousePosition=function(e,t){t.xPos=(e.offsetX-this._captureRegion.left)/this._captureRegion.width*65535,t.yPos=(e.offsetY-this._captureRegion.top)/this._captureRegion.height*65535},t.prototype._isOnScreenContent=function(e){var t=this._captureRegion.left,n=this._captureRegion.left+this._captureRegion.width,r=this._captureRegion.top,i=this._captureRegion.top+this._captureRegion.height;return t<=e.offsetX&&e.offsetX<n&&r<=e.offsetY&&e.offsetY<i},t.prototype._syncKeyStates=function(e){this._raiseKeyboardEvent({codeType:1,code:17,repeat:!1,keyUp:e}),this._raiseKeyboardEvent({codeType:1,code:16,repeat:!1,keyUp:e}),this._raiseKeyboardEvent({codeType:1,code:18,repeat:!1,keyUp:e}),this._raiseKeyboardEvent({codeType:1,code:91,repeat:!1,keyUp:e}),this._logger.info("Synced Key states.")},t.formatMouseEvent=function(e){if(!e)return new Uint8Array(0);e.buttonType||(e.buttonType=0),e.xPos||(e.xPos=0),e.yPos||(e.yPos=0),e.wheelRotation||(e.wheelRotation=0);var t=new ArrayBuffer(7),n=new DataView(t),r=(3&e.type)<<0,i=(7&e.buttonType)<<2,o=(e.buttonDown?1:0)<<5,a=(e.wheelButtonDown?1:0)<<6;return n.setUint8(0,1),n.setUint8(1,r|i|o|a|0),n.setUint16(2,e.xPos,!0),n.setUint16(4,e.yPos,!0),n.setUint8(6,e.wheelRotation),new Uint8Array(t)},t.formatKeyboardEvent=function(e){var t=new ArrayBuffer(3),n=new DataView(t),r=(3&e.codeType)<<0,i=(e.keyUp?1:0)<<4,o=(e.repeat?1:0)<<5;return n.setUint8(0,0),n.setUint8(1,0|r|i|o|0),n.setUint8(2,e.code),new Uint8Array(t)},t}(o.default);function s(e){switch(e){case 0:return 0;case 2:return 1;case 1:return 2;default:return}}t.SlimCoreElectronControlCapturer=a},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=function(e){function t(t){return e.call(this,t)||this}return i(t,e),t.prototype.changed=function(e){return this.subscribe({changed:e,on:void 0})},t.prototype.on=function(e,t){return this.subscribe({changed:void 0,on:{name:String(e),handler:this._toEventCallback(t)}})},t.prototype.once=function(e,t,n){var r,i=this;return r=this.on(e,this._fromEventCallback((function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];r.dispose(n),i._toEventCallback(t).apply(void 0,e)})))},t.prototype.raiseChanged=function(){this.raiseEvents((function(e){return e.changed&&e.changed()}))},t.prototype.event=function(e){var t=this;return{raise:this._fromEventCallback((function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return t._raiseEventImpl.apply(t,[String(e)].concat(n))}))}},t.prototype._raiseEventImpl=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.raiseEvents((function(n){var r;return n.on&&n.on.name===e&&(r=n.on).handler.apply(r,t)}))},t.prototype._toEventCallback=function(e){return e},t.prototype._fromEventCallback=function(e){return e},t}(n(3).EventSourceImpl);t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(4),i=function(){function e(e){this.subscriptions=[],this.eventLogger=e}return e.prototype.subscribe=function(e){return new o(this.subscriptions,e)},e.prototype.dispose=function(e){this.subscriptions=[]},e.prototype.raiseEvents=function(e){var t=this;this.subscriptions.slice().forEach((function(n){try{void 0!==n.eventHandler&&e(n.eventHandler)}catch(e){t.eventLogger&&t.eventLogger.warn&&t.eventLogger.warn("Event handler exception caught!",e)}}))},e}();t.EventSourceImpl=i;var o=function(){function e(e,t){this.subscriptions=e,this.eventHandler=t,this.subscriptions.push(this)}return e.prototype.dispose=function(){var e=this;r.remove(this.subscriptions,(function(t){return t===e})),this.eventHandler=void 0},e}()},function(t,n){t.exports=e}])},e.exports=r(n(1))},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t,n){this._create=e,this._release=t,this._logger=n,this._bindingMap={},this._logger.info("BindingManager created")}return e.prototype.acquire=function(e,t){var n=this;if(!this._bindingMap[t]||this._bindingMap[t].releasePromise){var r=!1,i=void 0;this._bindingMap[t]?(i=this._bindingMap[t].releasePromise.catch((function(e){return n._logger.info("Release binding error: "+e)})),r=!0):i=Promise.resolve();var o=i.then((function(){return n._create(t)})).then((function(e){return e})).catch((function(e){throw delete n._bindingMap[t],e}));this._bindingMap[t]={createPromise:o,owners:[],chained:r}}return this._bindingMap[t].owners.push(e),this._bindingMap[t].createPromise},e.prototype.release=function(e,t){return r(this,void 0,void 0,(function(){var n,r,o=this;return i(this,(function(i){switch(i.label){case 0:return this._bindingMap[t]?[4,this._bindingMap[t].createPromise]:[3,2];case 1:if(n=i.sent(),(r=this._bindingMap[t].owners.indexOf(e))>-1&&this._bindingMap[t].owners.splice(r,1),0===this._bindingMap[t].owners.length)return this._bindingMap[t].releasePromise=this._release(t,n).then((function(){o._bindingMap[t].chained||delete o._bindingMap[t]})),[2,this._bindingMap[t].releasePromise];i.label=2;case 2:return[2]}}))}))},e}();t.SlimCoreElectronBindingManager=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),i=n(52),o=n(53),a=n(54);t.initDelegate=function(e,t){if(!r.RootToolsManager.isDelegateSet()){var n=new a.RootToolsManagerDelegate(e,t.logger);r.RootToolsManager.setDelegate(n)}},t.patchLogger=function(e){if(!r.RootToolsManager.isDelegateSet()&&e.logger){var t=new o.RedirectingLogAppender(e.logger);r.LogFactory.instance().addAppender(t)}e.logger=new i.TsCallingLogger("JS.TsCalling.Electron",!1)},t.deinitLogging=function(){r.RootToolsManager.stopAsyncOperations()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(7),i=n(1),o=function(){function e(e,t,n){void 0===n&&(n=""),this.ulLogComponent=e,this.ulSafeComponent=t,this._getPrefix=i.isFunction(n)?n:function(){return n},this.logComponent=r.LogFactory.instance().component(this.ulLogComponent),r.LogFactory.instance().declareComponentSafe(this.ulLogComponent,t)}return e.prototype.createChild=function(t){var n=this,r=i.isFunction(t)?t:function(){return t};return new e(this.ulLogComponent,this.ulSafeComponent,(function(){return n._getPrefix()?n._getPrefix()+"/"+r():r()}))},e.prototype.log=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._apply((function(t){return e.logComponent.debug2(null,t)}),t)},e.prototype.debug=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._apply((function(t){return e.logComponent.debug4(null,t)}),t)},e.prototype.info=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._apply((function(t){return e.logComponent.debug1(null,t)}),t)},e.prototype.warn=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._apply((function(t){return e.logComponent.warn(null,t)}),t)},e.prototype.error=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._apply((function(t){return e.logComponent.error(null,t)}),t)},e.prototype._apply=function(e,t){void 0===t&&(t=[]),this._addPrefix(t),e(t.map((function(e){return e instanceof DOMException?e.toString():e})).map((function(e){return i.isObject(e)?JSON.stringify(e):e})).join(", "))},e.prototype._addPrefix=function(e){if(e&&e[0]){var t=this._getPrefix()+" "+e[0];e[0]=t}},e}();t.TsCallingLogger=o},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(7),a=function(e){function t(t){var n=e.call(this,new o.StandardLogFormatter(o.SLF_Flags.Component))||this;return n._logger=t,n}return i(t,e),t.prototype.log=function(e,t,n,r){if(this._logger){var i=e.level<=o.LogLevel.Debug4?this._logger.debug:e.level<=o.LogLevel.Debug2?this._logger.log:e.level<=o.LogLevel.Debug1?this._logger.info:e.level<=o.LogLevel.Warning?this._logger.warn:this._logger.error;i&&i.apply(this._logger,[this.formatter().format(e,t,n,r)])}},t}(o.AbstractLogAppender);t.RedirectingLogAppender=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(55),i=function(){function e(e,t){this._slimcore=e,this._logger=t}return e.prototype.fetchEcsConfig=function(e,t){return r.Resolved(void 0)},e.prototype.sendTelemetry=function(e,t){},e.prototype.sendLoggingEventToNative=function(e,t){this._slimcore.handleLoggingEvent?this._slimcore.handleLoggingEvent(e,t):this._logger.warn("slimcore.handleLoggingEvent is not available")},e.prototype.setNativeLoggingEventCallback=function(e){var t=this;e&&"function"==typeof e?this._slimcore.handle("logging-event",void 0,(function(n){t._logger.debug("RootToolsManagerDelegate: LoggingNativeEvent msg:"+n.message+" aux"+n.auxiliaryPayload),e(n.message,n.auxiliaryPayload)})):this._logger.warn("RootToolsManagerDelegate.setNativeLoggingEventCallback invalid callback provided")},e}();t.RootToolsManagerDelegate=i},function(e,t,n){"use strict";(function(e){function n(e){return null!=e&&"function"==typeof e.then}function r(e){return null!=e&&"function"==typeof e.cancel}function i(e,n){if(!t.config.catchExceptions)return e();try{return e()}catch(e){return n(e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.config={exceptionsToConsole:!0,catchExceptions:!0,traceEnabled:!1,exceptionHandler:void 0,unhandledErrorHandler:function(e){throw e}},t.fromThenable=function(e){var t=u();return e.then((function(e){t.resolve(e)}),(function(e){t.reject(e)})),t.promise().thenAsync((function(e){return e}))};var o,a=[],s=void 0!==e;function c(t){a.push(t),1===a.length&&(s?e(l):setTimeout(l,0))}function l(){var e=a;a=[];for(var t=0;t<e.length;t++)e[t]()}function u(){return new o.SyncTask}function d(e){return(new o.SyncTask).resolve(e).promise()}function h(e){var t=u(),i=!1;return t.onCancel((function(t){e.forEach((function(e){r(e)&&o.SyncTask.cancelOtherInternal(e,t)}))})),e.forEach((function(e){n(e)?e.then((function(e){i||(i=!0,t.resolve(e))}),(function(e){i||(i=!0,t.reject(e))})):i||(i=!0,t.resolve(e))})),t.promise()}t.asyncCallback=c,function(e){var o=function(){function e(){this._completedSuccess=!1,this._completedFail=!1,this._traceEnabled=!1,this._cancelCallbacks=[],this._wasCanceled=!1,this._wasExplicitlyCanceled=!1,this._resolving=!1,this._storedCallbackSets=[],this._mustHandleError=!0}return e.prototype._addCallbackSet=function(t,n){var r=this,i=new e;return i.onCancel((function(e){t.wasCanceled=!0,t.cancelContext=e,r._cancelInternal(e)})),t.task=i,this._storedCallbackSets.push(t),n?this._mustHandleError=!1:i._mustHandleError=!1,this._resolving||(this._completedSuccess?this._resolveSuccesses():this._completedFail&&this._resolveFailures()),i.promise()},e.prototype.onCancel=function(e){return this._completedSuccess||this._completedFail||(this._wasCanceled?e(this._cancelContext):this._cancelCallbacks.push(e)),this},e.prototype.then=function(e,t){return this._addCallbackSet({successFunc:e,failFunc:t},!0)},e.prototype.thenAsync=function(e,t){return this._addCallbackSet({successFunc:e,failFunc:t,asyncCallback:!0},!0)},e.prototype.catch=function(e){return this._addCallbackSet({failFunc:e},!0)},e.prototype.always=function(e){return this._addCallbackSet({successFunc:e,failFunc:e},!0)},e.prototype.setTracingEnabled=function(e){return this._traceEnabled=e,this},e.prototype.finally=function(e){return this._addCallbackSet({successFunc:e,failFunc:e},!1),this},e.prototype.done=function(e){return this._addCallbackSet({successFunc:e},!1),this},e.prototype.fail=function(e){return this._addCallbackSet({failFunc:e},!1),this},e.prototype.resolve=function(e){return this._checkState(!0),this._completedSuccess=!0,this._storedResolution=e,this._cancelCallbacks=[],this._resolveSuccesses(),this},e.prototype.reject=function(t){return this._checkState(!1),this._completedFail=!0,this._storedErrResolution=t,this._cancelCallbacks=[],this._resolveFailures(),e._enforceErrorHandled(this),this},e.prototype._checkState=function(e){if(this._completedSuccess||this._completedFail){this._completeStack&&console.error(this._completeStack.message,this._completeStack.stack);var n="Failed to "+(e?"resolve":"reject")+": the task is already "+(this._completedSuccess?"resolved":"rejected");throw new Error(n)}(t.config.traceEnabled||this._traceEnabled)&&(this._completeStack=new Error("resolve"))},e._enforceErrorHandled=function(n){n._mustHandleError&&(e._rejectedTasks.push(n),e._enforceErrorHandledTimer||(e._enforceErrorHandledTimer=setTimeout((function(){e._enforceErrorHandledTimer=void 0;var n=e._rejectedTasks;e._rejectedTasks=[],n.forEach((function(e,n){e._mustHandleError&&t.config.unhandledErrorHandler(e._storedErrResolution)}))}),0)))},e.prototype.cancel=function(e){if(this._wasExplicitlyCanceled)throw new Error("Already Canceled");this._wasExplicitlyCanceled=!0,this._cancelInternal(e)},e.prototype._cancelInternal=function(e){var t=this;if(!this._wasCanceled){this._wasCanceled=!0,this._cancelContext=e;var n=this._cancelCallbacks;this._cancelCallbacks=[],n.length>0&&n.forEach((function(e){t._completedSuccess||t._completedFail||e(t._cancelContext)}))}},e.cancelOtherInternal=function(e,t){var n=e;n._storedCallbackSets&&n._cancelInternal?n._cancelInternal(t):e.cancel(t)},e.prototype.promise=function(){return this},e.prototype._resolveSuccesses=function(){var e=this;for(this._resolving=!0;this._storedCallbackSets.length;){var t=this._storedCallbackSets;this._storedCallbackSets=[],t.forEach((function(t){t.asyncCallback?c((function(){return e._resolveSuccessCallback(t)})):e._resolveSuccessCallback(t)}))}this._resolving=!1},e.prototype._resolveSuccessCallback=function(t){var o=this;t.successFunc?i((function(){var i=t.successFunc(o._storedResolution);r(i)&&(t.wasCanceled?e.cancelOtherInternal(i,t.cancelContext):t.task.onCancel((function(t){return e.cancelOtherInternal(i,t)}))),n(i)?i.then((function(e){t.task.resolve(e)}),(function(e){t.task.reject(e)})):t.task.resolve(i)}),(function(e){o._handleException(e,"SyncTask caught exception in success block: "+e.toString()),t.task.reject(e)})):t.task.resolve(this._storedResolution)},e.prototype._resolveFailures=function(){var e=this;for(this._resolving=!0;this._storedCallbackSets.length;){var t=this._storedCallbackSets;this._storedCallbackSets=[],t.forEach((function(t){t.asyncCallback?c((function(){return e._resolveFailureCallback(t)})):e._resolveFailureCallback(t)}))}this._resolving=!1},e.prototype._resolveFailureCallback=function(t){var o=this;t.failFunc?i((function(){var i=t.failFunc(o._storedErrResolution);r(i)&&(t.wasCanceled?e.cancelOtherInternal(i,t.cancelContext):t.task.onCancel((function(t){return e.cancelOtherInternal(i,t)}))),n(i)?i.then((function(e){t.task.resolve(e)}),(function(e){t.task.reject(e)})):t.task.resolve(i)}),(function(e){o._handleException(e,"SyncTask caught exception in failure block: "+e.toString()),t.task.reject(e)})):t.task.reject(this._storedErrResolution)},e.prototype._handleException=function(e,n){t.config.exceptionsToConsole&&console.error(n),t.config.exceptionHandler&&t.config.exceptionHandler(e)},e.prototype.toEs6Promise=function(){var e=this;return new Promise((function(t,n){return e.then(t,n)}))},e._rejectedTasks=[],e}();e.SyncTask=o}(o||(o={})),t.all=function(e){if(0===e.length)return d([]);var t,i=u(),a=e.length,s=Array(e.length);i.onCancel((function(t){e.forEach((function(e){r(e)&&o.SyncTask.cancelOtherInternal(e,t)}))}));var c=function(){0==--a&&(void 0!==t?i.reject(t):i.resolve(s))};return e.forEach((function(e,r){n(e)?e.then((function(e){s[r]=e,c()}),(function(e){void 0===t&&(t=void 0===e||e),c()})):(s[r]=e,c())})),i.promise()},t.Defer=u,t.Resolved=d,t.Rejected=function(e){return(new o.SyncTask).reject(e).promise()},t.race=h,t.raceTimer=function(e,t){var n=u(),r=setTimeout((function(){n.resolve({timedOut:!0})}),t);return h([e.then((function(e){return clearTimeout(r),{timedOut:!1,result:e}})),n.promise()])}}).call(t,n(56).setImmediate)},function(e,t,n){(function(e){var r=void 0!==e&&e||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function o(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new o(i.call(setTimeout,r,arguments),clearTimeout)},t.setInterval=function(){return new o(i.call(setInterval,r,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(r,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},n(57),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(t,n(38))},function(e,t,n){(function(e,t){!function(e,n){"use strict";if(!e.setImmediate){var r,i,o,a,s,c=1,l={},u=!1,d=e.document,h=Object.getPrototypeOf&&Object.getPrototypeOf(e);h=h&&h.setTimeout?h:e,"[object process]"==={}.toString.call(e.process)?r=function(e){t.nextTick((function(){f(e)}))}:function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?(a="setImmediate$"+Math.random()+"$",s=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(a)&&f(+t.data.slice(a.length))},e.addEventListener?e.addEventListener("message",s,!1):e.attachEvent("onmessage",s),r=function(t){e.postMessage(a+t,"*")}):e.MessageChannel?((o=new MessageChannel).port1.onmessage=function(e){f(e.data)},r=function(e){o.port2.postMessage(e)}):d&&"onreadystatechange"in d.createElement("script")?(i=d.documentElement,r=function(e){var t=d.createElement("script");t.onreadystatechange=function(){f(e),t.onreadystatechange=null,i.removeChild(t),t=null},i.appendChild(t)}):r=function(e){setTimeout(f,0,e)},h.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var i={callback:e,args:t};return l[c]=i,r(c),c++},h.clearImmediate=p}function p(e){delete l[e]}function f(e){if(u)setTimeout(f,0,e);else{var t=l[e];if(t){u=!0;try{!function(e){var t=e.callback,n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(void 0,n)}}(t)}finally{p(e),u=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(t,n(38),n(58))},function(e,t){var n,r,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var c,l=[],u=!1,d=-1;function h(){u&&c&&(u=!1,c.length?l=c.concat(l):d=-1,l.length&&p())}function p(){if(!u){var e=s(h);u=!0;for(var t=l.length;t;){for(c=l,l=[];++d<t;)c&&c[d].run();d=-1,t=l.length}c=null,u=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function g(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];l.push(new f(e,t)),1!==l.length||u||s(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o,a=n(1);!function(e){e[e.Integer=0]="Integer",e[e.String=1]="String",e[e.Binary=2]="Binary"}(o||(o={}));var s=function(e){function t(t){var n=e.call(this,t)||this;return n.eventListenerArrays={},void 0!==t.oncommonwrapperevent&&(t.oncommonwrapperevent=function(e){var t=n.argsFromCommonWrapperEventPayload(e),r=n.eventListenerArrays[e.target];r&&r.forEach((function(e){e(t)}))}),n}return i(t,e),t.prototype.argsFromCommonWrapperEventPayload=function(e){if("object-property-changed"===e.target){var t=e.detail[0],n={objectType:t.objectType,objectId:t.objectId,propKey:t.propKey,value:void 0};switch(t.value.type){case o.Integer:n.value=t.value.intVal;break;case o.String:n.value=t.value.strVal;break;case o.Binary:n.value=t.value.binVal}return n}return e.detail[0]},t.prototype.addListener=function(e,t){var n=this.eventListenerArrays[e];return n||(n=this.eventListenerArrays[e]=[]),-1===n.indexOf(t)&&n.push(t),this},t.prototype.on=function(e,t){return this.addListener(e,t)},t.prototype.once=function(e,t){return this.addListener(e,t)},t.prototype.removeListener=function(e,t){var n=this.eventListenerArrays[e];if(n){var r=n.indexOf(t);r>-1&&n.splice(r,1)}return this},t.prototype.removeAllListeners=function(e){var t=this;if(e){var n=this.eventListenerArrays[e];return n&&(n=this.eventListenerArrays[e]=[]),this}return Object.keys(this.eventListenerArrays).forEach((function(e){t.eventListenerArrays[e]=[]})),this},t.prototype.getMaxListeners=function(){return 0},t.prototype.setMaxListeners=function(e){},t.prototype.listeners=function(e){return this.eventListenerArrays[e]},t.prototype.emit=function(e,t){var n=this.eventListenerArrays[e];return n&&n.forEach((function(e){e(t)})),!0},t}(function(){function e(e){var t=this;this._nativeObject=e,a.forIn(e,(function(e,n,r){a.isFunction(e)?t[n]||(t[n]=function(){return e.apply(r,arguments)}):Object.defineProperty(t,n,{get:function(){return r[n]},set:function(e){r[n]=e}})}))}return Object.defineProperty(e.prototype,"objectToWrap",{get:function(){return this._nativeObject},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"objectAsWrapped",{get:function(){return this},enumerable:!0,configurable:!0}),e}()),c=function(e){function t(t){return e.call(this,t)||this}return i(t,e),t}(s),l=function(e){function t(t){return e.call(this,t)||this}return i(t,e),t.prototype.createCallInterface=function(){var e=this.objectToWrap.createCallInterface();return new s(e).objectAsWrapped},t.prototype.getContentSharing=function(e){var t=this.objectToWrap.getContentSharing(e);return new s(t).objectAsWrapped},t.prototype.createVideoBindingRenderer=function(e){var t=this.objectToWrap.createVideoBindingRenderer(e);return new c(t).objectAsWrapped},t.prototype.createVideoBindingScreenShare=function(){var e=this.objectToWrap.createVideoBindingScreenShare();return new c(e).objectAsWrapped},t.prototype.videoCreateBinding=function(e,t){var n=this;return new Promise((function(r,i){var o=t,a=o.objectToWrap;void 0!==a.onvideobindingcreatedevent&&(a.onvideobindingcreatedevent=function(){r()}),void 0!==a.onvideobindingfailedevent&&(a.onvideobindingfailedevent=function(){n.objectToWrap.videoReleaseBinding(e,o.objectToWrap),i("binding creation failed")}),n.objectToWrap.videoCreateBinding(e,o.objectToWrap)}))},t.prototype.videoReleaseBinding=function(e,t){var n=this;return new Promise((function(r,i){var o=t,a=o.objectToWrap;void 0!==a.onvideobindingreleasedevent&&(a.onvideobindingreleasedevent=function(){r()}),n.objectToWrap.videoReleaseBinding(e,o.objectToWrap)}))},t.prototype.setMediaConfig=function(e){this.objectToWrap.setMediaConfig(JSON.stringify(e))},t}(s);t.UwpEngineWrapped=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(37);t.slimCoreElectronStackFactory=r.slimCoreElectronStackFactory,t.slimCoreUwpStackFactory=r.slimCoreUwpStackFactory;var i=n(10);t.getOvb=i.getOvb,t.getVersion=i.getTsCallingVersion;var o=n(2);t.generateCauseId=o.generateCauseId}])},e.exports=r(n(28),n(70))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";
/*!
 *  index.ts
 *  AUF
 *
 *  Created by Johan Blumenberg on 2016-12-29
 *  Copyright 2016 Microsoft. All rights reserved.
 *
 */function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(26)),r(n(29)),r(n(71)),r(n(62)),r(n(73))},function(e,t,n){"use strict";
/*!
 *  RootToolsManager.ts
 *  AUF
 *
 *  Created by Johan Blumenberg on 2016-12-29
 *  Copyright 2016 Microsoft. All rights reserved.
 *
 */var r,i=this&&this.__extends||(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var o=n(72),a=n(29),s=n(26),c=n(62),l=a.LogFactory.instance().component("RootToolsManager");a.LogFactory.instance().declareComponentSafe("RootToolsManager",!0);var u;!function(e){e[e.InternalBuild=0]="InternalBuild",e[e.PublicBuild=1]="PublicBuild"}(u=t.BuildType||(t.BuildType={}));var d=u.InternalBuild;function h(e,t){var n=[];for(var r in e)n.push(t(r,e[r]));return n}function p(e,t,n){if(null==e)return null==t||0===t.length;if(null==t)return null==e||0===e.length;if(e.length===t.length){for(var r=0;r<e.length;r++)if(!n(e[r],t[r]))return!1;return!0}return!1}function f(e,t){return null==e?null==t:null==t?null==e:e.arg===t.arg&&e.op===t.op&&e.value===t.value}function g(e,t){return null==e?null==t||0===t.logId:null==t?null==e||0===e.logId:e.logId===t.logId&&e.name===t.name&&p(e.matchers,t.matchers,f)}function _(e,t){return null==e?null==t:null==t?null==e:e.component===t.component&&e.parsedLevel===t.level}function m(e,t){return null==e?null==t:null==t?null==e:e.component===t.component&&e.level===t.level}t.setBuildType=function(e){var t=d;return d=e,t};var v=function(e){function t(t,n,r){var i=e.call(this)||this;return i._unmetConditions=[],i._rtMan=t,i._triggerCallback=n,i._ecsConfig=r,i.resetConditions(),i}return i(t,e),t.prototype.config=function(){return this._ecsConfig},t.prototype.configEquals=function(e){return this._ecsConfig.includeUnsafe===e.includeUnsafe&&this._ecsConfig.mutualSubmissionType===e.mutualSubmissionType&&this._ecsConfig.name===e.name&&this._ecsConfig.reenableAfterTriggering===e.reenableAfterTriggering&&this._ecsConfig.experimentTarget===e.experimentTarget&&g(this._ecsConfig.resetCondition,e.resetCondition)&&p(this._ecsConfig.conditions,e.conditions,g)&&p(this._ecsConfig.filters,e.filters,m)},t.prototype.nativeConfigEquals=function(e){return this._ecsConfig.includeUnsafe===e.includeUnsafe&&this._ecsConfig.name===e.name&&this._ecsConfig.reenableAfterTriggering===e.reenableAfterTriggering&&g(this._ecsConfig.resetCondition,e.resetCondition)&&p(this._ecsConfig.conditions,e.conditions,g)&&p(this._ecsConfig.filters,e.filters,_)},t.prototype.needReset=function(e){return!this.configEquals(e)},t.prototype.resetConditions=function(){this._unmetConditions=[];for(var e=0;e<this._ecsConfig.conditions.length;e++)this._unmetConditions.push(e)},t.prototype.matcherMatches=function(e,t){if(e.arg>=t.length)return!1;var n=t[e.arg],r="string"==typeof n?e.value:parseInt(e.value,10);return"="===e.op||"=="===e.op?n===r:"!="===e.op?n!==r:"<"===e.op?n<r:"<="===e.op?n<=r:">"===e.op?n>r:">="===e.op?n>=r:"CONTAINS"===e.op.toUpperCase()&&(""+n).indexOf(e.value)>=0},t.prototype.conditionMatches=function(e,t,n){if(t!==e.logId)return!1;if(e.matchers)for(var r=0;r<e.matchers.length;r++)if(!this.matcherMatches(e.matchers[r],n))return!1;return!0},t.prototype.log=function(e,t,n,r){if(0!==this._unmetConditions.length&&e.component!==l){var i=this._ecsConfig;i.resetCondition&&this.conditionMatches(i.resetCondition,t,r)&&(l.debug4("LogTrigger %s: resetCondition met",i.name),this.resetConditions());for(var o=0;o<this._unmetConditions.length;o++){var a=this._unmetConditions[o];if(this.conditionMatches(i.conditions[a],t,r)){l.debug4("LogTrigger %s: condition %s met",i.name,i.conditions[a].name),this._unmetConditions.splice(o,1);break}}0===this._unmetConditions.length&&(l.debug1("LogTrigger %s has triggered, trying to send the log",i.name),this._triggerCallback.call(this._rtMan,i),i.reenableAfterTriggering&&this.resetConditions())}},t.prototype.receiveAll=function(){return!0},t}(c.AbstractLogAppender),y=function(e){function t(t,n,r){var i=e.call(this)||this;return i._circularBuffer=[],i._circularBufferMaxSize=0,i._onBufferOverflow=null,i._circularBuffer=[],i._circularBufferMaxSize=n,i._includeUnsafe=t,i._onBufferOverflow=r||function(){return i._circularBuffer.shift()},i}return i(t,e),t.prototype.formatMessage=function(e){for(var t=[],n=0;n<e.length;n++)"string"==typeof e[n]||"number"==typeof e[n]?t.push(e[n]):t.push(JSON.stringify(e[n]));return t},t.prototype.log=function(e,t,n,r){if((this._includeUnsafe||e.component.safe())&&!(this._circularBuffer.length>this._circularBufferMaxSize)){var i={md:e,logId:t,messages:this.formatMessage(r)};this._circularBuffer.push(i),this._circularBuffer.length>this._circularBufferMaxSize&&this._onBufferOverflow()}},t.prototype.visitReverseOrder=function(e){for(var t=this._circularBuffer.length-1;t>=0;t--){var n=this._circularBuffer[t];if(!e(n.md,n.logId,n.messages))return}},t.prototype.visitForwardOrder=function(e){for(var t=0;t<this._circularBuffer.length;t++){var n=this._circularBuffer[t];if(!e(n.md,n.logId,n.messages))return}},t.prototype.needReset=function(e,t){return e!==this._includeUnsafe||t!==this._circularBufferMaxSize},t.prototype.dumpLogBuffer=function(e,t,n){var r=this,i=new C(e.reverse),o=e.filter.map((function(e){return{component:"root"===e.component?"":e.component,parsedLevel:e.level}})),a=n||{matchedLines:0,totalLines:0};return(e.reverse?this.visitReverseOrder:this.visitForwardOrder).apply(this,[function(e,n,s){return a.totalLines++,r.filterMatches(e,n,s,o)&&(a.matchedLines++,i.log(e.component,e.timestamp,e.level,n,s)),!t||i._data.length<t}]),i.close(),i.data()},t.prototype.filterMatches=function(e,t,n,r){for(var i=0;i<r.length;i++)if((""===r[i].component||e.component.name()===r[i].component||e.component.name().substr(0,r[i].component.length)===r[i].component&&"."===e.component.name().charAt(r[i].component.length))&&e.level>=r[i].parsedLevel)return!0;return!1},t.prototype.clear=function(){this._circularBuffer=[]},t.prototype.size=function(){return this._circularBuffer.length},t.prototype.empty=function(){return 0===this.size()},t.prototype.capacity=function(){return this._circularBufferMaxSize},t}(c.AbstractLogAppender);t.CircularBuffer=y;var C=function(){function e(e){this._reverse=e,this._first=!0,this._pending=[],this._components={},this._componentCount=0,this._lastts=0,this._base64chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",this._data="ULOG2"+String.fromCharCode(33)+String.fromCharCode(32),this._data+=e?String.fromCharCode(34):String.fromCharCode(32),this._data+=String.fromCharCode(32)}return e.prototype._add8=function(e){if(this._pending.push(255&e),3===this._pending.length){var t=(this._pending[0]<<16)+(this._pending[1]<<8)+(this._pending[2]<<0),n=this._base64chars[t>>18&63]+this._base64chars[t>>12&63]+this._base64chars[t>>6&63]+this._base64chars[t>>0&63];this._data+=n,this._pending=[]}},e.prototype._add16=function(e){this._add8(e>>8&255),this._add8(e>>0&255)},e.prototype._add32=function(e){this._add8(e>>24&255),this._add8(e>>16&255),this._add8(e>>8&255),this._add8(e>>0&255)},e.prototype._add64=function(e){this._add32(e/4294967296|0),this._add32(0|e)},e.prototype._addS=function(e){for(var t=0;t<e.length;t++)this._add8(e.charCodeAt(t));this._add8(0)},e.prototype._close=function(){for(;this._pending.length;)this._add8(0)},e.prototype.log=function(e,t,n,r,i){var o=this._components[e.name()];o||(o=++this._componentCount,this._components[e.name()]=o,this._add8(2),this._add16(o),this._addS(e.name()),this._addS(""),this._addS(""),this._add8(e.safe()?1:0));var a=128;this._first&&(a|=2);var s=t-this._lastts;this._lastts=t,s>-128&&s<128&&(a|=1),this._add8(a),1&a?this._add8(s):this._add64(1e3*t),this._first&&(this._add32(1),this._add8(0),this._add16(0)),this._add16(o),this._add8(n),this._add32(r),this._add8(i.length);for(var c=0;c<i.length;c++)this._add8(8),this._addS(""+i[c]);this._first=!1},e.prototype.close=function(){this._add8(7),this._close()},e.prototype.data=function(){return this._data},e}();function S(e){return"Native"===e||"JavaScript"===e||"Mixed"===e}var I=function(){function e(){this._maxUploadSize=0,this._jsToNativeBuffer=null,this._jsToNativeBufferHandle=null,this._jsToNativeFlushTimer=null,this._jsToNativeFlushInterval=0,this._triggers={},this._defaultBuffers=[{size:2097152,level:s.LogLevel.Debug4}],this._defaultKillswitch={blacklist:[],whitelist:[]},this._defaultBlacklists={component:[],logline:[]},this._localLogLevels={},this._defaultExperimentTarget="Mixed",this._BRBCallback=null}return e.prototype.setDelegate=function(e){this._glue=e,this.registerListeners()},e.prototype.isDelegateSet=function(){return null!=this._glue},e.prototype.setNativeFunctions=function(e){this._native&&this._native.log_config.removeLogTriggerListener(this),this._native=e,this._native&&this._native.log_config.addLogTriggerListener(this)},e.prototype.applyLogLevels=function(){var e={};for(var t in this._localLogLevels)e[t]=this._localLogLevels[t];e[""]=e.root||s.LogLevel.Debug4,delete e.root;var n=h(e,(function(e,t){return{component:e,level:t}}));n.sort((function(e,t){return e.component.length-t.component.length})),n.forEach((function(e){return a.LogFactory.instance().component(e.component).setLevel(e.level)})),this._native&&this._native.log_config.setLogLevelConfig(n)},e.prototype.setLocalLogLevelConfig=function(e){this._localLogLevels=e,this.applyLogLevels()},e.prototype.parseMatcher=function(e){return null==e||null==e.arg||null==e.op||null==e.value?null:{arg:e.arg,op:e.op,value:e.value}},e.prototype.parseCondition=function(e){if(null==e||null==e.logId)return null;if(e.matchers&&!(e.matchers instanceof Array))return null;var t,n={name:e.name||(t=e.logId,(4294967296+t).toString(16).substr(-8)),logId:e.logId,matchers:[]};if(e.matchers&&e.matchers.length)for(var r=0,i=e.matchers;r<i.length;r++){var o=i[r],a=this.parseMatcher(o);a&&n.matchers.push(a)}return n},e.prototype.parseFilter=function(e){return null==e||null==e.component||0===e.component.length?null:{component:e.component,level:e.level,parsedLevel:a.LogFactory.levelFromString(e.level)}},e.prototype.parseConfig=function(e,t,n){if(null==e)return null;if(!(e.conditions instanceof Array)||0==e.conditions.length)return null;if(!(e.filters instanceof Array)||0==e.filters.length)return null;if(e.resetCondition&&!this.parseCondition(e.resetCondition))return null;for(var r={name:e.name||t+"->"+n,ecsNs:t,reenableAfterTriggering:e.reenableAfterTriggering||!1,mutualSubmissionType:e.mutualSubmissionType||"",includeUnsafe:d!==u.PublicBuild&&(e.includeUnsafe||!1),experimentTarget:S(e.experimentTarget)&&e.experimentTarget||this._defaultExperimentTarget,conditions:[],resetCondition:null==e.resetCondition?e.resetCondition:this.parseCondition(e.resetCondition),filters:[]},i=0,o=e.conditions;i<o.length;i++){var a=o[i],s=this.parseCondition(a);s&&r.conditions.push(s)}for(var c=0,l=e.filters;c<l.length;c++){var h=l[c],p=this.parseFilter(h);p&&r.filters.push(p)}return 0===r.conditions.length?null:r},e.prototype.isExperimentListed=function(e,t,n,r){return!!e&&(!(!r||!e.some((function(e){return"*"===e.namespace})))||e.some((function(e){return e.namespace===t&&(e.experiment===n||"*"==e.experiment)})))},e.prototype.isExperimentAllowed=function(e,t,n){return!this.isExperimentListed(e.blacklist,t,n,!0)||this.isExperimentListed(e.whitelist,t,n,!1)},e.prototype.findTrigger=function(e,t){for(var n in e)if(e[n].configEquals(t))return n;return null},e.prototype.findTriggerByNativeConfig=function(e,t){for(var n in e)if(e[n].nativeConfigEquals(t))return n;return null},e.prototype.OnEcsChange=function(){var e=this;return null==this._glue?o.Resolved():this._glue.fetchEcsConfig("SkypeRootTools","ULBaseline").then((function(t){l.debug4("Reloading ULBaseline config - new config: %@",t),t||(l.warn("No ULBaseline config"),t={}),e._maxUploadSize=t.logUpload&&t.logUpload.maxSize||1024;var n=[],r=e._triggers;e._triggers={};var i=(t.logUpload&&t.logUpload.maxSize||1024)/100,u=t.circularBuffer&&t.circularBuffer.enabled,d=t.circularBuffer&&t.circularBuffer.buffers||e._defaultBuffers,p=t.circularBuffer&&t.circularBuffer.storeUnsafe;e._defaultExperimentTarget=S(t.defaultExperimentTarget)&&t.defaultExperimentTarget||"Mixed";var f=t.killswitch||e._defaultKillswitch,g=t.blacklists||e._defaultBlacklists;g.component.length>0&&a.LogFactory.instance().setComponentBlacklist(g.component);var _={};(t.componentLevels||[]).forEach((function(e){return _[e.component]=e.level})),function e(t,n,r){return n<t.length?r(t[n]).then((function(){return e(t,n+1,r)})):o.Resolved()}(t.configPaths||[],0,(function(t){return e._glue.fetchEcsConfig(t.ns,t.key).then((function(i){var o=i instanceof Array?i:[i];l.debug4("Reloading ECS config for %s->%s - new config: %@",t.ns,t.key,o);for(var a=0,s=o;a<s.length;a++){var c=s[a];if(null!=c){var d=e.parseConfig(c,t.ns,t.key);if(null!=d)if("JavaScript"===d.experimentTarget||"Mixed"===d.experimentTarget)if(l.debug2("Parsed ECS config for %s->%s - %@",t.ns,t.key,d),e.isExperimentAllowed(f,t.ns,d.name)){l.debug2("Allowing %s->%s:%s according to killswitch",t.ns,t.key,d.name),u=!0;var h=e.findTrigger(r,d);null!=h?(l.debug2("Triggers updated, keeping trigger %s",d.name),e._triggers[h]=r[h],delete r[h]):n.push(d),d.filters&&d.filters.forEach((function(e){return _[e.component]=Math.min(_[e.component]||255,e.parsedLevel)})),d.includeUnsafe&&(p=!0)}else l.debug2("Disallowing %s->%s according to killswitch",t.ns,t.key);else l.debug4("Skipping %s->%s, targeted for %s",t.ns,t.key,d);else l.error("Failed to parse ECS config for %s->%s",t.ns,t.key)}}}))})).always((function(){for(var t in e.applyLogLevels(),r)l.debug2("Triggers updated, removing trigger %s",r[t].config().name),a.LogFactory.instance().removeAppender(+t);if(n.forEach((function(t){l.debug2("Triggers updated, adding trigger %s",t.name);var n=new v(e,e._triggered,t),r=a.LogFactory.instance().addAppender(n);e._triggers[String(r)]=n})),_[""]=_.root||s.LogLevel.Debug4,delete _.root,!e._circularBuffer||u&&!e._circularBuffer.needReset(p,i)?e._circularBuffer&&(Object.keys(r).length>0||n.length>0?(l.debug2("Buffer updated, reapplying log levels, removing log levels wrapper"),a.LogFactory.instance().removeAppender(e._circularBufferHandle),e._circularBufferHandle=null):l.debug2("Buffer updated, no change")):(l.debug2("Buffer updated, removing existing buffer"),a.LogFactory.instance().removeAppender(e._circularBufferHandle),e._circularBuffer=null,e._circularBufferHandle=null),u&&(e._circularBuffer||(l.debug2("Buffer updated, adding new buffer (storeUnsafe=%d,maxSize=%s)",p,i),e._circularBuffer=new y(p,i)),null==e._circularBufferHandle&&(l.debug2("Creating log level wrapper"),e._circularBufferHandle=a.LogFactory.instance().addAppender(c.wrapAppenderWithLogLevels(e._circularBuffer,_),s.AppenderFlags.InsertFront))),e._native){var o=h(_,(function(e,t){return{component:e,level:t}}));o.sort((function(e,t){return e.component.length-t.component.length})),e._native.log_config.setLogBufferConfig(u,{storeUnsafe:p,buffers:d},o);var f=[];for(var g in e._triggers){var m=e._triggers[g].config();f.push({name:m.name,ecsNs:m.ecsNs,conditions:m.conditions,resetCondition:m.resetCondition,includeUnsafe:m.includeUnsafe,reenableAfterTriggering:m.reenableAfterTriggering,filters:m.filters.map((function(e){return{component:e.component,level:e.parsedLevel}})),dumpFile:!1,metadata:{}})}e._native.log_config.setLogTriggerConfig(f,{})}}))}))},e.prototype._send=function(e,t){null!=this._glue&&(this._glue.sendTelemetry("638b8ba2bae14e07aa5d73ddb5d5e5c5-297b8412-5df3-4a83-83c4-7b76c6c5d3f0-7104",{logTriggerName:e.name,logEcsNs:e.ecsNs,logdata:t}),l.debug4("LogSender::send, sent %d bytes",t.length))},e.prototype.triggered=function(e,t){},e.prototype.triggeredPartially=function(e,t,n,r,i){var o=this.findTriggerByNativeConfig(this._triggers,e);if(o){var s={level:t.level,component:a.LogFactory.instance().component(t.component),timestamp:t.timestamp};this._triggers[o].log(s,n,r,i)}},e.prototype.reset=function(e){var t=this.findTriggerByNativeConfig(this._triggers,e);t&&this._triggers[t].resetConditions()},e.prototype.dumpLogBuffer=function(e,t){if(this._circularBuffer){var n={matchedLines:0,totalLines:0},r=this._circularBuffer.dumpLogBuffer(e,this._maxUploadSize,n);if(l.debug4("dumpLogBuffer: dumped %d of %d lines, size of payload: %d",n.matchedLines,n.totalLines,null!=r?r.length:0),this._native){var i=o.Defer();return this._native.log_config.mergeAndDumpLogBuffer(r,e,t,(function(e){return i.resolve(e)})),i.promise()}return o.Resolved(r)}return l.warn("dumpLogBuffer: no log buffer enabled"),o.Rejected()},e.prototype._triggered=function(e){var t=this,n={compression:s.LogFileCompression.Compress,encoding:s.LogFileEncoding.Base64,encryption:s.LogFileEncryption.Encrypted,maxRotations:0,maxSize:this._maxUploadSize,reverse:!0},r={includeUnsafe:e.includeUnsafe,filter:e.filters.map((function(e){return{component:e.component,level:e.parsedLevel}})),reverse:!0};this.dumpLogBuffer(r,n).then((function(n){return t._send(e,n)}))},e.prototype.sendBRBEvent=function(e){try{if(l.debug2("sendBRBEvent %s",JSON.stringify(e)),null!=this._glue&&"function"==typeof this._glue.sendLoggingEventToNative){var t={eventType:"uploadBRB",mutualSubmissionType:"call",payload:e};this._glue.sendLoggingEventToNative(JSON.stringify(t),"")}}catch(e){l.error("sendBRBEvent %s: %s",e.name,e.message)}},e.prototype.setBRBCallback=function(e){l.debug2("setBRBCallback"),null!=this._glue?"function"==typeof this._glue.setNativeLoggingEventCallback?this._BRBCallback=e:l.warn("setBRBCallback: RootToolsManagerDelegate missing setNativeLoggingEventCallback method"):l.warn("setBRBCallback: RootToolsManagerDelegate is not set")},e.prototype.registerListeners=function(){var e=this;null!=this._glue&&"function"==typeof this._glue.setNativeLoggingEventCallback?this._glue.setNativeLoggingEventCallback((function(t,n){return e.handleNativeLoggingEvent(t,n)})):l.warn("registerListeners: RootToolsManagerDelegate missing setNativeLoggingEventCallback method")},e.prototype.handleNativeLoggingEvent=function(e,t){try{l.debug2("Native Log event message: %s aux: %s",e,t);var n=JSON.parse(e);if(n.eventType&&"uploadBRB"===n.eventType){if("function"!=typeof this._BRBCallback)return void l.warn("BRBCallback not set, ignoring native event");l.debug4("Sending BRB callback: %@",n.payload),this._BRBCallback(n.payload)}else n.eventType&&"jsLogFileConfiguration"===n.eventType&&this.handleLogFileConfigEvent(n)}catch(e){l.error("handleNativeLoggingEvent %s: %s",e.name,e.message)}},e.prototype.handleLogFileConfigEvent=function(e){if(e.payload){var t=e.payload;if(t.enabled){if(t.chunkSize&&t.flushInterval){var n=t.chunkSize,r=t.flushInterval;this.startJsToNativeLogging(n,r)}}else this.flushDisableJsToNativeLogging()}},e.prototype.logExternalForDDL=function(e,t){try{if(l.debug2("logExternalForDDL %s %s",e,t),null!=this._glue&&"function"==typeof this._glue.sendLoggingEventToNative){var n={eventType:"logInSClog",payload:{message:e,parameters:t}};this._glue.sendLoggingEventToNative(JSON.stringify(n),"")}else l.warn("ignoring logExternalForDDL, delegate misconfigured")}catch(e){l.error("logExternalForDDL %s: %s",e.name,e.message)}},e.prototype.startJsToNativeLogging=function(e,t){var n=this;if(this._jsToNativeBuffer){if(this._jsToNativeBuffer.capacity()===e&&this._jsToNativeFlushInterval===t)return void l.debug1("Same JS2Native settings received - doing nothing");l.debug1("Reapplying js to native settings"),this.flushDisableJsToNativeLogging()}this._jsToNativeBuffer=new y(!0,e,(function(){n.onJsToNativeBufferReady(n._jsToNativeBuffer)})),this.setJsToNativeFlushTimeout(t),this._jsToNativeFlushInterval=t,this._jsToNativeBufferHandle=a.LogFactory.instance().addAppender(this._jsToNativeBuffer)},e.prototype.flushDisableJsToNativeLogging=function(){this._jsToNativeBuffer&&this.onJsToNativeBufferReady(this._jsToNativeBuffer),this.plainDisableJsToNativeLogging()},e.prototype.plainDisableJsToNativeLogging=function(){this.clearJsToNativeFlushTimeout(),this._jsToNativeBufferHandle&&(a.LogFactory.instance().removeAppender(this._jsToNativeBufferHandle),this._jsToNativeBufferHandle=0,this._jsToNativeBuffer=null,l.debug1("Disabling forwarding JS logs to native"))},e.prototype.onJsToNativeBufferReady=function(e){null!=this._glue&&"function"==typeof this._glue.sendLoggingEventToNative?(this.clearJsToNativeFlushTimeout(),this.dumpJsToNativeBuffer(e),this.setJsToNativeFlushTimeout(this._jsToNativeFlushInterval)):this.plainDisableJsToNativeLogging()},e.prototype.dumpJsToNativeBuffer=function(e){if(!e.empty()){var t=e.dumpLogBuffer({reverse:!1,filter:[{component:"root",level:0}]});e.clear();this._glue.sendLoggingEventToNative(JSON.stringify({eventType:"writeLogData"}),t)}},e.prototype.clearJsToNativeFlushTimeout=function(){this._jsToNativeFlushTimer&&(clearTimeout(this._jsToNativeFlushTimer),this._jsToNativeFlushTimer=null)},e.prototype.setJsToNativeFlushTimeout=function(e){var t=this;!this._jsToNativeFlushTimer&&e&&(this._jsToNativeFlushTimer=setTimeout((function(){t._jsToNativeFlushTimer=null,t.onJsToNativeBufferReady(t._jsToNativeBuffer)}),e))},e.prototype.stopAsyncOperations=function(){this.flushDisableJsToNativeLogging()},e}();t.RootToolsManager=new I},function(e,t,n){"use strict";function r(e){return null!=e&&"function"==typeof e.then}function i(e){return null!=e&&"function"==typeof e.cancel}function o(e,n){if(!t.config.catchExceptions)return e();try{return e()}catch(e){return n(e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.config={exceptionsToConsole:!0,catchExceptions:!0,traceEnabled:!1,exceptionHandler:void 0,unhandledErrorHandler:function(e){throw e}},t.fromThenable=function(e){var t=d();return e.then((function(e){t.resolve(e)}),(function(e){t.reject(e)})),t.promise().thenAsync((function(e){return e}))};var a,s=[],c="undefined"!=typeof setImmediate;function l(e){s.push(e),1===s.length&&(c?setImmediate(u):setTimeout(u,0))}function u(){var e=s;s=[];for(var t=0;t<e.length;t++)e[t]()}function d(){return new a.SyncTask}function h(e){return(new a.SyncTask).resolve(e).promise()}function p(e){var t=d(),n=!1;return t.onCancel((function(t){e.forEach((function(e){i(e)&&a.SyncTask.cancelOtherInternal(e,t)}))})),e.forEach((function(e){r(e)?e.then((function(e){n||(n=!0,t.resolve(e))}),(function(e){n||(n=!0,t.reject(e))})):n||(n=!0,t.resolve(e))})),t.promise()}t.asyncCallback=l,function(e){var n=function(){function e(){this._completedSuccess=!1,this._completedFail=!1,this._traceEnabled=!1,this._cancelCallbacks=[],this._wasCanceled=!1,this._wasExplicitlyCanceled=!1,this._resolving=!1,this._storedCallbackSets=[],this._mustHandleError=!0}return e.prototype._addCallbackSet=function(t,n){var r=this,i=new e;return i.onCancel((function(e){t.wasCanceled=!0,t.cancelContext=e,r._cancelInternal(e)})),t.task=i,this._storedCallbackSets.push(t),n?this._mustHandleError=!1:i._mustHandleError=!1,this._resolving||(this._completedSuccess?this._resolveSuccesses():this._completedFail&&this._resolveFailures()),i.promise()},e.prototype.onCancel=function(e){return this._completedSuccess||this._completedFail||(this._wasCanceled?e(this._cancelContext):this._cancelCallbacks.push(e)),this},e.prototype.then=function(e,t){return this._addCallbackSet({successFunc:e,failFunc:t},!0)},e.prototype.thenAsync=function(e,t){return this._addCallbackSet({successFunc:e,failFunc:t,asyncCallback:!0},!0)},e.prototype.catch=function(e){return this._addCallbackSet({failFunc:e},!0)},e.prototype.always=function(e){return this._addCallbackSet({successFunc:e,failFunc:e},!0)},e.prototype.setTracingEnabled=function(e){return this._traceEnabled=e,this},e.prototype.finally=function(e){return this._addCallbackSet({successFunc:e,failFunc:e},!1),this},e.prototype.done=function(e){return this._addCallbackSet({successFunc:e},!1),this},e.prototype.fail=function(e){return this._addCallbackSet({failFunc:e},!1),this},e.prototype.resolve=function(e){return this._checkState(!0),this._completedSuccess=!0,this._storedResolution=e,this._cancelCallbacks=[],this._resolveSuccesses(),this},e.prototype.reject=function(t){return this._checkState(!1),this._completedFail=!0,this._storedErrResolution=t,this._cancelCallbacks=[],this._resolveFailures(),e._enforceErrorHandled(this),this},e.prototype._checkState=function(e){if(this._completedSuccess||this._completedFail){this._completeStack&&console.error(this._completeStack.message,this._completeStack.stack);var n="Failed to "+(e?"resolve":"reject")+": the task is already "+(this._completedSuccess?"resolved":"rejected");throw new Error(n)}(t.config.traceEnabled||this._traceEnabled)&&(this._completeStack=new Error("resolve"))},e._enforceErrorHandled=function(n){n._mustHandleError&&(e._rejectedTasks.push(n),e._enforceErrorHandledTimer||(e._enforceErrorHandledTimer=setTimeout((function(){e._enforceErrorHandledTimer=void 0;var n=e._rejectedTasks;e._rejectedTasks=[],n.forEach((function(e,n){e._mustHandleError&&t.config.unhandledErrorHandler(e._storedErrResolution)}))}),0)))},e.prototype.cancel=function(e){if(this._wasExplicitlyCanceled)throw new Error("Already Canceled");this._wasExplicitlyCanceled=!0,this._cancelInternal(e)},e.prototype._cancelInternal=function(e){var t=this;if(!this._wasCanceled){this._wasCanceled=!0,this._cancelContext=e;var n=this._cancelCallbacks;this._cancelCallbacks=[],n.length>0&&n.forEach((function(e){t._completedSuccess||t._completedFail||e(t._cancelContext)}))}},e.cancelOtherInternal=function(e,t){var n=e;n._storedCallbackSets&&n._cancelInternal?n._cancelInternal(t):e.cancel(t)},e.prototype.promise=function(){return this},e.prototype._resolveSuccesses=function(){var e=this;for(this._resolving=!0;this._storedCallbackSets.length;){var t=this._storedCallbackSets;this._storedCallbackSets=[],t.forEach((function(t){t.asyncCallback?l((function(){return e._resolveSuccessCallback(t)})):e._resolveSuccessCallback(t)}))}this._resolving=!1},e.prototype._resolveSuccessCallback=function(t){var n=this;t.successFunc?o((function(){var o=t.successFunc(n._storedResolution);i(o)&&(t.wasCanceled?e.cancelOtherInternal(o,t.cancelContext):t.task.onCancel((function(t){return e.cancelOtherInternal(o,t)}))),r(o)?o.then((function(e){t.task.resolve(e)}),(function(e){t.task.reject(e)})):t.task.resolve(o)}),(function(e){n._handleException(e,"SyncTask caught exception in success block: "+e.toString()),t.task.reject(e)})):t.task.resolve(this._storedResolution)},e.prototype._resolveFailures=function(){var e=this;for(this._resolving=!0;this._storedCallbackSets.length;){var t=this._storedCallbackSets;this._storedCallbackSets=[],t.forEach((function(t){t.asyncCallback?l((function(){return e._resolveFailureCallback(t)})):e._resolveFailureCallback(t)}))}this._resolving=!1},e.prototype._resolveFailureCallback=function(t){var n=this;t.failFunc?o((function(){var o=t.failFunc(n._storedErrResolution);i(o)&&(t.wasCanceled?e.cancelOtherInternal(o,t.cancelContext):t.task.onCancel((function(t){return e.cancelOtherInternal(o,t)}))),r(o)?o.then((function(e){t.task.resolve(e)}),(function(e){t.task.reject(e)})):t.task.resolve(o)}),(function(e){n._handleException(e,"SyncTask caught exception in failure block: "+e.toString()),t.task.reject(e)})):t.task.reject(this._storedErrResolution)},e.prototype._handleException=function(e,n){t.config.exceptionsToConsole&&console.error(n),t.config.exceptionHandler&&t.config.exceptionHandler(e)},e.prototype.toEs6Promise=function(){var e=this;return new Promise((function(t,n){return e.then(t,n)}))},e._rejectedTasks=[],e}();e.SyncTask=n}(a||(a={})),t.all=function(e){if(0===e.length)return h([]);var t,n=d(),o=e.length,s=Array(e.length);n.onCancel((function(t){e.forEach((function(e){i(e)&&a.SyncTask.cancelOtherInternal(e,t)}))}));var c=function(){0==--o&&(void 0!==t?n.reject(t):n.resolve(s))};return e.forEach((function(e,n){r(e)?e.then((function(e){s[n]=e,c()}),(function(e){void 0===t&&(t=void 0===e||e),c()})):(s[n]=e,c())})),n.promise()},t.Defer=d,t.Resolved=h,t.Rejected=function(e){return(new a.SyncTask).reject(e).promise()},t.race=p,t.raceTimer=function(e,t){var n=d(),r=setTimeout((function(){n.resolve({timedOut:!0})}),t);return p([e.then((function(e){return clearTimeout(r),{timedOut:!1,result:e}})),n.promise()])}},function(e,t,n){"use strict";
/*!
 *  pii.ts
 *  AUF
 *
 *  Created by Johan Blumenberg on 2017-01-16
 *  Copyright 2017 Microsoft. All rights reserved.
 *
 */Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){return e},i=!0,o=r,a={},s=0;var c,l=/^([0-9][0-9]?):([^<>\*\{\}&'\"\/\\?^`|~\s]+)$/;!function(e){e[e.MSA=1]="MSA",e[e.S4B_Bridge=2]="S4B_Bridge",e[e.PSTN=4]="PSTN",e[e.SkypeId=8]="SkypeId",e[e.Thread=19]="Thread",e[e.LegacyShortCircuit=20]="LegacyShortCircuit",e[e.OneToOneTextMessage=21]="OneToOneTextMessage",e[e.GroupTextMessage=22]="GroupTextMessage",e[e.Bot=28]="Bot",e[e.InternalSkype=48]="InternalSkype"}(c||(c={}));var u=[c.Thread,c.InternalSkype,c.Bot];t.enableAnonymization=function(e){i=e},t.useTagger=function(e){o=e||r},function(e){function t(e){return i?e?a[e]||function(e){return a[e]="u"+ ++s}(e):null:e}e.UserName=function(e){var n=t(e);return o(n)},e.Mri=function(e){var n,r=e.match(l);if(r){var i=Number(r[1]),a=r[2];n=-1!=u.indexOf(i)?e:i+":"+t(a)}else n=t(e);return o(n)},e.Omit=function(e){var t;return t=i?"number"==typeof e?19229:"string"==typeof e?e.charAt(0)+"...":null:e,o(t)}}(t.pii||(t.pii={}))},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{c(r.next(e))}catch(e){o(e)}}function s(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(75),o=n(76),a=n(12),s=n(79);t.PLATFORMS={"win32-ia32":922,"win32-x64":923,"linux-x64":924,"darwin-x64":925},t.getVSLSTokenFromAuthService=function(e){return r(this,void 0,void 0,(function*(){const e={hostname:"authsvc-server.teams.microsoft.com",port:443,path:"/v1.0/authz/visitor",method:"POST",headers:{"Content-Type":"application/json","x-ms-request-id":o(),"x-ms-client-type":s.name}},t=JSON.stringify({tenantId:"72f988bf-86f1-41af-91ab-2d7cd011db47"});let n;const r=new a.DeferredPromise;let c="";const l=i.request(e,e=>{200===e.statusCode?(e.setEncoding("utf8"),e.on("data",e=>{c+=e}),e.on("end",(function(){const e=JSON.parse(c);n=e.tokens,r.resolve()}))):r.reject("Expected 200 status code to get SkypeToken. status code: "+e.statusCode)});if(l.on("error",e=>{r.reject("HTTPS request failed for SkypeToken: "+e.message)}),l.write(t),l.end(),yield r.promise.catch(e=>{throw new Error(e)}),!n)throw new Error("Error retrieving SkypeToken");return n.skypeId=function(e){try{const t=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),n=JSON.parse(Buffer.from(t,"base64").toString("ascii"));if(!n.skypeid)throw new Error("skypeid claim not found");return n.skypeid}catch(e){throw new Error("Cannot retrieve skypeid from token: "+e.message)}}(n.skypeToken),n}))},t.getNormalizedVersion=function(){let e=s.version;return-1!==e.indexOf("-")?(e=e.substr(0,e.indexOf("-")),e+".999"):e+".0"}},function(e,t){e.exports=require("https")},function(e,t,n){var r=n(77),i=n(78),o=i;o.v1=r,o.v4=i,e.exports=o},function(e,t,n){var r,i,o=n(63),a=n(64),s=0,c=0;e.exports=function(e,t,n){var l=t&&n||0,u=t||[],d=(e=e||{}).node||r,h=void 0!==e.clockseq?e.clockseq:i;if(null==d||null==h){var p=o();null==d&&(d=r=[1|p[0],p[1],p[2],p[3],p[4],p[5]]),null==h&&(h=i=16383&(p[6]<<8|p[7]))}var f=void 0!==e.msecs?e.msecs:(new Date).getTime(),g=void 0!==e.nsecs?e.nsecs:c+1,_=f-s+(g-c)/1e4;if(_<0&&void 0===e.clockseq&&(h=h+1&16383),(_<0||f>s)&&void 0===e.nsecs&&(g=0),g>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");s=f,c=g,i=h;var m=(1e4*(268435455&(f+=122192928e5))+g)%4294967296;u[l++]=m>>>24&255,u[l++]=m>>>16&255,u[l++]=m>>>8&255,u[l++]=255&m;var v=f/4294967296*1e4&268435455;u[l++]=v>>>8&255,u[l++]=255&v,u[l++]=v>>>24&15|16,u[l++]=v>>>16&255,u[l++]=h>>>8|128,u[l++]=255&h;for(var y=0;y<6;++y)u[l+y]=d[y];return t||a(u)}},function(e,t,n){var r=n(63),i=n(64);e.exports=function(e,t,n){var o=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var a=(e=e||{}).random||(e.rng||r)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var s=0;s<16;++s)t[o+s]=a[s];return t||i(a)}},function(e){e.exports=JSON.parse('{"name":"vsliveshare-audio","displayName":"Live Share Audio","description":"Adds audio calling capabilities to Visual Studio Live Share","version":"0.1.49-598708e700","publisher":"ms-vsliveshare","preview":true,"license":"SEE LICENSE IN LICENSE.txt","icon":"images/icon.png","homepage":"https://aka.ms/vsls-audio","bugs":{"url":"https://aka.ms/vsls-issues","email":"vsls-feedback@microsoft.com"},"engines":{"vscode":"^1.21.0"},"keywords":["Collaboration","Voice","Sharing","Audio","Call"],"categories":["Other"],"aiKey":"AIF-d9b70cd4-b9f9-4d70-929b-a071c400b217","activationEvents":["onFileSystemAccess:vsls","*"],"repository":{"url":"https://github.com/MicrosoftDocs/live-share"},"main":"./out/extension","contributes":{"commands":[{"command":"liveshare.audio.installRecovery","title":"Repair Audio Installation","category":"Live Share"},{"command":"liveshare.audio.startOrJoinAudio","title":"Start or Join Audio Call","category":"Live Share","vsls-label":"$(unmute) Start or Join Audio Call","vsls-detail":"Enable audio for the Live Share session."},{"command":"liveshare.audio","title":"Call Settings","category":"Live Share","vsls-label":"$(unmute) Manage Call Settings","vsls-detail":"Mute/unmute, select audio devices, or disconnect from the call.","icon":{"dark":"images/dark/gear.svg","light":"images/light/gear.svg"}},{"command":"liveshare.audio.muteSelf","title":"Mute Yourself","category":"Live Share","icon":{"dark":"images/dark/speaker-mute.svg","light":"images/light/speaker-mute.svg"}},{"command":"liveshare.audio.unmuteSelf","title":"Unmute Yourself","category":"Live Share","icon":{"dark":"images/dark/speaker.svg","light":"images/light/speaker.svg"}},{"command":"liveshare.audio.leaveAudio","title":"Disconnect Audio Call","category":"Live Share","icon":{"dark":"images/stop.svg","light":"images/stop.svg"}}],"configuration":{"type":"object","title":"Live Share Audio","properties":{"liveshare.audio.joinCallBehavior":{"type":"string","default":"prompt","description":"Controls how to respond when an audio call is started.","enum":["accept","prompt"]},"liveshare.audio.startCallOnShare":{"type":"boolean","default":false,"description":"Controls whether to automatically start an audio call whenever you share."}}},"menus":{"commandPalette":[{"command":"liveshare.audio.startOrJoinAudio","when":"liveshare.audio:state == LiveShareWithoutAudio"},{"command":"liveshare.audio","when":"liveshare.audio:state == LiveShareWithAudio"}],"view/item/context":[{"command":"liveshare.audio","when":"view =~ /^liveshare\\\\.session(\\\\.explorer)?$/ && viewItem == audio.participants","group":"inline"},{"command":"liveshare.audio.leaveAudio","when":"view =~ /^liveshare\\\\.session(\\\\.explorer)?$/ && viewItem == audio.participants","group":"inline"},{"command":"liveshare.audio.muteSelf","when":"view =~ /^liveshare\\\\.session(\\\\.explorer)?$/ && viewItem == audio.self","group":"inline"},{"command":"liveshare.audio.unmuteSelf","when":"view =~ /^liveshare\\\\.session(\\\\.explorer)?$/ && viewItem == audio.self.muted","group":"inline"},{"command":"liveshare.audio","when":"view =~ /^liveshare\\\\.session(\\\\.explorer)?$/ && viewItem == audio.participants","group":"navigation"},{"command":"liveshare.audio.leaveAudio","when":"view =~ /^liveshare\\\\.session(\\\\.explorer)?$/ && viewItem == audio.participants","group":"navigation"},{"command":"liveshare.audio.muteSelf","when":"view =~ /^liveshare\\\\.session(\\\\.explorer)?$/ && viewItem == audio.self","group":"navigation"},{"command":"liveshare.audio.unmuteSelf","when":"view =~ /^liveshare\\\\.session(\\\\.explorer)?$/ && viewItem == audio.self.muted","group":"navigation"}]}},"scripts":{"vscode:prepublish":"npm run compile","compile":"tsc -p ./ && cpx ./src/calling/externalApp/{package.json,LiveShare.png,styles.css} ./out/calling/externalApp/dist","watch":"tsc -watch -p ./","webpack":"node ./node_modules/webpack/bin/webpack.js --config ./webpack.config.js","package":"node ./node_modules/vsce/out/vsce package","postinstall":"node ./node_modules/vscode/bin/install"},"devDependencies":{"@types/lodash":"^4.14.109","@types/mocha":"^2.2.42","copy-webpack-plugin":"^6.0.3","cpx":"^1.5.0","gulp":"^4.0.2","gulp-decompress":"^3.0.0","gulp-prompt":"^1.2.0","gulp-tslint":"^8.1.3","keytar":"^6.0.1","minimist":"^1.2.5","nerdbank-gitversioning":"^2.1.7","request":"^2.87.0","ts-loader":"^4.4.2","tslint":"^6.1.3","typescript":"^2.6.1","unzip":"^0.1.11","vsce":"^1.79.1","vscode":"^1.1.37","webpack":"^4.44.1","webpack-cli":"^3.3.5","yargs":"^12.0.1"},"dependencies":{"electron":"file:external/electron","dynamicloader":"file:external/dynamicloader","extract-zip":"^2.0.1","dateformat":"^3.0.3","download":"^8.0.0","fs-extra":"^6.0.1","glob":"^7.1.2","lockfile":"^1.0.4","lodash":"^4.17.20","semver":"^5.5.0","tar":"^6.0.5","tmp":"0.0.33","uuid":"^3.2.1","vscode-extension-telemetry":"0.1.0","vsls":"^0.3.967","vscode-jsonrpc":"^3.3.1","skype-calling-electron-embedded":"file:external/skype-calling-electron-embedded","@skype/skype-calling-electron":"^2019.35.0-0.5-8f105","@skype/skype-calling-interface":"^2019.35.0-0.5-8f105","@skype/rt-js-bindings":"^2019.35.0-0.5-8f105","@types/node":"^11.13.7"},"extensionDependencies":["ms-vsliveshare.vsliveshare"],"runtimeDependencies":[{"code":"electron-4.2.7","description":"electron-win-ia32-skype-4.2.7","url":"https://callingcdndev.blob.core.windows.net/electron/electron-win-ia32-signed/skype-4.2.7/3168415/electron.zip","platforms":["win32"],"architectures":["ia32"],"installPath":"./electron-4.2.7/dist","unpackPath":"../../temp","packageRootPath":"","installTestPath":"./electron-4.2.7/dist/electron.exe","checksum":"c26692fef51f3a3d0d3c743b85de9c90b9727167"},{"code":"electron-4.2.7","description":"electron-win-x64-skype-4.2.7","url":"https://callingcdndev.blob.core.windows.net/electron/electron-win-x64-signed/skype-4.2.7/3168415/electron.zip","platforms":["win32"],"architectures":["x64"],"installPath":"./electron-4.2.7/dist","unpackPath":"../../temp","packageRootPath":"","installTestPath":"./electron-4.2.7/dist/electron.exe","checksum":"e92d87e69cb4eb1931bbf1a4a0dcb999979635cb"},{"code":"electron-4.2.7","description":"electron-lin-x64-skype-4.2.7","url":"https://callingcdndev.blob.core.windows.net/electron/electron-lin-x64/skype-4.2.7/3168415/electron.zip","platforms":["linux"],"architectures":["x64"],"installPath":"./electron-4.2.7/dist","unpackPath":"../../temp","packageRootPath":"","installTestPath":"./electron-4.2.7/dist/electron","chmod":"755","chmodPaths":["electron"],"checksum":"d236d1a5f3bf626e6e65ac184a5070b261e5aa10"},{"code":"electron-4.2.12","description":"electron-electron-mac-x64-skype-4.2.12","url":"https://callingcdndev.blob.core.windows.net/electron/electron-mac-x64/skype-4.2.12/3664656/electron.zip","platforms":["darwin"],"architectures":["x64"],"installPath":"./electron-4.2.12/dist","unpackPath":"../../temp","packageRootPath":"","installTestPath":"./electron-4.2.12/dist/Electron.app/Contents/MacOS/Electron","checksum":"48000e7657bb661500c4df035a166ebd9f58c1a1"},{"code":"slimcore-4.0.2019.37.01.4","description":"slimcore-electron-2019.37.01.4.tgz","url":"https://callingcdndev.blob.core.windows.net/slimcore/linux-x64_gcc-skype-4.0-release/2019.37.01.4/slimcore-electron-2019.37.01.4.tgz","platforms":["linux"],"architectures":["x64"],"installPath":"./slimcore-4.0.2019.37.01.4","unpackPath":"../temp","packageRootPath":"package","installTestPath":"./slimcore-4.0.2019.37.01.4/package.json","checksum":"0940aa5ff1685a4e1d71197c8ce8f9a0606d66da"},{"code":"slimcore-4.0.2019.23.01.7","description":"slimcore-electron-signed-2019.23.01.7.zip","url":"https://callingcdndev.blob.core.windows.net/slimcore/macosx-x64_clang-libcxx-electron-4.0-release/2019.23.01.7/slimcore-electron-signed-2019.23.01.7.zip","platforms":["darwin"],"architectures":["x64"],"installPath":"./slimcore-4.0.2019.23.01.7","unpackPath":"../temp","packageRootPath":"package","installTestPath":"./slimcore-4.0.2019.23.01.7/package.json","checksum":"0aa4efe6345c77a0c5a5892177f1bef30209e822"},{"code":"slimcore-4.0.2019.37.01.4","description":"slimcore-electron-signed-2019.37.01.4.tgz","url":"https://callingcdndev.blob.core.windows.net/slimcore/win-x64_vs2017-crtdynamic-skype-4.0-release/2019.37.01.4/slimcore-electron-signed-2019.37.01.4.tgz","platforms":["win32"],"architectures":["x64"],"installPath":"./slimcore-4.0.2019.37.01.4","unpackPath":"../temp","packageRootPath":"package","installTestPath":"./slimcore-4.0.2019.37.01.4/package.json","checksum":"8f8726e42019c594a4c1ef54dfbcb5eb3e6cd509"},{"code":"slimcore-4.0.2019.37.01.4","description":"slimcore-electron-signed-2019.37.01.4.tgz","url":"https://callingcdndev.blob.core.windows.net/slimcore/win-x86_vs2017-crtdynamic-skype-4.0-release/2019.37.01.4/slimcore-electron-signed-2019.37.01.4.tgz","platforms":["win32"],"architectures":["ia32"],"installPath":"./slimcore-4.0.2019.37.01.4","unpackPath":"../temp","packageRootPath":"package","installTestPath":"./slimcore-4.0.2019.37.01.4/package.json","checksum":"bfdb8fb9a2f8440402fc2fb72a65e04e5a6bf486"}]}')},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(81);let{remote:i}=n(10);t.default=class{constructor(e,t,n,r){this.call=e,this.isScreenShareControlEnabled=n,this.trace=r,this.logPrefix="[Call]",this.participantMap={},this.callbacks=[],this.videoContexts={},this.isVideoStreamContextAvailable=!1,this.callbacks.push(this.call.changed(()=>{r.info(`${this.logPrefix} Call changed: ${this.call.callId}, ${this.call}`),t||(this.checkParticipants(this.call.participants),this.cleanVideoContexts())}))}get isVideoStreamAvailable(){return this.isVideoStreamContextAvailable}set isVideoStreamAvailable(e){this.isVideoStreamContextAvailable=e}stop(){this.isActiveCall()&&this.call.stop().then(()=>this.trace.info(`${this.logPrefix} Call finished, state: ${this.call.state}, reason:${this.call.terminatedReason} `)).catch(e=>this.trace.error(`${this.logPrefix} stop failed: ${e}`))}isMuted(){return!this.call||(this.call.isMuted||this.call.isServerMuted)}mute(){this.isActiveCall()&&this.call.mute().catch(e=>this.trace.error(`${this.logPrefix} mute failed: ${e}`))}unmute(){this.isActiveCall()&&this.call.unmute().catch(e=>this.trace.error(`${this.logPrefix} unmute failed: ${e}`))}showWindow(){if(this.isVideoStreamAvailable){i.getCurrentWindow().show()}}hideWindow(){i.getCurrentWindow().hide()}muteAll(){this.isActiveCall()&&this.call.muteParticipants(0,[]).catch(e=>this.trace.error(`${this.logPrefix} muteAll failed: ${e}`))}muteSpeaker(){this.isActiveCall()&&this.call.muteSpeaker().catch(e=>this.trace.error(`${this.logPrefix} muteSpeaker failed: ${e}`))}unmuteSpeaker(){this.isActiveCall()&&this.call.unmuteSpeaker().catch(e=>this.trace.error(`${this.logPrefix} unmuteSpeaker failed: ${e}`))}hold(){this.isActiveCall()&&this.call.hold().catch(e=>this.trace.error(`${this.logPrefix} hold failed: ${e}`))}unhold(){this.isActiveCall()&&this.call.unhold().catch(e=>this.trace.error(`${this.logPrefix} unhold failed: ${e}`))}reconnect(){this.call&&this.call.reconnect().catch(e=>this.trace.error(`${this.logPrefix} reconnect failed: ${e}`))}getCall(){return this.call}getCallInfo(){return this.call?{callId:this.call.callId,state:this.call.state,threadId:this.call.threadId}:null}isActiveCall(){return this.call&&7!==this.call.state&&6!==this.call.state}dispose(){this.trace.info(this.logPrefix+" call wrapper dispose start"),this.call.isVideoOn&&this.call.stopVideo(),this.callbacks.forEach(e=>e.dispose()),this.call=null,this.cleanVideoContexts(),Object.keys(this.participantMap).forEach(e=>{this.trace.info(`${this.logPrefix} disposing participant with id ${e}`),this.participantMap[e].dispose()}),this.participantMap={},this.hideWindow(),this.trace.info(this.logPrefix+" call wrapper dispose end")}checkParticipants(e){const t=e.filter(e=>!this.participantMap[e.id]),n=Object.keys(this.participantMap).filter(t=>!e.filter(e=>e.id===t).length);t.length&&(this.trace.info(`${this.logPrefix} new participants: ${t}`),t.forEach(e=>{this.participantMap[e.id]=new r.default(e,this,this.trace)})),n.length&&(this.trace.info(`${this.logPrefix} removed participants: ${n}`),n.forEach(e=>{this.participantMap[e].dispose(),delete this.participantMap[e]}))}cleanVideoContexts(){const e=[],t=this.call&&this.call.mediaStreams;for(const n of Object.keys(this.videoContexts)){const r=t&&t[0].some(e=>e.id===Number(n)),i=t&&t[1].some(e=>e.id===Number(n));r||i||e.push(this.videoContexts[n])}for(const t of e)t.reset&&t.reset()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(28),i=n(82),o=n(7);let{remote:a}=n(10);t.default=class{constructor(e,t,n){if(this.participant=e,this.call=t,this.trace=n,this.logPrefix="[Participant]",this.videoContexts=[],this.screenShareContext=new i.default(null),this.trace.info(`${this.logPrefix} Adding new participant with id: ${e.id}, isScreenShareControlEnabled: ${t.isScreenShareControlEnabled}`),t.isScreenShareControlEnabled){t.getCall().screenSharingControl.setRemotePointerImage(e,o.avatarBase64),this.checkStreams()}this.changedCallback=this.participant.changed(()=>{n.info(`${this.logPrefix} participant changed: ${this.participant.id} ${this.participant.state}`),this.checkStreams()})}dispose(){this.trace.info(`${this.logPrefix} Disposing participant ${this.participant.id}`),r.each(this.videoContexts,e=>this.removeContext(e)),this.screenShareContext.reset(),this.changedCallback.dispose(),this.participant=null}removeContext(e){e.reset&&e.reset(),r.remove(this.videoContexts,t=>t===e)}getContext(e){return r.find(this.videoContexts,t=>t.stream.id===e)}checkContext(e){this.trace.info(this.logPrefix+" check context start"),e&&e.stream&&(this.trace.info(`${this.logPrefix} isAvailable: ${e.stream.isAvailable}, context.renderer: ${e.renderer}, context.starting: ${e.starting}`),!e.stream.isAvailable||e.renderer||e.starting?e&&!e.stream.isAvailable&&e.renderer&&(this.trace.info(`${this.logPrefix} Participant ${this.participant.id} removing renderer`),this.call.isVideoStreamAvailable=!1,this.call.hideWindow(),this.removeContext(e)):(this.trace.info(`${this.logPrefix} Participant ${this.participant.id} stream ID ${e.stream.id} available, starting...`),e.init(),e.stream.start(e.container).then(t=>{e.starting=!1,e.renderer=t,this.trace.info(this.logPrefix+" setRenderer on screen sharing control");this.call.getCall().screenSharingControl.setRenderer(t),t.on("videoSizeChanged",(e,t)=>{this.trace.info(`${this.logPrefix} videoSizeChanged queued: renderer${e} size:${t}`),a.getCurrentWindow().setSize(e,t+30,!0)}),this.trace.info(this.logPrefix+" show screen share window"),this.call.isVideoStreamAvailable=!0,this.call.showWindow(),this.trace.info(`${this.logPrefix} Participant ${this.participant.id} new remote renderer: ${t}`)}).catch(e=>this.trace.error(`${this.logPrefix} Unable to start participant ${this.participant.id} video stream: ${e}`)))),this.trace.info(this.logPrefix+" check context end")}checkStreams(){this.trace.info(this.logPrefix+" checkStreams start");for(const e of this.videoContexts)e&&e.renderer&&!this.participant.streams[0].some(t=>t.id===e.stream.id)&&(this.trace.info(`${this.logPrefix} Participant ${this.participant.id} removing obsolete renderer`),this.removeContext(e));this.participant.streams[0].forEach(e=>{let t=this.getContext(e.id);this.trace.info(`${this.logPrefix} Adding video stream context: context: ${t}, isStreamAvailable: ${e.isAvailable}`),!t&&e.isAvailable&&(t=new i.default(e),this.videoContexts.push(t)),this.checkContext(t)}),this.screenShareContext.stream=r.head(this.participant.streams[1]),this.checkContext(this.screenShareContext),this.trace.info(this.logPrefix+" checkStreams end")}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e){this.stream=e,this.starting=!1}reset(){this.renderer&&(this.renderer.dispose(),this.renderer=void 0),this.container&&(this.container=void 0),this.starting=!1}init(){(this.renderer||this.container)&&this.reset(),this.container=document.createElement("div"),this.container.id="remoteVideo",this.container.className="video",document.body.appendChild(this.container),this.starting=!0}}}]);
//# sourceMappingURL=app-bundle.js.map